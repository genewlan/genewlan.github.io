<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0"><title>ggplot_picture_bioinformation | GeneWlan</title><meta name="author" content="ZhangLei"><meta name="copyright" content="ZhangLei"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="[TOC]  代码参考【来源于ocima公众号】 两组显著性差异图** 1234567891011121314151617181920##显著性差异图rm(list &#x3D; ls())Normal &lt;- c(0.83, 0.79, 0.99, 0.69)Cancer &lt;- c(0.56, 0.56, 0.64, 0.52) m &lt;- c(mean(Normal), mean(Canc">
<meta property="og:type" content="article">
<meta property="og:title" content="ggplot_picture_bioinformation">
<meta property="og:url" content="http://genewlan.github.io/2023/10/31/ggplot-picture/index.html">
<meta property="og:site_name" content="GeneWlan">
<meta property="og:description" content="[TOC]  代码参考【来源于ocima公众号】 两组显著性差异图** 1234567891011121314151617181920##显著性差异图rm(list &#x3D; ls())Normal &lt;- c(0.83, 0.79, 0.99, 0.69)Cancer &lt;- c(0.56, 0.56, 0.64, 0.52) m &lt;- c(mean(Normal), mean(Canc">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png">
<meta property="article:published_time" content="2023-10-31T09:08:06.000Z">
<meta property="article:modified_time" content="2023-10-31T09:12:39.996Z">
<meta property="article:author" content="ZhangLei">
<meta property="article:tag" content="ggplot">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://genewlan.github.io/2023/10/31/ggplot-picture/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  }
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'ggplot_picture_bioinformation',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-10-31 17:12:39'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><!-- hexo injector head_end start -->
    <style>
      #background-effect {
        position: fixed !important;
        top: 0px;
        left: 0px;
        z-index: -1;
        width: 100%;
        height: 100%
      }
    </style>
  <!-- hexo injector head_end end --><meta name="generator" content="Hexo 5.4.2"><link rel="alternate" href="/atom.xml" title="GeneWlan" type="application/atom+xml">
<link href="https://cdn.bootcss.com/KaTeX/0.11.1/katex.min.css" rel="stylesheet" /></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">30</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">23</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://s2.loli.net/2023/03/21/ZVUmQFknE2JosXT.jpg')"><nav id="nav"><span id="blog-info"><a href="/" title="GeneWlan"><span class="site-name">GeneWlan</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">ggplot_picture_bioinformation</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-10-31T09:08:06.000Z" title="发表于 2023-10-31 17:08:06">2023-10-31</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-10-31T09:12:39.996Z" title="更新于 2023-10-31 17:12:39">2023-10-31</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="ggplot_picture_bioinformation"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><p>[TOC]</p>
<h2 id="none"></h2>
<p>代码参考【来源于ocima公众号】</p>
<h3 id="两组显著性差异图">两组显著性差异图**</h3>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##显著性差异图</span></span><br><span class="line">rm<span class="punctuation">(</span><span class="built_in">list</span> <span class="operator">=</span> ls<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">Normal <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">0.83</span><span class="punctuation">,</span> <span class="number">0.79</span><span class="punctuation">,</span> <span class="number">0.99</span><span class="punctuation">,</span> <span class="number">0.69</span><span class="punctuation">)</span></span><br><span class="line">Cancer <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">0.56</span><span class="punctuation">,</span> <span class="number">0.56</span><span class="punctuation">,</span> <span class="number">0.64</span><span class="punctuation">,</span> <span class="number">0.52</span><span class="punctuation">)</span> </span><br><span class="line">m <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span>mean<span class="punctuation">(</span>Normal<span class="punctuation">)</span><span class="punctuation">,</span> mean<span class="punctuation">(</span>Cancer<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">s <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span>sd<span class="punctuation">(</span>Normal<span class="punctuation">)</span><span class="punctuation">,</span> sd<span class="punctuation">(</span>Cancer<span class="punctuation">)</span><span class="punctuation">)</span> </span><br><span class="line">d <span class="operator">&lt;-</span> data.frame<span class="punctuation">(</span>V<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;Normal&quot;</span><span class="punctuation">,</span> <span class="string">&quot;Cancer&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span> mean<span class="operator">=</span>m<span class="punctuation">,</span> sd<span class="operator">=</span>s<span class="punctuation">)</span> </span><br><span class="line">d<span class="operator">$</span>V <span class="operator">&lt;-</span> factor<span class="punctuation">(</span>d<span class="operator">$</span>V<span class="punctuation">,</span> levels<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;Normal&quot;</span><span class="punctuation">,</span> <span class="string">&quot;Cancer&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span> </span><br><span class="line">p <span class="operator">&lt;-</span> ggplot<span class="punctuation">(</span>d<span class="punctuation">,</span> aes<span class="punctuation">(</span>V<span class="punctuation">,</span> mean<span class="punctuation">,</span> fill<span class="operator">=</span>V<span class="punctuation">,</span> width<span class="operator">=</span><span class="number">.5</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="operator">+</span> </span><br><span class="line">   geom_errorbar<span class="punctuation">(</span>aes<span class="punctuation">(</span>ymin<span class="operator">=</span>mean<span class="operator">-</span>sd<span class="punctuation">,</span> ymax<span class="operator">=</span>mean<span class="operator">+</span>sd<span class="punctuation">,</span> width<span class="operator">=</span><span class="number">.2</span><span class="punctuation">)</span><span class="punctuation">,</span>position<span class="operator">=</span>position_dodge<span class="punctuation">(</span>width<span class="operator">=</span><span class="number">.8</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">   geom_bar<span class="punctuation">(</span>stat<span class="operator">=</span><span class="string">&quot;identity&quot;</span><span class="punctuation">,</span> position<span class="operator">=</span>position_dodge<span class="punctuation">(</span>width<span class="operator">=</span><span class="number">.8</span><span class="punctuation">)</span><span class="punctuation">,</span> colour<span class="operator">=</span><span class="string">&quot;black&quot;</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line"> scale_fill_manual<span class="punctuation">(</span>values <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;grey80&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;white&#x27;</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="operator">+</span>theme_bw<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">+</span>theme<span class="punctuation">(</span>legend.position<span class="operator">=</span><span class="string">&quot;none&quot;</span><span class="punctuation">)</span> <span class="operator">+</span> xlab<span class="punctuation">(</span><span class="string">&quot;&quot;</span><span class="punctuation">)</span> <span class="operator">+</span> ylab<span class="punctuation">(</span><span class="string">&quot;&quot;</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line"> theme<span class="punctuation">(</span>axis.text.x <span class="operator">=</span> element_text<span class="punctuation">(</span>face<span class="operator">=</span><span class="string">&quot;bold&quot;</span><span class="punctuation">,</span> size<span class="operator">=</span><span class="number">12</span><span class="punctuation">)</span><span class="punctuation">,</span>axis.text.y <span class="operator">=</span> element_text<span class="punctuation">(</span>face<span class="operator">=</span><span class="string">&quot;bold&quot;</span><span class="punctuation">,</span> size<span class="operator">=</span><span class="number">12</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line"> scale_y_continuous<span class="punctuation">(</span>expand<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span><span class="number">0</span><span class="punctuation">)</span><span class="punctuation">,</span> limits<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span> <span class="number">1.2</span><span class="punctuation">)</span><span class="punctuation">,</span> breaks<span class="operator">=</span>seq<span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span> <span class="number">1.2</span><span class="punctuation">,</span> by<span class="operator">=</span><span class="number">.2</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">p <span class="operator">&lt;-</span> p<span class="operator">+</span>geom_segment<span class="punctuation">(</span>aes<span class="punctuation">(</span>x<span class="operator">=</span><span class="number">1</span><span class="punctuation">,</span> y<span class="operator">=</span><span class="number">.98</span><span class="punctuation">,</span> xend<span class="operator">=</span><span class="number">1</span><span class="punctuation">,</span> yend<span class="operator">=</span><span class="number">1.1</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="operator">+</span>geom_segment<span class="punctuation">(</span>aes<span class="punctuation">(</span>x<span class="operator">=</span><span class="number">2</span><span class="punctuation">,</span> y<span class="operator">=</span><span class="number">.65</span><span class="punctuation">,</span> xend<span class="operator">=</span><span class="number">2</span><span class="punctuation">,</span> yend<span class="operator">=</span><span class="number">1.1</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line"> geom_segment<span class="punctuation">(</span>aes<span class="punctuation">(</span>x<span class="operator">=</span><span class="number">1</span><span class="punctuation">,</span> y<span class="operator">=</span><span class="number">1.1</span><span class="punctuation">,</span> xend<span class="operator">=</span><span class="number">2</span><span class="punctuation">,</span> yend<span class="operator">=</span><span class="number">1.1</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="operator">+</span>annotate<span class="punctuation">(</span><span class="string">&quot;text&quot;</span><span class="punctuation">,</span> x<span class="operator">=</span><span class="number">1.5</span><span class="punctuation">,</span> y<span class="operator">=</span><span class="number">1.08</span><span class="punctuation">,</span> label<span class="operator">=</span><span class="string">&quot;*&quot;</span><span class="punctuation">)</span> </span><br><span class="line">p     </span><br><span class="line"><span class="comment">#带误差棒的线图</span></span><br><span class="line">geom<span class="operator">+</span>line<span class="punctuation">(</span><span class="punctuation">)</span><span class="operator">+</span>geom<span class="operator">+</span>point<span class="punctuation">(</span><span class="punctuation">)</span><span class="operator">+</span>geom_errorbar</span><br><span class="line"><span class="comment">#也可使用函数 geom_pointrange() 或 geom_linerange() 替换 geom_errorbar()</span></span><br></pre></td></tr></table></figure>
<p><strong>barplot和ggplot2绘制柱状图</strong></p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">data <span class="operator">&lt;-</span> data.frame<span class="punctuation">(</span></span><br><span class="line">  specie<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="built_in">rep</span><span class="punctuation">(</span><span class="string">&quot;sorgho&quot;</span> <span class="punctuation">,</span> <span class="number">10</span><span class="punctuation">)</span> <span class="punctuation">,</span> <span class="built_in">rep</span><span class="punctuation">(</span><span class="string">&quot;poacee&quot;</span> <span class="punctuation">,</span> <span class="number">10</span><span class="punctuation">)</span> <span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">  cond_A<span class="operator">=</span>rnorm<span class="punctuation">(</span><span class="number">20</span><span class="punctuation">,</span><span class="number">10</span><span class="punctuation">,</span><span class="number">4</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">  cond_B<span class="operator">=</span>rnorm<span class="punctuation">(</span><span class="number">20</span><span class="punctuation">,</span><span class="number">8</span><span class="punctuation">,</span><span class="number">3</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">  cond_C<span class="operator">=</span>rnorm<span class="punctuation">(</span><span class="number">20</span><span class="punctuation">,</span><span class="number">5</span><span class="punctuation">,</span><span class="number">4</span><span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">)</span></span><br><span class="line">rm<span class="punctuation">(</span><span class="built_in">list</span> <span class="operator">=</span> ls<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#Let&#x27;s calculate the average value for each condition and each specie with the *aggregate* function</span></span><br><span class="line">bilan <span class="operator">&lt;-</span> aggregate<span class="punctuation">(</span>cbind<span class="punctuation">(</span>cond_A<span class="punctuation">,</span>cond_B<span class="punctuation">,</span>cond_C<span class="punctuation">)</span><span class="operator">~</span>specie <span class="punctuation">,</span> data<span class="operator">=</span>data <span class="punctuation">,</span> mean<span class="punctuation">)</span></span><br><span class="line">rownames<span class="punctuation">(</span>bilan<span class="punctuation">)</span> <span class="operator">&lt;-</span> bilan<span class="punctuation">[</span><span class="punctuation">,</span><span class="number">1</span><span class="punctuation">]</span></span><br><span class="line">bilan <span class="operator">&lt;-</span> as.matrix<span class="punctuation">(</span>bilan<span class="punctuation">[</span><span class="punctuation">,</span><span class="operator">-</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#Plot boundaries</span></span><br><span class="line">lim <span class="operator">&lt;-</span> 1.2<span class="operator">*</span><span class="built_in">max</span><span class="punctuation">(</span>bilan<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#A function to add arrows on the chart</span></span><br><span class="line">error.bar <span class="operator">&lt;-</span> <span class="keyword">function</span><span class="punctuation">(</span>x<span class="punctuation">,</span> y<span class="punctuation">,</span> upper<span class="punctuation">,</span> lower<span class="operator">=</span>upper<span class="punctuation">,</span> <span class="built_in">length</span><span class="operator">=</span><span class="number">0.1</span><span class="punctuation">,</span>...<span class="punctuation">)</span><span class="punctuation">&#123;</span></span><br><span class="line">  arrows<span class="punctuation">(</span>x<span class="punctuation">,</span>y<span class="operator">+</span>upper<span class="punctuation">,</span> x<span class="punctuation">,</span> y<span class="operator">-</span>lower<span class="punctuation">,</span> angle<span class="operator">=</span><span class="number">90</span><span class="punctuation">,</span> code<span class="operator">=</span><span class="number">3</span><span class="punctuation">,</span> <span class="built_in">length</span><span class="operator">=</span><span class="built_in">length</span><span class="punctuation">,</span> ...<span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#Then I calculate the standard deviation for each specie and condition :</span></span><br><span class="line">stdev <span class="operator">&lt;-</span> aggregate<span class="punctuation">(</span>cbind<span class="punctuation">(</span>cond_A<span class="punctuation">,</span>cond_B<span class="punctuation">,</span>cond_C<span class="punctuation">)</span><span class="operator">~</span>specie <span class="punctuation">,</span> data<span class="operator">=</span>data <span class="punctuation">,</span> sd<span class="punctuation">)</span></span><br><span class="line">rownames<span class="punctuation">(</span>stdev<span class="punctuation">)</span> <span class="operator">&lt;-</span> stdev<span class="punctuation">[</span><span class="punctuation">,</span><span class="number">1</span><span class="punctuation">]</span></span><br><span class="line">stdev <span class="operator">&lt;-</span> as.matrix<span class="punctuation">(</span>stdev<span class="punctuation">[</span><span class="punctuation">,</span><span class="operator">-</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">)</span> <span class="operator">*</span> <span class="number">1.96</span> <span class="operator">/</span> <span class="number">10</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#I am ready to add the error bar on the plot using my &quot;error bar&quot; function !</span></span><br><span class="line">ze_barplot <span class="operator">&lt;-</span> barplot<span class="punctuation">(</span>bilan <span class="punctuation">,</span> beside<span class="operator">=</span><span class="built_in">T</span> <span class="punctuation">,</span> legend.text<span class="operator">=</span><span class="built_in">T</span><span class="punctuation">,</span>col<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;blue&quot;</span> <span class="punctuation">,</span> <span class="string">&quot;skyblue&quot;</span><span class="punctuation">)</span> <span class="punctuation">,</span> ylim<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span>lim<span class="punctuation">)</span> <span class="punctuation">,</span> ylab<span class="operator">=</span><span class="string">&quot;height&quot;</span><span class="punctuation">,</span>las <span class="operator">=</span><span class="number">2</span><span class="punctuation">)</span></span><br><span class="line">error.bar<span class="punctuation">(</span>ze_barplot<span class="punctuation">,</span>bilan<span class="punctuation">,</span> stdev<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##用ggplot作图</span></span><br><span class="line">library<span class="punctuation">(</span>doBy<span class="punctuation">)</span></span><br><span class="line">data1 <span class="operator">&lt;-</span> melt<span class="punctuation">(</span>data<span class="punctuation">,</span>id.vars <span class="operator">=</span> <span class="string">&#x27;specie&#x27;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">data_stat <span class="operator">&lt;-</span> summaryBy<span class="punctuation">(</span>value<span class="operator">~</span>specie<span class="operator">+</span>variable<span class="punctuation">,</span> data1<span class="punctuation">,</span> FUN <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span>mean<span class="punctuation">,</span> sd<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#同样我们也设置一下均值和方差的阈值</span></span><br><span class="line">height <span class="operator">&lt;-</span> <span class="built_in">max</span><span class="punctuation">(</span>data_stat<span class="operator">$</span>value.mean<span class="punctuation">)</span><span class="operator">*</span><span class="number">1.2</span></span><br><span class="line">data_stat<span class="operator">$</span>value.sd <span class="operator">&lt;-</span> data_stat<span class="operator">$</span>value.sd<span class="operator">*</span><span class="number">1.96</span><span class="operator">/</span><span class="number">10</span></span><br><span class="line"><span class="comment">#作图</span></span><br><span class="line">ggplot<span class="punctuation">(</span>data_stat<span class="punctuation">,</span> aes<span class="punctuation">(</span>variable<span class="punctuation">,</span> value.mean<span class="punctuation">,</span> fill <span class="operator">=</span> specie<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_col<span class="punctuation">(</span>position <span class="operator">=</span> position_dodge<span class="punctuation">(</span>width <span class="operator">=</span> <span class="number">0.5</span><span class="punctuation">)</span><span class="punctuation">,</span> width <span class="operator">=</span> <span class="number">0.5</span><span class="punctuation">,</span> size <span class="operator">=</span> <span class="number">0.3</span><span class="punctuation">,</span> colour <span class="operator">=</span> <span class="string">&#x27;black&#x27;</span><span class="punctuation">)</span> <span class="operator">+</span>	<span class="comment">#柱形图绘制</span></span><br><span class="line">  geom_errorbar<span class="punctuation">(</span>aes<span class="punctuation">(</span>ymin <span class="operator">=</span> value.mean <span class="operator">-</span> value.sd<span class="punctuation">,</span> ymax <span class="operator">=</span> value.mean <span class="operator">+</span> value.sd<span class="punctuation">)</span><span class="punctuation">,</span> width <span class="operator">=</span> <span class="number">0.3</span><span class="punctuation">,</span> size <span class="operator">=</span> <span class="number">0.3</span><span class="punctuation">,</span> position <span class="operator">=</span> position_dodge<span class="punctuation">(</span><span class="number">0.5</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span>	<span class="comment">#误差线绘制</span></span><br><span class="line">  theme<span class="punctuation">(</span>panel.grid <span class="operator">=</span> element_blank<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">,</span> panel.background <span class="operator">=</span> element_rect<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&#x27;black&#x27;</span><span class="punctuation">,</span> fill <span class="operator">=</span> <span class="string">&#x27;transparent&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span> legend.title <span class="operator">=</span> element_blank<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span> 	<span class="comment">#调整背景</span></span><br><span class="line">  scale_y_continuous<span class="punctuation">(</span>limits <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span>height<span class="punctuation">)</span><span class="punctuation">,</span>expand <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span><span class="number">0</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">                      </span><br></pre></td></tr></table></figure>
<h3 id="华夫pie图"><strong>华夫pie图</strong></h3>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line">library<span class="punctuation">(</span>dplyr<span class="punctuation">)</span></span><br><span class="line">rm<span class="punctuation">(</span><span class="built_in">list</span> <span class="operator">=</span> ls<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">d <span class="operator">&lt;-</span> data_frame<span class="punctuation">(</span></span><br><span class="line">  date <span class="operator">=</span> as.Date<span class="punctuation">(</span><span class="number">1</span><span class="operator">:</span><span class="number">813</span><span class="punctuation">,</span> origin <span class="operator">=</span> <span class="string">&quot;2018-01-01&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">  year <span class="operator">=</span> format<span class="punctuation">(</span>date<span class="punctuation">,</span> <span class="string">&quot;%Y&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">  week <span class="operator">=</span> <span class="built_in">as.integer</span><span class="punctuation">(</span>format<span class="punctuation">(</span>date<span class="punctuation">,</span> <span class="string">&quot;%W&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span> <span class="number">1</span><span class="punctuation">,</span>  <span class="comment"># Week starts at 1</span></span><br><span class="line">  day <span class="operator">=</span> factor<span class="punctuation">(</span>weekdays<span class="punctuation">(</span>date<span class="punctuation">,</span> <span class="literal">TRUE</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">               levels <span class="operator">=</span> rev<span class="punctuation">(</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;周一&quot;</span><span class="punctuation">,</span><span class="string">&quot;周二&quot;</span><span class="punctuation">,</span><span class="string">&quot;周三&quot;</span><span class="punctuation">,</span><span class="string">&quot;周四&quot;</span><span class="punctuation">,</span><span class="string">&quot;周五&quot;</span><span class="punctuation">,</span><span class="string">&quot;周六&quot;</span><span class="punctuation">,</span><span class="string">&quot;周日&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">  hours <span class="operator">=</span> <span class="number">0</span><span class="punctuation">)</span></span><br><span class="line">d</span><br><span class="line">set.seed<span class="punctuation">(</span><span class="number">1</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment"># Simulate weekends</span></span><br><span class="line">weekends <span class="operator">&lt;-</span> dplyr<span class="operator">::</span>filter<span class="punctuation">(</span>d<span class="punctuation">,</span> grepl<span class="punctuation">(</span><span class="string">&quot;S(at|un)&quot;</span><span class="punctuation">,</span> day<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment"># Hours worked are (might be) poisson distributed</span></span><br><span class="line">weekends<span class="operator">$</span>hours <span class="operator">&lt;-</span> rpois<span class="punctuation">(</span>nrow<span class="punctuation">(</span>weekends<span class="punctuation">)</span><span class="punctuation">,</span> lambda <span class="operator">=</span> <span class="number">4</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment"># Simulate missing days with probability .7</span></span><br><span class="line">weekends<span class="operator">$</span>na <span class="operator">&lt;-</span> rbinom<span class="punctuation">(</span>nrow<span class="punctuation">(</span>weekends<span class="punctuation">)</span><span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">,</span> <span class="number">0.7</span><span class="punctuation">)</span></span><br><span class="line">weekends<span class="operator">$</span>hours <span class="operator">&lt;-</span> ifelse<span class="punctuation">(</span>weekends<span class="operator">$</span>na<span class="punctuation">,</span> <span class="literal">NA</span><span class="punctuation">,</span> weekends<span class="operator">$</span>hours<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Simulate weekdays</span></span><br><span class="line">weekdays <span class="operator">&lt;-</span> filter<span class="punctuation">(</span>d<span class="punctuation">,</span> <span class="operator">!</span>grepl<span class="punctuation">(</span><span class="string">&quot;S(at|un)&quot;</span><span class="punctuation">,</span> day<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">weekdays<span class="operator">$</span>hours <span class="operator">&lt;-</span> rpois<span class="punctuation">(</span>nrow<span class="punctuation">(</span>weekdays<span class="punctuation">)</span><span class="punctuation">,</span> lambda <span class="operator">=</span> <span class="number">8</span><span class="punctuation">)</span>  <span class="comment"># Greater lambda</span></span><br><span class="line">weekdays<span class="operator">$</span>na <span class="operator">&lt;-</span> rbinom<span class="punctuation">(</span>nrow<span class="punctuation">(</span>weekdays<span class="punctuation">)</span><span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">,</span> <span class="number">0.1</span><span class="punctuation">)</span>  <span class="comment"># Smaller p(missing)</span></span><br><span class="line">weekdays<span class="operator">$</span>hours <span class="operator">&lt;-</span> ifelse<span class="punctuation">(</span>weekdays<span class="operator">$</span>na<span class="punctuation">,</span> <span class="literal">NA</span><span class="punctuation">,</span> weekdays<span class="operator">$</span>hours<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Concatenate weekends and weekdays and arrange by date</span></span><br><span class="line">d <span class="operator">&lt;-</span> bind_rows<span class="punctuation">(</span>weekends<span class="punctuation">,</span> weekdays<span class="punctuation">)</span> <span class="operator">%&gt;%</span></span><br><span class="line">  arrange<span class="punctuation">(</span>date<span class="punctuation">)</span> <span class="operator">%&gt;%</span>  <span class="comment"># Arrange by date</span></span><br><span class="line">  select<span class="punctuation">(</span><span class="operator">-</span>na<span class="punctuation">)</span>  <span class="comment"># Remove na column</span></span><br><span class="line">d</span><br><span class="line"></span><br><span class="line">library<span class="punctuation">(</span>ggplot2<span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>viridis<span class="punctuation">)</span>  <span class="comment"># Color palette</span></span><br><span class="line">library<span class="punctuation">(</span>ggthemes<span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>ggcor<span class="punctuation">)</span></span><br><span class="line">gh_waffle <span class="operator">&lt;-</span> <span class="keyword">function</span><span class="punctuation">(</span>data<span class="punctuation">,</span> pal <span class="operator">=</span> <span class="string">&quot;D&quot;</span><span class="punctuation">,</span> dir <span class="operator">=</span> <span class="operator">-</span><span class="number">1</span><span class="punctuation">,</span>type <span class="operator">=</span> <span class="number">21</span><span class="punctuation">)</span><span class="punctuation">&#123;</span></span><br><span class="line">  </span><br><span class="line">  p <span class="operator">&lt;-</span> ggplot<span class="punctuation">(</span>data<span class="punctuation">,</span> aes<span class="punctuation">(</span>x <span class="operator">=</span> week<span class="punctuation">,</span> y <span class="operator">=</span> day<span class="punctuation">,</span> fill <span class="operator">=</span> hours<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">    scale_fill_viridis<span class="punctuation">(</span>name<span class="operator">=</span><span class="string">&quot;Hours&quot;</span><span class="punctuation">,</span></span><br><span class="line">                       option <span class="operator">=</span> pal<span class="punctuation">,</span>  <span class="comment"># Variable color palette</span></span><br><span class="line">                       direction <span class="operator">=</span> dir<span class="punctuation">,</span>  <span class="comment"># Variable color direction</span></span><br><span class="line">                       na.value <span class="operator">=</span> <span class="string">&quot;grey93&quot;</span><span class="punctuation">,</span></span><br><span class="line">                       limits <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span> <span class="built_in">max</span><span class="punctuation">(</span>data<span class="operator">$</span>hours<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">    <span class="comment"># geom_tile(color = &quot;white&quot;, size = 0.4) +</span></span><br><span class="line">    facet_wrap<span class="punctuation">(</span><span class="string">&quot;year&quot;</span><span class="punctuation">,</span> ncol <span class="operator">=</span> <span class="number">1</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">    scale_x_continuous<span class="punctuation">(</span></span><br><span class="line">      expand <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">      breaks <span class="operator">=</span> seq<span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span> <span class="number">52</span><span class="punctuation">,</span> <span class="built_in">length</span> <span class="operator">=</span> <span class="number">12</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">      labels <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;Jan&quot;</span><span class="punctuation">,</span> <span class="string">&quot;Feb&quot;</span><span class="punctuation">,</span> <span class="string">&quot;Mar&quot;</span><span class="punctuation">,</span> <span class="string">&quot;Apr&quot;</span><span class="punctuation">,</span> <span class="string">&quot;May&quot;</span><span class="punctuation">,</span> <span class="string">&quot;Jun&quot;</span><span class="punctuation">,</span></span><br><span class="line">                 <span class="string">&quot;Jul&quot;</span><span class="punctuation">,</span> <span class="string">&quot;Aug&quot;</span><span class="punctuation">,</span> <span class="string">&quot;Sep&quot;</span><span class="punctuation">,</span> <span class="string">&quot;Oct&quot;</span><span class="punctuation">,</span> <span class="string">&quot;Nov&quot;</span><span class="punctuation">,</span> <span class="string">&quot;Dec&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">    theme_tufte<span class="punctuation">(</span>base_family <span class="operator">=</span> <span class="string">&quot;Helvetica&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">    theme<span class="punctuation">(</span>axis.title <span class="operator">=</span> element_blank<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">          axis.ticks <span class="operator">=</span> element_blank<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">          legend.position <span class="operator">=</span> <span class="string">&quot;bottom&quot;</span><span class="punctuation">,</span></span><br><span class="line">          legend.key.width <span class="operator">=</span> unit<span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span> <span class="string">&quot;cm&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">          strip.text <span class="operator">=</span> element_text<span class="punctuation">(</span>hjust <span class="operator">=</span> <span class="number">0.01</span><span class="punctuation">,</span> face <span class="operator">=</span> <span class="string">&quot;bold&quot;</span><span class="punctuation">,</span> size <span class="operator">=</span> <span class="number">12</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">#圆形</span></span><br><span class="line">  <span class="keyword">if</span><span class="punctuation">(</span>type <span class="operator">==</span> <span class="number">21</span><span class="punctuation">)</span><span class="punctuation">&#123;</span>p <span class="operator">=</span> p <span class="operator">+</span>geom_point<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&quot;white&quot;</span><span class="punctuation">,</span> size <span class="operator">=</span> <span class="number">4</span><span class="punctuation">,</span>pch <span class="operator">=</span> <span class="number">21</span><span class="punctuation">)</span> <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="comment">#方形</span></span><br><span class="line">  <span class="keyword">if</span><span class="punctuation">(</span>type <span class="operator">==</span> <span class="number">22</span><span class="punctuation">)</span><span class="punctuation">&#123;</span>p <span class="operator">=</span> p <span class="operator">+</span>geom_point<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&quot;white&quot;</span><span class="punctuation">,</span> size <span class="operator">=</span> <span class="number">3</span><span class="punctuation">,</span>pch <span class="operator">=</span> <span class="number">22</span><span class="punctuation">)</span><span class="punctuation">&#125;</span></span><br><span class="line">  <span class="comment">#菱方形</span></span><br><span class="line">  <span class="keyword">if</span><span class="punctuation">(</span>type <span class="operator">==</span> <span class="number">23</span><span class="punctuation">)</span><span class="punctuation">&#123;</span>p <span class="operator">=</span> p <span class="operator">+</span>geom_point<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&quot;white&quot;</span><span class="punctuation">,</span> size <span class="operator">=</span> <span class="number">3</span><span class="punctuation">,</span>pch <span class="operator">=</span> <span class="number">23</span><span class="punctuation">)</span> <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="comment">#上三角</span></span><br><span class="line">  <span class="keyword">if</span><span class="punctuation">(</span>type <span class="operator">==</span> <span class="number">24</span><span class="punctuation">)</span><span class="punctuation">&#123;</span>p <span class="operator">=</span> p <span class="operator">+</span>geom_point<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&quot;white&quot;</span><span class="punctuation">,</span> size <span class="operator">=</span> <span class="number">3</span><span class="punctuation">,</span>pch <span class="operator">=</span> <span class="number">24</span><span class="punctuation">)</span> <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="comment">#下三角</span></span><br><span class="line">  <span class="keyword">if</span><span class="punctuation">(</span>type <span class="operator">==</span> <span class="number">25</span><span class="punctuation">)</span><span class="punctuation">&#123;</span>p <span class="operator">=</span> p <span class="operator">+</span>geom_point<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&quot;white&quot;</span><span class="punctuation">,</span> size <span class="operator">=</span> <span class="number">3</span><span class="punctuation">,</span>pch <span class="operator">=</span> <span class="number">25</span><span class="punctuation">)</span> <span class="punctuation">&#125;</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">#星形状图</span></span><br><span class="line">  <span class="keyword">if</span><span class="punctuation">(</span>type <span class="operator">==</span> <span class="string">&quot;star&quot;</span><span class="punctuation">)</span><span class="punctuation">&#123;</span>p <span class="operator">=</span> p <span class="operator">+</span>geom_star<span class="punctuation">(</span><span class="punctuation">)</span> <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="comment">#饼图</span></span><br><span class="line">  <span class="keyword">if</span><span class="punctuation">(</span>type <span class="operator">==</span> <span class="string">&quot;pie2&quot;</span><span class="punctuation">)</span><span class="punctuation">&#123;</span>p <span class="operator">=</span> p <span class="operator">+</span> geom_pie2<span class="punctuation">(</span>size <span class="operator">=</span> <span class="number">0.5</span><span class="punctuation">)</span> <span class="punctuation">&#125;</span></span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">  print<span class="punctuation">(</span>p<span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line">gh_waffle<span class="punctuation">(</span>d<span class="punctuation">,</span>pal <span class="operator">=</span> <span class="string">&quot;D&quot;</span><span class="punctuation">,</span> dir <span class="operator">=</span> <span class="operator">-</span><span class="number">1</span><span class="punctuation">,</span>type <span class="operator">=</span> <span class="number">21</span><span class="punctuation">)</span></span><br><span class="line">gh_waffle<span class="punctuation">(</span>d<span class="punctuation">,</span>pal <span class="operator">=</span> <span class="string">&quot;D&quot;</span><span class="punctuation">,</span> dir <span class="operator">=</span> <span class="operator">-</span><span class="number">1</span><span class="punctuation">,</span>type <span class="operator">=</span> <span class="string">&quot;pie2&quot;</span><span class="punctuation">)</span></span><br><span class="line"><span class="keyword">for</span> <span class="punctuation">(</span>pal <span class="keyword">in</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;A&quot;</span><span class="punctuation">,</span> <span class="string">&quot;B&quot;</span><span class="punctuation">,</span> <span class="string">&quot;C&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">  gh_waffle<span class="punctuation">(</span>d<span class="punctuation">,</span>pal<span class="punctuation">,</span> dir <span class="operator">=</span> <span class="operator">-</span><span class="number">1</span><span class="punctuation">,</span>type <span class="operator">=</span> <span class="string">&quot;star&quot;</span><span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="none"></h3>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">rm<span class="punctuation">(</span><span class="built_in">list</span> <span class="operator">=</span> ls<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>ggplot2<span class="punctuation">)</span></span><br><span class="line"><span class="comment">#绘制单线条</span></span><br><span class="line">df <span class="operator">&lt;-</span> data.frame<span class="punctuation">(</span>dose <span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;A&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;B&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;C&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span>len<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">5.16</span><span class="punctuation">,</span><span class="number">10.10</span><span class="punctuation">,</span><span class="number">30</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">head<span class="punctuation">(</span>df<span class="punctuation">)</span></span><br><span class="line"><span class="comment">#因为横坐标的属性为因子（离散型的字符转换为因子），所以需要添加‘group = 1’的设置。</span></span><br><span class="line">ggplot<span class="punctuation">(</span>data<span class="operator">=</span>df<span class="punctuation">,</span>aes<span class="punctuation">(</span>x<span class="operator">=</span>dose<span class="punctuation">,</span>y<span class="operator">=</span>len<span class="punctuation">,</span>group<span class="operator">=</span><span class="number">1</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="operator">+</span>geom_line<span class="punctuation">(</span>linetype <span class="operator">=</span> <span class="string">&quot;dashed&quot;</span><span class="punctuation">,</span>color<span class="operator">=</span><span class="string">&quot;red&quot;</span><span class="punctuation">)</span><span class="operator">+</span>geom_point<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment">#添加箭头</span></span><br><span class="line">library<span class="punctuation">(</span>grid<span class="punctuation">)</span></span><br><span class="line">ggplot<span class="punctuation">(</span>data<span class="operator">=</span>df<span class="punctuation">,</span> aes<span class="punctuation">(</span>x<span class="operator">=</span>dose<span class="punctuation">,</span> y<span class="operator">=</span>len<span class="punctuation">,</span> group<span class="operator">=</span><span class="number">1</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="operator">+</span>geom_line<span class="punctuation">(</span>arrow <span class="operator">=</span> arrow<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="operator">+</span>geom_point<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment">#自定义箭头类型</span></span><br><span class="line">myarrow<span class="operator">=</span>arrow<span class="punctuation">(</span>angle <span class="operator">=</span> <span class="number">15</span><span class="punctuation">,</span> ends <span class="operator">=</span> <span class="string">&quot;both&quot;</span><span class="punctuation">,</span> type <span class="operator">=</span> <span class="string">&quot;closed&quot;</span><span class="punctuation">)</span></span><br><span class="line">ggplot<span class="punctuation">(</span>data<span class="operator">=</span>df<span class="punctuation">,</span> aes<span class="punctuation">(</span>x<span class="operator">=</span>dose<span class="punctuation">,</span> y<span class="operator">=</span>len<span class="punctuation">,</span> group<span class="operator">=</span><span class="number">1</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span>geom_line<span class="punctuation">(</span>arrow<span class="operator">=</span>myarrow<span class="punctuation">)</span><span class="operator">+</span>geom_point<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment">#附赠</span></span><br><span class="line">ggplot<span class="punctuation">(</span>data<span class="operator">=</span>df<span class="punctuation">,</span> aes<span class="punctuation">(</span>x<span class="operator">=</span>dose<span class="punctuation">,</span> y<span class="operator">=</span>len<span class="punctuation">,</span> group<span class="operator">=</span><span class="number">1</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span> geom_step<span class="punctuation">(</span><span class="punctuation">)</span><span class="operator">+</span> geom_point<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#绘制多线条</span></span><br><span class="line">df2 <span class="operator">&lt;-</span> data.frame<span class="punctuation">(</span>supp<span class="operator">=</span><span class="built_in">rep</span><span class="punctuation">(</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;Case&quot;</span><span class="punctuation">,</span> <span class="string">&quot;Control&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span>each<span class="operator">=</span><span class="number">3</span><span class="punctuation">)</span><span class="punctuation">,</span> dose<span class="operator">=</span><span class="built_in">rep</span><span class="punctuation">(</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;A&quot;</span><span class="punctuation">,</span> <span class="string">&quot;B&quot;</span><span class="punctuation">,</span> <span class="string">&quot;C&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">)</span><span class="punctuation">,</span>len<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">6.8</span><span class="punctuation">,</span> <span class="number">15</span><span class="punctuation">,</span> <span class="number">38</span><span class="punctuation">,</span> <span class="number">5.16</span><span class="punctuation">,</span> <span class="number">10.10</span><span class="punctuation">,</span> <span class="number">30</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">head<span class="punctuation">(</span>df2<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">ggplot<span class="punctuation">(</span>data<span class="operator">=</span>df2<span class="punctuation">,</span> aes<span class="punctuation">(</span>x<span class="operator">=</span>dose<span class="punctuation">,</span> y<span class="operator">=</span>len<span class="punctuation">,</span> group<span class="operator">=</span>supp<span class="punctuation">)</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  geom_line<span class="punctuation">(</span>linetype<span class="operator">=</span><span class="string">&quot;dashed&quot;</span><span class="punctuation">,</span> color<span class="operator">=</span><span class="string">&quot;blue&quot;</span><span class="punctuation">,</span> size<span class="operator">=</span><span class="number">1.2</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  geom_point<span class="punctuation">(</span>color<span class="operator">=</span><span class="string">&quot;red&quot;</span><span class="punctuation">,</span> size<span class="operator">=</span><span class="number">3</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment">#改变线形</span></span><br><span class="line">ggplot<span class="punctuation">(</span>df2<span class="punctuation">,</span> aes<span class="punctuation">(</span>x<span class="operator">=</span>dose<span class="punctuation">,</span> y<span class="operator">=</span>len<span class="punctuation">,</span> group<span class="operator">=</span>supp<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_line<span class="punctuation">(</span>aes<span class="punctuation">(</span>linetype<span class="operator">=</span>supp<span class="punctuation">)</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  geom_point<span class="punctuation">(</span>aes<span class="punctuation">(</span>shape<span class="operator">=</span>supp<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment">#自定义线性</span></span><br><span class="line">ggplot<span class="punctuation">(</span>df2<span class="punctuation">,</span> aes<span class="punctuation">(</span>x<span class="operator">=</span>dose<span class="punctuation">,</span> y<span class="operator">=</span>len<span class="punctuation">,</span> group<span class="operator">=</span>supp<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_line<span class="punctuation">(</span>aes<span class="punctuation">(</span>linetype<span class="operator">=</span>supp<span class="punctuation">)</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  geom_point<span class="punctuation">(</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  scale_linetype_manual<span class="punctuation">(</span>values<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;twodash&quot;</span><span class="punctuation">,</span> <span class="string">&quot;dotted&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment">#更改颜色</span></span><br><span class="line">p <span class="operator">&lt;-</span> ggplot<span class="punctuation">(</span>df2<span class="punctuation">,</span> aes<span class="punctuation">(</span>x<span class="operator">=</span>dose<span class="punctuation">,</span> y<span class="operator">=</span>len<span class="punctuation">,</span> group<span class="operator">=</span>supp<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_line<span class="punctuation">(</span>aes<span class="punctuation">(</span>color<span class="operator">=</span>supp<span class="punctuation">)</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  geom_point<span class="punctuation">(</span>aes<span class="punctuation">(</span>color<span class="operator">=</span>supp<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">p</span><br><span class="line"><span class="comment"># Use custom color palettes</span></span><br><span class="line">p<span class="operator">+</span>scale_color_manual<span class="punctuation">(</span>values<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;#E69F00&quot;</span><span class="punctuation">,</span> <span class="string">&quot;#56B4E9&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment"># Use brewer color palettes</span></span><br><span class="line">p<span class="operator">+</span>scale_color_brewer<span class="punctuation">(</span>palette<span class="operator">=</span><span class="string">&quot;Dark2&quot;</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment"># Use grey scale</span></span><br><span class="line">p <span class="operator">+</span>scale_color_grey<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">+</span> theme_classic<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#绘制添加误差棒的折线图 可以使用position_dodge 参数，防止errorbars重叠</span></span><br><span class="line">ggplot<span class="punctuation">(</span>df3<span class="punctuation">,</span> aes<span class="punctuation">(</span>x<span class="operator">=</span>dose<span class="punctuation">,</span> y<span class="operator">=</span>len<span class="punctuation">,</span> group <span class="operator">=</span> supp<span class="punctuation">,</span> color<span class="operator">=</span>supp<span class="punctuation">)</span><span class="punctuation">)</span><span class="operator">+</span> </span><br><span class="line">  geom_errorbar<span class="punctuation">(</span>aes<span class="punctuation">(</span>ymin<span class="operator">=</span>len<span class="operator">-</span>sd<span class="punctuation">,</span> ymax<span class="operator">=</span>len<span class="operator">+</span>sd<span class="punctuation">)</span><span class="punctuation">,</span> width<span class="operator">=</span><span class="number">.1</span><span class="punctuation">,</span> </span><br><span class="line">                position<span class="operator">=</span>position_dodge<span class="punctuation">(</span><span class="number">0.05</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_line<span class="punctuation">(</span>aes<span class="punctuation">(</span>linetype<span class="operator">=</span>supp<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span> </span><br><span class="line">  geom_point<span class="punctuation">(</span>aes<span class="punctuation">(</span>shape<span class="operator">=</span>supp<span class="punctuation">)</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  labs<span class="punctuation">(</span>title<span class="operator">=</span><span class="string">&quot;Plot of lengthby dose&quot;</span><span class="punctuation">,</span>x<span class="operator">=</span><span class="string">&quot;Dose (mg)&quot;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&quot;Length&quot;</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  theme_classic<span class="punctuation">(</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  scale_color_manual<span class="punctuation">(</span>values<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;#999999&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;#E69F00&#x27;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 我们的另一个备选方案，拆线图也很好看</span></span><br><span class="line">library<span class="punctuation">(</span>ggpubr<span class="punctuation">)</span></span><br><span class="line">p<span class="operator">=</span>ggline<span class="punctuation">(</span><span class="built_in">all</span><span class="punctuation">,</span> x<span class="operator">=</span><span class="string">&quot;group&quot;</span><span class="punctuation">,</span> y<span class="operator">=</span><span class="string">&quot;distance&quot;</span><span class="punctuation">,</span> add <span class="operator">=</span> <span class="string">&quot;mean_se&quot;</span><span class="punctuation">,</span>  color <span class="operator">=</span> <span class="string">&quot;type&quot;</span><span class="punctuation">,</span></span><br><span class="line">       palette <span class="operator">=</span> <span class="string">&quot;jco&quot;</span><span class="punctuation">,</span>legend <span class="operator">=</span> <span class="string">&quot;right&quot;</span><span class="punctuation">)</span> <span class="operator">+</span>main_theme</span><br><span class="line">p</span><br><span class="line">ggsave<span class="punctuation">(</span>paste<span class="punctuation">(</span><span class="string">&quot;e.line&quot;</span><span class="punctuation">,</span><span class="string">&quot;.pdf&quot;</span><span class="punctuation">,</span> sep<span class="operator">=</span><span class="string">&quot;&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span> p<span class="punctuation">,</span> width <span class="operator">=</span> <span class="number">5</span><span class="punctuation">,</span> height <span class="operator">=</span> <span class="number">3</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<h3 id="雷达图"><strong>雷达图</strong></h3>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">setwd<span class="punctuation">(</span><span class="string">&#x27;./Script/雷达图/&#x27;</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment">#ggradar包需要通过 github 来安装，安装方法如下：</span></span><br><span class="line">devtools<span class="operator">::</span>install_github<span class="punctuation">(</span><span class="string">&quot;ricardo-bion/ggradar&quot;</span><span class="punctuation">,</span> dependencies<span class="operator">=</span><span class="literal">TRUE</span><span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>ggradar<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 或者手动下载下来</span></span><br><span class="line"><span class="comment">#install.packages(&quot;E:/R/R-3.5.2/library/ggradar-master/&quot;, repos = NULL, type = &quot;source&quot;) </span></span><br><span class="line"></span><br><span class="line">set.seed<span class="punctuation">(</span><span class="number">123</span><span class="punctuation">)</span></span><br><span class="line">mydata<span class="operator">&lt;-</span>matrix<span class="punctuation">(</span>runif<span class="punctuation">(</span><span class="number">24</span><span class="punctuation">,</span><span class="number">0</span><span class="punctuation">,</span><span class="number">1</span><span class="punctuation">)</span><span class="punctuation">,</span><span class="number">4</span><span class="punctuation">,</span><span class="number">6</span><span class="punctuation">)</span></span><br><span class="line">rownames<span class="punctuation">(</span>mydata<span class="punctuation">)</span> <span class="operator">&lt;-</span> <span class="built_in">LETTERS</span><span class="punctuation">[</span><span class="number">1</span><span class="operator">:</span><span class="number">4</span><span class="punctuation">]</span></span><br><span class="line">colnames<span class="punctuation">(</span>mydata<span class="punctuation">)</span> <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;Apple&quot;</span><span class="punctuation">,</span><span class="string">&quot;Google&quot;</span><span class="punctuation">,</span><span class="string">&quot;Amozon&quot;</span><span class="punctuation">,</span><span class="string">&quot;Tencent&quot;</span><span class="punctuation">,</span><span class="string">&quot;Alibaba&quot;</span><span class="punctuation">,</span><span class="string">&quot;Baidu&quot;</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment">#使用以上文本向量为矩阵列命名，方便展示</span></span><br><span class="line">mynewdata<span class="operator">&lt;-</span>data.frame<span class="punctuation">(</span>mydata<span class="punctuation">)</span></span><br><span class="line">Name<span class="operator">&lt;-</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;USA&quot;</span><span class="punctuation">,</span><span class="string">&quot;CHN&quot;</span><span class="punctuation">,</span><span class="string">&quot;UK&quot;</span><span class="punctuation">,</span><span class="string">&quot;RUS&quot;</span><span class="punctuation">)</span></span><br><span class="line">mynewdata<span class="operator">&lt;-</span>data.frame<span class="punctuation">(</span>Name<span class="punctuation">,</span>mynewdata<span class="punctuation">)</span></span><br><span class="line">mynewdata</span><br><span class="line"></span><br><span class="line"><span class="comment">#绘制所有变量的雷达图</span></span><br><span class="line">ggradar<span class="punctuation">(</span>mynewdata<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">library<span class="punctuation">(</span>ggradar<span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>scales<span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>tibble<span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>dplyr<span class="punctuation">)</span></span><br><span class="line"><span class="comment">#利用内置car数据集进行雷达图绘制，主要是对数据进行scale，然后绘制</span></span><br><span class="line">mtcars <span class="operator">%&gt;%</span></span><br><span class="line">  rownames_to_column<span class="punctuation">(</span> var <span class="operator">=</span> <span class="string">&quot;group&quot;</span> <span class="punctuation">)</span> <span class="operator">%&gt;%</span> <span class="comment">#保留行名称</span></span><br><span class="line">  mutate_at<span class="punctuation">(</span>vars<span class="punctuation">(</span><span class="operator">-</span>group<span class="punctuation">)</span><span class="punctuation">,</span>funs<span class="punctuation">(</span>rescale<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">%&gt;%</span></span><br><span class="line">  tail<span class="punctuation">(</span><span class="number">4</span><span class="punctuation">)</span> <span class="operator">%&gt;%</span> select<span class="punctuation">(</span><span class="number">1</span><span class="operator">:</span><span class="number">6</span><span class="punctuation">)</span> <span class="operator">-&gt;</span> mtcars_radar</span><br><span class="line">ggradar<span class="punctuation">(</span>mtcars_radar<span class="punctuation">,</span> grid.line.width <span class="operator">=</span> <span class="number">0.5</span><span class="punctuation">,</span>axis.label.size<span class="operator">=</span> <span class="number">5</span><span class="punctuation">,</span>group.line.width <span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span>group.point.size <span class="operator">=</span> <span class="number">2</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#简单例子</span></span><br><span class="line">set.seed<span class="punctuation">(</span><span class="number">1234</span><span class="punctuation">)</span></span><br><span class="line">dat <span class="operator">&lt;-</span> data.frame<span class="punctuation">(</span></span><br><span class="line">  obj <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;obj1&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;obj2&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;obj3&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">  factor1 <span class="operator">=</span> runif<span class="punctuation">(</span><span class="number">3</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">  factor2 <span class="operator">=</span> runif<span class="punctuation">(</span><span class="number">3</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">  factor3 <span class="operator">=</span> runif<span class="punctuation">(</span><span class="number">3</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">  factor4 <span class="operator">=</span> runif<span class="punctuation">(</span><span class="number">3</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">  factor5 <span class="operator">=</span> runif<span class="punctuation">(</span><span class="number">3</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment">#查看数据集结构</span></span><br><span class="line">dat</span><br><span class="line">ggradar<span class="punctuation">(</span>dat<span class="punctuation">,</span> background.circle.transparency <span class="operator">=</span> <span class="number">0</span><span class="punctuation">,</span> group.colours <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;blue&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;red&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;green3&#x27;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<h3 id="发散性正负图"><strong>发散性正负图</strong></h3>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">setwd<span class="punctuation">(</span><span class="string">&#x27;../发散性正负图/&#x27;</span><span class="punctuation">)</span></span><br><span class="line">rm<span class="punctuation">(</span><span class="built_in">list</span> <span class="operator">=</span> ls<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>ggplot2<span class="punctuation">)</span></span><br><span class="line"><span class="comment"># 使用mtcars数据集</span></span><br><span class="line">data<span class="punctuation">(</span><span class="string">&quot;mtcars&quot;</span><span class="punctuation">)</span>  </span><br><span class="line"><span class="comment"># 保留car name ，新建一列</span></span><br><span class="line">mtcars<span class="operator">$</span>car_name <span class="operator">&lt;-</span> rownames<span class="punctuation">(</span>mtcars<span class="punctuation">)</span> </span><br><span class="line"><span class="comment"># 对mpg进行标准化处理 </span></span><br><span class="line">mtcars<span class="operator">$</span>mpg_z <span class="operator">&lt;-</span> <span class="built_in">round</span><span class="punctuation">(</span><span class="punctuation">(</span>mtcars<span class="operator">$</span>mpg <span class="operator">-</span> mean<span class="punctuation">(</span>mtcars<span class="operator">$</span>mpg<span class="punctuation">)</span><span class="punctuation">)</span><span class="operator">/</span>sd<span class="punctuation">(</span>mtcars<span class="operator">$</span>mpg<span class="punctuation">)</span><span class="punctuation">,</span> <span class="number">2</span><span class="punctuation">)</span>  </span><br><span class="line"><span class="comment"># 按照0未阈值 ，分上 下</span></span><br><span class="line">mtcars<span class="operator">$</span>mpg_type <span class="operator">&lt;-</span> ifelse<span class="punctuation">(</span>mtcars<span class="operator">$</span>mpg_z <span class="operator">&lt;</span> <span class="number">0</span><span class="punctuation">,</span> <span class="string">&quot;below&quot;</span><span class="punctuation">,</span> <span class="string">&quot;above&quot;</span><span class="punctuation">)</span>  </span><br><span class="line"></span><br><span class="line">mtcars <span class="operator">&lt;-</span> mtcars<span class="punctuation">[</span>order<span class="punctuation">(</span>mtcars<span class="operator">$</span>mpg_z<span class="punctuation">)</span><span class="punctuation">,</span> <span class="punctuation">]</span>  <span class="comment"># 为展示美观，数据排序</span></span><br><span class="line"><span class="comment"># 改为因子，能够保持原顺序 改为因子使图形按照原顺序输出，很常用</span></span><br><span class="line">mtcars<span class="operator">$</span>car_name <span class="operator">&lt;-</span> factor<span class="punctuation">(</span>mtcars<span class="operator">$</span>car_name<span class="punctuation">,</span> levels <span class="operator">=</span> mtcars<span class="operator">$</span>car_name<span class="punctuation">)</span>  </span><br><span class="line"></span><br><span class="line"><span class="comment">#Diverging bars是一种可以同时处理负值和正值的条形图。注意为了使柱状图创建柱形图而不是直方图，需要确保：</span></span><br><span class="line"><span class="comment">#（1）设置stat=identity</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#（2）在aes()中同时提供x和y，其中x是字符或因子，y是数值。</span></span><br><span class="line">ggplot<span class="punctuation">(</span>mtcars<span class="punctuation">,</span> aes<span class="punctuation">(</span>x<span class="operator">=</span>car_name<span class="punctuation">,</span> y<span class="operator">=</span>mpg_z<span class="punctuation">,</span> label<span class="operator">=</span>mpg_z<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span>   geom_bar<span class="punctuation">(</span>stat<span class="operator">=</span><span class="string">&#x27;identity&#x27;</span><span class="punctuation">,</span> aes<span class="punctuation">(</span>fill<span class="operator">=</span>mpg_type<span class="punctuation">)</span><span class="punctuation">,</span> width<span class="operator">=</span><span class="number">.5</span><span class="punctuation">)</span>  <span class="operator">+</span> </span><br><span class="line">  scale_fill_manual<span class="punctuation">(</span>name<span class="operator">=</span><span class="string">&quot;Mileage&quot;</span><span class="punctuation">,</span> labels <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;Above Average&quot;</span><span class="punctuation">,</span> <span class="string">&quot;Below Average&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span> values <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;above&quot;</span><span class="operator">=</span><span class="string">&quot;#00ba38&quot;</span><span class="punctuation">,</span> <span class="string">&quot;below&quot;</span><span class="operator">=</span><span class="string">&quot;#f8766d&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span>  </span><br><span class="line">  labs<span class="punctuation">(</span>subtitle<span class="operator">=</span><span class="string">&quot;Normalised mileage from &#x27;mtcars&#x27;&quot;</span><span class="punctuation">,</span> title<span class="operator">=</span> <span class="string">&quot;Diverging Bars&quot;</span><span class="punctuation">)</span> <span class="operator">+</span> coord_flip<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">+</span> theme_bw<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment">#Diverging Lollipop Chart</span></span><br><span class="line">ggplot<span class="punctuation">(</span>mtcars<span class="punctuation">,</span> aes<span class="punctuation">(</span>x<span class="operator">=</span>car_name<span class="punctuation">,</span> y<span class="operator">=</span>mpg_z<span class="punctuation">,</span> label<span class="operator">=</span>mpg_z<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span>   geom_point<span class="punctuation">(</span>stat<span class="operator">=</span><span class="string">&#x27;identity&#x27;</span><span class="punctuation">,</span> color<span class="operator">=</span><span class="string">&quot;orange&quot;</span><span class="punctuation">,</span>size<span class="operator">=</span><span class="number">4</span><span class="punctuation">)</span>  <span class="operator">+</span>  geom_segment<span class="punctuation">(</span>aes<span class="punctuation">(</span>y <span class="operator">=</span> <span class="number">0</span><span class="punctuation">,</span> </span><br><span class="line">                                                                                                                                  x <span class="operator">=</span>car_name<span class="punctuation">,</span> </span><br><span class="line">                                                                                                                                  yend <span class="operator">=</span> mpg_z<span class="punctuation">,</span> </span><br><span class="line">                                                                                                                                  xend <span class="operator">=</span>car_name<span class="punctuation">)</span><span class="punctuation">,</span> </span><br><span class="line">                                                                                                                              color <span class="operator">=</span> <span class="string">&quot;grey&quot;</span><span class="punctuation">)</span>  <span class="operator">+</span>  labs<span class="punctuation">(</span>title<span class="operator">=</span><span class="string">&quot;Diverging Lollipop Chart&quot;</span><span class="punctuation">)</span> <span class="operator">+</span>   ylim<span class="punctuation">(</span><span class="operator">-</span><span class="number">2.5</span><span class="punctuation">,</span> <span class="number">2.5</span><span class="punctuation">)</span> <span class="operator">+</span>  coord_flip<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">+</span> theme_bw<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment">#点图</span></span><br><span class="line">ggplot<span class="punctuation">(</span>mtcars<span class="punctuation">,</span> aes<span class="punctuation">(</span>x<span class="operator">=</span>car_name<span class="punctuation">,</span> y<span class="operator">=</span>mpg_z<span class="punctuation">,</span> label<span class="operator">=</span>mpg_z<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span>   geom_point<span class="punctuation">(</span>stat<span class="operator">=</span><span class="string">&#x27;identity&#x27;</span><span class="punctuation">,</span> aes<span class="punctuation">(</span>col<span class="operator">=</span>mpg_type<span class="punctuation">)</span><span class="punctuation">,</span> size<span class="operator">=</span><span class="number">6</span><span class="punctuation">)</span>  <span class="operator">+</span>  scale_color_manual<span class="punctuation">(</span>name<span class="operator">=</span><span class="string">&quot;Mileage&quot;</span><span class="punctuation">,</span></span><br><span class="line">                                                                                                                                        labels <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;Above Average&quot;</span><span class="punctuation">,</span> <span class="string">&quot;Below Average&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">                                                                                                                                        values <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;above&quot;</span><span class="operator">=</span><span class="string">&quot;#00ba38&quot;</span><span class="punctuation">,</span> <span class="string">&quot;below&quot;</span><span class="operator">=</span><span class="string">&quot;#f8766d&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span>   geom_text<span class="punctuation">(</span>color<span class="operator">=</span><span class="string">&quot;white&quot;</span><span class="punctuation">,</span> size<span class="operator">=</span><span class="number">2</span><span class="punctuation">)</span> <span class="operator">+</span>  labs<span class="punctuation">(</span>title<span class="operator">=</span><span class="string">&quot;Diverging Dot Plot&quot;</span><span class="punctuation">,</span></span><br><span class="line">                                                                                                                                                                                                                                       subtitle<span class="operator">=</span><span class="string">&quot;Normalized mileage from &#x27;mtcars&#x27;: Dotplot&quot;</span><span class="punctuation">)</span> <span class="operator">+</span>   ylim<span class="punctuation">(</span><span class="operator">-</span><span class="number">2.5</span><span class="punctuation">,</span> <span class="number">2.5</span><span class="punctuation">)</span> <span class="operator">+</span>  coord_flip<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">+</span> theme_bw<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<hr>
<h3 id="bee蜜蜂图"><strong>bee蜜蜂图</strong></h3>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">setwd<span class="punctuation">(</span><span class="string">&#x27;./蜜蜂图/&#x27;</span><span class="punctuation">)</span></span><br><span class="line">rm<span class="punctuation">(</span><span class="built_in">list</span> <span class="operator">=</span> ls<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment">#install.packages(&quot;beeswarm&quot;)</span></span><br><span class="line">library<span class="punctuation">(</span><span class="string">&#x27;beeswarm&#x27;</span><span class="punctuation">)</span></span><br><span class="line"><span class="string">&#x27;&#x27;</span><span class="string">&#x27;</span></span><br><span class="line"><span class="string">其中主要的参数：</span></span><br><span class="line"><span class="string">Method 主要是指的散点图的样式。Center对称群；另外还有swarm（成群的），hex，square。</span></span><br><span class="line"><span class="string">spacing 各点之间距离。</span></span><br><span class="line"><span class="string">Cex 各点的大小。</span></span><br><span class="line"><span class="string">corral 控制点不超过坐标点的区域，可以结合corralWidth设置坐标位置宽度。超出的部分如果设置omit则会忽略；设置random会随机显示在覆盖的区域。</span></span><br><span class="line"><span class="string">Priority 点的排布，但是只在method=swarm时可用。其可选的参数包括：ascending（升序），descending（降序），density， random（随机显示） ，none。</span></span><br><span class="line"><span class="string">Add 是否加在其它绘图之上，比如箱线图上加这个图则设置为TRUE。</span></span><br><span class="line"><span class="string">Pwcol 设置分组，可以给与不同的颜色显示不同的点。当然，可以支持list设置多个组的不同样本颜色。</span></span><br><span class="line"><span class="string">Pch 点的形状，可以参考plot对点的设置。&#x27;</span><span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="comment">#单组数据</span></span><br><span class="line">distributions <span class="operator">&lt;-</span> data.frame<span class="punctuation">(</span>runif <span class="operator">=</span> runif<span class="punctuation">(</span><span class="number">200</span><span class="punctuation">,</span><span class="built_in">min</span> <span class="operator">=</span> <span class="operator">-</span><span class="number">3</span><span class="punctuation">,</span> <span class="built_in">max</span> <span class="operator">=</span> <span class="number">3</span><span class="punctuation">)</span><span class="punctuation">,</span> rnorm <span class="operator">=</span> rnorm<span class="punctuation">(</span><span class="number">200</span><span class="punctuation">)</span><span class="punctuation">,</span>rlnorm <span class="operator">=</span> rlnorm<span class="punctuation">(</span><span class="number">200</span><span class="punctuation">,</span> sdlog <span class="operator">=</span> <span class="number">0.5</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">beeswarm<span class="punctuation">(</span>distributions<span class="punctuation">,</span> col <span class="operator">=</span> <span class="number">2</span><span class="operator">:</span><span class="number">4</span><span class="punctuation">,</span> pch<span class="operator">=</span><span class="number">16</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment">###多组数据</span></span><br><span class="line"></span><br><span class="line">data<span class="punctuation">(</span>breast<span class="punctuation">)</span></span><br><span class="line">beeswarm<span class="punctuation">(</span>time_survival <span class="operator">~</span> ER<span class="punctuation">,</span> data <span class="operator">=</span> breast<span class="punctuation">,</span> pch <span class="operator">=</span> <span class="number">16</span><span class="punctuation">,</span> pwcol <span class="operator">=</span> <span class="number">1</span> <span class="operator">+</span><span class="built_in">as.numeric</span><span class="punctuation">(</span>event_survival<span class="punctuation">)</span><span class="punctuation">,</span>xlab <span class="operator">=</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span> ylab <span class="operator">=</span> <span class="string">&quot;Follow-up time(months)&quot;</span><span class="punctuation">,</span>labels <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;ER neg&quot;</span><span class="punctuation">,</span> <span class="string">&quot;ER pos&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span> </span><br><span class="line">legend<span class="punctuation">(</span><span class="string">&quot;topright&quot;</span><span class="punctuation">,</span> legend <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;Yes&quot;</span><span class="punctuation">,</span><span class="string">&quot;No&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span> title <span class="operator">=</span> <span class="string">&quot;Censored&quot;</span><span class="punctuation">,</span> pch <span class="operator">=</span> <span class="number">16</span><span class="punctuation">,</span> col <span class="operator">=</span> <span class="number">1</span><span class="operator">:</span><span class="number">2</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##每个组独立设置颜色</span></span><br><span class="line">Dd<span class="operator">=</span><span class="number">1</span> <span class="operator">+</span> <span class="built_in">as.numeric</span><span class="punctuation">(</span>breast <span class="operator">$</span>event_survival<span class="punctuation">)</span></span><br><span class="line">mycol<span class="operator">=</span><span class="built_in">list</span><span class="punctuation">(</span><span class="punctuation">)</span> </span><br><span class="line">neg<span class="operator">=</span>which<span class="punctuation">(</span>Dd<span class="operator">==</span><span class="number">1</span><span class="punctuation">)</span></span><br><span class="line">pos<span class="operator">=</span>which<span class="punctuation">(</span>Dd<span class="operator">==</span><span class="number">2</span><span class="punctuation">)</span></span><br><span class="line">mycol<span class="operator">$</span>neg<span class="operator">=</span>Dd<span class="punctuation">[</span><span class="number">1</span><span class="operator">:</span><span class="built_in">length</span><span class="punctuation">(</span>neg<span class="punctuation">)</span><span class="punctuation">]</span></span><br><span class="line">mycol<span class="operator">$</span>pos<span class="operator">=</span>Dd<span class="punctuation">[</span><span class="number">1</span><span class="operator">:</span><span class="built_in">length</span><span class="punctuation">(</span>pos<span class="punctuation">)</span><span class="punctuation">]</span><span class="operator">+</span><span class="number">1</span></span><br><span class="line">data<span class="operator">=</span><span class="built_in">list</span><span class="punctuation">(</span><span class="punctuation">)</span> </span><br><span class="line">data<span class="operator">$</span>neg<span class="operator">=</span>breast<span class="operator">$</span>time_survival<span class="punctuation">[</span>neg<span class="punctuation">]</span></span><br><span class="line">data<span class="operator">$</span>pos<span class="operator">=</span>breast<span class="operator">$</span>time_survival<span class="punctuation">[</span>pos<span class="punctuation">]</span></span><br><span class="line">beeswarm<span class="punctuation">(</span>data<span class="punctuation">,</span> pch <span class="operator">=</span> <span class="number">16</span><span class="punctuation">,</span> pwcol <span class="operator">=</span> mycol<span class="punctuation">,</span>xlab<span class="operator">=</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span> ylab <span class="operator">=</span> <span class="string">&quot;Follow-up time (months)&quot;</span><span class="punctuation">,</span>labels <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;ERneg&quot;</span><span class="punctuation">,</span> <span class="string">&quot;ER pos&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">legend<span class="punctuation">(</span><span class="string">&quot;topright&quot;</span><span class="punctuation">,</span> legend <span class="operator">=</span> <span class="number">1</span><span class="operator">:</span><span class="number">3</span><span class="punctuation">,</span>title <span class="operator">=</span> <span class="string">&quot;Censored&quot;</span><span class="punctuation">,</span> pch <span class="operator">=</span> <span class="number">16</span><span class="punctuation">,</span> col <span class="operator">=</span> <span class="number">1</span><span class="operator">:</span><span class="number">3</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#另外此包还内置了自己的一个箱线图的绘制函数，和R语言基础的函数名称是一样的boxplot：</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##基础箱线图 </span></span><br><span class="line">beeswarm<span class="punctuation">(</span>len <span class="operator">~</span> dose<span class="punctuation">,</span> data <span class="operator">=</span> ToothGrowth<span class="punctuation">)</span> </span><br><span class="line">bxplot<span class="punctuation">(</span>len <span class="operator">~</span> dose<span class="punctuation">,</span> data <span class="operator">=</span> ToothGrowth<span class="punctuation">,</span> add <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">###负责箱线图绘制</span></span><br><span class="line">data<span class="punctuation">(</span>breast<span class="punctuation">)</span> </span><br><span class="line">bxplot<span class="punctuation">(</span>time_survival <span class="operator">~</span> event_survival<span class="punctuation">,</span> data <span class="operator">=</span> breast<span class="punctuation">,</span> probs <span class="operator">=</span> seq<span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">,</span>by <span class="operator">=</span> <span class="number">0.1</span><span class="punctuation">)</span><span class="punctuation">,</span> col <span class="operator">=</span> rainbow<span class="punctuation">(</span><span class="number">10</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">beeswarm<span class="punctuation">(</span>time_survival <span class="operator">~</span> event_survival<span class="punctuation">,</span> data <span class="operator">=</span> breast<span class="punctuation">,</span> pch <span class="operator">=</span> <span class="number">21</span><span class="punctuation">,</span> bg <span class="operator">=</span><span class="string">&quot;green&quot;</span><span class="punctuation">,</span> add <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="beanplot-豆荚图">BeanPlot(豆荚图)</h3>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">library<span class="punctuation">(</span>beanplot<span class="punctuation">)</span></span><br><span class="line">par<span class="punctuation">(</span>mfrow <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">boxplot<span class="punctuation">(</span>len <span class="operator">~</span> dose<span class="punctuation">,</span> data <span class="operator">=</span> ToothGrowth<span class="punctuation">,</span></span><br><span class="line">        boxwex <span class="operator">=</span> <span class="number">0.25</span><span class="punctuation">,</span> at <span class="operator">=</span> <span class="number">1</span><span class="operator">:</span><span class="number">3</span> <span class="operator">-</span> <span class="number">0.2</span><span class="punctuation">,</span></span><br><span class="line">        subset <span class="operator">=</span> supp <span class="operator">==</span> <span class="string">&quot;VC&quot;</span><span class="punctuation">,</span> col <span class="operator">=</span> <span class="string">&quot;yellow&quot;</span><span class="punctuation">,</span></span><br><span class="line">        main <span class="operator">=</span> <span class="string">&quot;Guinea Pigs&#x27; Tooth Growth&quot;</span><span class="punctuation">,</span></span><br><span class="line">        xlab <span class="operator">=</span> <span class="string">&quot;Vitamin C dose mg&quot;</span><span class="punctuation">,</span></span><br><span class="line">        ylab <span class="operator">=</span> <span class="string">&quot;tooth length&quot;</span><span class="punctuation">,</span> ylim <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="operator">-</span><span class="number">1</span><span class="punctuation">,</span> <span class="number">40</span><span class="punctuation">)</span><span class="punctuation">,</span> yaxs <span class="operator">=</span> <span class="string">&quot;i&quot;</span><span class="punctuation">)</span></span><br><span class="line">boxplot<span class="punctuation">(</span>len <span class="operator">~</span> dose<span class="punctuation">,</span> data <span class="operator">=</span> ToothGrowth<span class="punctuation">,</span> add<span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">,</span></span><br><span class="line">        boxwex <span class="operator">=</span> <span class="number">0.25</span><span class="punctuation">,</span> at <span class="operator">=</span> <span class="number">1</span><span class="operator">:</span><span class="number">3</span> <span class="operator">+</span> <span class="number">0.2</span><span class="punctuation">,</span></span><br><span class="line">        subset <span class="operator">=</span> supp <span class="operator">==</span> <span class="string">&quot;OJ&quot;</span><span class="punctuation">,</span> col <span class="operator">=</span> <span class="string">&quot;orange&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">legend<span class="punctuation">(</span><span class="string">&quot;bottomright&quot;</span><span class="punctuation">,</span>bty<span class="operator">=</span><span class="string">&quot;n&quot;</span><span class="punctuation">,</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;Ascorbic acid&quot;</span><span class="punctuation">,</span> <span class="string">&quot;Orange juice&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">       fill <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;yellow&quot;</span><span class="punctuation">,</span> <span class="string">&quot;orange&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">beanplot<span class="punctuation">(</span>len <span class="operator">~</span> reorder<span class="punctuation">(</span>supp<span class="punctuation">,</span> len<span class="punctuation">,</span> mean<span class="punctuation">)</span> <span class="operator">*</span>dose<span class="punctuation">,</span> ToothGrowth<span class="punctuation">,</span></span><br><span class="line">         side <span class="operator">=</span> <span class="string">&quot;b&quot;</span><span class="punctuation">,</span> col <span class="operator">=</span> <span class="built_in">list</span><span class="punctuation">(</span><span class="string">&quot;yellow&quot;</span><span class="punctuation">,</span><span class="string">&quot;orange&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span> border <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;yellow2&quot;</span><span class="punctuation">,</span></span><br><span class="line">                                                               <span class="string">&quot;darkorange&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span> main <span class="operator">=</span> <span class="string">&quot;Guinea Pigs&#x27; Tooth Growth&quot;</span><span class="punctuation">,</span></span><br><span class="line">         xlab <span class="operator">=</span> <span class="string">&quot;Vitamin C dose mg&quot;</span><span class="punctuation">,</span> ylab <span class="operator">=</span> <span class="string">&quot;tooth length&quot;</span><span class="punctuation">,</span>ylim <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="operator">-</span><span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">                                                                    <span class="number">40</span><span class="punctuation">)</span><span class="punctuation">,</span> yaxs <span class="operator">=</span> <span class="string">&quot;i&quot;</span><span class="punctuation">)</span></span><br><span class="line">legend<span class="punctuation">(</span><span class="string">&quot;bottomright&quot;</span><span class="punctuation">,</span>bty<span class="operator">=</span><span class="string">&quot;n&quot;</span><span class="punctuation">,</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;Ascorbic acid&quot;</span><span class="punctuation">,</span> <span class="string">&quot;Orange juice&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">       fill <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;yellow&quot;</span><span class="punctuation">,</span> <span class="string">&quot;orange&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<h3 id="none"></h3>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">library<span class="punctuation">(</span>ggplot2<span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>ggsci<span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>ggalluvial<span class="punctuation">)</span></span><br><span class="line">rm<span class="punctuation">(</span><span class="built_in">list</span> <span class="operator">=</span> ls<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">pdf<span class="punctuation">(</span><span class="string">&#x27;./phylum.pdf&#x27;</span><span class="punctuation">)</span></span><br><span class="line">phylum <span class="operator">&lt;-</span> read.delim<span class="punctuation">(</span><span class="string">&quot;1.txt&quot;</span><span class="punctuation">,</span>check.names <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">,</span>stringsAsFactors <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span></span><br><span class="line">p <span class="operator">&lt;-</span> ggplot<span class="punctuation">(</span>data <span class="operator">=</span> phylum<span class="punctuation">,</span>aes<span class="punctuation">(</span>x<span class="operator">=</span>variable<span class="punctuation">,</span>y<span class="operator">=</span>value<span class="punctuation">,</span>alluvium<span class="operator">=</span>Phylum<span class="punctuation">,</span>stratum<span class="operator">=</span>Phylum<span class="punctuation">,</span>fill<span class="operator">=</span>Phylum<span class="punctuation">)</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  geom_alluvium<span class="punctuation">(</span>aes<span class="punctuation">(</span>fill<span class="operator">=</span>Phylum<span class="punctuation">,</span>colour <span class="operator">=</span> Phylum<span class="punctuation">)</span><span class="punctuation">)</span><span class="operator">+</span>geom_stratum<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line">p<span class="operator">+</span>scale_color_npg<span class="punctuation">(</span><span class="punctuation">)</span><span class="operator">+</span>scale_fill_npg<span class="punctuation">(</span><span class="punctuation">)</span><span class="operator">+</span>theme<span class="punctuation">(</span>axis.text.x<span class="operator">=</span>element_text<span class="punctuation">(</span>size<span class="operator">=</span><span class="number">12</span><span class="punctuation">)</span><span class="punctuation">,</span>axis.text.y<span class="operator">=</span>element_text<span class="punctuation">(</span>size<span class="operator">=</span><span class="number">12</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">                                           legend.text<span class="operator">=</span>element_text<span class="punctuation">(</span>size<span class="operator">=</span><span class="number">10</span><span class="punctuation">)</span><span class="punctuation">,</span>legend.title<span class="operator">=</span>element_blank<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">                                           legend.position <span class="operator">=</span> <span class="string">&#x27;bottom&#x27;</span><span class="punctuation">)</span><span class="operator">+</span>xlab<span class="punctuation">(</span><span class="string">&#x27;&#x27;</span><span class="punctuation">)</span><span class="operator">+</span>ylab<span class="punctuation">(</span><span class="string">&#x27;&#x27;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">dev.off<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>饼图</p>
<p><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s?__biz=MzA3MzcwNDMyNA==&amp;mid=2247485098&amp;idx=2&amp;sn=4adcf3c4aca5d9c03208aec5e4c2f518&amp;chksm=9f0bb041a87c39571e5e0a40af63163d0e1d50519de3ccf0a4eb2a39085d058fd53cb770a233&amp;mpshare=1&amp;scene=1&amp;srcid=&amp;sharer_sharetime=1592181290604&amp;sharer_shareid=a9c678b9d5b98f3f89a861807cb45f79&amp;key=15fd7ea6eecdea226a0c8d700a877f32f4cc6f881ba1899577fd51be3fd12a1b6786d85702fda9dd1b3ae38d5e9191d24d627e02150f230a186dbf45b6747e6be38f080f5b8f93564eb463ac6a0911c3&amp;ascene=1&amp;uin=Mjc2NjUwNjgzOA%3D%3D&amp;devicetype=Windows+10+x64&amp;version=62090070&amp;lang=zh_CN&amp;exportkey=AzadIfn6%2BwTEjW2SziDxCMM%3D&amp;pass_ticket=u7NR5bYzf02sDg1rcV%2FEKVKBwY5earOnuUBXjo84nhp6rauQdjFylEmD7mJC851l">【R与Excel】满足需求：多层饼图 </a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="comment">#The slices will be ordered and plotted counter-clockwise.</span></span><br><span class="line">labels =<span class="string">&#x27;Frogs&#x27;</span>,<span class="string">&#x27;Hogs&#x27;</span>,<span class="string">&#x27;Dogs&#x27;</span>,<span class="string">&#x27;Logs&#x27;</span><span class="comment">#定义标签</span></span><br><span class="line">sizes=[<span class="number">15</span>,<span class="number">30</span>,<span class="number">45</span>,<span class="number">10</span>]<span class="comment">#每一块的比例</span></span><br><span class="line">colors=[<span class="string">&#x27;yellowgreen&#x27;</span>,<span class="string">&#x27;gold&#x27;</span>,<span class="string">&#x27;lightskyblue&#x27;</span>,<span class="string">&#x27;lightcoral&#x27;</span>]<span class="comment">#每一块的颜色</span></span><br><span class="line">explode=(<span class="number">0</span>, <span class="number">0.1</span>, <span class="number">0.1</span>, <span class="number">0</span>)<span class="comment">#突出显示，这里仅仅突出显示第二块（即Hogs&#x27;）</span></span><br><span class="line">plt.pie(sizes,explode=explode,labels=labels,colors=colors,autopct=<span class="string">&#x27;%1.1f%%&#x27;</span>,shadow=<span class="literal">True</span>,startangle=<span class="number">90</span>)</span><br><span class="line">plt.axis (<span class="string">&#x27;equal&#x27;</span>)<span class="comment">#显示为圆（避免比例压缩为椭圆）</span></span><br><span class="line">plt.show ()</span><br><span class="line">plt.savefig(<span class="string">&#x27;piechart.png&#x27;</span> , dpi=<span class="number">300</span>)</span><br><span class="line"></span><br><span class="line">***************R中方法******************</span><br><span class="line">a &lt;- c(<span class="string">&quot;A&quot;</span>,<span class="string">&quot;B&quot;</span>,<span class="string">&quot;C&quot;</span>,<span class="string">&quot;D&quot;</span>,<span class="string">&quot;E&quot;</span>,<span class="string">&quot;F&quot;</span>,<span class="string">&quot;G&quot;</span>)</span><br><span class="line">b &lt;- c(<span class="number">17</span>,<span class="number">13</span>,<span class="number">8</span>,<span class="number">5</span>,<span class="number">10</span>,<span class="number">2</span>,<span class="number">9</span>)</span><br><span class="line">pct &lt;- <span class="built_in">round</span>(b/<span class="built_in">sum</span>(b)*<span class="number">100</span>)</span><br><span class="line">lab &lt;- paste(a,<span class="string">&#x27; &#x27;</span>,pct,<span class="string">&quot;%&quot;</span>,sep = <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">d &lt;- data.frame(a,b,lab)</span><br><span class="line">d &lt;- d[order(d[,<span class="string">&quot;b&quot;</span>]),]</span><br><span class="line">library(RColorBrewer)</span><br><span class="line">pie(d[,<span class="string">&quot;b&quot;</span>],labels=NA,clockwise=T,col=brewer.pal(<span class="number">7</span>,<span class="string">&quot;Set1&quot;</span>),</span><br><span class="line">    border=<span class="string">&quot;white&quot;</span>,radius=<span class="number">0.9</span>,cex=<span class="number">0.5</span>,main=<span class="string">&quot;Pie chart&quot;</span>)</span><br><span class="line"><span class="comment">#添加图例</span></span><br><span class="line">legend(<span class="string">&quot;right&quot;</span>,legend = lab,bty = <span class="string">&quot;n&quot;</span>,inset = c(-<span class="number">0.7</span>,<span class="number">0</span>),</span><br><span class="line">       xpd = T,fill = brewer.pal(<span class="number">7</span>,<span class="string">&quot;Set1&quot;</span>))</span><br><span class="line"><span class="comment">#还有一种方式是在扇形的附近进行文字标注</span></span><br><span class="line">pie(d$b,labels=d$lab,col=rainbow(length(d$lab)),</span><br><span class="line">    main=<span class="string">&quot;Pie Chart with Percentage&quot;</span>)</span><br><span class="line"><span class="comment">#3D饼图</span></span><br><span class="line">library(plotrix)</span><br><span class="line">pie3D(d$b, labels=d$lab, explode=<span class="number">0.1</span>, height = <span class="number">0.2</span>,</span><br><span class="line">      radius = <span class="number">0.8</span>, main=<span class="string">&quot;3D Pie Chart&quot;</span>,col =  brewer.pal(<span class="number">7</span>,<span class="string">&quot;Set1&quot;</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">#ggplot2画法</span></span><br><span class="line">color &lt;- c(<span class="string">&#x27;#FF7F00&#x27;</span>, <span class="string">&#x27;#FFFF33&#x27;</span>, <span class="string">&#x27;#984EA3&#x27;</span>, <span class="string">&#x27;#4DAF4A&#x27;</span>, <span class="string">&#x27;#377EB8&#x27;</span>, <span class="string">&#x27;#E41A1C&#x27;</span>,</span><br><span class="line">           <span class="string">&#x27;#FFED6F&#x27;</span>, <span class="string">&#x27;#CCEBC5&#x27;</span>, <span class="string">&#x27;#BC80BD&#x27;</span>, <span class="string">&#x27;#FCCDE5&#x27;</span>, <span class="string">&#x27;#B3DE69&#x27;</span>, <span class="string">&#x27;#FDB462&#x27;</span>)</span><br><span class="line">names(color) &lt;- names(phylum)</span><br><span class="line">library(ggplot2)</span><br><span class="line"></span><br><span class="line"><span class="built_in">dir</span>.create(<span class="string">&#x27;plot&#x27;</span>, recursive = TRUE)  <span class="comment">#创建目录“plot”用于存放图片</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (module <span class="keyword">in</span> unique(node$modularity_class)) &#123;</span><br><span class="line">  node_module &lt;- subset(node, modularity_class == module)</span><br><span class="line">  node_phylum &lt;- data.frame(table(node_module$phylum))</span><br><span class="line">  </span><br><span class="line">  p &lt;- ggplot(node_phylum, aes(x = <span class="string">&#x27;&#x27;</span>, y = Freq, fill = Var1)) + </span><br><span class="line">    geom_bar(stat = <span class="string">&#x27;identity&#x27;</span>, width = <span class="number">1</span>) +</span><br><span class="line">    coord_polar(theta = <span class="string">&#x27;y&#x27;</span>) +</span><br><span class="line">    scale_fill_manual(limits = names(color), values = color) + </span><br><span class="line">    theme(panel.grid = element_blank(), panel.background = element_blank(), </span><br><span class="line">          axis.text.x = element_blank()) +</span><br><span class="line">    labs(x = <span class="string">&#x27;&#x27;</span>, y = <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">  ggsave(paste(<span class="string">&#x27;plot/&#x27;</span>, module,<span class="string">&#x27;.pdf&#x27;</span>, sep = <span class="string">&#x27;&#x27;</span>), p)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="直方图"><strong>直方图</strong></h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">barplot(data3, xlab=&quot;x-axis&quot;, ylab=&quot;y-axis&quot;, main=&quot;bar chart 1&quot;,</span><br><span class="line">col=c(&quot;grey&quot;, &quot;blue&quot;, &quot;yellow&quot;), beside=TRUE);#不加beside就位填充图</span><br></pre></td></tr></table></figure>
<p><strong>base包画直方图</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&gt; set.seed(123);</span><br><span class="line">&gt; data1 &lt;- rnorm(100, mean=5, sd=3);</span><br><span class="line">&gt; hist(data1, main=&quot;histogram&quot;, xlab=&quot;x-axis&quot;, col=&quot;green&quot;,</span><br><span class="line">border=&quot;blue&quot;, breaks=10, freq=FALSE);</span><br><span class="line">&gt; lines(density(data1), col=&quot;red&quot;);</span><br><span class="line"></span><br><span class="line">hist(x,breaks=20,ylim=c(0,220))</span><br><span class="line">text(res$mids,res$counts+10,labels=res$counts)</span><br><span class="line">#ggplot格式</span><br><span class="line">ggplot(data,aes(x=mids,y=counts)) + geom_bar(stat=&quot;identity&quot;) + geom_text(aes(label=counts),vjust=-1) + ylim(0,220)</span><br></pre></td></tr></table></figure>
<p><strong>填充形状不同的直方图</strong></p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># create dummy data</span></span><br><span class="line">data <span class="operator">&lt;-</span> data.frame<span class="punctuation">(</span></span><br><span class="line">  name<span class="operator">=</span><span class="built_in">letters</span><span class="punctuation">[</span><span class="number">1</span><span class="operator">:</span><span class="number">5</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  value<span class="operator">=</span>sample<span class="punctuation">(</span>seq<span class="punctuation">(</span><span class="number">4</span><span class="punctuation">,</span><span class="number">15</span><span class="punctuation">)</span><span class="punctuation">,</span><span class="number">5</span><span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># barplot</span></span><br><span class="line">barplot<span class="punctuation">(</span> height<span class="operator">=</span>data<span class="operator">$</span>value<span class="punctuation">,</span> <span class="built_in">names</span><span class="operator">=</span>data<span class="operator">$</span>name <span class="punctuation">,</span> density<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">5</span><span class="punctuation">,</span><span class="number">10</span><span class="punctuation">,</span><span class="number">20</span><span class="punctuation">,</span><span class="number">30</span><span class="punctuation">,</span><span class="number">7</span><span class="punctuation">)</span> <span class="punctuation">,</span> angle<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span><span class="number">45</span><span class="punctuation">,</span><span class="number">90</span><span class="punctuation">,</span><span class="number">11</span><span class="punctuation">,</span><span class="number">36</span><span class="punctuation">)</span> <span class="punctuation">,</span> col<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;red&quot;</span><span class="punctuation">,</span><span class="string">&quot;grey&quot;</span><span class="punctuation">,</span><span class="string">&quot;black&quot;</span><span class="punctuation">,</span><span class="string">&quot;#EA1D4B&quot;</span><span class="punctuation">,</span><span class="string">&quot;yellow&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment">#density可以通过调控线的密度，angle通过调控线的方向来做出不同样式的填充线。这两种参数一起调控，可实现相当多的类型。</span></span><br></pre></td></tr></table></figure>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">setwd<span class="punctuation">(</span><span class="string">&#x27;../直方图/&#x27;</span><span class="punctuation">)</span></span><br><span class="line">rm<span class="punctuation">(</span><span class="built_in">list</span> <span class="operator">=</span> ls<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>ggplot2<span class="punctuation">)</span></span><br><span class="line">set.seed<span class="punctuation">(</span><span class="number">1234</span><span class="punctuation">)</span></span><br><span class="line">df <span class="operator">&lt;-</span>  data.frame<span class="punctuation">(</span>sex <span class="operator">=</span> factor<span class="punctuation">(</span><span class="built_in">rep</span><span class="punctuation">(</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;F&quot;</span><span class="punctuation">,</span><span class="string">&quot;M&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span>each <span class="operator">=</span> <span class="number">200</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">,</span>weight <span class="operator">=</span> <span class="built_in">round</span><span class="punctuation">(</span><span class="built_in">c</span><span class="punctuation">(</span>rnorm<span class="punctuation">(</span><span class="number">200</span><span class="punctuation">,</span>mean <span class="operator">=</span> <span class="number">55</span><span class="punctuation">,</span>sd <span class="operator">=</span> <span class="number">5</span><span class="punctuation">)</span><span class="punctuation">,</span>rnorm<span class="punctuation">(</span><span class="number">200</span><span class="punctuation">,</span>mean <span class="operator">=</span> <span class="number">65</span><span class="punctuation">,</span>sd<span class="operator">=</span> <span class="number">5</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">ggplot<span class="punctuation">(</span>df<span class="punctuation">,</span>aes<span class="punctuation">(</span>x<span class="operator">=</span>weight<span class="punctuation">)</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  geom_histogram<span class="punctuation">(</span>binwidth <span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span>color <span class="operator">=</span> <span class="string">&quot; black&quot;</span><span class="punctuation">,</span>fill <span class="operator">=</span> <span class="string">&quot; white&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">ggplot<span class="punctuation">(</span>df<span class="punctuation">,</span> aes<span class="punctuation">(</span>x<span class="operator">=</span>weight<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_histogram<span class="punctuation">(</span>binwidth<span class="operator">=</span><span class="number">1</span><span class="punctuation">,</span>color<span class="operator">=</span><span class="string">&quot;black&quot;</span><span class="punctuation">,</span> fill<span class="operator">=</span><span class="string">&quot;lightblue&quot;</span><span class="punctuation">,</span>linetype<span class="operator">=</span><span class="string">&quot;dashed&quot;</span><span class="punctuation">)</span><span class="operator">+</span> <span class="comment">#设置框线类型，颜色和fill的颜色</span></span><br><span class="line">  geom_vline<span class="punctuation">(</span>aes<span class="punctuation">(</span>xintercept<span class="operator">=</span>mean<span class="punctuation">(</span>weight<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">,</span> color<span class="operator">=</span><span class="string">&quot;blue&quot;</span><span class="punctuation">,</span> linetype<span class="operator">=</span><span class="string">&quot;dashed&quot;</span><span class="punctuation">,</span> size<span class="operator">=</span><span class="number">1</span><span class="punctuation">)</span> <span class="comment">#添加均值线，设置线型，颜色等</span></span><br><span class="line"></span><br><span class="line">ggplot<span class="punctuation">(</span>df<span class="punctuation">,</span> aes<span class="punctuation">(</span>x<span class="operator">=</span>weight<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span> </span><br><span class="line">  geom_histogram<span class="punctuation">(</span>aes<span class="punctuation">(</span>y<span class="operator">=</span>..density..<span class="punctuation">)</span><span class="punctuation">,</span> colour<span class="operator">=</span><span class="string">&quot;black&quot;</span><span class="punctuation">,</span> fill<span class="operator">=</span><span class="string">&quot;white&quot;</span><span class="punctuation">)</span><span class="operator">+</span> <span class="comment"># 需要密度形式 </span></span><br><span class="line">  geom_density<span class="punctuation">(</span>alpha<span class="operator">=</span><span class="number">.2</span><span class="punctuation">,</span> fill<span class="operator">=</span><span class="string">&quot;#FF6666&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">ggplot<span class="punctuation">(</span>df<span class="punctuation">,</span> aes<span class="punctuation">(</span>x<span class="operator">=</span>weight<span class="punctuation">,</span> color<span class="operator">=</span>sex<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_histogram<span class="punctuation">(</span>fill<span class="operator">=</span><span class="string">&quot;white&quot;</span><span class="punctuation">,</span> alpha<span class="operator">=</span><span class="number">0.5</span><span class="punctuation">,</span> position<span class="operator">=</span><span class="string">&quot;identity&quot;</span><span class="punctuation">)</span> <span class="comment">#分组设置 其中position可选 “identity”, “stack”, “dodge”. 默认值是 “stack”.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#分组添加均值线</span></span><br><span class="line">library<span class="punctuation">(</span>plyr<span class="punctuation">)</span></span><br><span class="line">mu <span class="operator">&lt;-</span> ddply<span class="punctuation">(</span>df<span class="punctuation">,</span> <span class="string">&quot;sex&quot;</span><span class="punctuation">,</span> summarise<span class="punctuation">,</span> grp.mean<span class="operator">=</span>mean<span class="punctuation">(</span>weight<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">p<span class="operator">&lt;-</span>ggplot<span class="punctuation">(</span>df<span class="punctuation">,</span> aes<span class="punctuation">(</span>x<span class="operator">=</span>weight<span class="punctuation">,</span> color<span class="operator">=</span>sex<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_histogram<span class="punctuation">(</span>fill<span class="operator">=</span><span class="string">&quot;white&quot;</span><span class="punctuation">,</span> position<span class="operator">=</span><span class="string">&quot;dodge&quot;</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  geom_vline<span class="punctuation">(</span>data<span class="operator">=</span>mu<span class="punctuation">,</span> aes<span class="punctuation">(</span>xintercept<span class="operator">=</span>grp.mean<span class="punctuation">,</span> color<span class="operator">=</span>sex<span class="punctuation">)</span><span class="punctuation">,</span>linetype<span class="operator">=</span><span class="string">&quot;dashed&quot;</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  theme<span class="punctuation">(</span>legend.position<span class="operator">=</span><span class="string">&quot;top&quot;</span><span class="punctuation">)</span></span><br><span class="line">p</span><br><span class="line"></span><br><span class="line"><span class="comment"># Use custom color palettes  自定义颜色</span></span><br><span class="line">p<span class="operator">+</span>scale_color_manual<span class="punctuation">(</span>values<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;#999999&quot;</span><span class="punctuation">,</span> <span class="string">&quot;#E69F00&quot;</span><span class="punctuation">,</span> <span class="string">&quot;#56B4E9&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment"># Use brewer color palettes</span></span><br><span class="line">p<span class="operator">+</span>scale_color_brewer<span class="punctuation">(</span>palette<span class="operator">=</span><span class="string">&quot;Dark2&quot;</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment"># Use grey scale</span></span><br><span class="line">p <span class="operator">+</span> scale_color_grey<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">+</span> theme_classic<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">+</span> theme<span class="punctuation">(</span>legend.position<span class="operator">=</span><span class="string">&quot;top&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#分组更改fill设置</span></span><br><span class="line">ggplot<span class="punctuation">(</span>df<span class="punctuation">,</span> aes<span class="punctuation">(</span>x<span class="operator">=</span>weight<span class="punctuation">,</span> fill<span class="operator">=</span>sex<span class="punctuation">,</span> color<span class="operator">=</span>sex<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span>  geom_histogram<span class="punctuation">(</span>binwidth<span class="operator">=</span><span class="number">1</span><span class="punctuation">,</span>position<span class="operator">=</span><span class="string">&quot;identity&quot;</span><span class="punctuation">,</span> alpha<span class="operator">=</span><span class="number">0.5</span><span class="punctuation">)</span><span class="operator">+</span> geom_vline<span class="punctuation">(</span>data<span class="operator">=</span>mu<span class="punctuation">,</span> aes<span class="punctuation">(</span>xintercept<span class="operator">=</span>grp.mean<span class="punctuation">)</span><span class="punctuation">,</span>linetype<span class="operator">=</span><span class="string">&quot;dashed&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#depth 深度、GC 含量散点密度图</span></span><br><span class="line">depth_GC <span class="operator">&lt;-</span> ggplot<span class="punctuation">(</span>depth_base<span class="punctuation">,</span> aes<span class="punctuation">(</span>GC<span class="punctuation">,</span> depth<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">	geom_point<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&#x27;gray&#x27;</span><span class="punctuation">,</span> alpha <span class="operator">=</span> <span class="number">0.6</span><span class="punctuation">,</span> pch <span class="operator">=</span> <span class="number">19</span><span class="punctuation">,</span> size <span class="operator">=</span> <span class="number">0.5</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">	geom_vline<span class="punctuation">(</span>xintercept <span class="operator">=</span> GC_mean<span class="punctuation">,</span> color <span class="operator">=</span> <span class="string">&#x27;red&#x27;</span><span class="punctuation">,</span> lty <span class="operator">=</span> <span class="number">2</span><span class="punctuation">,</span> lwd <span class="operator">=</span> <span class="number">0.5</span><span class="punctuation">)</span> <span class="operator">+</span> </span><br><span class="line">	geom_hline<span class="punctuation">(</span>yintercept <span class="operator">=</span> depth_mean<span class="punctuation">,</span> color <span class="operator">=</span> <span class="string">&#x27;red&#x27;</span><span class="punctuation">,</span> lty <span class="operator">=</span> <span class="number">2</span><span class="punctuation">,</span> lwd <span class="operator">=</span> <span class="number">0.5</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">	stat_density2d<span class="punctuation">(</span>aes<span class="punctuation">(</span>fill <span class="operator">=</span> ..density..<span class="punctuation">,</span> alpha <span class="operator">=</span> ..density..<span class="punctuation">)</span><span class="punctuation">,</span> geom <span class="operator">=</span> <span class="string">&#x27;tile&#x27;</span><span class="punctuation">,</span> contour <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">,</span> n <span class="operator">=</span> <span class="number">500</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">	scale_fill_gradientn<span class="punctuation">(</span>colors <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;transparent&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;gray&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;yellow&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;red&#x27;</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">	theme<span class="punctuation">(</span>panel.grid.major <span class="operator">=</span> element_line<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&#x27;gray&#x27;</span><span class="punctuation">,</span> linetype <span class="operator">=</span> <span class="number">2</span><span class="punctuation">,</span> size <span class="operator">=</span> <span class="number">0.25</span><span class="punctuation">)</span><span class="punctuation">,</span> panel.background <span class="operator">=</span> element_rect<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&#x27;black&#x27;</span><span class="punctuation">,</span> fill <span class="operator">=</span> <span class="string">&#x27;transparent&#x27;</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">	labs<span class="punctuation">(</span>x <span class="operator">=</span> paste<span class="punctuation">(</span><span class="string">&#x27;GC % (Average :&#x27;</span><span class="punctuation">,</span> GC_mean<span class="punctuation">,</span> <span class="string">&#x27;%)&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span> y <span class="operator">=</span> paste<span class="punctuation">(</span><span class="string">&#x27;Depth (Average :&#x27;</span><span class="punctuation">,</span> depth_mean<span class="punctuation">,</span> <span class="string">&#x27;X)&#x27;</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">	theme<span class="punctuation">(</span>axis.text <span class="operator">=</span> element_text<span class="punctuation">(</span>size <span class="operator">=</span> <span class="number">10</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">	theme<span class="punctuation">(</span>axis.title <span class="operator">=</span> element_text<span class="punctuation">(</span>size <span class="operator">=</span> <span class="number">12</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">	theme<span class="punctuation">(</span>legend.position <span class="operator">=</span> <span class="string">&#x27;none&#x27;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#depth 深度直方密度图</span></span><br><span class="line">depth_hist <span class="operator">&lt;-</span> ggplot<span class="punctuation">(</span>depth_base<span class="punctuation">,</span> aes<span class="punctuation">(</span>depth<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">	geom_histogram<span class="punctuation">(</span>binwidth <span class="operator">=</span> <span class="punctuation">(</span><span class="built_in">max</span><span class="punctuation">(</span>depth_base<span class="operator">$</span>depth<span class="punctuation">)</span> <span class="operator">-</span> <span class="built_in">min</span><span class="punctuation">(</span>depth_base<span class="operator">$</span>depth<span class="punctuation">)</span><span class="punctuation">)</span><span class="operator">/</span><span class="number">100</span><span class="punctuation">,</span> fill <span class="operator">=</span> <span class="string">&#x27;gray&#x27;</span><span class="punctuation">,</span> color <span class="operator">=</span> <span class="string">&#x27;gray40&#x27;</span><span class="punctuation">,</span> size <span class="operator">=</span> <span class="number">0.1</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">	geom_rug<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&#x27;gray&#x27;</span><span class="punctuation">,</span> alpha <span class="operator">=</span> <span class="number">0.6</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">	theme<span class="punctuation">(</span>panel.grid.major <span class="operator">=</span> element_line<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&#x27;gray&#x27;</span><span class="punctuation">,</span> linetype <span class="operator">=</span> <span class="number">2</span><span class="punctuation">,</span> size <span class="operator">=</span> <span class="number">0.25</span><span class="punctuation">)</span><span class="punctuation">,</span> panel.background <span class="operator">=</span> element_rect<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&#x27;black&#x27;</span><span class="punctuation">,</span> fill <span class="operator">=</span> <span class="string">&#x27;transparent&#x27;</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">	theme<span class="punctuation">(</span>axis.line <span class="operator">=</span> element_line<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&#x27;black&#x27;</span><span class="punctuation">,</span> size <span class="operator">=</span> <span class="number">0.3</span><span class="punctuation">)</span><span class="punctuation">,</span> axis.text <span class="operator">=</span> element_text<span class="punctuation">(</span>size <span class="operator">=</span> <span class="number">10</span><span class="punctuation">)</span><span class="punctuation">,</span> axis.title <span class="operator">=</span> element_text<span class="punctuation">(</span>size <span class="operator">=</span> <span class="number">12</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">	labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&#x27;&#x27;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&#x27;Numbers&#x27;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">	coord_flip<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">	geom_vline<span class="punctuation">(</span>xintercept <span class="operator">=</span> depth_mean<span class="punctuation">,</span> color <span class="operator">=</span> <span class="string">&#x27;red&#x27;</span><span class="punctuation">,</span> lty <span class="operator">=</span> <span class="number">2</span><span class="punctuation">,</span> lwd <span class="operator">=</span> <span class="number">0.5</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#GC 含量直方密度图</span></span><br><span class="line">GC_hist <span class="operator">&lt;-</span> ggplot<span class="punctuation">(</span>depth_base<span class="punctuation">,</span> aes<span class="punctuation">(</span>GC<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">	geom_histogram<span class="punctuation">(</span>binwidth <span class="operator">=</span> <span class="punctuation">(</span><span class="built_in">max</span><span class="punctuation">(</span>depth_base<span class="operator">$</span>GC<span class="punctuation">)</span> <span class="operator">-</span> <span class="built_in">min</span><span class="punctuation">(</span>depth_base<span class="operator">$</span>GC<span class="punctuation">)</span><span class="punctuation">)</span><span class="operator">/</span><span class="number">100</span><span class="punctuation">,</span> fill <span class="operator">=</span> <span class="string">&#x27;gray&#x27;</span><span class="punctuation">,</span> color <span class="operator">=</span> <span class="string">&#x27;gray40&#x27;</span><span class="punctuation">,</span> size <span class="operator">=</span> <span class="number">0.1</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">	geom_rug<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&#x27;gray&#x27;</span><span class="punctuation">,</span> alpha <span class="operator">=</span> <span class="number">0.6</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">	theme<span class="punctuation">(</span>panel.grid.major <span class="operator">=</span> element_line<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&#x27;gray&#x27;</span><span class="punctuation">,</span> linetype <span class="operator">=</span> <span class="number">2</span><span class="punctuation">,</span> size <span class="operator">=</span> <span class="number">0.25</span><span class="punctuation">)</span><span class="punctuation">,</span> panel.background <span class="operator">=</span> element_rect<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&#x27;black&#x27;</span><span class="punctuation">,</span> fill <span class="operator">=</span> <span class="string">&#x27;transparent&#x27;</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">	theme<span class="punctuation">(</span>axis.line <span class="operator">=</span> element_line<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&#x27;black&#x27;</span><span class="punctuation">,</span> size <span class="operator">=</span> <span class="number">0.3</span><span class="punctuation">)</span><span class="punctuation">,</span> axis.text <span class="operator">=</span> element_text<span class="punctuation">(</span>size <span class="operator">=</span> <span class="number">10</span><span class="punctuation">)</span><span class="punctuation">,</span> axis.title <span class="operator">=</span> element_text<span class="punctuation">(</span>size <span class="operator">=</span> <span class="number">12</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">	labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&#x27;&#x27;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&#x27;Numbers&#x27;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">	geom_vline<span class="punctuation">(</span>xintercept <span class="operator">=</span> GC_mean<span class="punctuation">,</span> color <span class="operator">=</span> <span class="string">&#x27;red&#x27;</span><span class="punctuation">,</span> lty <span class="operator">=</span> <span class="number">2</span><span class="punctuation">,</span> lwd <span class="operator">=</span> <span class="number">0.5</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#组合图片并输出</span></span><br><span class="line"><span class="comment">#pdf(paste(opt$output, &#x27;.pdf&#x27;, sep = &#x27;.&#x27;), width = 8, height = 8)</span></span><br><span class="line"><span class="comment">#	grid.newpage()</span></span><br><span class="line"><span class="comment">#	pushViewport(viewport(layout = grid.layout(3, 3)))</span></span><br><span class="line"><span class="comment">#	print(depth_GC, vp = viewport(layout.pos.row = 2:3, layout.pos.col = 1:2))</span></span><br><span class="line"><span class="comment">#	print(GC_hist, vp = viewport(layout.pos.row = 1, layout.pos.col = 1:2))</span></span><br><span class="line"><span class="comment">#	print(depth_hist, vp = viewport(layout.pos.row = 2:3, layout.pos.col = 3))</span></span><br><span class="line"><span class="comment">#dev.off()</span></span><br></pre></td></tr></table></figure>
<h3 id="热图">热图</h3>
<h4 id="对角线热图">对角线热图</h4>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/zhouhucheng00/article/details/86143828">ggplot绘制热图</a></p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">rm<span class="punctuation">(</span><span class="built_in">list</span> <span class="operator">=</span> ls<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span><span class="string">&#x27;ggmatrix&#x27;</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment"># install.packages(&quot;devtools&quot;)</span></span><br><span class="line">devtools<span class="operator">::</span>install_github<span class="punctuation">(</span><span class="string">&quot;houyunhuang/ggmatrix&quot;</span><span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>ggmatrix<span class="punctuation">)</span> <span class="comment">## 0.1.2版本</span></span><br><span class="line">library<span class="punctuation">(</span>RColorBrewer<span class="punctuation">)</span></span><br><span class="line">df <span class="operator">&lt;-</span> data.frame<span class="punctuation">(</span>x <span class="operator">=</span> <span class="built_in">rep</span><span class="punctuation">(</span><span class="number">1</span><span class="operator">:</span><span class="number">11</span><span class="punctuation">,</span> <span class="number">14</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">                 y <span class="operator">=</span> <span class="built_in">rep</span><span class="punctuation">(</span><span class="number">1</span><span class="operator">:</span><span class="number">14</span><span class="punctuation">,</span> each <span class="operator">=</span> <span class="number">11</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">                 group <span class="operator">=</span> sample<span class="punctuation">(</span><span class="built_in">LETTERS</span><span class="punctuation">[</span><span class="number">1</span><span class="operator">:</span><span class="number">5</span><span class="punctuation">]</span><span class="punctuation">,</span> <span class="number">154</span><span class="punctuation">,</span> replace <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">                 values1 <span class="operator">=</span> rnorm<span class="punctuation">(</span><span class="number">154</span><span class="punctuation">,</span> mean <span class="operator">=</span> <span class="number">10</span><span class="punctuation">,</span> sd <span class="operator">=</span> <span class="number">5</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">                 values2 <span class="operator">=</span> rnorm<span class="punctuation">(</span><span class="number">154</span><span class="punctuation">,</span> mean <span class="operator">=</span> <span class="operator">-</span><span class="number">10</span><span class="punctuation">,</span> sd <span class="operator">=</span> <span class="number">2</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">                 stringsAsFactors <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span></span><br><span class="line">ggplot<span class="punctuation">(</span>df<span class="punctuation">,</span> aes<span class="punctuation">(</span>x <span class="operator">=</span> x<span class="punctuation">,</span> y <span class="operator">=</span> y<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span> geom_triangle<span class="punctuation">(</span><span class="punctuation">)</span> <span class="comment">#默认填充色（fill）为空，只画出上下三角形</span></span><br><span class="line">ggplot<span class="punctuation">(</span>df<span class="punctuation">,</span> aes<span class="punctuation">(</span>x <span class="operator">=</span> x<span class="punctuation">,</span> y <span class="operator">=</span> y<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span> geom_triangle<span class="punctuation">(</span>fill <span class="operator">=</span> <span class="string">&quot;lightblue&quot;</span><span class="punctuation">)</span> <span class="comment">#当设置fill参数时，表明把上下三角形当成一个整体来处理，映射颜色也完全相同</span></span><br><span class="line"></span><br><span class="line">ggplot<span class="punctuation">(</span>df<span class="punctuation">,</span> aes<span class="punctuation">(</span>x <span class="operator">=</span> x<span class="punctuation">,</span> y <span class="operator">=</span> y<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span> geom_triangle<span class="punctuation">(</span>aes<span class="punctuation">(</span>fill <span class="operator">=</span> values1<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment">## 设置上三角颜色为浅蓝色</span></span><br><span class="line">ggplot<span class="punctuation">(</span>df<span class="punctuation">,</span> aes<span class="punctuation">(</span>x <span class="operator">=</span> x<span class="punctuation">,</span> y <span class="operator">=</span> y<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span> geom_triangle<span class="punctuation">(</span>fill.upper <span class="operator">=</span> <span class="string">&quot;lightblue&quot;</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment">## 设置上三角颜色为浅蓝色，且设置下三角颜色为橙色</span></span><br><span class="line">ggplot<span class="punctuation">(</span>df<span class="punctuation">,</span> aes<span class="punctuation">(</span>x <span class="operator">=</span> x<span class="punctuation">,</span> y <span class="operator">=</span> y<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_triangle<span class="punctuation">(</span>fill.upper <span class="operator">=</span> <span class="string">&quot;lightblue&quot;</span><span class="punctuation">,</span> fill.lower <span class="operator">=</span> <span class="string">&quot;orange&quot;</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment">#采用映射</span></span><br><span class="line">ggplot<span class="punctuation">(</span>df<span class="punctuation">,</span> aes<span class="punctuation">(</span>x <span class="operator">=</span> x<span class="punctuation">,</span> y <span class="operator">=</span> y<span class="punctuation">,</span> fill.upper <span class="operator">=</span> values1<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_triangle<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  scale_fill_upper_gradientn<span class="punctuation">(</span>colours <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;red&quot;</span><span class="punctuation">,</span> <span class="string">&quot;white&quot;</span><span class="punctuation">,</span> <span class="string">&quot;blue&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment">#同时映射上下三角，是不是感觉不用ggnewscale或者relayer包的黑科技了，会爽很多。</span></span><br><span class="line">ggplot<span class="punctuation">(</span>df<span class="punctuation">,</span> aes<span class="punctuation">(</span>x <span class="operator">=</span> x<span class="punctuation">,</span> y <span class="operator">=</span> y<span class="punctuation">,</span> fill.upper <span class="operator">=</span> values1<span class="punctuation">,</span> fill.lower <span class="operator">=</span> values2<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_triangle<span class="punctuation">(</span>mode <span class="operator">=</span> <span class="string">&quot;lb-rt&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  scale_fill_upper_gradientn<span class="punctuation">(</span>colours <span class="operator">=</span> brewer.pal<span class="punctuation">(</span><span class="number">5</span><span class="punctuation">,</span> <span class="string">&quot;Greys&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  scale_fill_lower_gradientn<span class="punctuation">(</span>colours <span class="operator">=</span> brewer.pal<span class="punctuation">(</span><span class="number">5</span><span class="punctuation">,</span> <span class="string">&quot;YlGnBu&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment">#也可以映射离散变量。</span></span><br><span class="line">ggplot<span class="punctuation">(</span>df<span class="punctuation">,</span> aes<span class="punctuation">(</span>x <span class="operator">=</span> x<span class="punctuation">,</span> y <span class="operator">=</span> y<span class="punctuation">,</span> fill.upper <span class="operator">=</span> group<span class="punctuation">,</span> fill.lower <span class="operator">=</span> values2<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_triangle<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  scale_fill_upper_manual<span class="punctuation">(</span>values <span class="operator">=</span> brewer.pal<span class="punctuation">(</span><span class="number">5</span><span class="punctuation">,</span> <span class="string">&quot;Set1&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  scale_fill_lower_gradientn<span class="punctuation">(</span>colours <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;#E9A3C9&quot;</span><span class="punctuation">,</span> <span class="string">&quot;#F7F7F7&quot;</span><span class="punctuation">,</span> <span class="string">&quot;#A1D76A&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">                             guide <span class="operator">=</span> guide_legend<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment">#ggmatrix提供了五种颜色映射函数，每个函数的用法均和对应的原ggplot2中的函数相同。</span></span><br><span class="line"><span class="comment">#scale_fill_lower/upper_gradient()——ggplot2中scale_fill_gradient()。</span></span><br><span class="line"><span class="comment">#scale_fill_lower/upper_gradient2()——ggplot2中scale_fill_gradient2()。</span></span><br><span class="line"><span class="comment">#scale_fill_lower/upper_gradientn()——ggplot2中scale_fill_gradientn()。</span></span><br><span class="line"><span class="comment">#scale_fill_lower/upper_identity()——ggplot2中scale_fill_identity()。</span></span><br><span class="line"><span class="comment">#scale_fill_lower/upper_manual()——ggplot2中scale_fill_manual()</span></span><br></pre></td></tr></table></figure>
<h4 id="环状热图">环状热图</h4>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">rm<span class="punctuation">(</span><span class="built_in">list</span> <span class="operator">=</span> ls<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>ggforce<span class="punctuation">)</span></span><br><span class="line"><span class="comment">#加上force=TRUE升级</span></span><br><span class="line">devtools<span class="operator">::</span>install_github<span class="punctuation">(</span><span class="punctuation">(</span><span class="string">&quot;houyunhuang/ggcor&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span>force <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>ggcor<span class="punctuation">)</span></span><br><span class="line">correlate<span class="punctuation">(</span>mtcars<span class="punctuation">,</span>method <span class="operator">=</span> <span class="string">&#x27;spearman&#x27;</span><span class="punctuation">)</span> <span class="operator">%&gt;%</span> trans_polar<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment">#trans_polar()是在ggcor的总体框架下设计的，所以对于输入数据也要求是cor_tbl对象，</span></span><br><span class="line"><span class="comment">#当输入不是cor_tbl对象时，调用fortify_cor()函数转化。</span></span><br><span class="line">correlate<span class="punctuation">(</span>mtcars<span class="punctuation">)</span> <span class="operator">%&gt;%</span>polarcor<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment">#对称矩阵</span></span><br><span class="line">correlate<span class="punctuation">(</span>mtcars<span class="punctuation">)</span> <span class="operator">%&gt;%</span></span><br><span class="line">  polarcor<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">+</span> geom_arc_colour<span class="punctuation">(</span>aes<span class="punctuation">(</span>fill <span class="operator">=</span> r<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment">## 非对称的情况</span></span><br><span class="line">library<span class="punctuation">(</span>ggplot2<span class="punctuation">)</span></span><br><span class="line">data<span class="punctuation">(</span><span class="string">&quot;varespec&quot;</span><span class="punctuation">,</span> package <span class="operator">=</span> <span class="string">&quot;vegan&quot;</span><span class="punctuation">)</span></span><br><span class="line">data<span class="punctuation">(</span><span class="string">&quot;varechem&quot;</span><span class="punctuation">,</span> package <span class="operator">=</span> <span class="string">&quot;vegan&quot;</span><span class="punctuation">)</span></span><br><span class="line">correlate<span class="punctuation">(</span>varechem<span class="punctuation">,</span> varespec<span class="punctuation">)</span> <span class="operator">%&gt;%</span></span><br><span class="line">  polarcor<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_arc_colour<span class="punctuation">(</span>aes<span class="punctuation">(</span>fill <span class="operator">=</span> r<span class="punctuation">)</span><span class="punctuation">,</span> size <span class="operator">=</span> <span class="number">0.25</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  coord_fixed<span class="punctuation">(</span>xlim <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="operator">-</span><span class="number">1.2</span><span class="punctuation">,</span> <span class="number">1.2</span><span class="punctuation">)</span><span class="punctuation">,</span> ylim <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="operator">-</span><span class="number">1.2</span><span class="punctuation">,</span> <span class="number">1.2</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#通过`set_arc_axis_x()`、`set_arc_axis_y()`函数来设置尺寸</span></span><br><span class="line">correlate<span class="punctuation">(</span>varechem<span class="punctuation">,</span> varespec<span class="punctuation">)</span> <span class="operator">%&gt;%</span></span><br><span class="line">  polarcor<span class="punctuation">(</span>no.axis <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_arc_colour<span class="punctuation">(</span>aes<span class="punctuation">(</span>fill <span class="operator">=</span> r<span class="punctuation">)</span><span class="punctuation">,</span> size <span class="operator">=</span> <span class="number">0.25</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  set_arc_axis_x<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  set_arc_axis_y<span class="punctuation">(</span>size <span class="operator">=</span> <span class="number">2.8</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  coord_fixed<span class="punctuation">(</span>xlim <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="operator">-</span><span class="number">1.2</span><span class="punctuation">,</span> <span class="number">1.2</span><span class="punctuation">)</span><span class="punctuation">,</span> ylim <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="operator">-</span><span class="number">1.2</span><span class="punctuation">,</span> <span class="number">1.2</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#分组的极坐标</span></span><br><span class="line">set.seed<span class="punctuation">(</span><span class="number">20200328</span><span class="punctuation">)</span></span><br><span class="line">grp <span class="operator">&lt;-</span> sample<span class="punctuation">(</span><span class="built_in">LETTERS</span><span class="punctuation">[</span><span class="number">1</span><span class="operator">:</span><span class="number">3</span><span class="punctuation">]</span><span class="punctuation">,</span> <span class="number">24</span><span class="punctuation">,</span> replace <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span></span><br><span class="line">grp</span><br><span class="line">fortify_cor<span class="punctuation">(</span>varechem<span class="punctuation">,</span> varespec<span class="punctuation">,</span> group <span class="operator">=</span> grp<span class="punctuation">)</span> <span class="operator">%&gt;%</span></span><br><span class="line">  polarcor<span class="punctuation">(</span>no.axis <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">,</span> split.by.group <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">,</span> group.space <span class="operator">=</span> <span class="number">2</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_arc_colour<span class="punctuation">(</span>aes<span class="punctuation">(</span>fill <span class="operator">=</span> r<span class="punctuation">)</span><span class="punctuation">,</span> colour <span class="operator">=</span> <span class="string">&quot;grey90&quot;</span><span class="punctuation">,</span> size <span class="operator">=</span> <span class="number">0.1</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  set_arc_axis_x<span class="punctuation">(</span>mapping <span class="operator">=</span> aes<span class="punctuation">(</span>colour <span class="operator">=</span> .group<span class="punctuation">)</span><span class="punctuation">,</span> size <span class="operator">=</span> <span class="number">2.8</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  set_arc_axis_y<span class="punctuation">(</span>size <span class="operator">=</span> <span class="number">2.8</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  coord_fixed<span class="punctuation">(</span>xlim <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="operator">-</span><span class="number">1.2</span><span class="punctuation">,</span> <span class="number">1.2</span><span class="punctuation">)</span><span class="punctuation">,</span> ylim <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="operator">-</span><span class="number">1.2</span><span class="punctuation">,</span> <span class="number">1.2</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#对于变量少的加上标签</span></span><br><span class="line">correlate<span class="punctuation">(</span>varechem<span class="punctuation">,</span> varespec<span class="punctuation">,</span> cor.test <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span> <span class="operator">%&gt;%</span></span><br><span class="line">  polarcor<span class="punctuation">(</span>no.axis <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_arc_colour<span class="punctuation">(</span>aes<span class="punctuation">(</span>fill <span class="operator">=</span> r<span class="punctuation">)</span><span class="punctuation">,</span> size <span class="operator">=</span> <span class="number">0.25</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_point<span class="punctuation">(</span>mapping <span class="operator">=</span> aes<span class="punctuation">(</span>x<span class="punctuation">,</span> y<span class="punctuation">)</span><span class="punctuation">,</span> shape <span class="operator">=</span> <span class="number">4</span><span class="punctuation">,</span></span><br><span class="line">             data <span class="operator">=</span> <span class="keyword">function</span><span class="punctuation">(</span>data<span class="punctuation">)</span> filter<span class="punctuation">(</span>data<span class="punctuation">,</span> p.value <span class="operator">&gt;</span> <span class="number">0.05</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  set_arc_axis_x<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  set_arc_axis_y<span class="punctuation">(</span>size <span class="operator">=</span> <span class="number">2.8</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  scale_fill_gradient2n<span class="punctuation">(</span>colours <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;blue&quot;</span><span class="punctuation">,</span> <span class="string">&quot;white&quot;</span><span class="punctuation">,</span> <span class="string">&quot;red&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  coord_fixed<span class="punctuation">(</span>xlim <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="operator">-</span><span class="number">1.2</span><span class="punctuation">,</span> <span class="number">1.2</span><span class="punctuation">)</span><span class="punctuation">,</span> ylim <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="operator">-</span><span class="number">1.2</span><span class="punctuation">,</span> <span class="number">1.2</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#对于变量更少的，我们完全可以加个系数和显著性标记。</span></span><br><span class="line">correlate<span class="punctuation">(</span>mtcars<span class="punctuation">,</span> cor.test <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span> <span class="operator">%&gt;%</span></span><br><span class="line">  polarcor<span class="punctuation">(</span>cluster <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_arc_colour<span class="punctuation">(</span>aes<span class="punctuation">(</span>fill <span class="operator">=</span> r<span class="punctuation">)</span><span class="punctuation">,</span> size <span class="operator">=</span> <span class="number">0.25</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_mark<span class="punctuation">(</span>aes<span class="punctuation">(</span>x<span class="punctuation">,</span> y<span class="punctuation">,</span> r <span class="operator">=</span> r<span class="punctuation">,</span> p.value <span class="operator">=</span> p.value<span class="punctuation">,</span> angle <span class="operator">=</span> angle<span class="punctuation">)</span><span class="punctuation">,</span> </span><br><span class="line">            size <span class="operator">=</span> <span class="number">3</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  scale_fill_gradient2n<span class="punctuation">(</span>colours <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;blue&quot;</span><span class="punctuation">,</span> <span class="string">&quot;white&quot;</span><span class="punctuation">,</span> <span class="string">&quot;red&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  coord_fixed<span class="punctuation">(</span>xlim <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="operator">-</span><span class="number">1.05</span><span class="punctuation">,</span> <span class="number">1.05</span><span class="punctuation">)</span><span class="punctuation">,</span> ylim <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="operator">-</span><span class="number">1.05</span><span class="punctuation">,</span> <span class="number">1.05</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#一般性的热图</span></span><br><span class="line">a <span class="operator">&lt;-</span> cor_tbl<span class="punctuation">(</span>extra.mat <span class="operator">=</span> <span class="built_in">list</span><span class="punctuation">(</span>mat <span class="operator">=</span> varespec<span class="punctuation">[</span><span class="punctuation">,</span><span class="number">1</span><span class="operator">:</span><span class="number">10</span><span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">%&gt;%</span></span><br><span class="line">  polarcor<span class="punctuation">(</span>no.axis <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_arc_colour<span class="punctuation">(</span>aes<span class="punctuation">(</span>fill <span class="operator">=</span> mat<span class="punctuation">)</span><span class="punctuation">,</span> size <span class="operator">=</span> <span class="number">0.1</span><span class="punctuation">,</span> colour <span class="operator">=</span> <span class="string">&quot;white&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  set_arc_axis_x<span class="punctuation">(</span>size <span class="operator">=</span> <span class="number">2.8</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  set_arc_axis_y<span class="punctuation">(</span>size <span class="operator">=</span> <span class="number">2</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  scale_fill_gradientn<span class="punctuation">(</span>colours <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;green&quot;</span><span class="punctuation">,</span> <span class="string">&quot;black&quot;</span><span class="punctuation">,</span> <span class="string">&quot;red&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  coord_fixed<span class="punctuation">(</span>xlim <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="operator">-</span><span class="number">1.15</span><span class="punctuation">,</span> <span class="number">1.15</span><span class="punctuation">)</span><span class="punctuation">,</span> ylim <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="operator">-</span><span class="number">1.1</span><span class="punctuation">,</span> <span class="number">1.15</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="heatmap-pheatmap热图">heatmap&amp;pheatmap热图</h4>
<hr>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##heatmap.2画热图</span></span><br><span class="line">data<span class="punctuation">(</span><span class="string">&quot;attitude&quot;</span><span class="punctuation">)</span></span><br><span class="line">Ca <span class="operator">&lt;-</span> cor<span class="punctuation">(</span>attitude<span class="punctuation">)</span><span class="comment">#cor的结果就是矩阵</span></span><br><span class="line"></span><br><span class="line">library<span class="punctuation">(</span>gplots<span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>RColorBrewer<span class="punctuation">)</span></span><br><span class="line">coul <span class="operator">&lt;-</span> colorRampPalette<span class="punctuation">(</span>brewer.pal<span class="punctuation">(</span><span class="number">8</span><span class="punctuation">,</span> <span class="string">&quot;PiYG&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">(</span><span class="number">25</span><span class="punctuation">)</span><span class="comment">#换个好看的颜色</span></span><br><span class="line">hM <span class="operator">&lt;-</span> format<span class="punctuation">(</span><span class="built_in">round</span><span class="punctuation">(</span>Ca<span class="punctuation">,</span> <span class="number">2</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="comment">#对数据保留2位小数</span></span><br><span class="line"></span><br><span class="line">heatmap.2<span class="punctuation">(</span>Ca<span class="punctuation">,</span></span><br><span class="line">trace<span class="operator">=</span><span class="string">&quot;none&quot;</span><span class="punctuation">,</span><span class="comment">#不显示trace</span></span><br><span class="line">col<span class="operator">=</span>coul<span class="punctuation">,</span><span class="comment">#修改热图颜色</span></span><br><span class="line">density.info <span class="operator">=</span> <span class="string">&quot;none&quot;</span><span class="punctuation">,</span><span class="comment">#图例取消density</span></span><br><span class="line">key.xlab <span class="operator">=</span><span class="string">&#x27;Correlation&#x27;</span><span class="punctuation">,</span></span><br><span class="line">key.title <span class="operator">=</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">cexRow <span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span>cexCol <span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span><span class="comment">#修改横纵坐标字体</span></span><br><span class="line">Rowv <span class="operator">=</span> <span class="built_in">F</span><span class="punctuation">,</span>Colv <span class="operator">=</span> <span class="built_in">F</span><span class="punctuation">,</span> <span class="comment">#去除聚类</span></span><br><span class="line">margins <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">6</span><span class="punctuation">,</span> <span class="number">6</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">cellnote <span class="operator">=</span> hM<span class="punctuation">,</span>notecol<span class="operator">=</span><span class="string">&#x27;black&#x27;</span><span class="comment">#添加相关系数的值及修改字体颜色</span></span><br><span class="line">            <span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">###### pheatmap画图</span></span><br><span class="line">library<span class="punctuation">(</span>pheatmap<span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>rmarkdown<span class="punctuation">)</span></span><br><span class="line"><span class="comment">#将Rmd文件转换为html</span></span><br><span class="line">render<span class="punctuation">(</span><span class="string">&quot;./pheatmap.Rmd&quot;</span><span class="punctuation">,</span><span class="string">&quot;html_document&quot;</span><span class="punctuation">)</span></span><br><span class="line">rm<span class="punctuation">(</span><span class="built_in">list</span><span class="operator">=</span>ls<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">test <span class="operator">=</span> matrix<span class="punctuation">(</span>rnorm<span class="punctuation">(</span><span class="number">200</span><span class="punctuation">)</span><span class="punctuation">,</span><span class="number">20</span><span class="punctuation">,</span><span class="number">10</span><span class="punctuation">)</span></span><br><span class="line">test<span class="punctuation">[</span><span class="number">1</span><span class="operator">:</span><span class="number">10</span><span class="punctuation">,</span> seq<span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span> <span class="number">10</span><span class="punctuation">,</span> <span class="number">2</span><span class="punctuation">)</span><span class="punctuation">]</span> <span class="operator">=</span> test<span class="punctuation">[</span><span class="number">1</span><span class="operator">:</span><span class="number">10</span><span class="punctuation">,</span> seq<span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span> <span class="number">10</span><span class="punctuation">,</span> <span class="number">2</span><span class="punctuation">)</span><span class="punctuation">]</span> <span class="operator">+</span> <span class="number">3</span> </span><br><span class="line">test<span class="punctuation">[</span><span class="number">11</span><span class="operator">:</span><span class="number">20</span><span class="punctuation">,</span> seq<span class="punctuation">(</span><span class="number">2</span><span class="punctuation">,</span> <span class="number">10</span><span class="punctuation">,</span> <span class="number">2</span><span class="punctuation">)</span><span class="punctuation">]</span> <span class="operator">=</span> test<span class="punctuation">[</span><span class="number">11</span><span class="operator">:</span><span class="number">20</span><span class="punctuation">,</span> seq<span class="punctuation">(</span><span class="number">2</span><span class="punctuation">,</span> <span class="number">10</span><span class="punctuation">,</span> <span class="number">2</span><span class="punctuation">)</span><span class="punctuation">]</span> <span class="operator">+</span> <span class="number">2</span> </span><br><span class="line">test<span class="punctuation">[</span><span class="number">15</span><span class="operator">:</span><span class="number">20</span><span class="punctuation">,</span> seq<span class="punctuation">(</span><span class="number">2</span><span class="punctuation">,</span> <span class="number">10</span><span class="punctuation">,</span> <span class="number">2</span><span class="punctuation">)</span><span class="punctuation">]</span> <span class="operator">=</span> test<span class="punctuation">[</span><span class="number">15</span><span class="operator">:</span><span class="number">20</span><span class="punctuation">,</span> seq<span class="punctuation">(</span><span class="number">2</span><span class="punctuation">,</span> <span class="number">10</span><span class="punctuation">,</span> <span class="number">2</span><span class="punctuation">)</span><span class="punctuation">]</span> <span class="operator">+</span> <span class="number">4</span> </span><br><span class="line">colnames<span class="punctuation">(</span>test<span class="punctuation">)</span> <span class="operator">=</span> paste<span class="punctuation">(</span><span class="string">&quot;Test&quot;</span><span class="punctuation">,</span> <span class="number">1</span><span class="operator">:</span><span class="number">10</span><span class="punctuation">,</span> sep <span class="operator">=</span> <span class="string">&quot;&quot;</span><span class="punctuation">)</span> </span><br><span class="line">rownames<span class="punctuation">(</span>test<span class="punctuation">)</span> <span class="operator">=</span> paste<span class="punctuation">(</span><span class="string">&quot;Gene&quot;</span><span class="punctuation">,</span> <span class="number">1</span><span class="operator">:</span><span class="number">20</span><span class="punctuation">,</span> sep <span class="operator">=</span> <span class="string">&quot;&quot;</span><span class="punctuation">)</span></span><br><span class="line">head<span class="punctuation">(</span>test<span class="punctuation">[</span><span class="punctuation">,</span><span class="number">1</span><span class="operator">:</span><span class="number">6</span><span class="punctuation">]</span><span class="punctuation">)</span></span><br><span class="line">pheatmap<span class="punctuation">(</span>test<span class="punctuation">)</span></span><br><span class="line"><span class="comment"># scale = &quot;row&quot;参数对行进行归一化</span></span><br><span class="line"><span class="comment"># clustering_method参数设定不同聚类方法，默认为&quot;complete&quot;,可以设定为&#x27;ward&#x27;, &#x27;ward.D&#x27;, &#x27;ward.D2&#x27;, &#x27;single&#x27;, &#x27;complete&#x27;, &#x27;average&#x27;, &#x27;mcquitty&#x27;, &#x27;median&#x27; or &#x27;centroid&#x27;</span></span><br><span class="line">pheatmap<span class="punctuation">(</span>test<span class="punctuation">,</span>scale <span class="operator">=</span> <span class="string">&quot;row&quot;</span><span class="punctuation">,</span> clustering_method <span class="operator">=</span> <span class="string">&quot;average&quot;</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment">#表示行聚类使用皮尔森相关系数聚类，默认为欧氏距离&quot;euclidean&quot;</span></span><br><span class="line">pheatmap<span class="punctuation">(</span>test<span class="punctuation">,</span> scale <span class="operator">=</span> <span class="string">&quot;row&quot;</span><span class="punctuation">,</span> clustering_distance_rows <span class="operator">=</span> <span class="string">&quot;correlation&quot;</span><span class="punctuation">)</span> </span><br><span class="line"></span><br><span class="line">pheatmap<span class="punctuation">(</span>test<span class="punctuation">,</span> display_numbers <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span></span><br><span class="line">pheatmap<span class="punctuation">(</span>test<span class="punctuation">,</span> display_numbers <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">,</span> number_format <span class="operator">=</span> <span class="string">&quot;\%.1e&quot;</span><span class="punctuation">)</span></span><br><span class="line">pheatmap<span class="punctuation">(</span>test<span class="punctuation">,</span> display_numbers <span class="operator">=</span> matrix<span class="punctuation">(</span>ifelse<span class="punctuation">(</span>res<span class="operator">$</span>p <span class="operator">&lt;=</span> <span class="number">0.01</span><span class="punctuation">,</span><span class="string">&quot;**&quot;</span><span class="punctuation">,</span></span><br><span class="line">    ifelse<span class="punctuation">(</span>res<span class="operator">$</span>p <span class="operator">&lt;=</span> <span class="number">0.05</span><span class="punctuation">,</span> <span class="string">&quot;*&quot;</span><span class="punctuation">,</span> <span class="string">&quot;&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">,</span> nrow<span class="punctuation">(</span>res<span class="operator">$</span>p<span class="punctuation">)</span><span class="punctuation">)</span><span class="comment">#还可以自己设定要显示的内容；</span></span><br><span class="line"> display_numbers<span class="operator">=</span><span class="built_in">T</span><span class="punctuation">,</span>number_format<span class="operator">=</span><span class="string">&quot;%.3f&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="comment">#自定义颜色</span></span><br><span class="line">pheatmap<span class="punctuation">(</span>test<span class="punctuation">,</span> color <span class="operator">=</span> colorRampPalette<span class="punctuation">(</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;navy&quot;</span><span class="punctuation">,</span> <span class="string">&quot;white&quot;</span><span class="punctuation">,</span> <span class="string">&quot;firebrick3&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">(</span><span class="number">50</span><span class="punctuation">)</span><span class="punctuation">)</span> </span><br><span class="line"><span class="comment">#颜色赋予变量 </span></span><br><span class="line">hmcol <span class="operator">&lt;-</span> rev<span class="punctuation">(</span>colorRampPalette<span class="punctuation">(</span>RColorBrewer<span class="operator">::</span>brewer.pal<span class="punctuation">(</span><span class="number">9</span><span class="punctuation">,</span> <span class="string">&quot;YlOrRd&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">(</span><span class="number">255</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment"># 设置对角距离为NA，增强颜色的展示力  适用于相关性热图</span></span><br><span class="line">diag<span class="punctuation">(</span>dists<span class="punctuation">)</span> <span class="operator">&lt;-</span> <span class="literal">NA</span></span><br><span class="line"><span class="comment">#行 列是否聚类，cluster_row ,cluster_col </span></span><br><span class="line">pheatmap<span class="punctuation">(</span>test<span class="punctuation">,</span> cluster_row <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">,</span>cluster_col <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span> </span><br><span class="line"><span class="comment"># Show text within cells pheatmap(test, display_numbers = TRUE) </span></span><br><span class="line"><span class="comment">#pheatmap(test, display_numbers = TRUE, number_format = &quot;%.1e&quot;) # number_format = &quot;%.1e&quot;参数设定数值的显示格式</span></span><br><span class="line">pheatmap<span class="punctuation">(</span>test<span class="punctuation">,</span> display_numbers <span class="operator">=</span> matrix<span class="punctuation">(</span>ifelse<span class="punctuation">(</span>test <span class="operator">&gt;</span> <span class="number">5</span><span class="punctuation">,</span> <span class="string">&quot;*&quot;</span><span class="punctuation">,</span> <span class="string">&quot;&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span> nrow<span class="punctuation">(</span>test<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span> </span><br><span class="line"><span class="comment">#设定legend展示的值</span></span><br><span class="line"><span class="comment">#legend_breaks参数设定图例显示范围，legend_labels参数添加图例标签</span></span><br><span class="line">pheatmap<span class="punctuation">(</span>test<span class="punctuation">,</span> cluster_row <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">,</span> legend_breaks <span class="operator">=</span> <span class="operator">-</span><span class="number">1</span><span class="operator">:</span><span class="number">4</span><span class="punctuation">,</span> legend_labels <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;0&quot;</span><span class="punctuation">,</span> <span class="string">&quot;1e-4&quot;</span><span class="punctuation">,</span> <span class="string">&quot;1e-3&quot;</span><span class="punctuation">,</span> <span class="string">&quot;1e-2&quot;</span><span class="punctuation">,</span> <span class="string">&quot;1e-1&quot;</span><span class="punctuation">,</span> <span class="string">&quot;1&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment">#去掉legend</span></span><br><span class="line">pheatmap<span class="punctuation">(</span>test<span class="punctuation">,</span> legend <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span></span><br><span class="line">         angle_col <span class="operator">=</span> <span class="number">45</span><span class="comment">#调角度</span></span><br><span class="line"><span class="comment"># border=FALSE参数去掉边框线</span></span><br><span class="line">pheatmap<span class="punctuation">(</span>test<span class="punctuation">,</span> border<span class="operator">=</span><span class="literal">FALSE</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment"># border_color参数设定每个热图格子的边框色</span></span><br><span class="line">pheatmap<span class="punctuation">(</span>test<span class="punctuation">,</span> border_color <span class="operator">=</span> <span class="string">&quot;red&quot;</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment"># treeheight_row和treeheight_col参数设定行和列聚类树的高度，默认为50</span></span><br><span class="line">pheatmap<span class="punctuation">(</span>test<span class="punctuation">,</span> treeheight_row <span class="operator">=</span> <span class="number">30</span><span class="punctuation">,</span> treeheight_col <span class="operator">=</span> <span class="number">50</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment"># Fix cell sizes and save to file with correct size </span></span><br><span class="line">pheatmap<span class="punctuation">(</span>test<span class="punctuation">,</span> cellwidth <span class="operator">=</span> <span class="number">15</span><span class="punctuation">,</span> cellheight <span class="operator">=</span> <span class="number">12</span><span class="punctuation">,</span> main <span class="operator">=</span> <span class="string">&quot;Example heatmap&quot;</span><span class="punctuation">)</span> </span><br><span class="line"></span><br><span class="line"><span class="comment">#设置字体大小，设置行、列的聚类方法()</span></span><br><span class="line">drows<span class="operator">&lt;-</span>vegdist<span class="punctuation">(</span>data<span class="punctuation">,</span>method<span class="operator">=</span><span class="string">&quot;bray&quot;</span><span class="punctuation">)</span></span><br><span class="line">dcols<span class="operator">&lt;-</span>vegdist<span class="punctuation">(</span>t<span class="punctuation">(</span>data<span class="punctuation">)</span><span class="punctuation">,</span>method<span class="operator">=</span><span class="string">&quot;bray&quot;</span><span class="punctuation">)</span></span><br><span class="line">pheatmap<span class="punctuation">(</span>data<span class="punctuation">,</span>cellwidth <span class="operator">=</span> <span class="literal">NA</span><span class="punctuation">,</span> cellheight <span class="operator">=</span><span class="literal">NA</span><span class="punctuation">,</span> treeheight_row <span class="operator">=</span> <span class="number">50</span><span class="punctuation">,</span> treeheight_col <span class="operator">=</span> <span class="number">50</span> <span class="punctuation">,</span>color <span class="operator">=</span> colorRampPalette<span class="punctuation">(</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;green&quot;</span><span class="punctuation">,</span> <span class="string">&quot;black&quot;</span><span class="punctuation">,</span><span class="string">&quot;red&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">(</span><span class="number">100</span><span class="punctuation">)</span><span class="punctuation">,</span> scale<span class="operator">=</span><span class="string">&quot;row&quot;</span><span class="punctuation">,</span> legend<span class="operator">=</span><span class="literal">TRUE</span><span class="punctuation">,</span>border_color<span class="operator">=</span><span class="literal">NA</span><span class="punctuation">,</span> fontsize_row<span class="operator">=</span><span class="number">8</span><span class="punctuation">,</span> fontsize_col<span class="operator">=</span><span class="number">10</span><span class="punctuation">,</span>clustering_distance_rows <span class="operator">=</span>drows<span class="punctuation">,</span> clustering_distance_cols <span class="operator">=</span> dcols<span class="punctuation">,</span> clustering_method<span class="operator">=</span><span class="string">&quot;average&quot;</span><span class="punctuation">,</span>main<span class="operator">=</span><span class="string">&quot;Heatmap&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span>控制图例范围<span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span></span><br><span class="line">data1<span class="operator">&lt;-</span><span class="built_in">c</span><span class="punctuation">(</span>runif<span class="punctuation">(</span><span class="number">20</span><span class="punctuation">,</span><span class="built_in">min</span><span class="operator">=</span><span class="operator">-</span><span class="number">2</span><span class="punctuation">,</span><span class="built_in">max</span><span class="operator">=</span><span class="number">2</span><span class="punctuation">)</span><span class="punctuation">,</span>rnorm<span class="punctuation">(</span><span class="number">380</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">data1<span class="operator">&lt;-</span>matrix<span class="punctuation">(</span>sample<span class="punctuation">(</span>data1<span class="punctuation">,</span><span class="number">400</span><span class="punctuation">,</span>replace <span class="operator">=</span> <span class="built_in">F</span><span class="punctuation">)</span><span class="punctuation">,</span>nrow<span class="operator">=</span><span class="number">20</span><span class="punctuation">)</span></span><br><span class="line"><span class="built_in">range</span><span class="punctuation">(</span>data1<span class="punctuation">)</span></span><br><span class="line"><span class="comment">#breaks</span></span><br><span class="line">bk <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span>seq<span class="punctuation">(</span><span class="operator">-</span><span class="number">3</span><span class="punctuation">,</span><span class="operator">-</span><span class="number">0.1</span><span class="punctuation">,</span>by<span class="operator">=</span><span class="number">0.01</span><span class="punctuation">)</span><span class="punctuation">,</span>seq<span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span><span class="number">3</span><span class="punctuation">,</span>by<span class="operator">=</span><span class="number">0.01</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment"># 做热图：</span></span><br><span class="line">pheatmap<span class="operator">::</span>pheatmap<span class="punctuation">(</span>data1<span class="punctuation">,</span></span><br><span class="line">         scale <span class="operator">=</span> <span class="string">&quot;none&quot;</span><span class="punctuation">,</span></span><br><span class="line">         color <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span>colorRampPalette<span class="punctuation">(</span>colors <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;blue&quot;</span><span class="punctuation">,</span><span class="string">&quot;white&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">(</span><span class="built_in">length</span><span class="punctuation">(</span>bk<span class="punctuation">)</span><span class="operator">/</span><span class="number">2</span><span class="punctuation">)</span><span class="punctuation">,</span>colorRampPalette<span class="punctuation">(</span>colors <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;white&quot;</span><span class="punctuation">,</span><span class="string">&quot;red&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">(</span><span class="built_in">length</span><span class="punctuation">(</span>bk<span class="punctuation">)</span><span class="operator">/</span><span class="number">2</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">         legend_breaks<span class="operator">=</span>seq<span class="punctuation">(</span><span class="operator">-</span><span class="number">3</span><span class="punctuation">,</span><span class="number">3</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">         breaks <span class="operator">=</span> bk<span class="punctuation">)</span></span><br><span class="line"><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#设置颜色</span></span><br><span class="line">col <span class="operator">=</span> colorRampPalette<span class="punctuation">(</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;lightblue&quot;</span><span class="punctuation">,</span><span class="string">&quot;yellow&quot;</span><span class="punctuation">,</span><span class="string">&quot;orange&quot;</span><span class="punctuation">,</span><span class="string">&quot;red&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span>bias<span class="operator">=</span><span class="number">3</span><span class="punctuation">)</span><span class="punctuation">(</span><span class="number">300</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment">#设置注释信息 自定义图例颜色</span></span><br><span class="line">ann_colors<span class="operator">=</span><span class="built_in">list</span><span class="punctuation">(</span>Group<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span>H<span class="operator">=</span><span class="string">&quot;blue&quot;</span><span class="punctuation">,</span>D<span class="operator">=</span><span class="string">&quot;red&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span>Class<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span>Bacteroidetes<span class="operator">=</span><span class="string">&quot;#EE7AE9&quot;</span><span class="punctuation">,</span>Firmicutes<span class="operator">=</span><span class="string">&quot;#795EA2&quot;</span><span class="punctuation">,</span>Proteobacteria<span class="operator">=</span><span class="string">&quot;#3370CC&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment">#gaps_col =  3 第几列断开 cut_tree = 2#分几分</span></span><br><span class="line"><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span></span><br><span class="line"><span class="comment"># gaps_row = c(10, 14)参数在第10和14行处添加gap, 要求对行不进行聚类</span></span><br><span class="line">pheatmap<span class="punctuation">(</span>genu<span class="punctuation">,</span>display_numbers <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">,</span>number_color <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">,</span>scale <span class="operator">=</span> <span class="string">&quot;row&quot;</span><span class="punctuation">,</span></span><br><span class="line">         cellwidth <span class="operator">=</span> <span class="literal">NA</span> <span class="punctuation">,</span> cellheight <span class="operator">=</span> <span class="literal">NA</span><span class="punctuation">,</span></span><br><span class="line">         cluster_rows<span class="operator">=</span><span class="literal">FALSE</span><span class="punctuation">,</span>treeheight_row <span class="operator">=</span> <span class="number">50</span><span class="punctuation">,</span> treeheight_col <span class="operator">=</span> <span class="number">50</span><span class="punctuation">,</span> </span><br><span class="line">         cluster_cols<span class="operator">=</span><span class="literal">TRUE</span><span class="punctuation">,</span>color <span class="operator">=</span> colorRampPalette<span class="punctuation">(</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;green&quot;</span><span class="punctuation">,</span> <span class="string">&quot;black&quot;</span><span class="punctuation">,</span><span class="string">&quot;red&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">(</span><span class="number">100</span><span class="punctuation">)</span><span class="punctuation">,</span>border_color <span class="operator">=</span> <span class="literal">NA</span><span class="punctuation">,</span>cutree_cols <span class="operator">=</span> <span class="number">2</span><span class="punctuation">,</span>legend <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span></span><br><span class="line"><span class="built_in">min</span><span class="punctuation">(</span>genu<span class="punctuation">)</span></span><br><span class="line">drows <span class="operator">&lt;-</span> vegdist<span class="punctuation">(</span>genu<span class="punctuation">,</span>method <span class="operator">=</span> <span class="string">&quot;bray&quot;</span><span class="punctuation">)</span></span><br><span class="line">dcols <span class="operator">&lt;-</span> vegdist<span class="punctuation">(</span>t<span class="punctuation">(</span>genu<span class="punctuation">)</span><span class="punctuation">,</span>method <span class="operator">=</span> <span class="string">&quot;bray&quot;</span><span class="punctuation">)</span></span><br><span class="line">pheatmap<span class="punctuation">(</span>genu<span class="punctuation">,</span>cellwidth <span class="operator">=</span> <span class="literal">NA</span><span class="punctuation">,</span> cellheight <span class="operator">=</span> <span class="literal">NA</span><span class="punctuation">,</span> treeheight_row <span class="operator">=</span> <span class="number">50</span><span class="punctuation">,</span> treeheight_col <span class="operator">=</span> <span class="number">50</span> </span><br><span class="line">         <span class="punctuation">,</span>color <span class="operator">=</span> colorRampPalette<span class="punctuation">(</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;green&quot;</span><span class="punctuation">,</span> <span class="string">&quot;black&quot;</span><span class="punctuation">,</span><span class="string">&quot;red&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">(</span><span class="number">100</span><span class="punctuation">)</span><span class="punctuation">,</span> legend_breaks <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">1</span><span class="operator">:</span><span class="number">5</span><span class="punctuation">)</span><span class="punctuation">,</span> legend_labels <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;1.0&quot;</span><span class="punctuation">,</span><span class="string">&quot;2.0&quot;</span><span class="punctuation">,</span><span class="string">&quot;3.0&quot;</span><span class="punctuation">,</span><span class="string">&quot;4.0&quot;</span><span class="punctuation">,</span><span class="string">&quot;5.0&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">         scale <span class="operator">=</span><span class="string">&quot;row&quot;</span><span class="punctuation">,</span> legend <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">,</span>border_color <span class="operator">=</span> <span class="literal">NA</span><span class="punctuation">,</span> cutree_rows <span class="operator">=</span> <span class="number">3</span><span class="punctuation">,</span>cutree_cols <span class="operator">=</span> <span class="number">3</span><span class="punctuation">,</span></span><br><span class="line">         fontsize_row <span class="operator">=</span> <span class="number">8</span><span class="punctuation">,</span> fontsize_col <span class="operator">=</span> <span class="number">10</span><span class="punctuation">,</span>clustering_distance_rows <span class="operator">=</span> drows<span class="punctuation">,</span> </span><br><span class="line">         clustering_distance_cols <span class="operator">=</span> dcols<span class="punctuation">,</span> clustering_method <span class="operator">=</span><span class="string">&quot;average&quot;</span><span class="punctuation">,</span>main <span class="operator">=</span><span class="string">&quot;Heatmap&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##针对聚类树添加与否 会改变相应的位置问题</span></span><br><span class="line">p <span class="operator">&lt;-</span> pheatmap<span class="punctuation">(</span>test<span class="punctuation">)</span> <span class="comment">#默认加聚类树</span></span><br><span class="line">r <span class="operator">=</span> rownames<span class="punctuation">(</span>test<span class="punctuation">)</span><span class="punctuation">[</span>p<span class="operator">$</span>tree_row<span class="punctuation">[[</span><span class="string">&quot;order&quot;</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">]</span> <span class="comment">#提取出来</span></span><br><span class="line"><span class="built_in">c</span> <span class="operator">=</span> colnames<span class="punctuation">(</span>test<span class="punctuation">)</span><span class="punctuation">[</span>p<span class="operator">$</span>tree_col<span class="punctuation">[[</span><span class="string">&quot;order&quot;</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">]</span> </span><br><span class="line">new_test <span class="operator">=</span> test<span class="punctuation">[</span>r<span class="punctuation">,</span><span class="built_in">c</span><span class="punctuation">]</span></span><br><span class="line">pheatmap<span class="punctuation">(</span>new_test<span class="punctuation">,</span>cluster_rows <span class="operator">=</span> <span class="built_in">F</span><span class="punctuation">,</span>cluster_cols <span class="operator">=</span> <span class="built_in">F</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment">#当然另一种简单方法直接设置树高：很巧妙，设置高度为0，就不显示了</span></span><br><span class="line">pheatmap<span class="punctuation">(</span>diy1<span class="punctuation">,</span>treeheight_row <span class="operator">=</span> <span class="number">0</span><span class="punctuation">,</span>treeheight_col <span class="operator">=</span> <span class="number">0</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<h4 id="相关性热图-ggcor包"><strong>相关性热图 (ggcor包)</strong></h4>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">####计算相关性时候的技巧</span></span><br><span class="line"><span class="comment">#将 spearman 相关系数低于 0.7 的关系剔除，即 r&gt;=0.7</span></span><br><span class="line">library<span class="punctuation">(</span>Hmisc<span class="punctuation">)</span></span><br><span class="line">r <span class="operator">&lt;-</span> genus_corr<span class="operator">$</span>r  </span><br><span class="line">r<span class="punctuation">[</span><span class="built_in">abs</span><span class="punctuation">(</span>r<span class="punctuation">)</span> <span class="operator">&lt;</span> <span class="number">0.7</span><span class="punctuation">]</span> <span class="operator">&lt;-</span> <span class="number">0</span></span><br><span class="line">p <span class="operator">&lt;-</span> genus_corr<span class="operator">$</span>P</span><br><span class="line">p <span class="operator">&lt;-</span> p.adjust<span class="punctuation">(</span>p<span class="punctuation">,</span> method <span class="operator">=</span> <span class="string">&#x27;BH&#x27;</span><span class="punctuation">)</span>    <span class="comment">#可选 p 值校正，这里使用 BH 法校正 p 值</span></span><br><span class="line">p<span class="punctuation">[</span>p<span class="operator">&gt;=</span><span class="number">0.05</span><span class="punctuation">]</span> <span class="operator">&lt;-</span> <span class="operator">-</span><span class="number">1</span></span><br><span class="line">p<span class="punctuation">[</span>p<span class="operator">&lt;</span><span class="number">0.05</span> <span class="operator">&amp;</span> p<span class="operator">&gt;=</span><span class="number">0</span><span class="punctuation">]</span> <span class="operator">&lt;-</span> <span class="number">1</span></span><br><span class="line">p<span class="punctuation">[</span>p<span class="operator">==</span><span class="operator">-</span><span class="number">1</span><span class="punctuation">]</span> <span class="operator">&lt;-</span> <span class="number">0</span></span><br><span class="line"><span class="comment">#根据上述筛选的 r 值和 p 值保留数据</span></span><br><span class="line">z <span class="operator">&lt;-</span> r <span class="operator">*</span> p</span><br><span class="line">diag<span class="punctuation">(</span>z<span class="punctuation">)</span> <span class="operator">&lt;-</span> <span class="number">0</span>    <span class="comment">#将相关矩阵中对角线中的值（代表了自相关）转为 0</span></span><br><span class="line"></span><br><span class="line">Spearman秩相关系数，Pearson线性相关系数要求连续变量的取值服从正态分布，不服从正态分布的变量、分类或等级变量之间的关联性可采用Spearman秩相关系数，也称等级相关系数来描述。Pearson要求两个变量均符合正态分布，而当其中一个变量不符合正态分布时，就需要使用Spearman。</span><br><span class="line"></span><br><span class="line"> <span class="comment"># 使用shapiro.test函数检验每个变量是否与正太分布具有显著性差异</span></span><br><span class="line"><span class="keyword">for</span><span class="punctuation">(</span>i <span class="keyword">in</span> <span class="number">1</span><span class="operator">:</span>ncol<span class="punctuation">(</span>attitude<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">&#123;</span></span><br><span class="line">  p_value <span class="operator">&lt;-</span> apply<span class="punctuation">(</span>attitude<span class="punctuation">,</span><span class="number">2</span><span class="punctuation">,</span>shapiro.test<span class="punctuation">)</span><span class="punctuation">[[</span>i<span class="punctuation">]</span><span class="punctuation">]</span><span class="operator">$</span>p.value</span><br><span class="line">  <span class="comment"># 输出结果变量名和p值。</span></span><br><span class="line">  print<span class="punctuation">(</span>paste<span class="punctuation">(</span><span class="built_in">names</span><span class="punctuation">(</span>attitude<span class="punctuation">)</span><span class="punctuation">[</span>i<span class="punctuation">]</span><span class="punctuation">,</span>p_value<span class="punctuation">,</span>sep<span class="operator">=</span><span class="string">&quot;    &quot;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">&#125;</span> <span class="comment">#判断下变量是否符合正太分布</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#箱线图查看下分布情况</span></span><br><span class="line">library<span class="punctuation">(</span>reshape<span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>ggplot2<span class="punctuation">)</span></span><br><span class="line"><span class="comment"># 宽格式变为长格式：</span></span><br><span class="line">attitude_melt <span class="operator">&lt;-</span> melt<span class="punctuation">(</span>attitude<span class="punctuation">)</span>  </span><br><span class="line"><span class="comment"># 作图查看每个变量的离群值：</span></span><br><span class="line">ggplot<span class="punctuation">(</span>attitude_melt<span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  geom_boxplot<span class="punctuation">(</span>aes<span class="punctuation">(</span>x<span class="operator">=</span>variable<span class="punctuation">,</span>y<span class="operator">=</span>value<span class="punctuation">,</span>fill<span class="operator">=</span>variable<span class="punctuation">)</span><span class="punctuation">,</span>outlier.colour <span class="operator">=</span> <span class="string">&quot;red&quot;</span><span class="punctuation">,</span>outlier.size <span class="operator">=</span> <span class="number">3</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  theme_bw<span class="punctuation">(</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  theme<span class="punctuation">(</span></span><br><span class="line">    axis.text.x <span class="operator">=</span> element_text<span class="punctuation">(</span>angle <span class="operator">=</span> <span class="number">30</span><span class="punctuation">,</span>hjust<span class="operator">=</span><span class="number">1</span><span class="punctuation">,</span>vjust<span class="operator">=</span><span class="number">1</span><span class="punctuation">)</span></span><br><span class="line">  <span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#读取数据</span></span><br><span class="line">dat <span class="operator">&lt;-</span> read.table<span class="punctuation">(</span><span class="string">&#x27;data.txt&#x27;</span><span class="punctuation">,</span> sep <span class="operator">=</span> <span class="string">&#x27;\t&#x27;</span><span class="punctuation">,</span> row.names <span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span> header <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">,</span> stringsAsFactors <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">,</span> check.names <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span></span><br><span class="line">dat_env <span class="operator">&lt;-</span> dat<span class="punctuation">[</span><span class="number">1</span><span class="operator">:</span><span class="number">6</span><span class="punctuation">]</span>	<span class="comment">#只包含环境因子数据</span></span><br><span class="line">dat_phylum <span class="operator">&lt;-</span> dat<span class="punctuation">[</span><span class="number">8</span><span class="operator">:</span><span class="number">17</span><span class="punctuation">]</span>	<span class="comment">#只包含细菌类群丰度数据</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##协方差和常见的相关系数</span></span><br><span class="line"><span class="comment">#协方差计算，cov()</span></span><br><span class="line">cov_pearson <span class="operator">&lt;-</span> cov<span class="punctuation">(</span>dat<span class="punctuation">,</span> method <span class="operator">=</span> <span class="string">&#x27;pearson&#x27;</span><span class="punctuation">)</span></span><br><span class="line">cov_spearman <span class="operator">&lt;-</span> cov<span class="punctuation">(</span>dat<span class="punctuation">,</span> method <span class="operator">=</span> <span class="string">&#x27;spearman&#x27;</span><span class="punctuation">)</span></span><br><span class="line">cov_kendall <span class="operator">&lt;-</span> cov<span class="punctuation">(</span>dat<span class="punctuation">,</span> method <span class="operator">=</span> <span class="string">&#x27;kendall&#x27;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#相关系数计算，cor()</span></span><br><span class="line">cor_pearson <span class="operator">&lt;-</span> cor<span class="punctuation">(</span>dat<span class="punctuation">,</span> method <span class="operator">=</span> <span class="string">&#x27;pearson&#x27;</span><span class="punctuation">)</span></span><br><span class="line">cor_spearman <span class="operator">&lt;-</span> cor<span class="punctuation">(</span>dat<span class="punctuation">,</span> method <span class="operator">=</span> <span class="string">&#x27;spearman&#x27;</span><span class="punctuation">)</span></span><br><span class="line">cor_kendall <span class="operator">&lt;-</span> cor<span class="punctuation">(</span>dat<span class="punctuation">,</span> method <span class="operator">=</span> <span class="string">&#x27;kendall&#x27;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#输出，例如</span></span><br><span class="line"><span class="comment">#提取“cor_pearson”中相关系数 &gt;0.5 或 &lt;-0.5 的结果输出为 csv 样式</span></span><br><span class="line">cor_pearson<span class="punctuation">[</span><span class="built_in">abs</span><span class="punctuation">(</span>cor_pearson<span class="punctuation">)</span> <span class="operator">&lt;=</span> <span class="number">0.5</span><span class="punctuation">]</span> <span class="operator">&lt;-</span> <span class="number">0</span></span><br><span class="line">write.csv<span class="punctuation">(</span>cor_pearson<span class="punctuation">,</span> <span class="string">&#x27;cor_pearson.csv&#x27;</span><span class="punctuation">,</span> <span class="built_in">quote</span> <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span></span><br><span class="line">write.table<span class="punctuation">(</span>genu_fun_corr_final<span class="punctuation">,</span> <span class="string">&#x27;lia_cor.txt&#x27;</span><span class="punctuation">,</span> row.names <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">,</span> sep <span class="operator">=</span> <span class="string">&#x27;\t&#x27;</span><span class="punctuation">,</span> <span class="built_in">quote</span> <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment">#指定分组的相关性分析，cor()</span></span><br><span class="line"><span class="comment">#此处计算“dat_phylum”和“dat_env”中数据的相关性，即只关注细菌类群丰度与环境因子之间的相关性</span></span><br><span class="line">phylum_env_spearman <span class="operator">&lt;-</span> cor<span class="punctuation">(</span>dat_phylum<span class="punctuation">,</span> dat_env<span class="punctuation">,</span> method <span class="operator">=</span> <span class="string">&#x27;spearman&#x27;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#hetcor()，以计算“dat_phylum”中两两细菌类群间多分格相关系数为例</span></span><br><span class="line">library<span class="punctuation">(</span>polycor<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">cor_polychoric <span class="operator">&lt;-</span> hetcor<span class="punctuation">(</span>dat_phylum<span class="punctuation">,</span> type <span class="operator">=</span> <span class="string">&#x27;Polychoric&#x27;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#偏相关，pcor()</span></span><br><span class="line"><span class="comment">#此处计算“dat_phylum”中，Proteobacteria 和 Acidobacteria 的偏相关系数</span></span><br><span class="line">library<span class="punctuation">(</span>ggm<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">select <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;Proteobacteria&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;Acidobacteria&#x27;</span><span class="punctuation">)</span></span><br><span class="line">delet <span class="operator">&lt;-</span>  <span class="built_in">names</span><span class="punctuation">(</span>dat_phylum<span class="punctuation">)</span><span class="punctuation">[</span><span class="operator">-</span>which<span class="punctuation">(</span><span class="built_in">names</span><span class="punctuation">(</span>dat_phylum<span class="punctuation">)</span> <span class="operator">%in%</span> select<span class="punctuation">)</span><span class="punctuation">]</span></span><br><span class="line">pcor<span class="punctuation">(</span><span class="built_in">c</span><span class="punctuation">(</span>select<span class="punctuation">,</span> delet<span class="punctuation">)</span><span class="punctuation">,</span> cov<span class="punctuation">(</span>dat_phylum<span class="punctuation">,</span> method <span class="operator">=</span> <span class="string">&#x27;spearman&#x27;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##相关性的显著性检验</span></span><br><span class="line"><span class="comment">#cor.test()，此处使用“dat”中 Proteobacteria 和 Acidobacteria 列的数据</span></span><br><span class="line"><span class="comment">#意在判断“cor_pearson”中 Proteobacteria 和 Acidobacteria 的相关系数是否显著</span></span><br><span class="line">cor.test<span class="punctuation">(</span>dat<span class="punctuation">[</span><span class="punctuation">,</span><span class="string">&#x27;Proteobacteria&#x27;</span><span class="punctuation">]</span><span class="punctuation">,</span> dat<span class="punctuation">[</span><span class="punctuation">,</span><span class="string">&#x27;Acidobacteria&#x27;</span><span class="punctuation">]</span><span class="punctuation">,</span> method <span class="operator">=</span> <span class="string">&#x27;pearson&#x27;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#corr.test()  </span></span><br><span class="line">library<span class="punctuation">(</span>psych<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">phylum_corr <span class="operator">&lt;-</span> corr.test<span class="punctuation">(</span>dat_phylum<span class="punctuation">,</span> method <span class="operator">=</span> <span class="string">&#x27;spearman&#x27;</span><span class="punctuation">)</span></span><br><span class="line">phylum_env_corr <span class="operator">&lt;-</span> corr.test<span class="punctuation">(</span>dat_phylum<span class="punctuation">,</span> dat_env<span class="punctuation">,</span> method <span class="operator">=</span> <span class="string">&#x27;spearman&#x27;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#以“phylum_corr”为例，查看数据</span></span><br><span class="line">phylum_corr<span class="operator">$</span>r	<span class="comment">#相关系数值</span></span><br><span class="line">phylum_corr<span class="operator">$</span>p	<span class="comment">#显著性 p 值</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#筛选，例如</span></span><br><span class="line"><span class="comment">#“phylum_corr”中，根据 p(&lt;0.05) 值和 r(&gt;=0.3 or &lt;=-0.3) 值做保留</span></span><br><span class="line">phylum_corr<span class="operator">$</span>p<span class="punctuation">[</span>phylum_corr<span class="operator">$</span>p <span class="operator">&gt;=</span> <span class="number">0.05</span><span class="punctuation">]</span> <span class="operator">&lt;-</span> <span class="operator">-</span><span class="number">1</span></span><br><span class="line">phylum_corr<span class="operator">$</span>p<span class="punctuation">[</span>phylum_corr<span class="operator">$</span>p <span class="operator">&lt;</span> <span class="number">0.05</span> <span class="operator">&amp;</span> phylum_corr<span class="operator">$</span>p <span class="operator">&gt;=</span> <span class="number">0</span><span class="punctuation">]</span> <span class="operator">&lt;-</span> <span class="number">1</span></span><br><span class="line">phylum_corr<span class="operator">$</span>p<span class="punctuation">[</span>phylum_corr<span class="operator">$</span>p <span class="operator">==</span> <span class="operator">-</span><span class="number">1</span><span class="punctuation">]</span> <span class="operator">&lt;-</span> <span class="number">0</span></span><br><span class="line">phylum_corr<span class="operator">$</span>r<span class="punctuation">[</span><span class="built_in">abs</span><span class="punctuation">(</span>phylum_corr<span class="operator">$</span>r<span class="punctuation">)</span> <span class="operator">&lt;</span> <span class="number">0.3</span><span class="punctuation">]</span> <span class="operator">&lt;-</span> <span class="number">0</span></span><br><span class="line">phylum_corr_final <span class="operator">&lt;-</span> phylum_corr<span class="operator">$</span>r <span class="operator">*</span> phylum_corr<span class="operator">$</span>p</span><br><span class="line"><span class="comment">#或者occor.r[occor.p&gt;0.05|abs(occor.r)&lt;0.6] = 0</span></span><br><span class="line">write.csv<span class="punctuation">(</span>phylum_corr_final<span class="punctuation">,</span> <span class="string">&#x27;phylum_corr_final.csv&#x27;</span><span class="punctuation">,</span> <span class="built_in">quote</span> <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 数据量小时可以用psych包corr.test求相关性矩阵，数据量大时，可应用WGCNA中corAndPvalue, 但p值需要借助其他函数矫正</span></span><br><span class="line">occor <span class="operator">=</span> corr.test<span class="punctuation">(</span>otu<span class="punctuation">,</span>use<span class="operator">=</span><span class="string">&quot;pairwise&quot;</span><span class="punctuation">,</span>method<span class="operator">=</span><span class="string">&quot;spearman&quot;</span><span class="punctuation">,</span>adjust<span class="operator">=</span><span class="string">&quot;fdr&quot;</span><span class="punctuation">,</span>alpha<span class="operator">=</span><span class="number">0.05</span><span class="punctuation">)</span></span><br><span class="line">occor.r <span class="operator">=</span> occor<span class="operator">$</span>r <span class="comment"># 取相关性矩阵R值</span></span><br><span class="line">occor.p <span class="operator">=</span> occor<span class="operator">$</span>p <span class="comment"># 取相关性矩阵p值</span></span><br><span class="line"><span class="comment"># 确定物种间存在相互作用关系的阈值，将相关性R矩阵内不符合的数据转换为0</span></span><br><span class="line">occor.r<span class="punctuation">[</span>occor.p<span class="operator">&gt;</span><span class="number">0.05</span><span class="operator">|</span><span class="built_in">abs</span><span class="punctuation">(</span>occor.r<span class="punctuation">)</span><span class="operator">&lt;</span><span class="number">0.6</span><span class="punctuation">]</span> <span class="operator">=</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#计算相关矩阵及显著性水平。</span></span><br><span class="line">library<span class="punctuation">(</span>Hmisc<span class="punctuation">)</span></span><br><span class="line"><span class="comment">#所有变量间相关系数的对称矩阵</span></span><br><span class="line">rcorr_matrix <span class="operator">&lt;-</span> rcorr<span class="punctuation">(</span>as.matrix<span class="punctuation">(</span>mtcars<span class="punctuation">)</span><span class="punctuation">,</span> type <span class="operator">=</span> <span class="string">&#x27;pearson&#x27;</span><span class="punctuation">)</span></span><br><span class="line">rcorr_matrix<span class="operator">$</span>r    <span class="comment">#相关矩阵</span></span><br><span class="line">rcorr_matrix<span class="operator">$</span>P    <span class="comment">#p 值矩阵</span></span><br><span class="line"><span class="comment">#给定两组变量间相关系数的非对称矩阵</span></span><br><span class="line">x <span class="operator">&lt;-</span> as.matrix<span class="punctuation">(</span>mtcars<span class="punctuation">[</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;mpg&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;cyl&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;disp&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;hp&#x27;</span><span class="punctuation">)</span><span class="punctuation">]</span><span class="punctuation">)</span></span><br><span class="line">y <span class="operator">&lt;-</span> as.matrix<span class="punctuation">(</span><span class="punctuation">(</span>mtcars<span class="punctuation">[</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;drat&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;wt&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;qsec&#x27;</span><span class="punctuation">)</span><span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">rcorr_matrix <span class="operator">&lt;-</span> rcorr<span class="punctuation">(</span>x<span class="punctuation">,</span> y<span class="punctuation">,</span> type <span class="operator">=</span> <span class="string">&#x27;pearson&#x27;</span><span class="punctuation">)</span></span><br><span class="line">rcorr_matrix<span class="operator">$</span>r    <span class="comment">#相关矩阵</span></span><br><span class="line">rcorr_matrix<span class="operator">$</span>P    <span class="comment">#p 值矩阵</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">##相关图绘制示例，corrplot 包</span></span><br><span class="line">library<span class="punctuation">(</span>corrplot<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#第一个示例，根据筛选后的数据“phylum_corr_final”作图</span></span><br><span class="line">corrplot<span class="punctuation">(</span>phylum_corr_final<span class="punctuation">,</span> method <span class="operator">=</span> <span class="string">&#x27;number&#x27;</span><span class="punctuation">,</span> number.cex <span class="operator">=</span> <span class="number">0.8</span><span class="punctuation">,</span> diag <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">,</span> tl.cex <span class="operator">=</span> <span class="number">0.8</span><span class="punctuation">)</span></span><br><span class="line">corrplot<span class="punctuation">(</span>phylum_corr_final<span class="punctuation">,</span> add <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">,</span> type <span class="operator">=</span> <span class="string">&#x27;upper&#x27;</span><span class="punctuation">,</span> method <span class="operator">=</span> <span class="string">&#x27;pie&#x27;</span><span class="punctuation">,</span> diag <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">,</span> tl.pos <span class="operator">=</span> <span class="string">&#x27;n&#x27;</span><span class="punctuation">,</span> cl.pos <span class="operator">=</span> <span class="string">&#x27;n&#x27;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#第二个示例，在作图时，通过指定过滤参数（p&lt;0.05），作图时自动屏蔽不显著的值</span></span><br><span class="line">corrplot<span class="punctuation">(</span>phylum_env_corr<span class="operator">$</span>r<span class="punctuation">,</span> p.mat <span class="operator">=</span> phylum_env_corr<span class="operator">$</span>p<span class="punctuation">,</span> method <span class="operator">=</span> <span class="string">&#x27;number&#x27;</span><span class="punctuation">,</span> insig <span class="operator">=</span> <span class="string">&#x27;blank&#x27;</span><span class="punctuation">,</span> sig.level <span class="operator">=</span> <span class="number">0.05</span><span class="punctuation">,</span> addCoef.col <span class="operator">=</span> <span class="string">&#x27;black&#x27;</span><span class="punctuation">,</span>  number.cex <span class="operator">=</span> <span class="number">0.8</span><span class="punctuation">,</span> tl.cex <span class="operator">=</span> <span class="number">0.8</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#读取相关性数据（已经计算好的相关性结果数据）</span></span><br><span class="line">pearson1 <span class="operator">&lt;-</span> as.matrix<span class="punctuation">(</span>read.table<span class="punctuation">(</span><span class="string">&#x27;pearson1.txt&#x27;</span><span class="punctuation">,</span> sep <span class="operator">=</span> <span class="string">&#x27;\t&#x27;</span><span class="punctuation">,</span> row.names <span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span> header <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">pearson2 <span class="operator">&lt;-</span> as.matrix<span class="punctuation">(</span>read.table<span class="punctuation">(</span><span class="string">&#x27;pearson2.txt&#x27;</span><span class="punctuation">,</span> sep <span class="operator">=</span> <span class="string">&#x27;\t&#x27;</span><span class="punctuation">,</span> row.names <span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span> header <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##############################</span></span><br><span class="line"><span class="comment">####corrplot 包相关图示例</span></span><br><span class="line">library<span class="punctuation">(</span>corrplot<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#默认</span></span><br><span class="line">corrplot<span class="punctuation">(</span>pearson1<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#method 参数，调整相关系数的展示方式</span></span><br><span class="line">corrplot<span class="punctuation">(</span>pearson1<span class="punctuation">,</span> method <span class="operator">=</span> <span class="string">&#x27;color&#x27;</span><span class="punctuation">)</span></span><br><span class="line">corrplot<span class="punctuation">(</span>pearson1<span class="punctuation">,</span> method <span class="operator">=</span> <span class="string">&#x27;number&#x27;</span><span class="punctuation">)</span></span><br><span class="line">corrplot<span class="punctuation">(</span>pearson1<span class="punctuation">,</span> method <span class="operator">=</span> <span class="string">&#x27;pie&#x27;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#diag = FALSE，隐藏对角线值</span></span><br><span class="line">corrplot<span class="punctuation">(</span>pearson1<span class="punctuation">,</span> method <span class="operator">=</span> <span class="string">&#x27;square&#x27;</span><span class="punctuation">,</span> diag <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#tl.pos、tl.cex、tl.col、tl.offset、tl.srt 等参数，调整变量标签字体属性</span></span><br><span class="line"><span class="comment">#例如调整大小及颜色</span></span><br><span class="line">corrplot<span class="punctuation">(</span>pearson1<span class="punctuation">,</span> method <span class="operator">=</span> <span class="string">&#x27;pie&#x27;</span><span class="punctuation">,</span> diag <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">,</span> tl.cex <span class="operator">=</span> <span class="number">0.8</span><span class="punctuation">,</span> tl.col <span class="operator">=</span> <span class="string">&#x27;black&#x27;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#cl.pos、cl.lim、cl.length、cl.cex、cl.ratio、cl.align.text、cl.offset 等参数，调整相关性标尺属性</span></span><br><span class="line"><span class="comment">#例如将标尺调整至图的下方，并调整刻度值的间隔</span></span><br><span class="line">corrplot<span class="punctuation">(</span>pearson1<span class="punctuation">,</span> method <span class="operator">=</span> <span class="string">&#x27;pie&#x27;</span><span class="punctuation">,</span> diag <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">,</span> cl.pos <span class="operator">=</span> <span class="string">&#x27;b&#x27;</span><span class="punctuation">,</span> cl.length <span class="operator">=</span> <span class="number">9</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#number.cex、number.font、number.digits 等参数，调整相关性数字属性（当 method = &#x27;number&#x27; 时可调整）</span></span><br><span class="line"><span class="comment">#例如调整展示数值的尺寸</span></span><br><span class="line">corrplot<span class="punctuation">(</span>pearson1<span class="punctuation">,</span> method <span class="operator">=</span> <span class="string">&#x27;number&#x27;</span><span class="punctuation">,</span> diag <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">,</span> number.cex <span class="operator">=</span> <span class="number">0.8</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#order、hclust.method（当 order = &#x27;hclust&#x27; 时可调整）等参数，可根据相关性强度对变量的展示顺序重新排列</span></span><br><span class="line"><span class="comment">#例如将变量根据 ward 最小方差聚类排序，并将变量聚为 3 类</span></span><br><span class="line">corrplot<span class="punctuation">(</span>pearson1<span class="punctuation">,</span> method <span class="operator">=</span> <span class="string">&#x27;color&#x27;</span><span class="punctuation">,</span> order <span class="operator">=</span> <span class="string">&#x27;hclust&#x27;</span><span class="punctuation">,</span> hclust.method <span class="operator">=</span> <span class="string">&#x27;ward.D&#x27;</span><span class="punctuation">,</span> addrect <span class="operator">=</span> <span class="number">3</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#type 可设置相关图的展示形式，默认展示全部</span></span><br><span class="line"><span class="comment">#例如仅展示对称矩阵的上三角部分</span></span><br><span class="line">corrplot<span class="punctuation">(</span>pearson1<span class="punctuation">,</span> method <span class="operator">=</span> <span class="string">&#x27;color&#x27;</span><span class="punctuation">,</span> type <span class="operator">=</span> <span class="string">&#x27;upper&#x27;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#添加 add = TRUE 时（默认 FALSE），可将新图叠加在原图上方</span></span><br><span class="line"><span class="comment">#例如一个组合样式的相关图</span></span><br><span class="line">corrplot<span class="punctuation">(</span>pearson1<span class="punctuation">,</span> method <span class="operator">=</span> <span class="string">&#x27;number&#x27;</span><span class="punctuation">,</span> number.cex <span class="operator">=</span> <span class="number">0.8</span><span class="punctuation">,</span> diag <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">,</span> tl.cex <span class="operator">=</span> <span class="number">0.8</span><span class="punctuation">)</span></span><br><span class="line">corrplot<span class="punctuation">(</span>pearson1<span class="punctuation">,</span> add <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">,</span> type <span class="operator">=</span> <span class="string">&#x27;upper&#x27;</span><span class="punctuation">,</span> method <span class="operator">=</span> <span class="string">&#x27;pie&#x27;</span><span class="punctuation">,</span> diag <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">,</span> tl.pos <span class="operator">=</span> <span class="string">&#x27;n&#x27;</span><span class="punctuation">,</span> cl.pos <span class="operator">=</span> <span class="string">&#x27;n&#x27;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#col 属性自定义相关性的颜色设置，bg 可设置背景色</span></span><br><span class="line"><span class="comment">#例如自定义相关系数的颜色范围</span></span><br><span class="line">col1 <span class="operator">&lt;-</span> colorRampPalette<span class="punctuation">(</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;red3&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;orange&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;white&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;blue&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;blue4&#x27;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">corrplot<span class="punctuation">(</span>pearson1<span class="punctuation">,</span> method <span class="operator">=</span> <span class="string">&#x27;number&#x27;</span><span class="punctuation">,</span> diag <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">,</span> col <span class="operator">=</span> col1<span class="punctuation">(</span><span class="number">21</span><span class="punctuation">)</span><span class="punctuation">,</span> tl.cex <span class="operator">=</span> <span class="number">0.8</span><span class="punctuation">)</span></span><br><span class="line">corrplot<span class="punctuation">(</span>pearson1<span class="punctuation">,</span> add <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">,</span> type <span class="operator">=</span> <span class="string">&#x27;upper&#x27;</span><span class="punctuation">,</span> method <span class="operator">=</span> <span class="string">&#x27;circle&#x27;</span><span class="punctuation">,</span> diag <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">,</span> col <span class="operator">=</span> col1<span class="punctuation">(</span><span class="number">21</span><span class="punctuation">)</span><span class="punctuation">,</span> tl.pos <span class="operator">=</span> <span class="string">&#x27;n&#x27;</span><span class="punctuation">,</span> cl.pos <span class="operator">=</span> <span class="string">&#x27;n&#x27;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#当 method 不为 “number”时，可使用 addgrid.col 设置颜色显示相关系数，同时配合 number.font 等参数使用</span></span><br><span class="line"><span class="comment">#例如当 method = &#x27;color&#x27; 时，在图中显示相关系数数值，并 number.cex 调整字体大小</span></span><br><span class="line">corrplot<span class="punctuation">(</span>pearson2<span class="punctuation">,</span> method <span class="operator">=</span> <span class="string">&#x27;color&#x27;</span><span class="punctuation">,</span> addCoef.col <span class="operator">=</span> <span class="string">&#x27;black&#x27;</span><span class="punctuation">,</span> number.cex <span class="operator">=</span> <span class="number">0.8</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#当存在显著性检验结果时，可使用 sig.level、insig 等参数根据显著性 p 值屏蔽不显著的相关系数</span></span><br><span class="line"><span class="comment">#通常与 pch、pch.col、pch.cex 等参数来使用，这些参数设置屏蔽区的展示方式</span></span><br><span class="line"><span class="comment">#此处借用 psych 包中的 corr.test()，基于原始数据计算相关性，并执行显著性检验，之后根据结果绘制相关图</span></span><br><span class="line">library<span class="punctuation">(</span>psych<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">top10_phylum <span class="operator">&lt;-</span> read.csv<span class="punctuation">(</span><span class="string">&#x27;top10_phylum.csv&#x27;</span><span class="punctuation">,</span> row.names <span class="operator">=</span> <span class="number">1</span><span class="punctuation">)</span></span><br><span class="line">spearman1 <span class="operator">&lt;-</span> corr.test<span class="punctuation">(</span>top10_phylum<span class="punctuation">,</span> method <span class="operator">=</span> <span class="string">&#x27;spearman&#x27;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">corrplot<span class="punctuation">(</span>spearman1<span class="operator">$</span>r<span class="punctuation">,</span> method <span class="operator">=</span> <span class="string">&#x27;square&#x27;</span><span class="punctuation">,</span> type <span class="operator">=</span> <span class="string">&#x27;lower&#x27;</span><span class="punctuation">,</span> p.mat <span class="operator">=</span> spearman1<span class="operator">$</span>p<span class="punctuation">,</span> sig.level <span class="operator">=</span> <span class="number">0.05</span><span class="punctuation">,</span> insig <span class="operator">=</span> <span class="string">&#x27;blank&#x27;</span><span class="punctuation">,</span> addCoef.col <span class="operator">=</span> <span class="string">&#x27;black&#x27;</span><span class="punctuation">,</span> diag <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">,</span> number.cex <span class="operator">=</span> <span class="number">0.8</span><span class="punctuation">,</span> tl.cex <span class="operator">=</span> <span class="number">0.8</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##############################</span></span><br><span class="line"><span class="comment">####corrgram 包相关图示例</span></span><br><span class="line">library<span class="punctuation">(</span>corrgram<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#默认</span></span><br><span class="line">corrgram<span class="punctuation">(</span>pearson1<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#order = TRUE 时，可根据相关性强度对变量的展示顺序重新排列</span></span><br><span class="line">corrgram<span class="punctuation">(</span>pearson1<span class="punctuation">,</span> order <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#lower.panel、upper.panel 等参数可以设置相关系数的展示方式</span></span><br><span class="line"><span class="comment">#例如设置下三角区域填充图样式，上三角区域饼图样式</span></span><br><span class="line">corrgram<span class="punctuation">(</span>pearson1<span class="punctuation">,</span> lower.panel <span class="operator">=</span> panel.fill<span class="punctuation">,</span> upper.panel <span class="operator">=</span> panel.pie<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#text.panel、label.pos 、label.srt、cex.labels、font.labels 等参数可用于调整面板的外观显示样式</span></span><br><span class="line"><span class="comment">#例如调整变量标签的字体大小</span></span><br><span class="line">corrgram<span class="punctuation">(</span>pearson1<span class="punctuation">,</span> lower.panel <span class="operator">=</span> panel.shade<span class="punctuation">,</span> upper.panel <span class="operator">=</span> <span class="literal">NULL</span><span class="punctuation">,</span> cex.labels <span class="operator">=</span> <span class="number">1</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#col.regions 可用于自定义颜色范围，例如</span></span><br><span class="line">col1 <span class="operator">&lt;-</span> colorRampPalette<span class="punctuation">(</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;red3&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;orange&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;white&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;blue&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;blue4&#x27;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">corrgram<span class="punctuation">(</span>pearson1<span class="punctuation">,</span> lower.panel <span class="operator">=</span> panel.shade<span class="punctuation">,</span> upper.panel <span class="operator">=</span> panel.pie<span class="punctuation">,</span> col.regions <span class="operator">=</span> col1<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#可以直接读取原始数据，通过指定相关系数类型，作图展示</span></span><br><span class="line"><span class="comment">#相较于直接读取相关矩阵，此时可以添加散点图或拟合线图类型展示变量间的相关性</span></span><br><span class="line">top10_phylum <span class="operator">&lt;-</span> read.csv<span class="punctuation">(</span><span class="string">&#x27;top10_phylum.csv&#x27;</span><span class="punctuation">,</span> row.names <span class="operator">=</span> <span class="number">1</span><span class="punctuation">)</span></span><br><span class="line">corrgram<span class="punctuation">(</span>top10_phylum<span class="punctuation">,</span> cor.method <span class="operator">=</span> <span class="string">&#x27;pearson&#x27;</span><span class="punctuation">,</span> lower.panel <span class="operator">=</span> panel.pts<span class="punctuation">,</span> upper.panel <span class="operator">=</span> panel.ellipse<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##############################</span></span><br><span class="line"><span class="comment">####pairs()，绘制变量间两两相关性散点图矩阵</span></span><br><span class="line">top10_phylum <span class="operator">&lt;-</span> as.matrix<span class="punctuation">(</span>read.csv<span class="punctuation">(</span><span class="string">&#x27;top10_phylum.csv&#x27;</span><span class="punctuation">,</span> row.names <span class="operator">=</span> <span class="number">1</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">panel.hist <span class="operator">&lt;-</span> <span class="keyword">function</span><span class="punctuation">(</span>x<span class="punctuation">,</span> ...<span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">    usr <span class="operator">&lt;-</span> par<span class="punctuation">(</span><span class="string">&#x27;usr&#x27;</span><span class="punctuation">)</span>; <span class="built_in">on.exit</span><span class="punctuation">(</span>par<span class="punctuation">(</span>usr<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">    par<span class="punctuation">(</span>usr <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span>usr<span class="punctuation">[</span><span class="number">1</span><span class="operator">:</span><span class="number">2</span><span class="punctuation">]</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">,</span> <span class="number">1.5</span><span class="punctuation">)</span> <span class="punctuation">)</span></span><br><span class="line">    h <span class="operator">&lt;-</span> hist<span class="punctuation">(</span>x<span class="punctuation">,</span> plot <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span></span><br><span class="line">    breaks <span class="operator">&lt;-</span> h<span class="operator">$</span>breaks; nB <span class="operator">&lt;-</span> <span class="built_in">length</span><span class="punctuation">(</span>breaks<span class="punctuation">)</span></span><br><span class="line">    y <span class="operator">&lt;-</span> h<span class="operator">$</span>counts; y <span class="operator">&lt;-</span> y<span class="operator">/</span><span class="built_in">max</span><span class="punctuation">(</span>y<span class="punctuation">)</span></span><br><span class="line">    rect<span class="punctuation">(</span>breaks<span class="punctuation">[</span><span class="operator">-</span>nB<span class="punctuation">]</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">,</span> breaks<span class="punctuation">[</span><span class="operator">-</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">,</span> y<span class="punctuation">,</span> col <span class="operator">=</span> <span class="string">&#x27;cyan&#x27;</span><span class="punctuation">,</span> ...<span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line">pairs<span class="punctuation">(</span>top10_phylum<span class="punctuation">,</span> panel <span class="operator">=</span> panel.smooth<span class="punctuation">,</span> diag.panel <span class="operator">=</span> panel.hist<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##############################</span></span><br><span class="line"><span class="comment">####GGally 包相关图示例</span></span><br><span class="line">library<span class="punctuation">(</span>GGally<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#默认</span></span><br><span class="line">ggcorr<span class="punctuation">(</span>pearson1<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#label = TRUE 时，在图中展示相关系数数值，此时可使用 label_alpha、label_color、label_round、label_size 等参数设置字体属性</span></span><br><span class="line">ggcorr<span class="punctuation">(</span>pearson1<span class="punctuation">,</span> label <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">,</span> label_alpha <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#low、mid、high 等参数可自定义颜色范围，例如</span></span><br><span class="line">ggcorr<span class="punctuation">(</span>pearson1<span class="punctuation">,</span> low <span class="operator">=</span> <span class="string">&#x27;red&#x27;</span><span class="punctuation">,</span> mid <span class="operator">=</span> <span class="string">&#x27;white&#x27;</span><span class="punctuation">,</span> high <span class="operator">=</span> <span class="string">&#x27;blue&#x27;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#读取原始数据，指定所需计算的相关系数类型，自定义作图样式</span></span><br><span class="line">top10_phylum <span class="operator">&lt;-</span> read.csv<span class="punctuation">(</span><span class="string">&#x27;top10_phylum.csv&#x27;</span><span class="punctuation">,</span> row.names <span class="operator">=</span> <span class="number">1</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">ggcorr<span class="punctuation">(</span></span><br><span class="line">	top10_phylum<span class="punctuation">,</span> </span><br><span class="line">	method <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;pairwise&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;pearson&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span> </span><br><span class="line">	name <span class="operator">=</span> <span class="built_in">expression</span><span class="punctuation">(</span>rho<span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">	geom <span class="operator">=</span> <span class="string">&#x27;circle&#x27;</span><span class="punctuation">,</span></span><br><span class="line">	max_size <span class="operator">=</span> <span class="number">15</span><span class="punctuation">,</span></span><br><span class="line">	min_size <span class="operator">=</span> <span class="number">5</span><span class="punctuation">,</span></span><br><span class="line">	size <span class="operator">=</span> <span class="number">3</span><span class="punctuation">,</span></span><br><span class="line">	hjust <span class="operator">=</span> <span class="number">0.75</span><span class="punctuation">,</span></span><br><span class="line">	nbreaks <span class="operator">=</span> <span class="number">6</span><span class="punctuation">,</span></span><br><span class="line">	palette <span class="operator">=</span> <span class="string">&#x27;PuOr&#x27;</span> <span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#ggpairs() 绘制变量间两两相关性散点图矩阵</span></span><br><span class="line">top10_phylum <span class="operator">&lt;-</span> read.csv<span class="punctuation">(</span><span class="string">&#x27;top10_phylum.csv&#x27;</span><span class="punctuation">,</span> row.names <span class="operator">=</span> <span class="number">1</span><span class="punctuation">)</span></span><br><span class="line">ggpairs<span class="punctuation">(</span>top10_phylum<span class="punctuation">,</span> columns <span class="operator">=</span> <span class="number">1</span><span class="operator">:</span><span class="number">6</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="ggcor包组合相关矩阵和mantel相">ggcor包组合相关矩阵和Mantel相</h4>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span>ggcor包组合相关矩阵和Mantel相<span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span></span><br><span class="line">rm<span class="punctuation">(</span><span class="built_in">list</span> <span class="operator">=</span> ls<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>vegan<span class="punctuation">)</span> <span class="comment">## 获取数据</span></span><br><span class="line">library<span class="punctuation">(</span>ggcor<span class="punctuation">)</span></span><br><span class="line">data<span class="punctuation">(</span><span class="string">&quot;varespec&quot;</span><span class="punctuation">)</span></span><br><span class="line">data<span class="punctuation">(</span><span class="string">&quot;varechem&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">mantel <span class="operator">&lt;-</span> mantel_test<span class="punctuation">(</span>varespec<span class="punctuation">,</span> varechem<span class="punctuation">)</span></span><br><span class="line">combination_layout<span class="punctuation">(</span>mantel<span class="punctuation">,</span> type <span class="operator">=</span> <span class="string">&quot;upper&quot;</span><span class="punctuation">,</span> show.diag <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">,</span></span><br><span class="line">                   col.names <span class="operator">=</span> <span class="built_in">names</span><span class="punctuation">(</span>varechem<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"><span class="string">&#x27;&#x27;</span><span class="string">&#x27;</span></span><br><span class="line"><span class="string">type、show.diag、row.names、col.names都是相关系数矩阵相关的参数，</span></span><br><span class="line"><span class="string">若觉得这些有点多难得处理，完全可以传递一个cor_tbl对象给cor_tbl参数，这样所有的问题完美解决。如下：</span></span><br><span class="line"><span class="string">&#x27;</span><span class="string">&#x27;&#x27;</span></span><br><span class="line">corr <span class="operator">&lt;-</span> correlate<span class="punctuation">(</span>varechem<span class="punctuation">,</span> cor.test <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span> <span class="operator">%&gt;%</span> </span><br><span class="line">  as_cor_tbl<span class="punctuation">(</span>type <span class="operator">=</span> <span class="string">&quot;upper&quot;</span><span class="punctuation">,</span> show.diag <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span></span><br><span class="line">combination_layout<span class="punctuation">(</span>mantel<span class="punctuation">,</span> cor_tbl <span class="operator">=</span> corr<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">combination_layout<span class="punctuation">(</span>mantel<span class="punctuation">,</span> cor_tbl <span class="operator">=</span> corr<span class="punctuation">)</span> <span class="operator">%&gt;%</span> </span><br><span class="line">  ggplot<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">+</span> </span><br><span class="line">  geom_link<span class="punctuation">(</span>aes<span class="punctuation">(</span>color <span class="operator">=</span> r<span class="punctuation">)</span><span class="punctuation">,</span> curvature <span class="operator">=</span> <span class="number">0.05</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_start_point<span class="punctuation">(</span>fill <span class="operator">=</span> <span class="string">&quot;red&quot;</span><span class="punctuation">,</span> shape <span class="operator">=</span> <span class="number">23</span><span class="punctuation">,</span> size <span class="operator">=</span> <span class="number">4</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_end_point<span class="punctuation">(</span>fill <span class="operator">=</span> <span class="string">&quot;blue&quot;</span><span class="punctuation">,</span> shape <span class="operator">=</span> <span class="number">21</span><span class="punctuation">,</span> size <span class="operator">=</span> <span class="number">4</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_start_label<span class="punctuation">(</span>aes<span class="punctuation">(</span>x <span class="operator">=</span> x <span class="operator">-</span> <span class="number">0.5</span><span class="punctuation">)</span><span class="punctuation">,</span> hjust <span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span> size <span class="operator">=</span> <span class="number">5</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_end_label<span class="punctuation">(</span>aes<span class="punctuation">(</span>x <span class="operator">=</span> xend <span class="operator">+</span> <span class="number">0.5</span><span class="punctuation">)</span><span class="punctuation">,</span> hjust <span class="operator">=</span> <span class="number">0</span><span class="punctuation">,</span> size <span class="operator">=</span> <span class="number">5</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line"><span class="comment">#  scale_fill_gradient2(midpoint = 0, low = &#x27;blue&#x27;, mid = &#x27;white&#x27;, high = &#x27;red&#x27;, space = &#x27;Lab&#x27;) +#环境变量相关系数颜色赋值</span></span><br><span class="line"><span class="comment">#  scale_size(range = c(0, 1)) +  #根据 Mantel 相关指定线条粗细</span></span><br><span class="line">  remove_axis<span class="punctuation">(</span><span class="string">&#x27;all&#x27;</span><span class="punctuation">)</span> <span class="operator">+</span> <span class="comment">#去除原 x、y 轴上的环境变量标签</span></span><br><span class="line">  scale_color_gradient<span class="punctuation">(</span>low <span class="operator">=</span> <span class="string">&#x27;red&#x27;</span><span class="punctuation">,</span> high <span class="operator">=</span> <span class="string">&#x27;blue&#x27;</span><span class="punctuation">)</span> <span class="operator">+</span> <span class="comment">#根据 Mantel 相关 r 值指定线条颜色</span></span><br><span class="line">  coord_cartesian<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  theme_void<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">###多组的情况下</span></span><br><span class="line">mantel2 <span class="operator">&lt;-</span> mantel_test<span class="punctuation">(</span>varespec<span class="punctuation">,</span> varechem<span class="punctuation">,</span> mantel.fun <span class="operator">=</span> <span class="string">&#x27;mantel.randtest&#x27;</span><span class="punctuation">,</span>spec.dist.method <span class="operator">=</span> <span class="string">&#x27;bray&#x27;</span><span class="punctuation">,</span> env.dist.method <span class="operator">=</span> <span class="string">&#x27;euclidean&#x27;</span><span class="punctuation">,</span> </span><br><span class="line">                       spec.select <span class="operator">=</span> <span class="built_in">list</span><span class="punctuation">(</span>Spec01 <span class="operator">=</span> <span class="number">1</span><span class="operator">:</span><span class="number">7</span><span class="punctuation">,</span></span><br><span class="line">                                          Spec02 <span class="operator">=</span> <span class="number">8</span><span class="operator">:</span><span class="number">18</span><span class="punctuation">,</span></span><br><span class="line">                                          Spec03 <span class="operator">=</span> <span class="number">19</span><span class="operator">:</span><span class="number">24</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;</span><span class="string">&#x27;</span></span><br><span class="line"><span class="string">有个细节需要注意，对于这个图，默认的起点都是群落，终点是环境，当然完全可以通过start.var、end.var参数来改变默认设置。</span></span><br><span class="line"><span class="string">&#x27;</span><span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="comment">##过程中，各样本基于物种丰度转化为 Bray-curtis 距离，基于环境变量使用欧式距离 ,mantel.fun可选择不同包中的mantel检验</span></span><br><span class="line">combination_layout<span class="punctuation">(</span>mantel2<span class="punctuation">,</span> cor_tbl <span class="operator">=</span> corr<span class="punctuation">)</span> <span class="operator">%&gt;%</span> <span class="comment">#设置参数start.var = env2 type = &quot;upper&quot; 可调整线条方向 lower朝下</span></span><br><span class="line">  ggplot<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">+</span> </span><br><span class="line">  geom_link<span class="punctuation">(</span>aes<span class="punctuation">(</span>colour <span class="operator">=</span> r<span class="punctuation">,</span>size <span class="operator">=</span> r<span class="punctuation">)</span><span class="punctuation">,</span>curvature <span class="operator">=</span> <span class="number">0.05</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_start_point<span class="punctuation">(</span>fill <span class="operator">=</span> <span class="string">&quot;red&quot;</span><span class="punctuation">,</span> shape <span class="operator">=</span> <span class="number">23</span><span class="punctuation">,</span> size <span class="operator">=</span> <span class="number">4</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_end_point<span class="punctuation">(</span>fill <span class="operator">=</span> <span class="string">&quot;blue&quot;</span><span class="punctuation">,</span> shape <span class="operator">=</span> <span class="number">21</span><span class="punctuation">,</span> size <span class="operator">=</span> <span class="number">4</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_start_label<span class="punctuation">(</span>aes<span class="punctuation">(</span>x <span class="operator">=</span> x <span class="operator">-</span> <span class="number">0.5</span><span class="punctuation">)</span><span class="punctuation">,</span> hjust <span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span> size <span class="operator">=</span> <span class="number">5</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_end_label<span class="punctuation">(</span>aes<span class="punctuation">(</span>x <span class="operator">=</span> xend <span class="operator">+</span> <span class="number">0.5</span><span class="punctuation">)</span><span class="punctuation">,</span> hjust <span class="operator">=</span> <span class="number">0</span><span class="punctuation">,</span> size <span class="operator">=</span> <span class="number">5</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  scale_color_gradient<span class="punctuation">(</span>low <span class="operator">=</span> <span class="string">&#x27;red&#x27;</span><span class="punctuation">,</span> high <span class="operator">=</span> <span class="string">&#x27;blue&#x27;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  scale_size<span class="punctuation">(</span><span class="built_in">range</span> <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span> </span><br><span class="line">  coord_cartesian<span class="punctuation">(</span>xlim <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="operator">-</span><span class="number">5</span><span class="punctuation">,</span> <span class="number">14</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  theme_void<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#组合图</span></span><br><span class="line"><span class="comment">#第一种</span></span><br><span class="line">mantel2 <span class="operator">&lt;-</span> mantel_test<span class="punctuation">(</span>varespec<span class="punctuation">,</span> varechem<span class="punctuation">,</span> mantel.fun <span class="operator">=</span> <span class="string">&#x27;mantel.randtest&#x27;</span><span class="punctuation">,</span>spec.dist.method <span class="operator">=</span> <span class="string">&#x27;bray&#x27;</span><span class="punctuation">,</span> env.dist.method <span class="operator">=</span> <span class="string">&#x27;euclidean&#x27;</span><span class="punctuation">,</span> </span><br><span class="line">                       spec.select <span class="operator">=</span> <span class="built_in">list</span><span class="punctuation">(</span>Spec01 <span class="operator">=</span> <span class="number">1</span><span class="operator">:</span><span class="number">7</span><span class="punctuation">,</span></span><br><span class="line">                                          Spec02 <span class="operator">=</span> <span class="number">8</span><span class="operator">:</span><span class="number">18</span><span class="punctuation">,</span></span><br><span class="line">                                          Spec03 <span class="operator">=</span> <span class="number">19</span><span class="operator">:</span><span class="number">24</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">mantel4 <span class="operator">&lt;-</span> mantel2<span class="punctuation">[</span><span class="operator">-</span>which<span class="punctuation">(</span>mantel2<span class="operator">$</span>p.value<span class="operator">&gt;</span><span class="number">0.05</span><span class="punctuation">)</span><span class="punctuation">,</span><span class="punctuation">]</span> <span class="comment">#可以做一定得筛选</span></span><br><span class="line"><span class="comment">##划定p值r值范围 变为离散型</span></span><br><span class="line"><span class="comment">#作图根据定义的区间设置连线风格，区分显著的相关系数和不显著的 Mantel 相关</span></span><br><span class="line">mantel2 <span class="operator">&lt;-</span> mutate<span class="punctuation">(</span>mantel2<span class="punctuation">,</span> </span><br><span class="line">                  r <span class="operator">=</span> cut<span class="punctuation">(</span>r<span class="punctuation">,</span> breaks <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="operator">-</span><span class="literal">Inf</span><span class="punctuation">,</span> <span class="number">0.25</span><span class="punctuation">,</span> <span class="number">0.5</span><span class="punctuation">,</span> <span class="literal">Inf</span><span class="punctuation">)</span><span class="punctuation">,</span> </span><br><span class="line">                          labels <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;&lt;0.25&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;0.25-0.5&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;&gt;=0.5&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span> right <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">                  p.value <span class="operator">=</span> cut<span class="punctuation">(</span>p.value<span class="punctuation">,</span> breaks <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="operator">-</span><span class="literal">Inf</span><span class="punctuation">,</span> <span class="number">0.001</span><span class="punctuation">,</span> <span class="number">0.01</span><span class="punctuation">,</span> <span class="number">0.05</span><span class="punctuation">,</span> <span class="literal">Inf</span><span class="punctuation">)</span><span class="punctuation">,</span> </span><br><span class="line">                                labels <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;&lt;0.001&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;0.001-0.01&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;0.01-0.05&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;&gt;=0.05&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span> right <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#对于重要的相关系数的取舍，除了选择了直接剔除或者不在图中展示。此外，也可以选择将它们保留在图中，使用其它颜色区分即可。</span></span><br><span class="line">df <span class="operator">&lt;-</span> combination_layout<span class="punctuation">(</span>mantel2<span class="punctuation">,</span> cor_tbl <span class="operator">=</span> corr<span class="punctuation">)</span> <span class="comment">## 这里需要存储下结果</span></span><br><span class="line">options<span class="punctuation">(</span>ggcor.link.inherit.aes <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span><span class="comment">#我们可以通过全局变量ggcor.link.inherit.aes来改变link相关的图层映射参数继承。</span></span><br><span class="line">quickcor<span class="punctuation">(</span>corr<span class="punctuation">)</span> <span class="operator">+</span> geom_square<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">+</span> <span class="comment">#还有更多样式，和 corrplot 包中的风格是一致的</span></span><br><span class="line">  geom_link<span class="punctuation">(</span>aes<span class="punctuation">(</span>colour <span class="operator">=</span> p.value<span class="punctuation">,</span>size <span class="operator">=</span> r<span class="punctuation">)</span><span class="punctuation">,</span> data <span class="operator">=</span> df<span class="punctuation">)</span> <span class="operator">+</span> <span class="comment"># 添加连接线</span></span><br><span class="line">  geom_start_point<span class="punctuation">(</span>fill <span class="operator">=</span> <span class="string">&quot;red&quot;</span><span class="punctuation">,</span> shape <span class="operator">=</span> <span class="number">23</span><span class="punctuation">,</span> size <span class="operator">=</span> <span class="number">4</span><span class="punctuation">,</span> data <span class="operator">=</span> df<span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_end_point<span class="punctuation">(</span>fill <span class="operator">=</span> <span class="string">&quot;blue&quot;</span><span class="punctuation">,</span> shape <span class="operator">=</span> <span class="number">21</span><span class="punctuation">,</span> size <span class="operator">=</span> <span class="number">4</span><span class="punctuation">,</span> data <span class="operator">=</span> df<span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_start_label<span class="punctuation">(</span>aes<span class="punctuation">(</span>x <span class="operator">=</span> x <span class="operator">-</span> <span class="number">0.5</span><span class="punctuation">)</span><span class="punctuation">,</span> hjust <span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span> size <span class="operator">=</span> <span class="number">5</span><span class="punctuation">,</span> data <span class="operator">=</span> df<span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  <span class="comment">#scale_fill_gradient2(midpoint = 0, low = &#x27;blue&#x27;, mid = &#x27;white&#x27;, high = &#x27;red&#x27;, space = &#x27;Lab&#x27;)+</span></span><br><span class="line">  scale_fill_gradient2<span class="punctuation">(</span>midpoint <span class="operator">=</span> <span class="number">0</span><span class="punctuation">,</span> low <span class="operator">=</span> <span class="string">&quot;#56B4E9&quot;</span><span class="punctuation">,</span> mid <span class="operator">=</span> <span class="string">&quot;white&quot;</span><span class="punctuation">,</span>high <span class="operator">=</span> <span class="string">&quot;#E69F00&quot;</span><span class="punctuation">,</span> space <span class="operator">=</span> <span class="string">&quot;Lab&quot;</span> <span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  <span class="comment">#scale_color_gradient(low = &#x27;red&#x27;, high = &#x27;blue&#x27;) +</span></span><br><span class="line">  scale_color_manual<span class="punctuation">(</span>values<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;#56B4E9&quot;</span><span class="punctuation">,</span> <span class="string">&quot;#E69F00&quot;</span><span class="punctuation">,</span> <span class="string">&quot;#999999&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  scale_size_manual<span class="punctuation">(</span>values <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">0.1</span><span class="punctuation">,</span> <span class="number">0.5</span><span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">)</span><span class="punctuation">)</span>  <span class="operator">+</span></span><br><span class="line">  geom_end_label<span class="punctuation">(</span>aes<span class="punctuation">(</span>x <span class="operator">=</span> xend <span class="operator">+</span> <span class="number">0.5</span><span class="punctuation">)</span><span class="punctuation">,</span> hjust <span class="operator">=</span> <span class="number">0</span><span class="punctuation">,</span> size <span class="operator">=</span> <span class="number">3.8</span><span class="punctuation">,</span> data <span class="operator">=</span> df<span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  expand_axis<span class="punctuation">(</span>x <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="operator">-</span><span class="number">6</span><span class="punctuation">,</span> <span class="number">14.5</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  remove_y_axis<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="计算alpha多样性指数"><strong>计算Alpha多样性指数</strong></h3>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#更多参数见2018_Book_StatisticalAnalysisOfMicrobiom书第6章</span></span><br><span class="line">library<span class="punctuation">(</span>vegan<span class="punctuation">)</span></span><br><span class="line">rm<span class="punctuation">(</span><span class="built_in">list</span> <span class="operator">=</span> ls<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##物种丰富度 Richness 指数</span></span><br><span class="line">richness <span class="operator">&lt;-</span> rowSums<span class="punctuation">(</span>otu <span class="operator">&gt;</span> <span class="number">0</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment">#或</span></span><br><span class="line">richness <span class="operator">&lt;-</span> estimateR<span class="punctuation">(</span>otu<span class="punctuation">)</span><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">,</span> <span class="punctuation">]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##Shannon（以下 Shannon 公式的对数底数均设使用 e，在 R 中即表示为 exp(1)）</span></span><br><span class="line"><span class="comment">#Shannon 指数</span></span><br><span class="line">shannon_index <span class="operator">&lt;-</span> diversity<span class="punctuation">(</span>otu<span class="punctuation">,</span> index <span class="operator">=</span> <span class="string">&#x27;shannon&#x27;</span><span class="punctuation">,</span> base <span class="operator">=</span> <span class="built_in">exp</span><span class="punctuation">(</span><span class="number">1</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#Shannon 多样性</span></span><br><span class="line">shannon_diversity <span class="operator">&lt;-</span> <span class="built_in">exp</span><span class="punctuation">(</span><span class="number">1</span><span class="punctuation">)</span><span class="operator">^</span>shannon_index</span><br><span class="line"></span><br><span class="line"><span class="comment">#Shannon 均匀度（Pielou 均匀度）</span></span><br><span class="line">pielou <span class="operator">&lt;-</span> shannon_index <span class="operator">/</span> <span class="built_in">log</span><span class="punctuation">(</span>richness<span class="punctuation">,</span> <span class="built_in">exp</span><span class="punctuation">(</span><span class="number">1</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##Simpson</span></span><br><span class="line"><span class="comment">#Gini-Simpson 指数（我们平时常用的 Simpson 指数即为 Gini-Simpson 指数）</span></span><br><span class="line">gini_simpson_index <span class="operator">&lt;-</span> diversity<span class="punctuation">(</span>otu<span class="punctuation">,</span> index <span class="operator">=</span> <span class="string">&#x27;simpson&#x27;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#经典 Simpson 指数（使用频率比较低）</span></span><br><span class="line">simpson_index <span class="operator">&lt;-</span> 1 <span class="operator">-</span> gini_simpson_index</span><br><span class="line"><span class="comment">#Invsimpson 指数（Gini-Simpson 的倒数）</span></span><br><span class="line">invsimpson_index <span class="operator">&lt;-</span> 1 <span class="operator">/</span> gini_simpson_index</span><br><span class="line"><span class="comment">#或</span></span><br><span class="line">invsimpson_index <span class="operator">&lt;-</span> diversity<span class="punctuation">(</span>otu<span class="punctuation">,</span> index <span class="operator">=</span> <span class="string">&#x27;invsimpson&#x27;</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment">#Simpson 多样性</span></span><br><span class="line">simpson_diversity <span class="operator">&lt;-</span> 1 <span class="operator">/</span> <span class="punctuation">(</span><span class="number">1</span> <span class="operator">-</span> gini_simpson_index<span class="punctuation">)</span></span><br><span class="line"><span class="comment">#Simpson 均匀度（equitability 均匀度）</span></span><br><span class="line">equitability <span class="operator">&lt;-</span> 1 <span class="operator">/</span> <span class="punctuation">(</span>richness <span class="operator">*</span> <span class="punctuation">(</span><span class="number">1</span> <span class="operator">-</span> gini_simpson_index<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">str<span class="punctuation">(</span>ace<span class="punctuation">)</span></span><br><span class="line"><span class="comment">##Chao1 &amp; ACE</span></span><br><span class="line"><span class="comment">#Chao1 指数</span></span><br><span class="line">chao1 <span class="operator">&lt;-</span> estimateR<span class="punctuation">(</span>otu<span class="punctuation">)</span><span class="punctuation">[</span><span class="number">2</span><span class="punctuation">,</span> <span class="punctuation">]</span></span><br><span class="line"><span class="comment">#ACE 指数</span></span><br><span class="line">ace <span class="operator">&lt;-</span> estimateR<span class="punctuation">(</span>otu<span class="punctuation">)</span><span class="punctuation">[</span><span class="number">4</span><span class="punctuation">,</span> <span class="punctuation">]</span></span><br><span class="line"><span class="comment">##goods_coverage 指数</span></span><br><span class="line">goods_coverage <span class="operator">&lt;-</span> 1 <span class="operator">-</span> rowSums<span class="punctuation">(</span>otu <span class="operator">==</span> <span class="number">1</span><span class="punctuation">)</span> <span class="operator">/</span> rowSums<span class="punctuation">(</span>otu<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#定义函数，计算丰富度、Shannon 熵指数、Simpson 指数（Gini-Simpson 指数）、Pielou 均匀度、Chao1 指数、ACE 指数、goods_coverage、PD_whole_tree</span></span><br><span class="line">library<span class="punctuation">(</span>picante<span class="punctuation">)</span>	<span class="comment">#picante 包加载时默认同时加载 vegan</span></span><br><span class="line">alpha <span class="operator">&lt;-</span> <span class="keyword">function</span><span class="punctuation">(</span>x<span class="punctuation">,</span> tree <span class="operator">=</span> <span class="literal">NULL</span><span class="punctuation">,</span> base <span class="operator">=</span> <span class="built_in">exp</span><span class="punctuation">(</span><span class="number">1</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">  est <span class="operator">&lt;-</span> estimateR<span class="punctuation">(</span>x<span class="punctuation">)</span></span><br><span class="line">  Richness <span class="operator">&lt;-</span> est<span class="punctuation">[</span><span class="number">1</span><span class="punctuation">,</span> <span class="punctuation">]</span></span><br><span class="line">  Chao1 <span class="operator">&lt;-</span> est<span class="punctuation">[</span><span class="number">2</span><span class="punctuation">,</span> <span class="punctuation">]</span></span><br><span class="line">  ACE <span class="operator">&lt;-</span> est<span class="punctuation">[</span><span class="number">4</span><span class="punctuation">,</span> <span class="punctuation">]</span></span><br><span class="line">  Shannon <span class="operator">&lt;-</span> diversity<span class="punctuation">(</span>x<span class="punctuation">,</span> index <span class="operator">=</span> <span class="string">&#x27;shannon&#x27;</span><span class="punctuation">,</span> base <span class="operator">=</span> base<span class="punctuation">)</span></span><br><span class="line">  Simpson <span class="operator">&lt;-</span> diversity<span class="punctuation">(</span>x<span class="punctuation">,</span> index <span class="operator">=</span> <span class="string">&#x27;simpson&#x27;</span><span class="punctuation">)</span>	<span class="comment">#Gini-Simpson 指数</span></span><br><span class="line">  Pielou <span class="operator">&lt;-</span> Shannon <span class="operator">/</span> <span class="built_in">log</span><span class="punctuation">(</span>Richness<span class="punctuation">,</span> base<span class="punctuation">)</span></span><br><span class="line">  goods_coverage <span class="operator">&lt;-</span> 1 <span class="operator">-</span> rowSums<span class="punctuation">(</span>x <span class="operator">==</span> <span class="number">1</span><span class="punctuation">)</span> <span class="operator">/</span> rowSums<span class="punctuation">(</span>x<span class="punctuation">)</span></span><br><span class="line">  result <span class="operator">&lt;-</span> data.frame<span class="punctuation">(</span>Richness<span class="punctuation">,</span> Shannon<span class="punctuation">,</span> Simpson<span class="punctuation">,</span> Pielou<span class="punctuation">,</span> Chao1<span class="punctuation">,</span> ACE<span class="punctuation">,</span> goods_coverage<span class="punctuation">)</span></span><br><span class="line">  <span class="keyword">if</span> <span class="punctuation">(</span><span class="operator">!</span><span class="built_in">is.null</span><span class="punctuation">(</span>tree<span class="punctuation">)</span><span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">    PD_whole_tree <span class="operator">&lt;-</span> pd<span class="punctuation">(</span>x<span class="punctuation">,</span> tree<span class="punctuation">,</span> include.root <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span></span><br><span class="line">    <span class="built_in">names</span><span class="punctuation">(</span>PD_whole_tree<span class="punctuation">)</span> <span class="operator">&lt;-</span> <span class="string">&#x27;PD_whole_tree&#x27;</span></span><br><span class="line">    result <span class="operator">&lt;-</span> cbind<span class="punctuation">(</span>result<span class="punctuation">,</span> PD_whole_tree<span class="punctuation">)</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line">  result</span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#加载 OTU 丰度表和进化树文件</span></span><br><span class="line">otu <span class="operator">&lt;-</span> read.delim<span class="punctuation">(</span><span class="string">&#x27;OTU_table.txt&#x27;</span><span class="punctuation">,</span> row.names <span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span> sep <span class="operator">=</span> <span class="string">&#x27;\t&#x27;</span><span class="punctuation">,</span> stringsAsFactors <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">,</span> check.names <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span></span><br><span class="line">otu <span class="operator">&lt;-</span> t<span class="punctuation">(</span>otu<span class="punctuation">)</span></span><br><span class="line">tree <span class="operator">&lt;-</span> read.tree<span class="punctuation">(</span><span class="string">&#x27;otu_phylo.tre&#x27;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#不包含谱系多样性，无需指定进化树；Shannon 公式的 log 底数我们使用 2</span></span><br><span class="line">alpha_all <span class="operator">&lt;-</span> alpha<span class="punctuation">(</span>otu<span class="punctuation">,</span> base <span class="operator">=</span> <span class="number">2</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment">#包含谱系多样性时，指定进化树文件；Shannon 公式的 log 底数我们使用 2</span></span><br><span class="line">alpha_all <span class="operator">&lt;-</span> alpha<span class="punctuation">(</span>otu<span class="punctuation">,</span> tree<span class="punctuation">,</span> base <span class="operator">=</span> <span class="number">2</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment">#输出，例如 csv 格式</span></span><br><span class="line">write.csv<span class="punctuation">(</span>alpha_all<span class="punctuation">,</span> <span class="string">&#x27;alpha.csv&#x27;</span><span class="punctuation">,</span> <span class="built_in">quote</span> <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="go条形图-气泡图"><strong>Go条形图&amp;气泡图</strong></h3>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">rm<span class="punctuation">(</span><span class="built_in">list</span><span class="operator">=</span>ls<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>xlsx<span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>ggplot2<span class="punctuation">)</span></span><br><span class="line">data <span class="operator">&lt;-</span> read.xlsx<span class="punctuation">(</span><span class="string">&#x27;GO_bar.xlsx&#x27;</span><span class="punctuation">,</span>header <span class="operator">=</span> <span class="built_in">T</span><span class="punctuation">,</span>sheetIndex <span class="operator">=</span> <span class="number">1</span><span class="punctuation">)</span></span><br><span class="line">p <span class="operator">&lt;-</span> ggplot<span class="punctuation">(</span>data<span class="punctuation">,</span>aes<span class="punctuation">(</span>x<span class="operator">=</span>Go_term<span class="punctuation">,</span>y<span class="operator">=</span>Counts<span class="punctuation">,</span>fill <span class="operator">=</span> Go_category<span class="punctuation">)</span><span class="punctuation">)</span><span class="operator">+</span>geom_bar<span class="punctuation">(</span>stat <span class="operator">=</span> <span class="string">&quot;identity&quot;</span><span class="punctuation">,</span>width <span class="operator">=</span> <span class="number">0.8</span><span class="punctuation">)</span></span><br><span class="line">p</span><br><span class="line"><span class="comment">#将GO_term设定为factor即可按照顺序输出</span></span><br><span class="line">GO_term_order<span class="operator">=</span>factor<span class="punctuation">(</span><span class="built_in">as.integer</span><span class="punctuation">(</span>rownames<span class="punctuation">(</span>data<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">,</span>labels<span class="operator">=</span>data<span class="operator">$</span>Go_term<span class="punctuation">)</span></span><br><span class="line">ggplot<span class="punctuation">(</span>data<span class="punctuation">,</span>aes<span class="punctuation">(</span>x<span class="operator">=</span>GO_term_order<span class="punctuation">,</span>y<span class="operator">=</span>Counts<span class="punctuation">,</span>fill <span class="operator">=</span> Go_category<span class="punctuation">)</span><span class="punctuation">)</span><span class="operator">+</span>geom_bar<span class="punctuation">(</span>stat <span class="operator">=</span> <span class="string">&quot;identity&quot;</span><span class="punctuation">,</span>width <span class="operator">=</span> <span class="number">0.8</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">   coord_flip<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">+</span>  xlab<span class="punctuation">(</span><span class="string">&quot;GO term&quot;</span><span class="punctuation">)</span> <span class="operator">+</span> ylab<span class="punctuation">(</span><span class="string">&quot;Num of Genes&quot;</span><span class="punctuation">)</span> <span class="operator">+</span> theme_bw<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment">#或者将坐标轴调整角度</span></span><br><span class="line">COLS <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;#66C3A5&quot;</span><span class="punctuation">,</span> <span class="string">&quot;#8DA1CB&quot;</span><span class="punctuation">,</span> <span class="string">&quot;#FD8D62&quot;</span><span class="punctuation">)</span></span><br><span class="line">ggplot<span class="punctuation">(</span>data<span class="operator">=</span>data<span class="punctuation">,</span> aes<span class="punctuation">(</span>x<span class="operator">=</span>GO_term_order<span class="punctuation">,</span>y<span class="operator">=</span>Counts<span class="punctuation">,</span> fill<span class="operator">=</span>Go_category<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_bar<span class="punctuation">(</span>stat<span class="operator">=</span><span class="string">&quot;identity&quot;</span><span class="punctuation">,</span> width<span class="operator">=</span><span class="number">0.8</span><span class="punctuation">)</span> <span class="operator">+</span> </span><br><span class="line">  scale_fill_manual<span class="punctuation">(</span>values <span class="operator">=</span> COLS<span class="punctuation">)</span> <span class="operator">+</span> theme_bw<span class="punctuation">(</span><span class="punctuation">)</span>  <span class="operator">+</span></span><br><span class="line">  xlab<span class="punctuation">(</span><span class="string">&quot;GO term&quot;</span><span class="punctuation">)</span> <span class="operator">+</span> ylab<span class="punctuation">(</span><span class="string">&quot;Num of Genes&quot;</span><span class="punctuation">)</span> <span class="operator">+</span> labs<span class="punctuation">(</span>title <span class="operator">=</span> <span class="string">&quot;The Most Enriched GO Terms&quot;</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  theme<span class="punctuation">(</span>axis.text.x<span class="operator">=</span>element_text<span class="punctuation">(</span>face <span class="operator">=</span> <span class="string">&quot;bold&quot;</span><span class="punctuation">,</span> color<span class="operator">=</span><span class="string">&quot;black&quot;</span><span class="punctuation">,</span>angle <span class="operator">=</span> <span class="number">70</span><span class="punctuation">,</span>vjust <span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span> hjust <span class="operator">=</span> <span class="number">1</span> <span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  scale_y_continuous<span class="punctuation">(</span>limits <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span><span class="number">170</span><span class="punctuation">)</span><span class="punctuation">,</span>expand <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span><span class="number">0</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">theme<span class="punctuation">(</span>axis.text <span class="operator">=</span> element_text<span class="punctuation">(</span>size <span class="operator">=</span> <span class="number">12</span><span class="punctuation">)</span><span class="punctuation">,</span> axis.title <span class="operator">=</span> element_text<span class="punctuation">(</span>size <span class="operator">=</span> <span class="number">13</span><span class="punctuation">)</span><span class="punctuation">,</span> legend.title <span class="operator">=</span> element_blank<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">,</span>legend.text <span class="operator">=</span> element_text<span class="punctuation">(</span>size <span class="operator">=</span> <span class="number">11</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##我们还可以将不同分组的Go_term的名字都映射颜色</span></span><br><span class="line">table<span class="punctuation">(</span>go_enrich_df<span class="operator">$</span>type<span class="punctuation">)</span> <span class="comment">## 使用table函数统计每一组中包含的个数，方便后面进行颜色的映射</span></span><br><span class="line"> theme<span class="punctuation">(</span>axis.text.y <span class="operator">=</span> element_text<span class="punctuation">(</span>angle<span class="operator">=</span><span class="number">0</span><span class="punctuation">,</span>hjust<span class="operator">=</span><span class="number">1</span><span class="punctuation">,</span> vjust<span class="operator">=</span><span class="number">1</span><span class="punctuation">,</span> color  <span class="operator">=</span> <span class="built_in">rep</span><span class="punctuation">(</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;#FD8D62&quot;</span><span class="punctuation">,</span><span class="string">&quot;#8DA1CB&quot;</span><span class="punctuation">,</span> <span class="string">&quot;#66C3A5&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">12</span><span class="punctuation">,</span><span class="number">4</span><span class="punctuation">,</span><span class="number">20</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="comment">#根据算出的数目映射</span></span><br></pre></td></tr></table></figure>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##GO气泡图</span></span><br><span class="line">rm<span class="punctuation">(</span><span class="built_in">list</span> <span class="operator">=</span> ls<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>GOplot<span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>ggplot2<span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>RColorBrewer<span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>ggrepel<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">data<span class="punctuation">(</span>EC<span class="punctuation">)</span></span><br><span class="line">head<span class="punctuation">(</span>EC<span class="operator">$</span>david<span class="punctuation">)</span></span><br><span class="line">head<span class="punctuation">(</span>EC<span class="operator">$</span>genelist<span class="punctuation">)</span></span><br><span class="line">circ <span class="operator">&lt;-</span> circle_dat<span class="punctuation">(</span>EC<span class="operator">$</span>david<span class="punctuation">,</span> EC<span class="operator">$</span>genelist<span class="punctuation">)</span></span><br><span class="line"><span class="comment">#直接气泡图</span></span><br><span class="line">GOBubble<span class="punctuation">(</span>circ<span class="punctuation">,</span> labels <span class="operator">=</span> <span class="number">4</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment">#labels: Sets a threshold for the displayed labels. The threshold refers to the -log(adjusted p-value) (default=5)</span></span><br><span class="line"><span class="comment">#略调整参数之后可以对图的布局、颜色等进行调整</span></span><br><span class="line">GOBubble<span class="punctuation">(</span>circ<span class="punctuation">,</span> title <span class="operator">=</span> <span class="string">&#x27;Bubble plot&#x27;</span><span class="punctuation">,</span> colour <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;orange&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;darkred&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;gold&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span> display <span class="operator">=</span> <span class="string">&#x27;multiple&#x27;</span><span class="punctuation">,</span> labels <span class="operator">=</span> <span class="number">3</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">circ2 <span class="operator">&lt;-</span> circ<span class="punctuation">[</span><span class="operator">!</span>duplicated<span class="punctuation">(</span>circ<span class="operator">$</span>ID<span class="punctuation">)</span><span class="punctuation">,</span><span class="operator">-</span><span class="number">5</span><span class="punctuation">]</span></span><br><span class="line">head<span class="punctuation">(</span>circ2<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##ggplot画图</span></span><br><span class="line">ggplot<span class="punctuation">(</span>circ2<span class="punctuation">,</span>aes<span class="punctuation">(</span>x<span class="operator">=</span>zscore<span class="punctuation">,</span>y<span class="operator">=</span><span class="operator">-</span>log10<span class="punctuation">(</span>adj_pval<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  geom_point<span class="punctuation">(</span>aes<span class="punctuation">(</span>size<span class="operator">=</span>count<span class="punctuation">,</span>color<span class="operator">=</span>category<span class="punctuation">)</span><span class="punctuation">,</span>alpha<span class="operator">=</span><span class="number">0.6</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  scale_size<span class="punctuation">(</span><span class="built_in">range</span><span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span><span class="number">12</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  scale_color_brewer<span class="punctuation">(</span>palette <span class="operator">=</span> <span class="string">&quot;Accent&quot;</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  theme_bw<span class="punctuation">(</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  theme<span class="punctuation">(</span></span><br><span class="line">    <span class="comment">#legend.position = c(&quot;none&quot;)</span></span><br><span class="line">  <span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  geom_text_repel<span class="punctuation">(</span></span><br><span class="line">    data <span class="operator">=</span> circ2<span class="punctuation">[</span><span class="operator">-</span>log10<span class="punctuation">(</span>circ2<span class="operator">$</span>adj_pval<span class="punctuation">)</span><span class="operator">&gt;</span><span class="number">3</span><span class="punctuation">,</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    aes<span class="punctuation">(</span>label <span class="operator">=</span> ID<span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">    size <span class="operator">=</span> <span class="number">3</span><span class="punctuation">,</span></span><br><span class="line">    segment.color <span class="operator">=</span> <span class="string">&quot;black&quot;</span><span class="punctuation">,</span> show.legend <span class="operator">=</span> <span class="literal">FALSE</span> <span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  facet_grid<span class="punctuation">(</span>.<span class="operator">~</span>category<span class="punctuation">)</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="富集气泡图"><strong>富集气泡图</strong></h3>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">library<span class="punctuation">(</span>ggplot2<span class="punctuation">)</span></span><br><span class="line">pathway <span class="operator">=</span> read.delim<span class="punctuation">(</span><span class="string">&#x27;KEGG_pathwa.txt&#x27;</span><span class="punctuation">,</span>check.names <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">,</span>header <span class="operator">=</span> <span class="built_in">T</span><span class="punctuation">,</span>sep <span class="operator">=</span> <span class="string">&#x27;\t&#x27;</span><span class="punctuation">)</span></span><br><span class="line">p <span class="operator">&lt;-</span> ggplot<span class="punctuation">(</span>pathway<span class="punctuation">,</span>aes<span class="punctuation">(</span>GeneRatio<span class="punctuation">,</span>Description<span class="punctuation">)</span><span class="punctuation">)</span><span class="operator">+</span>geom_point<span class="punctuation">(</span>aes<span class="punctuation">(</span>size <span class="operator">=</span> Count<span class="punctuation">,</span>color <span class="operator">=</span> <span class="operator">-</span><span class="number">1</span><span class="operator">*</span>log10<span class="punctuation">(</span>qvalue<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  scale_color_gradient<span class="punctuation">(</span>low <span class="operator">=</span> <span class="string">&quot;green&quot;</span><span class="punctuation">,</span>high <span class="operator">=</span> <span class="string">&#x27;red&#x27;</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  labs<span class="punctuation">(</span>color <span class="operator">=</span> <span class="built_in">expression</span><span class="punctuation">(</span><span class="operator">-</span><span class="built_in">log</span><span class="punctuation">[</span><span class="number">10</span><span class="punctuation">]</span><span class="punctuation">(</span>qvalue<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">,</span>size <span class="operator">=</span> <span class="string">&#x27;Gene&#x27;</span><span class="punctuation">,</span></span><br><span class="line">       x <span class="operator">=</span> <span class="string">&#x27;GeneRatio&#x27;</span><span class="punctuation">,</span></span><br><span class="line">       y <span class="operator">=</span> <span class="string">&#x27;Go_term&#x27;</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  theme<span class="punctuation">(</span>panel.grid <span class="operator">=</span> element_blank<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">,</span> panel.background <span class="operator">=</span> element_rect<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&#x27;black&#x27;</span><span class="punctuation">,</span> fill <span class="operator">=</span> <span class="string">&#x27;transparent&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span> strip.text <span class="operator">=</span> element_text<span class="punctuation">(</span>size <span class="operator">=</span> <span class="number">12</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  theme<span class="punctuation">(</span>axis.text <span class="operator">=</span> element_text<span class="punctuation">(</span>size <span class="operator">=</span> <span class="number">13</span><span class="punctuation">)</span><span class="punctuation">,</span> axis.title <span class="operator">=</span> element_text<span class="punctuation">(</span>size <span class="operator">=</span> <span class="number">13</span><span class="punctuation">)</span><span class="punctuation">,</span> legend.key <span class="operator">=</span> element_blank<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">,</span> legend.text <span class="operator">=</span> element_text<span class="punctuation">(</span>size <span class="operator">=</span> <span class="number">11</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">p        </span><br><span class="line">ggsave<span class="punctuation">(</span><span class="string">&quot;T01vsT07_up.pdf&quot;</span><span class="punctuation">,</span>p<span class="punctuation">,</span>width <span class="operator">=</span> <span class="number">10</span><span class="punctuation">,</span>height <span class="operator">=</span> <span class="number">7</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="火山图"><strong>火山图</strong></h3>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br></pre></td><td class="code"><pre><span class="line">setwd<span class="punctuation">(</span><span class="string">&#x27;../huoshantuGGplot/&#x27;</span><span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>ggplot2<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#读取数据</span></span><br><span class="line">diff_stat <span class="operator">&lt;-</span> read.delim<span class="punctuation">(</span><span class="string">&#x27;diff_stat.txt&#x27;</span><span class="punctuation">,</span> sep <span class="operator">=</span> <span class="string">&#x27;\t&#x27;</span><span class="punctuation">,</span> stringsAsFactors <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##横轴 log2 Fold Change（log2FC），纵轴 -log10 FDR（-log10(FDR)）</span></span><br><span class="line"><span class="comment">#散点图轮廓</span></span><br><span class="line">p1 <span class="operator">&lt;-</span> ggplot<span class="punctuation">(</span>diff_stat<span class="punctuation">,</span> aes<span class="punctuation">(</span>x <span class="operator">=</span> log2FC<span class="punctuation">,</span> y <span class="operator">=</span> <span class="operator">-</span>log10<span class="punctuation">(</span>FDR<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_point<span class="punctuation">(</span>size <span class="operator">=</span> <span class="number">0.5</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&#x27;log2 Fold Change&#x27;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&#x27;-log10 FDR p-value&#x27;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">p1</span><br><span class="line"></span><br><span class="line"><span class="comment">#根据差异水平赋值颜色，例如 |log2FC| &gt;= 1 &amp; FDR p-value &lt; 0.05</span></span><br><span class="line">diff_stat<span class="punctuation">[</span>which<span class="punctuation">(</span>diff_stat<span class="operator">$</span>FDR <span class="operator">&lt;</span> <span class="number">0.05</span> <span class="operator">&amp;</span> diff_stat<span class="operator">$</span>log2FC <span class="operator">&gt;=</span> <span class="number">1</span><span class="punctuation">)</span><span class="punctuation">,</span><span class="string">&#x27;diff&#x27;</span><span class="punctuation">]</span> <span class="operator">&lt;-</span> <span class="string">&#x27;up&#x27;</span></span><br><span class="line">diff_stat<span class="punctuation">[</span>which<span class="punctuation">(</span>diff_stat<span class="operator">$</span>FDR <span class="operator">&lt;</span> <span class="number">0.05</span> <span class="operator">&amp;</span> diff_stat<span class="operator">$</span>log2FC <span class="operator">&lt;=</span> <span class="operator">-</span><span class="number">1</span><span class="punctuation">)</span><span class="punctuation">,</span><span class="string">&#x27;diff&#x27;</span><span class="punctuation">]</span> <span class="operator">&lt;-</span> <span class="string">&#x27;dowm&#x27;</span></span><br><span class="line">diff_stat<span class="punctuation">[</span><span class="operator">!</span><span class="punctuation">(</span>diff_stat<span class="operator">$</span>diff <span class="operator">%in%</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;up&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;dowm&#x27;</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">,</span><span class="string">&#x27;diff&#x27;</span><span class="punctuation">]</span> <span class="operator">&lt;-</span> <span class="string">&#x27;no&#x27;</span></span><br><span class="line"></span><br><span class="line">p1 <span class="operator">&lt;-</span> ggplot<span class="punctuation">(</span>diff_stat<span class="punctuation">,</span> aes<span class="punctuation">(</span>x <span class="operator">=</span> log2FC<span class="punctuation">,</span> y <span class="operator">=</span> <span class="operator">-</span>log10<span class="punctuation">(</span>FDR<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_point<span class="punctuation">(</span>aes<span class="punctuation">(</span>color <span class="operator">=</span> diff<span class="punctuation">)</span><span class="punctuation">,</span> size <span class="operator">=</span> <span class="number">0.5</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  scale_colour_manual<span class="punctuation">(</span>limits <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;up&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;dowm&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;no&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span> values <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;blue&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;red&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;gray40&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span> labels <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;Enriched OTUs&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;Depleted OTUs&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;No diff OTUs&#x27;</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&#x27;log2 Fold Change&#x27;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&#x27;-log10 FDR p-value&#x27;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">p1</span><br><span class="line"></span><br><span class="line"><span class="comment">#背景外观，调整示例</span></span><br><span class="line">p1 <span class="operator">&lt;-</span> p1 <span class="operator">+</span></span><br><span class="line">  theme<span class="punctuation">(</span>panel.grid.major <span class="operator">=</span> element_line<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&#x27;gray&#x27;</span><span class="punctuation">,</span> size <span class="operator">=</span> <span class="number">0.2</span><span class="punctuation">)</span><span class="punctuation">,</span> panel.background <span class="operator">=</span> element_rect<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&#x27;black&#x27;</span><span class="punctuation">,</span> fill <span class="operator">=</span> <span class="string">&#x27;transparent&#x27;</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_vline<span class="punctuation">(</span>xintercept <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="operator">-</span><span class="number">1</span><span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">)</span><span class="punctuation">,</span> color <span class="operator">=</span> <span class="string">&#x27;gray&#x27;</span><span class="punctuation">,</span> linetype <span class="operator">=</span> <span class="number">2</span><span class="punctuation">,</span> size <span class="operator">=</span> <span class="number">0.5</span><span class="punctuation">)</span> <span class="operator">+</span> </span><br><span class="line">  geom_hline<span class="punctuation">(</span>yintercept <span class="operator">=</span> <span class="operator">-</span>log10<span class="punctuation">(</span><span class="number">0.05</span><span class="punctuation">)</span><span class="punctuation">,</span> color <span class="operator">=</span> <span class="string">&#x27;gray&#x27;</span><span class="punctuation">,</span> linetype <span class="operator">=</span> <span class="number">2</span><span class="punctuation">,</span> size <span class="operator">=</span> <span class="number">0.5</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">p1</span><br><span class="line"></span><br><span class="line"><span class="comment">#图例，调整示例</span></span><br><span class="line">p1 <span class="operator">&lt;-</span> p1 <span class="operator">+</span></span><br><span class="line">  theme<span class="punctuation">(</span>legend.title <span class="operator">=</span> element_blank<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">,</span> legend.key <span class="operator">=</span> element_rect<span class="punctuation">(</span>fill <span class="operator">=</span> <span class="string">&#x27;transparent&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span> legend.background <span class="operator">=</span> element_rect<span class="punctuation">(</span>fill <span class="operator">=</span> <span class="string">&#x27;transparent&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span> legend.position <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">0.2</span><span class="punctuation">,</span> <span class="number">0.9</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">p1</span><br><span class="line"></span><br><span class="line"><span class="comment">#输出图片至本地</span></span><br><span class="line">ggsave<span class="punctuation">(</span><span class="string">&#x27;volcano_plot1.pdf&#x27;</span><span class="punctuation">,</span> p1<span class="punctuation">,</span> width <span class="operator">=</span> <span class="number">3.5</span><span class="punctuation">,</span> height <span class="operator">=</span> <span class="number">4.5</span><span class="punctuation">)</span></span><br><span class="line">ggsave<span class="punctuation">(</span><span class="string">&#x27;volcano_plot1.png&#x27;</span><span class="punctuation">,</span> p1<span class="punctuation">,</span> width <span class="operator">=</span> <span class="number">3.5</span><span class="punctuation">,</span> height <span class="operator">=</span> <span class="number">4.5</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##横轴 log2 Fold Change（log2FC），纵轴 log10 baseMean（log10baseMean），示例</span></span><br><span class="line">p2 <span class="operator">&lt;-</span> ggplot<span class="punctuation">(</span>diff_stat<span class="punctuation">,</span> aes<span class="punctuation">(</span>x <span class="operator">=</span> log2FC<span class="punctuation">,</span> y <span class="operator">=</span> log10baseMean<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_point<span class="punctuation">(</span>aes<span class="punctuation">(</span>color <span class="operator">=</span> diff<span class="punctuation">)</span><span class="punctuation">,</span> size <span class="operator">=</span> <span class="number">0.5</span><span class="punctuation">)</span> <span class="operator">+</span>	<span class="comment">#绘制散点</span></span><br><span class="line">  scale_colour_manual<span class="punctuation">(</span>limits <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;up&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;dowm&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;no&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span> values <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;blue&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;red&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;gray40&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span> labels <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;Enriched OTUs&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;Depleted OTUs&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;No diff OTUs&#x27;</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span>	<span class="comment">#赋值点的颜色，并设置图例展示标签</span></span><br><span class="line">  labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&#x27;log2 Fold Change&#x27;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&#x27;log10 Average Abundance&#x27;</span><span class="punctuation">)</span> <span class="operator">+</span>	<span class="comment">#设置坐标轴标题</span></span><br><span class="line">  theme<span class="punctuation">(</span>panel.grid.major <span class="operator">=</span> element_line<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&#x27;gray&#x27;</span><span class="punctuation">,</span> size <span class="operator">=</span> <span class="number">0.2</span><span class="punctuation">)</span><span class="punctuation">,</span> panel.background <span class="operator">=</span> element_rect<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&#x27;black&#x27;</span><span class="punctuation">,</span> fill <span class="operator">=</span> <span class="string">&#x27;transparent&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span> legend.title <span class="operator">=</span> element_blank<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">,</span> legend.key <span class="operator">=</span> element_rect<span class="punctuation">(</span>fill <span class="operator">=</span> <span class="string">&#x27;transparent&#x27;</span><span class="punctuation">)</span><span class="punctuation">)</span>	<span class="comment">#主体设置，包括背景、网格线、图例等的调整</span></span><br><span class="line"></span><br><span class="line">p2</span><br><span class="line"></span><br><span class="line"><span class="comment">#如需翻转 x、y 轴</span></span><br><span class="line">p2 <span class="operator">+</span> coord_flip<span class="punctuation">(</span><span class="punctuation">)</span> </span><br><span class="line"></span><br><span class="line"><span class="comment">#带分面的火山图示例</span></span><br><span class="line"><span class="comment">#这里把上述数据框“diff_stat”重复上 3 次，且当作 3 个不同分组的比较结果吧，仅用于演示分面图</span></span><br><span class="line">dat1 <span class="operator">&lt;-</span> diff_stat</span><br><span class="line">dat1<span class="operator">$</span>group <span class="operator">&lt;-</span> <span class="string">&#x27;group1 vs 2&#x27;</span></span><br><span class="line">gene <span class="operator">&lt;-</span> diff_stat</span><br><span class="line">gene<span class="operator">$</span>group <span class="operator">&lt;-</span> <span class="string">&#x27;group2 vs 3&#x27;</span></span><br><span class="line">dat3 <span class="operator">&lt;-</span> diff_stat</span><br><span class="line">dat3<span class="operator">$</span>group <span class="operator">&lt;-</span> <span class="string">&#x27;group1 vs 3&#x27;</span></span><br><span class="line">dat <span class="operator">&lt;-</span> rbind<span class="punctuation">(</span>dat1<span class="punctuation">,</span> gene<span class="punctuation">,</span> dat3<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">p3 <span class="operator">&lt;-</span> ggplot<span class="punctuation">(</span>dat<span class="punctuation">,</span> aes<span class="punctuation">(</span>x <span class="operator">=</span> log2FC<span class="punctuation">,</span> y <span class="operator">=</span> log10baseMean<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_point<span class="punctuation">(</span>aes<span class="punctuation">(</span>color <span class="operator">=</span> diff<span class="punctuation">)</span><span class="punctuation">,</span> size <span class="operator">=</span> <span class="number">0.5</span><span class="punctuation">,</span> show.legend <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span> <span class="operator">+</span>	<span class="comment">#绘制散点（这里隐藏了图例）</span></span><br><span class="line">  scale_colour_manual<span class="punctuation">(</span>limits <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;up&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;dowm&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;no&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span> values <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;blue&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;red&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;gray40&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span> labels <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;Enriched OTUs&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;Depleted OTUs&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;No diff OTUs&#x27;</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span>	<span class="comment">#赋值点的颜色，并设置图例展示标签</span></span><br><span class="line">  labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&#x27;log2 Fold Change&#x27;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&#x27;log10 Average Abundance&#x27;</span><span class="punctuation">)</span> <span class="operator">+</span>	<span class="comment">#设置坐标轴标题</span></span><br><span class="line">  theme<span class="punctuation">(</span>panel.grid.major <span class="operator">=</span> element_line<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&#x27;gray&#x27;</span><span class="punctuation">,</span> size <span class="operator">=</span> <span class="number">0.2</span><span class="punctuation">)</span><span class="punctuation">,</span> panel.background <span class="operator">=</span> element_rect<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&#x27;black&#x27;</span><span class="punctuation">,</span> fill <span class="operator">=</span> <span class="string">&#x27;transparent&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span> legend.title <span class="operator">=</span> element_blank<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">,</span> legend.key <span class="operator">=</span> element_rect<span class="punctuation">(</span>fill <span class="operator">=</span> <span class="string">&#x27;transparent&#x27;</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span>	<span class="comment">#主体设置，包括背景、网格线、图例等的调整</span></span><br><span class="line">  coord_flip<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">+</span>	<span class="comment">#翻转坐标轴</span></span><br><span class="line">  facet_wrap<span class="punctuation">(</span><span class="operator">~</span>group<span class="punctuation">,</span> ncol <span class="operator">=</span> <span class="number">3</span><span class="punctuation">,</span> scale <span class="operator">=</span> <span class="string">&#x27;free&#x27;</span><span class="punctuation">)</span>	<span class="comment">#添加分面，根据数据中 group 列的信息将图片划分为 3 列展示</span></span><br><span class="line"></span><br><span class="line">p3</span><br><span class="line"></span><br><span class="line"><span class="comment">#输出图片至本地</span></span><br><span class="line">ggsave<span class="punctuation">(</span><span class="string">&#x27;volcano_plot2.pdf&#x27;</span><span class="punctuation">,</span> p2<span class="punctuation">,</span> width <span class="operator">=</span> <span class="number">5</span><span class="punctuation">,</span> height <span class="operator">=</span> <span class="number">4.5</span><span class="punctuation">)</span></span><br><span class="line">ggsave<span class="punctuation">(</span><span class="string">&#x27;volcano_plot2.png&#x27;</span><span class="punctuation">,</span> p2<span class="punctuation">,</span> width <span class="operator">=</span> <span class="number">5</span><span class="punctuation">,</span> height <span class="operator">=</span> <span class="number">4.5</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##grid 多图组合示例</span></span><br><span class="line">library<span class="punctuation">(</span>grid<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">png<span class="punctuation">(</span><span class="string">&#x27;volcano_plot.png&#x27;</span><span class="punctuation">,</span> width <span class="operator">=</span> <span class="number">2300</span><span class="punctuation">,</span> height <span class="operator">=</span> <span class="number">1500</span><span class="punctuation">,</span> res <span class="operator">=</span> <span class="number">300</span><span class="punctuation">,</span> units <span class="operator">=</span> <span class="string">&#x27;px&#x27;</span><span class="punctuation">)</span></span><br><span class="line">grid.newpage<span class="punctuation">(</span><span class="punctuation">)</span>	<span class="comment">#新建画板</span></span><br><span class="line">pushViewport<span class="punctuation">(</span>viewport<span class="punctuation">(</span>layout <span class="operator">=</span> grid.layout<span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span> <span class="number">2</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span>	<span class="comment">#分割画板为两片区域，分别放置 p1 和 p2</span></span><br><span class="line">print<span class="punctuation">(</span>p1<span class="punctuation">,</span> vp <span class="operator">=</span> viewport<span class="punctuation">(</span>layout.pos.row <span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span> layout.pos.col <span class="operator">=</span> <span class="number">1</span><span class="punctuation">)</span><span class="punctuation">)</span>	<span class="comment">#放置 p1</span></span><br><span class="line">print<span class="punctuation">(</span>p2 <span class="operator">+</span> guides<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&#x27;none&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span> vp <span class="operator">=</span> viewport<span class="punctuation">(</span>layout.pos.row <span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span> layout.pos.col <span class="operator">=</span> <span class="number">2</span><span class="punctuation">)</span><span class="punctuation">)</span>	<span class="comment">#放置 p2，两张图共用一张图例即可，组合时顺便去掉 p2 的图例</span></span><br><span class="line">dev.off<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##带双 logFC 信息的二维散点图</span></span><br><span class="line"><span class="comment">#读取另一个作图数据</span></span><br><span class="line">gene <span class="operator">&lt;-</span> read.csv<span class="punctuation">(</span><span class="string">&#x27;gene_two.csv&#x27;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#标记显著性（默认 p &lt; 0.05）</span></span><br><span class="line">gene<span class="punctuation">[</span>which<span class="punctuation">(</span>gene<span class="operator">$</span>FDR_A <span class="operator">&lt;</span> <span class="number">0.05</span> <span class="operator">&amp;</span> gene<span class="operator">$</span>FDR_B <span class="operator">&lt;</span> <span class="number">0.05</span><span class="punctuation">)</span><span class="punctuation">,</span><span class="string">&#x27;type1&#x27;</span><span class="punctuation">]</span> <span class="operator">&lt;-</span> <span class="string">&#x27;sign&#x27;</span></span><br><span class="line">gene<span class="punctuation">[</span>which<span class="punctuation">(</span>gene<span class="operator">$</span>FDR_A <span class="operator">&gt;=</span> <span class="number">0.05</span> <span class="operator">|</span> gene<span class="operator">$</span>FDR_B <span class="operator">&gt;=</span> <span class="number">0.05</span><span class="punctuation">)</span><span class="punctuation">,</span><span class="string">&#x27;type1&#x27;</span><span class="punctuation">]</span> <span class="operator">&lt;-</span> <span class="string">&#x27;no&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#标记差异倍数（默认 |log2FC| &gt;= 1）</span></span><br><span class="line">gene<span class="punctuation">[</span>which<span class="punctuation">(</span>gene<span class="operator">$</span>logFC_A <span class="operator">&lt;=</span> <span class="operator">-</span><span class="number">1</span> <span class="operator">&amp;</span> gene<span class="operator">$</span>logFC_B <span class="operator">&lt;=</span> <span class="operator">-</span><span class="number">1</span><span class="punctuation">)</span><span class="punctuation">,</span><span class="string">&#x27;type2&#x27;</span><span class="punctuation">]</span> <span class="operator">&lt;-</span> <span class="string">&#x27;a_down.b_down&#x27;</span></span><br><span class="line">gene<span class="punctuation">[</span>which<span class="punctuation">(</span>gene<span class="operator">$</span>logFC_A <span class="operator">&gt;=</span> <span class="number">1</span> <span class="operator">&amp;</span> gene<span class="operator">$</span>logFC_B <span class="operator">&lt;=</span> <span class="operator">-</span><span class="number">1</span><span class="punctuation">)</span><span class="punctuation">,</span><span class="string">&#x27;type2&#x27;</span><span class="punctuation">]</span> <span class="operator">&lt;-</span> <span class="string">&#x27;a_up.b_down&#x27;</span></span><br><span class="line">gene<span class="punctuation">[</span>which<span class="punctuation">(</span>gene<span class="operator">$</span>logFC_A <span class="operator">&lt;=</span> <span class="operator">-</span><span class="number">1</span> <span class="operator">&amp;</span> gene<span class="operator">$</span>logFC_B <span class="operator">&gt;=</span> <span class="number">1</span><span class="punctuation">)</span><span class="punctuation">,</span><span class="string">&#x27;type2&#x27;</span><span class="punctuation">]</span> <span class="operator">&lt;-</span> <span class="string">&#x27;a_down.b_up&#x27;</span></span><br><span class="line">gene<span class="punctuation">[</span>which<span class="punctuation">(</span>gene<span class="operator">$</span>logFC_A <span class="operator">&gt;=</span> <span class="number">1</span> <span class="operator">&amp;</span> gene<span class="operator">$</span>logFC_B <span class="operator">&gt;=</span> <span class="number">1</span><span class="punctuation">)</span><span class="punctuation">,</span><span class="string">&#x27;type2&#x27;</span><span class="punctuation">]</span> <span class="operator">&lt;-</span> <span class="string">&#x27;a_up_b_up&#x27;</span></span><br><span class="line">gene<span class="punctuation">[</span><span class="built_in">is.na</span><span class="punctuation">(</span>gene<span class="operator">$</span>type2<span class="punctuation">)</span><span class="punctuation">,</span><span class="string">&#x27;type2&#x27;</span><span class="punctuation">]</span> <span class="operator">&lt;-</span> <span class="string">&#x27;no&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#合并显著性和差异倍数，用于标记差异基因</span></span><br><span class="line">gene<span class="operator">$</span>type3 <span class="operator">&lt;-</span> paste<span class="punctuation">(</span>gene<span class="operator">$</span>type1<span class="punctuation">,</span> gene<span class="operator">$</span>type2<span class="punctuation">,</span> sep <span class="operator">=</span> <span class="string">&#x27;.&#x27;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#排序，为了使作图时显著的点绘制在前方（减少被遮盖）</span></span><br><span class="line">gene<span class="operator">$</span>type3 <span class="operator">&lt;-</span> factor<span class="punctuation">(</span>gene<span class="operator">$</span>type3<span class="punctuation">,</span> levels <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;sign.a_down.b_down&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;sign.a_up.b_down&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;sign.a_down.b_up&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;sign.a_up_b_up&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;no.a_down.b_down&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;no.a_up.b_down&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;no.a_down.b_up&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;no.a_up_b_up&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;sign.no&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;no.no&#x27;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">gene <span class="operator">&lt;-</span> gene<span class="punctuation">[</span>order<span class="punctuation">(</span>gene<span class="operator">$</span>type3<span class="punctuation">,</span> decreasing <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span><span class="punctuation">,</span> <span class="punctuation">]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#ggplot2 作图</span></span><br><span class="line">p <span class="operator">&lt;-</span> ggplot<span class="punctuation">(</span>gene<span class="punctuation">,</span> aes<span class="punctuation">(</span>logFC_A<span class="punctuation">,</span> logFC_B<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_point<span class="punctuation">(</span>aes<span class="punctuation">(</span>color <span class="operator">=</span> type3<span class="punctuation">,</span> size <span class="operator">=</span> logCPM<span class="punctuation">)</span><span class="punctuation">,</span> alpha <span class="operator">=</span> <span class="number">0.6</span><span class="punctuation">,</span> show.legend <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span> <span class="operator">+</span>	<span class="comment">#设置点颜色（按基因差异类型）、大小（按基因表达量 CPM 值），透明度，并取消图例</span></span><br><span class="line">  scale_size<span class="punctuation">(</span><span class="built_in">range</span> <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span> <span class="number">4</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span>	<span class="comment">#控制点大小的范围</span></span><br><span class="line">  scale_color_manual<span class="punctuation">(</span>limits <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;sign.a_down.b_down&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;sign.a_up.b_down&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;sign.a_down.b_up&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;sign.a_up_b_up&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;no.a_down.b_down&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;no.a_up.b_down&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;no.a_down.b_up&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;no.a_up_b_up&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;sign.no&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;no.no&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span> values <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;red&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;orange&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;purple&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;blue&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;gray&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;gray&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;gray&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;gray&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;gray&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;gray&#x27;</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span>	<span class="comment">#根据不同类型赋值颜色</span></span><br><span class="line">  theme<span class="punctuation">(</span>panel.grid <span class="operator">=</span> element_blank<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">,</span> panel.background <span class="operator">=</span> element_rect<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&#x27;black&#x27;</span><span class="punctuation">,</span> fill <span class="operator">=</span> <span class="string">&#x27;transparent&#x27;</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span>	<span class="comment">#调整背景</span></span><br><span class="line">  geom_vline<span class="punctuation">(</span>xintercept <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="operator">-</span><span class="number">1</span><span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">)</span><span class="punctuation">,</span> lty <span class="operator">=</span> <span class="number">2</span><span class="punctuation">)</span> <span class="operator">+</span> </span><br><span class="line">  geom_hline<span class="punctuation">(</span>yintercept <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="operator">-</span><span class="number">1</span><span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">)</span><span class="punctuation">,</span> lty <span class="operator">=</span> <span class="number">2</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&#x27;log2FC (group A vs C)&#x27;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&#x27;log2FC (group B vs C)&#x27;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">p</span><br><span class="line"></span><br><span class="line">p <span class="operator">&lt;-</span> p <span class="operator">+</span>	<span class="comment">#在合适的位置添加文字标记（当然，选择 AI、PS 后续添加也很方便）</span></span><br><span class="line">  annotate<span class="punctuation">(</span><span class="string">&#x27;text&#x27;</span><span class="punctuation">,</span> label <span class="operator">=</span> <span class="string">&#x27;A Down\nB Down&#x27;</span><span class="punctuation">,</span> <span class="operator">-</span><span class="number">7</span><span class="punctuation">,</span> <span class="operator">-</span><span class="number">9</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  annotate<span class="punctuation">(</span><span class="string">&#x27;text&#x27;</span><span class="punctuation">,</span> label <span class="operator">=</span> <span class="string">&#x27;A Down\nB Up&#x27;</span><span class="punctuation">,</span> <span class="operator">-</span><span class="number">7</span><span class="punctuation">,</span> <span class="number">12</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  annotate<span class="punctuation">(</span><span class="string">&#x27;text&#x27;</span><span class="punctuation">,</span> label <span class="operator">=</span> <span class="string">&#x27;A Up\nB Down&#x27;</span><span class="punctuation">,</span> <span class="number">9</span><span class="punctuation">,</span> <span class="operator">-</span><span class="number">9</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  annotate<span class="punctuation">(</span><span class="string">&#x27;text&#x27;</span><span class="punctuation">,</span> label <span class="operator">=</span> <span class="string">&#x27;A Up\nB Up&#x27;</span><span class="punctuation">,</span> <span class="number">9</span><span class="punctuation">,</span> <span class="number">12</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">p</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="deseq2"><strong>Deseq2</strong></h3>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#建立与 Bioconductor 连接</span></span><br><span class="line">source<span class="punctuation">(</span><span class="string">&#x27;https://bioconductor.org/biocLite.R&#x27;</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment">#若连接失败可更换下面命令试下</span></span><br><span class="line">source<span class="punctuation">(</span><span class="string">&#x27;http://bioconductor.org/biocLite.R&#x27;</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment">#安装 DESeq2</span></span><br><span class="line">biocLite<span class="punctuation">(</span><span class="string">&#x27;DESeq2&#x27;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">###############################################</span></span><br><span class="line">library<span class="punctuation">(</span>DESeq2<span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>ggplot2<span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>grid<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##导入 OTU 丰度表和分组文件</span></span><br><span class="line">otu_file <span class="operator">&lt;-</span> read.delim<span class="punctuation">(</span><span class="string">&#x27;otu_table.txt&#x27;</span><span class="punctuation">,</span> row.names <span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span> sep <span class="operator">=</span> <span class="string">&#x27;\t&#x27;</span><span class="punctuation">,</span> stringsAsFactors <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">,</span> check.names <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span></span><br><span class="line">group_file <span class="operator">&lt;-</span> read.delim<span class="punctuation">(</span><span class="string">&#x27;group.txt&#x27;</span><span class="punctuation">,</span> row.names <span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span> sep <span class="operator">=</span> <span class="string">&#x27;\t&#x27;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##DESeq2 默认流程，可使用 ?DESeqDataSet 等查看更多内容</span></span><br><span class="line"><span class="comment">#第一步，构建 DESeqDataSet 对象</span></span><br><span class="line">dds <span class="operator">&lt;-</span> DESeqDataSetFromMatrix<span class="punctuation">(</span>countData <span class="operator">=</span> otu_file<span class="punctuation">,</span> colData <span class="operator">=</span> group_file<span class="punctuation">,</span> design <span class="operator">=</span> <span class="operator">~</span>group<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#第二步，差异分析</span></span><br><span class="line">dds <span class="operator">&lt;-</span> DESeq<span class="punctuation">(</span>dds<span class="punctuation">)</span></span><br><span class="line">suppressMessages<span class="punctuation">(</span>dds<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#第三步，提取结果</span></span><br><span class="line">res <span class="operator">&lt;-</span> results<span class="punctuation">(</span>dds<span class="punctuation">,</span> contrast<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;group&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;treat&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;control&#x27;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#简要查看结果</span></span><br><span class="line">res</span><br><span class="line"><span class="comment">#或</span></span><br><span class="line">summary<span class="punctuation">(</span>res<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##结果提取</span></span><br><span class="line">deseq_res <span class="operator">&lt;-</span> as.data.frame<span class="punctuation">(</span>res<span class="punctuation">[</span>order<span class="punctuation">(</span>res<span class="operator">$</span>padj<span class="punctuation">)</span><span class="punctuation">,</span> <span class="punctuation">]</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment">#可选使用下命令将“baseMean”这一列转化为相对丰度数值</span></span><br><span class="line"><span class="comment">#deseq_res$baseMean &lt;- deseq_res$baseMean / sum(deseq_res$baseMean)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#输出</span></span><br><span class="line">deseq_res<span class="operator">$</span>otu_id <span class="operator">&lt;-</span> rownames<span class="punctuation">(</span>deseq_res<span class="punctuation">)</span></span><br><span class="line">write.table<span class="punctuation">(</span>deseq_res<span class="punctuation">[</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">7</span><span class="punctuation">,</span> <span class="number">1</span><span class="operator">:</span><span class="number">6</span><span class="punctuation">)</span><span class="punctuation">]</span><span class="punctuation">,</span> <span class="string">&#x27;DESeq2.txt&#x27;</span><span class="punctuation">,</span> row.names <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">,</span> sep <span class="operator">=</span> <span class="string">&#x27;\t&#x27;</span><span class="punctuation">,</span> <span class="built_in">quote</span> <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##ggplot2 差异火山图</span></span><br><span class="line"><span class="comment">#统计类型归类（根据 |log2FC| &gt;= 1 &amp; FDR p-value &lt; 0.05 ）</span></span><br><span class="line"><span class="keyword">for</span> <span class="punctuation">(</span>i <span class="keyword">in</span> <span class="number">1</span><span class="operator">:</span>nrow<span class="punctuation">(</span>deseq_res<span class="punctuation">)</span><span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">	<span class="keyword">if</span> <span class="punctuation">(</span><span class="built_in">abs</span><span class="punctuation">(</span>deseq_res<span class="punctuation">[</span>i<span class="punctuation">,</span><span class="string">&#x27;log2FoldChange&#x27;</span><span class="punctuation">]</span><span class="punctuation">)</span> <span class="operator">&gt;=</span> <span class="number">1</span><span class="punctuation">)</span> deseq_res<span class="punctuation">[</span>i<span class="punctuation">,</span><span class="string">&#x27;select_change&#x27;</span><span class="punctuation">]</span> <span class="operator">&lt;-</span> <span class="string">&#x27;y&#x27;</span> <span class="keyword">else</span> deseq_res<span class="punctuation">[</span>i<span class="punctuation">,</span><span class="string">&#x27;select_change&#x27;</span><span class="punctuation">]</span> <span class="operator">&lt;-</span> <span class="string">&#x27;n&#x27;</span></span><br><span class="line">	<span class="keyword">if</span> <span class="punctuation">(</span>deseq_res<span class="punctuation">[</span>i<span class="punctuation">,</span><span class="string">&#x27;padj&#x27;</span><span class="punctuation">]</span> <span class="operator">%in%</span> <span class="literal">NA</span> <span class="operator">|</span> <span class="built_in">abs</span><span class="punctuation">(</span>deseq_res<span class="punctuation">[</span>i<span class="punctuation">,</span><span class="string">&#x27;padj&#x27;</span><span class="punctuation">]</span><span class="punctuation">)</span> <span class="operator">&gt;=</span> <span class="number">0.05</span><span class="punctuation">)</span> deseq_res<span class="punctuation">[</span>i<span class="punctuation">,</span><span class="string">&#x27;select_pvalue&#x27;</span><span class="punctuation">]</span> <span class="operator">&lt;-</span> <span class="string">&#x27;n&#x27;</span> <span class="keyword">else</span> deseq_res<span class="punctuation">[</span>i<span class="punctuation">,</span><span class="string">&#x27;select_pvalue&#x27;</span><span class="punctuation">]</span> <span class="operator">&lt;-</span> <span class="string">&#x27;y&#x27;</span></span><br><span class="line">	deseq_res<span class="punctuation">[</span>i<span class="punctuation">,</span><span class="string">&#x27;select&#x27;</span><span class="punctuation">]</span> <span class="operator">&lt;-</span> paste<span class="punctuation">(</span>deseq_res<span class="punctuation">[</span>i<span class="punctuation">,</span><span class="string">&#x27;select_change&#x27;</span><span class="punctuation">]</span><span class="punctuation">,</span> deseq_res<span class="punctuation">[</span>i<span class="punctuation">,</span><span class="string">&#x27;select_pvalue&#x27;</span><span class="punctuation">]</span><span class="punctuation">,</span> sep <span class="operator">=</span> <span class="string">&#x27;&#x27;</span><span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line">deseq_res<span class="operator">$</span>select <span class="operator">&lt;-</span> factor<span class="punctuation">(</span>deseq_res<span class="operator">$</span>select<span class="punctuation">,</span> levels <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;nn&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;ny&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;yn&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;yy&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span> labels <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;p &gt;= 0.05, FC &lt; 2&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;p &lt; 0.05, FC &lt; 2&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;p &gt;= 0.05, FC &gt;= 2&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;p &lt; 0.05, FC &gt;= 2&#x27;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#纵轴为显著性 p 值</span></span><br><span class="line">volcano_plot_pvalue <span class="operator">&lt;-</span> ggplot<span class="punctuation">(</span>deseq_res<span class="punctuation">,</span> aes<span class="punctuation">(</span>log2FoldChange<span class="punctuation">,</span> <span class="operator">-</span><span class="built_in">log</span><span class="punctuation">(</span>padj<span class="punctuation">,</span> <span class="number">10</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">geom_point<span class="punctuation">(</span>aes<span class="punctuation">(</span>color <span class="operator">=</span> select<span class="punctuation">)</span><span class="punctuation">,</span> alpha <span class="operator">=</span> <span class="number">0.6</span><span class="punctuation">,</span> show.legend <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">scale_color_manual<span class="punctuation">(</span>values <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;gray30&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;green4&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;red2&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;blue2&#x27;</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">theme<span class="punctuation">(</span>panel.grid <span class="operator">=</span> element_blank<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">,</span> panel.background <span class="operator">=</span> element_rect<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&#x27;black&#x27;</span><span class="punctuation">,</span> fill <span class="operator">=</span> <span class="string">&#x27;transparent&#x27;</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">geom_vline<span class="punctuation">(</span>xintercept <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="operator">-</span><span class="number">1</span><span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">)</span><span class="punctuation">,</span> color <span class="operator">=</span> <span class="string">&#x27;gray&#x27;</span><span class="punctuation">,</span> size <span class="operator">=</span> <span class="number">0.5</span><span class="punctuation">)</span> <span class="operator">+</span> </span><br><span class="line">geom_hline<span class="punctuation">(</span>yintercept <span class="operator">=</span> <span class="operator">-</span><span class="built_in">log</span><span class="punctuation">(</span><span class="number">0.05</span><span class="punctuation">,</span> <span class="number">10</span><span class="punctuation">)</span><span class="punctuation">,</span> color <span class="operator">=</span> <span class="string">&#x27;gray&#x27;</span><span class="punctuation">,</span> size <span class="operator">=</span> <span class="number">0.5</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&#x27;log2 Fold Change&#x27;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&#x27;-log10 p-value&#x27;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#纵轴为 OTU 丰度</span></span><br><span class="line">volcano_plot_abundance <span class="operator">&lt;-</span> ggplot<span class="punctuation">(</span>deseq_res<span class="punctuation">,</span> aes<span class="punctuation">(</span>log2FoldChange<span class="punctuation">,</span> <span class="number">100</span> <span class="operator">*</span> baseMean <span class="operator">/</span> <span class="built_in">sum</span><span class="punctuation">(</span>deseq_res<span class="operator">$</span>baseMean<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">geom_point<span class="punctuation">(</span>aes<span class="punctuation">(</span>color <span class="operator">=</span> select<span class="punctuation">)</span><span class="punctuation">,</span> alpha <span class="operator">=</span> <span class="number">0.6</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">scale_color_manual<span class="punctuation">(</span>values <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;gray30&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;green4&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;red2&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;blue2&#x27;</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">theme<span class="punctuation">(</span>panel.grid <span class="operator">=</span> element_blank<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">,</span> panel.background <span class="operator">=</span> element_rect<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&#x27;black&#x27;</span><span class="punctuation">,</span> fill <span class="operator">=</span> <span class="string">&#x27;transparent&#x27;</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">theme<span class="punctuation">(</span>legend.title <span class="operator">=</span> element_blank<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">,</span> legend.key <span class="operator">=</span> element_rect<span class="punctuation">(</span>fill <span class="operator">=</span> <span class="string">&#x27;transparent&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span> legend.background <span class="operator">=</span> element_rect<span class="punctuation">(</span>fill <span class="operator">=</span> <span class="string">&#x27;transparent&#x27;</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">geom_vline<span class="punctuation">(</span>xintercept <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="operator">-</span><span class="number">1</span><span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">)</span><span class="punctuation">,</span> color <span class="operator">=</span> <span class="string">&#x27;gray&#x27;</span><span class="punctuation">,</span> size <span class="operator">=</span> <span class="number">0.5</span><span class="punctuation">)</span> <span class="operator">+</span> </span><br><span class="line">labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&#x27;log2 Fold Change&#x27;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&#x27;Abundance (%)&#x27;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#输出单图</span></span><br><span class="line"><span class="comment">#ggsave(&#x27;volcano_plot_pvalue.pdf&#x27;, volcano_plot_pvalue, width = 5, height = 5)</span></span><br><span class="line"><span class="comment">#ggsave(&#x27;volcano_plot_abundance.png&#x27;, volcano_plot_abundance, width = 5, height = 5)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#组合并输出</span></span><br><span class="line">png<span class="punctuation">(</span><span class="string">&#x27;volcano_plot.png&#x27;</span><span class="punctuation">,</span> width <span class="operator">=</span> <span class="number">3000</span><span class="punctuation">,</span> height <span class="operator">=</span> <span class="number">1600</span><span class="punctuation">,</span> res <span class="operator">=</span> <span class="number">300</span><span class="punctuation">,</span> units <span class="operator">=</span> <span class="string">&#x27;px&#x27;</span><span class="punctuation">)</span></span><br><span class="line">	grid.newpage<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line">	pushViewport<span class="punctuation">(</span>viewport<span class="punctuation">(</span>layout <span class="operator">=</span> grid.layout<span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span> <span class="number">2</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">	print<span class="punctuation">(</span>volcano_plot_pvalue<span class="punctuation">,</span> vp <span class="operator">=</span> viewport<span class="punctuation">(</span>layout.pos.row <span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span> layout.pos.col <span class="operator">=</span> <span class="number">1</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">	print<span class="punctuation">(</span>volcano_plot_abundance<span class="punctuation">,</span> vp <span class="operator">=</span> viewport<span class="punctuation">(</span>layout.pos.row <span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span> layout.pos.col <span class="operator">=</span> <span class="number">2</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">dev.off<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="镜面柱形图"><strong>镜面柱形图</strong></h3>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">library<span class="punctuation">(</span>ggplot2<span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>reshape2<span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>doBy<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#读入数据，合并数据</span></span><br><span class="line">plant30 <span class="operator">&lt;-</span> read.csv<span class="punctuation">(</span><span class="string">&#x27;30days.csv&#x27;</span><span class="punctuation">)</span></span><br><span class="line">plant30<span class="operator">$</span>days <span class="operator">&lt;-</span> <span class="built_in">rep</span><span class="punctuation">(</span><span class="string">&#x27;30&#x27;</span><span class="punctuation">,</span> nrow<span class="punctuation">(</span>plant30<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">plant45 <span class="operator">&lt;-</span> read.csv<span class="punctuation">(</span><span class="string">&#x27;45days.csv&#x27;</span><span class="punctuation">)</span></span><br><span class="line">plant45<span class="operator">$</span>days <span class="operator">&lt;-</span> <span class="built_in">rep</span><span class="punctuation">(</span><span class="string">&#x27;45&#x27;</span><span class="punctuation">,</span> nrow<span class="punctuation">(</span>plant45<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">plant60 <span class="operator">&lt;-</span> read.csv<span class="punctuation">(</span><span class="string">&#x27;60days.csv&#x27;</span><span class="punctuation">)</span></span><br><span class="line">plant60<span class="operator">$</span>days <span class="operator">&lt;-</span> <span class="built_in">rep</span><span class="punctuation">(</span><span class="string">&#x27;60&#x27;</span><span class="punctuation">,</span> nrow<span class="punctuation">(</span>plant60<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">plant75 <span class="operator">&lt;-</span> read.csv<span class="punctuation">(</span><span class="string">&#x27;75days.csv&#x27;</span><span class="punctuation">)</span></span><br><span class="line">plant75<span class="operator">$</span>days <span class="operator">&lt;-</span> <span class="built_in">rep</span><span class="punctuation">(</span><span class="string">&#x27;75&#x27;</span><span class="punctuation">,</span> nrow<span class="punctuation">(</span>plant75<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">plant90 <span class="operator">&lt;-</span> read.csv<span class="punctuation">(</span><span class="string">&#x27;90days.csv&#x27;</span><span class="punctuation">)</span></span><br><span class="line">plant90<span class="operator">$</span>days <span class="operator">&lt;-</span> <span class="built_in">rep</span><span class="punctuation">(</span><span class="string">&#x27;90&#x27;</span><span class="punctuation">,</span> nrow<span class="punctuation">(</span>plant90<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">plant_all <span class="operator">&lt;-</span> rbind<span class="punctuation">(</span>plant30<span class="punctuation">,</span> plant45<span class="punctuation">,</span> plant60<span class="punctuation">,</span> plant75<span class="punctuation">,</span> plant90<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#统计均值、标准差</span></span><br><span class="line">plant_all <span class="operator">&lt;-</span> melt<span class="punctuation">(</span>plant_all<span class="punctuation">,</span> id <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;plant&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;days&#x27;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">plant_all_stat <span class="operator">&lt;-</span> summaryBy<span class="punctuation">(</span>value<span class="operator">~</span>variable<span class="operator">+</span>plant<span class="operator">+</span>days<span class="punctuation">,</span> plant_all<span class="punctuation">,</span> FUN <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span>mean<span class="punctuation">,</span> sd<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#作图</span></span><br><span class="line">plant_all_stat<span class="punctuation">[</span>which<span class="punctuation">(</span>plant_all_stat<span class="operator">$</span>variable <span class="operator">==</span> <span class="string">&#x27;root_length&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;value.mean&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;value.sd&#x27;</span><span class="punctuation">)</span><span class="punctuation">]</span> <span class="operator">&lt;-</span> plant_all_stat<span class="punctuation">[</span>which<span class="punctuation">(</span>plant_all_stat<span class="operator">$</span>variable <span class="operator">==</span> <span class="string">&#x27;root_length&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;value.mean&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;value.sd&#x27;</span><span class="punctuation">)</span><span class="punctuation">]</span> <span class="operator">*</span> <span class="operator">-</span><span class="number">1</span></span><br><span class="line"></span><br><span class="line">ggplot<span class="punctuation">(</span>plant_all_stat<span class="punctuation">,</span> aes<span class="punctuation">(</span>days<span class="punctuation">,</span> value.mean<span class="punctuation">,</span> fill <span class="operator">=</span> plant<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_col<span class="punctuation">(</span>position <span class="operator">=</span> position_dodge<span class="punctuation">(</span>width <span class="operator">=</span> <span class="number">0.5</span><span class="punctuation">)</span><span class="punctuation">,</span> width <span class="operator">=</span> <span class="number">0.5</span><span class="punctuation">,</span> size <span class="operator">=</span> <span class="number">0.3</span><span class="punctuation">,</span> colour <span class="operator">=</span> <span class="string">&#x27;black&#x27;</span><span class="punctuation">)</span> <span class="operator">+</span>	<span class="comment">#柱形图绘制</span></span><br><span class="line">  geom_errorbar<span class="punctuation">(</span>aes<span class="punctuation">(</span>ymin <span class="operator">=</span> value.mean <span class="operator">-</span> value.sd<span class="punctuation">,</span> ymax <span class="operator">=</span> value.mean <span class="operator">+</span> value.sd<span class="punctuation">)</span><span class="punctuation">,</span> width <span class="operator">=</span> <span class="number">0.3</span><span class="punctuation">,</span> size <span class="operator">=</span> <span class="number">0.3</span><span class="punctuation">,</span> position <span class="operator">=</span> position_dodge<span class="punctuation">(</span><span class="number">0.5</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span>	<span class="comment">#误差线绘制</span></span><br><span class="line">  theme<span class="punctuation">(</span>panel.grid <span class="operator">=</span> element_blank<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">,</span> panel.background <span class="operator">=</span> element_rect<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&#x27;black&#x27;</span><span class="punctuation">,</span> fill <span class="operator">=</span> <span class="string">&#x27;transparent&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span> legend.title <span class="operator">=</span> element_blank<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span> 	<span class="comment">#调整背景</span></span><br><span class="line">  labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&#x27;Time (days)&#x27;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&#x27;Length (cm)&#x27;</span><span class="punctuation">)</span> <span class="operator">+</span>	<span class="comment">#设置坐标轴标签</span></span><br><span class="line">  geom_hline<span class="punctuation">(</span>yintercept <span class="operator">=</span> <span class="number">0</span><span class="punctuation">,</span> size <span class="operator">=</span> <span class="number">0.3</span><span class="punctuation">)</span> <span class="operator">+</span>	<span class="comment">#在 y = 0 处添加横线</span></span><br><span class="line">  scale_y_continuous<span class="punctuation">(</span>breaks <span class="operator">=</span> seq<span class="punctuation">(</span><span class="operator">-</span><span class="number">45</span><span class="punctuation">,</span> <span class="number">45</span><span class="punctuation">,</span> <span class="number">15</span><span class="punctuation">)</span><span class="punctuation">,</span> labels <span class="operator">=</span> <span class="built_in">as.character</span><span class="punctuation">(</span><span class="built_in">abs</span><span class="punctuation">(</span>seq<span class="punctuation">(</span><span class="operator">-</span><span class="number">45</span><span class="punctuation">,</span> <span class="number">45</span><span class="punctuation">,</span> <span class="number">15</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">,</span> limits <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="operator">-</span><span class="number">45</span><span class="punctuation">,</span> <span class="number">45</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span>	<span class="comment">#调整纵轴刻度</span></span><br><span class="line">  annotate<span class="punctuation">(</span><span class="string">&#x27;text&#x27;</span><span class="punctuation">,</span>label <span class="operator">=</span> <span class="string">&#x27;Stem&#x27;</span><span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">,</span> <span class="number">43</span><span class="punctuation">)</span> <span class="operator">+</span>	<span class="comment">#这两句添加“Stem”和“Root”标签</span></span><br><span class="line">  annotate<span class="punctuation">(</span><span class="string">&#x27;text&#x27;</span><span class="punctuation">,</span>label <span class="operator">=</span> <span class="string">&#x27;Root&#x27;</span><span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">,</span> <span class="operator">-</span><span class="number">43</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">ggsave<span class="punctuation">(</span><span class="string">&#x27;plant.pdf&#x27;</span><span class="punctuation">,</span> width <span class="operator">=</span> <span class="number">6</span><span class="punctuation">,</span> height <span class="operator">=</span> <span class="number">4</span><span class="punctuation">)</span></span><br><span class="line">ggsave<span class="punctuation">(</span><span class="string">&#x27;plant.png&#x27;</span><span class="punctuation">,</span> width <span class="operator">=</span> <span class="number">6</span><span class="punctuation">,</span> height <span class="operator">=</span> <span class="number">4</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##############################</span></span><br><span class="line"><span class="comment">#在统计均值、标准差之前，也可先将根长数据取负值</span></span><br><span class="line">plant_all <span class="operator">&lt;-</span> rbind<span class="punctuation">(</span>plant30<span class="punctuation">,</span> plant45<span class="punctuation">,</span> plant60<span class="punctuation">,</span> plant75<span class="punctuation">,</span> plant90<span class="punctuation">)</span></span><br><span class="line">plant_all<span class="operator">$</span>root_length <span class="operator">&lt;-</span> plant_all<span class="operator">$</span>root_length <span class="operator">*</span> <span class="operator">-</span><span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#统计均值、标准差</span></span><br><span class="line">plant_all <span class="operator">&lt;-</span> melt<span class="punctuation">(</span>plant_all<span class="punctuation">,</span> id <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;plant&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;days&#x27;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">plant_all_stat <span class="operator">&lt;-</span> summaryBy<span class="punctuation">(</span>value<span class="operator">~</span>variable<span class="operator">+</span>plant<span class="operator">+</span>days<span class="punctuation">,</span> plant_all<span class="punctuation">,</span> FUN <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span>mean<span class="punctuation">,</span> sd<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#作图</span></span><br><span class="line">ggplot<span class="punctuation">(</span>plant_all_stat<span class="punctuation">,</span> aes<span class="punctuation">(</span>days<span class="punctuation">,</span> value.mean<span class="punctuation">,</span> fill <span class="operator">=</span> plant<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_col<span class="punctuation">(</span>position <span class="operator">=</span> position_dodge<span class="punctuation">(</span>width <span class="operator">=</span> <span class="number">0.5</span><span class="punctuation">)</span><span class="punctuation">,</span> width <span class="operator">=</span> <span class="number">0.5</span><span class="punctuation">,</span> size <span class="operator">=</span> <span class="number">0.3</span><span class="punctuation">,</span> colour <span class="operator">=</span> <span class="string">&#x27;black&#x27;</span><span class="punctuation">)</span> <span class="operator">+</span>	<span class="comment">#柱形图绘制</span></span><br><span class="line">  geom_errorbar<span class="punctuation">(</span>aes<span class="punctuation">(</span>ymin <span class="operator">=</span> value.mean <span class="operator">-</span> value.sd<span class="punctuation">,</span> ymax <span class="operator">=</span> value.mean <span class="operator">+</span> value.sd<span class="punctuation">)</span><span class="punctuation">,</span> width <span class="operator">=</span> <span class="number">0.3</span><span class="punctuation">,</span> size <span class="operator">=</span> <span class="number">0.3</span><span class="punctuation">,</span> position <span class="operator">=</span> position_dodge<span class="punctuation">(</span><span class="number">0.5</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span>	<span class="comment">#误差线绘制</span></span><br><span class="line">  theme<span class="punctuation">(</span>panel.grid <span class="operator">=</span> element_blank<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">,</span> panel.background <span class="operator">=</span> element_rect<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&#x27;black&#x27;</span><span class="punctuation">,</span> fill <span class="operator">=</span> <span class="string">&#x27;transparent&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span> legend.title <span class="operator">=</span> element_blank<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span> 	<span class="comment">#调整背景</span></span><br><span class="line">  labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&#x27;Time (days)&#x27;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&#x27;Length (cm)&#x27;</span><span class="punctuation">)</span> <span class="operator">+</span>	<span class="comment">#设置坐标轴标签</span></span><br><span class="line">  geom_hline<span class="punctuation">(</span>yintercept <span class="operator">=</span> <span class="number">0</span><span class="punctuation">,</span> size <span class="operator">=</span> <span class="number">0.3</span><span class="punctuation">)</span> <span class="operator">+</span>	<span class="comment">#在 y = 0 处添加横线</span></span><br><span class="line">  scale_y_continuous<span class="punctuation">(</span>breaks <span class="operator">=</span> seq<span class="punctuation">(</span><span class="operator">-</span><span class="number">45</span><span class="punctuation">,</span> <span class="number">45</span><span class="punctuation">,</span> <span class="number">15</span><span class="punctuation">)</span><span class="punctuation">,</span> labels <span class="operator">=</span> <span class="built_in">as.character</span><span class="punctuation">(</span><span class="built_in">abs</span><span class="punctuation">(</span>seq<span class="punctuation">(</span><span class="operator">-</span><span class="number">45</span><span class="punctuation">,</span> <span class="number">45</span><span class="punctuation">,</span> <span class="number">15</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">,</span> limits <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="operator">-</span><span class="number">45</span><span class="punctuation">,</span> <span class="number">45</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span>	<span class="comment">#调整纵轴刻度</span></span><br><span class="line">  annotate<span class="punctuation">(</span><span class="string">&#x27;text&#x27;</span><span class="punctuation">,</span>label <span class="operator">=</span> <span class="string">&#x27;Stem&#x27;</span><span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">,</span> <span class="number">43</span><span class="punctuation">)</span> <span class="operator">+</span>	<span class="comment">#这两句添加“Stem”和“Root”标签</span></span><br><span class="line">  annotate<span class="punctuation">(</span><span class="string">&#x27;text&#x27;</span><span class="punctuation">,</span>label <span class="operator">=</span> <span class="string">&#x27;Root&#x27;</span><span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">,</span> <span class="operator">-</span><span class="number">43</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">ggsave<span class="punctuation">(</span><span class="string">&#x27;plant.pdf&#x27;</span><span class="punctuation">,</span> width <span class="operator">=</span> <span class="number">6</span><span class="punctuation">,</span> height <span class="operator">=</span> <span class="number">4</span><span class="punctuation">)</span></span><br><span class="line">ggsave<span class="punctuation">(</span><span class="string">&#x27;plant.png&#x27;</span><span class="punctuation">,</span> width <span class="operator">=</span> <span class="number">6</span><span class="punctuation">,</span> height <span class="operator">=</span> <span class="number">4</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<h3 id="丰度饼图">丰度饼图</h3>
<p><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/s7umGxtvNhJljhTPXVafVQ">patternplot包：用ggplot解决你对线性填充，不！所有填充的全部幻想</a></p>
<img src="/2023/10/31/ggplot-picture/Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20200610091212834.png" alt="image-20200610091212834" style="zoom:50%;">
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">############################################</span></span><br><span class="line"><span class="comment">#读取数据</span></span><br><span class="line">phylum <span class="operator">&lt;-</span> read.delim<span class="punctuation">(</span><span class="string">&#x27;phylum.txt&#x27;</span><span class="punctuation">,</span> sep <span class="operator">=</span> <span class="string">&#x27;\t&#x27;</span><span class="punctuation">,</span> stringsAsFactors <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">,</span> check.names <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##pie()</span></span><br><span class="line"><span class="comment">#pdf(&#x27;pie_plot.pdf&#x27;)</span></span><br><span class="line">png<span class="punctuation">(</span><span class="string">&#x27;pie_plot.png&#x27;</span><span class="punctuation">,</span> width <span class="operator">=</span> <span class="number">2000</span><span class="punctuation">,</span> height <span class="operator">=</span> <span class="number">2000</span><span class="punctuation">,</span> res <span class="operator">=</span> <span class="number">300</span><span class="punctuation">,</span> units <span class="operator">=</span> <span class="string">&#x27;px&#x27;</span><span class="punctuation">)</span></span><br><span class="line">par<span class="punctuation">(</span>mar <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">5</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">,</span> <span class="number">5</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">pie<span class="punctuation">(</span>phylum<span class="operator">$</span>a1<span class="punctuation">,</span> col <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;blue&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;orange&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;red&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;green2&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;purple&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;cyan&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span> labels <span class="operator">=</span> phylum<span class="operator">$</span>phylum<span class="punctuation">,</span> font <span class="operator">=</span> <span class="number">3</span><span class="punctuation">,</span> main <span class="operator">=</span> <span class="string">&#x27;Sample: a1\nPhylum level&#x27;</span><span class="punctuation">)</span></span><br><span class="line">dev.off<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">##pie3D()</span></span><br><span class="line">library<span class="punctuation">(</span>plotrix<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#pdf(&#x27;pie3D_plot.pdf&#x27;, width = 6.5, height = 6)</span></span><br><span class="line">png<span class="punctuation">(</span><span class="string">&#x27;pie3D_plot.png&#x27;</span><span class="punctuation">,</span> width <span class="operator">=</span> <span class="number">2100</span><span class="punctuation">,</span> height <span class="operator">=</span> <span class="number">2000</span><span class="punctuation">,</span> res <span class="operator">=</span> <span class="number">300</span><span class="punctuation">,</span> units <span class="operator">=</span> <span class="string">&#x27;px&#x27;</span><span class="punctuation">)</span></span><br><span class="line">pie3D<span class="punctuation">(</span>phylum<span class="operator">$</span>a1<span class="punctuation">,</span> col <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;blue&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;orange&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;red&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;green2&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;purple&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;cyan&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span> explode <span class="operator">=</span> <span class="number">0.05</span><span class="punctuation">,</span> height <span class="operator">=</span> <span class="number">0.1</span><span class="punctuation">,</span> radius <span class="operator">=</span> <span class="number">0.85</span><span class="punctuation">,</span> labels <span class="operator">=</span> phylum<span class="operator">$</span>phylum<span class="punctuation">,</span> labelcex <span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span> main <span class="operator">=</span> <span class="string">&#x27;Sample: a1\nPhylum level&#x27;</span><span class="punctuation">)</span></span><br><span class="line">dev.off<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">##fan.plot()</span></span><br><span class="line">library<span class="punctuation">(</span>plotrix<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#pdf(&#x27;fan_plot.pdf&#x27;)</span></span><br><span class="line">png<span class="punctuation">(</span><span class="string">&#x27;fan_plot.png&#x27;</span><span class="punctuation">,</span> width <span class="operator">=</span> <span class="number">2000</span><span class="punctuation">,</span> height <span class="operator">=</span> <span class="number">2000</span><span class="punctuation">,</span> res <span class="operator">=</span> <span class="number">300</span><span class="punctuation">,</span> units <span class="operator">=</span> <span class="string">&#x27;px&#x27;</span><span class="punctuation">)</span></span><br><span class="line">fan.plot<span class="punctuation">(</span>phylum<span class="operator">$</span>a1<span class="punctuation">,</span> col <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;blue&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;orange&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;red&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;green2&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;purple&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;cyan&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span> labels <span class="operator">=</span> phylum<span class="operator">$</span>phylum<span class="punctuation">,</span> main <span class="operator">=</span> <span class="string">&#x27;Sample: a1\nPhylum level&#x27;</span><span class="punctuation">)</span></span><br><span class="line">dev.off<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">##ggplot2</span></span><br><span class="line">library<span class="punctuation">(</span>ggplot2<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">p <span class="operator">&lt;-</span> ggplot<span class="punctuation">(</span>phylum<span class="punctuation">,</span> aes<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&#x27;&#x27;</span><span class="punctuation">,</span> y <span class="operator">=</span> a1<span class="punctuation">,</span> fill <span class="operator">=</span> phylum<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span> </span><br><span class="line">geom_bar<span class="punctuation">(</span>stat <span class="operator">=</span> <span class="string">&#x27;identity&#x27;</span><span class="punctuation">,</span> width <span class="operator">=</span> <span class="number">1</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">coord_polar<span class="punctuation">(</span>theta <span class="operator">=</span> <span class="string">&#x27;y&#x27;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">scale_fill_manual<span class="punctuation">(</span>values <span class="operator">=</span> rev<span class="punctuation">(</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;blue&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;orange&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;red&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;green2&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;purple&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;cyan&#x27;</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">theme<span class="punctuation">(</span>panel.grid <span class="operator">=</span> element_blank<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">,</span> panel.background <span class="operator">=</span> element_blank<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">,</span> axis.text.x <span class="operator">=</span> element_blank<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">,</span> plot.title <span class="operator">=</span> element_text<span class="punctuation">(</span>hjust <span class="operator">=</span> <span class="number">0.5</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">theme<span class="punctuation">(</span>legend.text <span class="operator">=</span> element_text<span class="punctuation">(</span>face <span class="operator">=</span> <span class="string">&#x27;italic&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span> legend.title <span class="operator">=</span> element_blank<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&#x27;&#x27;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&#x27;&#x27;</span><span class="punctuation">,</span> title <span class="operator">=</span> <span class="string">&#x27;Sample: a1&#x27;</span><span class="punctuation">,</span> fill <span class="operator">=</span> <span class="string">&#x27;Phylum&#x27;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#ggsave(&#x27;ggplot2_plot.pdf&#x27;, p, width = 5, height = 5)</span></span><br><span class="line">ggsave<span class="punctuation">(</span><span class="string">&#x27;ggplot2_plot.png&#x27;</span><span class="punctuation">,</span> p<span class="punctuation">,</span> width <span class="operator">=</span> <span class="number">5</span><span class="punctuation">,</span> height <span class="operator">=</span> <span class="number">5</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">############################################</span></span><br><span class="line"><span class="comment">#一个组合样式的 ggplot2 饼图示例</span></span><br><span class="line">library<span class="punctuation">(</span>doBy<span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>ggplot2<span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>grid<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##预处理</span></span><br><span class="line"><span class="comment">#读取数据</span></span><br><span class="line">abundance <span class="operator">&lt;-</span> read.delim<span class="punctuation">(</span><span class="string">&#x27;abundance.txt&#x27;</span><span class="punctuation">,</span> sep <span class="operator">=</span> <span class="string">&#x27;\t&#x27;</span><span class="punctuation">,</span> stringsAsFactors <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">,</span> check.names <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#按类群丰度排序</span></span><br><span class="line">abundance<span class="operator">$</span>abundance_sum <span class="operator">&lt;-</span> apply<span class="punctuation">(</span>abundance<span class="punctuation">[</span><span class="number">1</span><span class="operator">:</span><span class="number">3</span><span class="punctuation">]</span><span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">,</span> <span class="built_in">sum</span><span class="punctuation">)</span></span><br><span class="line">stat <span class="operator">&lt;-</span> summaryBy<span class="punctuation">(</span>abundance_sum<span class="operator">~</span>phylum<span class="punctuation">,</span> abundance<span class="punctuation">,</span> FUN <span class="operator">=</span> <span class="built_in">sum</span><span class="punctuation">)</span></span><br><span class="line">abundance<span class="operator">$</span>phylum <span class="operator">&lt;-</span> factor<span class="punctuation">(</span>abundance<span class="operator">$</span>phylum<span class="punctuation">,</span> levels <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="punctuation">&#123;</span>stat<span class="punctuation">[</span>order<span class="punctuation">(</span>stat<span class="operator">$</span>abundance_sum.sum<span class="punctuation">)</span><span class="punctuation">,</span> <span class="punctuation">]</span><span class="punctuation">&#125;</span><span class="operator">$</span>phylum<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">abundance <span class="operator">&lt;-</span> abundance<span class="punctuation">[</span>order<span class="punctuation">(</span>abundance<span class="operator">$</span>phylum<span class="punctuation">,</span> abundance<span class="operator">$</span>abundance_sum<span class="punctuation">,</span> decreasing <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span><span class="punctuation">,</span> <span class="punctuation">]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#挑选 top10 属</span></span><br><span class="line">top10_genus <span class="operator">&lt;-</span> as.vector<span class="punctuation">(</span>abundance<span class="punctuation">[</span>order<span class="punctuation">(</span>abundance<span class="operator">$</span>abundance_sum<span class="punctuation">,</span> decreasing <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span><span class="punctuation">,</span> <span class="punctuation">]</span><span class="operator">$</span>genus<span class="punctuation">[</span><span class="number">1</span><span class="operator">:</span><span class="number">10</span><span class="punctuation">]</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##ggplot2 饼图</span></span><br><span class="line">abundance<span class="operator">$</span>phylum <span class="operator">&lt;-</span> factor<span class="punctuation">(</span>abundance<span class="operator">$</span>phylum<span class="punctuation">,</span> levels <span class="operator">=</span> rev<span class="punctuation">(</span>levels<span class="punctuation">(</span>abundance<span class="operator">$</span>phylum<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">abundance<span class="operator">$</span>genus <span class="operator">&lt;-</span> factor<span class="punctuation">(</span>abundance<span class="operator">$</span>genus<span class="punctuation">,</span> levels <span class="operator">=</span> as.vector<span class="punctuation">(</span>abundance<span class="operator">$</span>genus<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#定义颜色</span></span><br><span class="line"><span class="comment">#length(unique(abundance$phylum))</span></span><br><span class="line"><span class="comment">#length(unique(abundance$genus))</span></span><br><span class="line">color_phylum <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;blue&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;orange&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;red&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;yellow2&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;green2&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;purple&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;cyan&#x27;</span><span class="punctuation">)</span></span><br><span class="line">color_genus <span class="operator">&lt;-</span> sample<span class="punctuation">(</span>colors<span class="punctuation">(</span><span class="number">1</span><span class="punctuation">)</span><span class="punctuation">,</span> <span class="number">50</span><span class="punctuation">,</span> replace <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span>	<span class="comment">#随机颜色</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#定义函数，#在 ggplot2 中提取图例，参考自</span></span><br><span class="line"><span class="comment">#https://stackoverflow.com/questions/13712574/how-to-change-position-of-grid-draw</span></span><br><span class="line">g_legend <span class="operator">&lt;-</span> <span class="keyword">function</span><span class="punctuation">(</span>gg_plot<span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">    tmp <span class="operator">&lt;-</span> ggplot_gtable<span class="punctuation">(</span>ggplot_build<span class="punctuation">(</span>gg_plot<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">    leg <span class="operator">&lt;-</span> which<span class="punctuation">(</span>sapply<span class="punctuation">(</span>tmp<span class="operator">$</span>grobs<span class="punctuation">,</span> <span class="keyword">function</span><span class="punctuation">(</span>x<span class="punctuation">)</span> x<span class="operator">$</span>name<span class="punctuation">)</span> <span class="operator">==</span> <span class="string">&#x27;guide-box&#x27;</span><span class="punctuation">)</span></span><br><span class="line">    leg <span class="operator">&lt;-</span> tmp<span class="operator">$</span>grobs<span class="punctuation">[[</span>leg<span class="punctuation">]</span><span class="punctuation">]</span></span><br><span class="line">    leg</span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#内饼（属）</span></span><br><span class="line">genus <span class="operator">&lt;-</span> ggplot<span class="punctuation">(</span>abundance<span class="punctuation">,</span> aes<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&#x27;&#x27;</span><span class="punctuation">,</span> y <span class="operator">=</span> a1<span class="punctuation">,</span> fill <span class="operator">=</span> genus<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span> </span><br><span class="line">geom_bar<span class="punctuation">(</span>stat <span class="operator">=</span> <span class="string">&#x27;identity&#x27;</span><span class="punctuation">,</span> width <span class="operator">=</span> <span class="number">1</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">coord_polar<span class="punctuation">(</span>theta <span class="operator">=</span> <span class="string">&#x27;y&#x27;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">scale_fill_manual<span class="punctuation">(</span>values <span class="operator">=</span> color_genus<span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">theme<span class="punctuation">(</span>panel.grid <span class="operator">=</span> element_blank<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">,</span> panel.background <span class="operator">=</span> element_blank<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">,</span> axis.text.x <span class="operator">=</span> element_blank<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">,</span> plot.background <span class="operator">=</span> element_blank<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">,</span> legend.text <span class="operator">=</span> element_text<span class="punctuation">(</span>face <span class="operator">=</span> <span class="string">&#x27;italic&#x27;</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&#x27;&#x27;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&#x27;&#x27;</span><span class="punctuation">,</span> title <span class="operator">=</span> <span class="string">&#x27;&#x27;</span><span class="punctuation">,</span> fill <span class="operator">=</span> <span class="string">&#x27;top10 genus&#x27;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">genus_pie <span class="operator">&lt;-</span> genus <span class="operator">+</span> theme<span class="punctuation">(</span>legend.position <span class="operator">=</span> <span class="string">&#x27;none&#x27;</span><span class="punctuation">)</span></span><br><span class="line">genus_legend <span class="operator">&lt;-</span> g_legend<span class="punctuation">(</span>genus <span class="operator">+</span> scale_fill_manual<span class="punctuation">(</span>values <span class="operator">=</span> color_genus<span class="punctuation">[</span>which<span class="punctuation">(</span>abundance<span class="operator">$</span>genus <span class="operator">%in%</span> top10_genus<span class="punctuation">)</span><span class="punctuation">]</span><span class="punctuation">,</span> limits <span class="operator">=</span> top10_genus<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#外环（门）</span></span><br><span class="line">phylum <span class="operator">&lt;-</span> ggplot<span class="punctuation">(</span>abundance<span class="punctuation">,</span> aes<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&#x27;&#x27;</span><span class="punctuation">,</span> y <span class="operator">=</span> a1<span class="punctuation">,</span> fill <span class="operator">=</span> phylum<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span> </span><br><span class="line">geom_bar<span class="punctuation">(</span>stat <span class="operator">=</span> <span class="string">&#x27;identity&#x27;</span><span class="punctuation">,</span> width <span class="operator">=</span> <span class="number">0.1</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">coord_polar<span class="punctuation">(</span>theta <span class="operator">=</span> <span class="string">&#x27;y&#x27;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">scale_fill_manual<span class="punctuation">(</span>values <span class="operator">=</span> color_phylum<span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">theme<span class="punctuation">(</span>panel.grid <span class="operator">=</span> element_blank<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">,</span> panel.background <span class="operator">=</span> element_blank<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">,</span> axis.text.x <span class="operator">=</span> element_blank<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">,</span> plot.background <span class="operator">=</span> element_blank<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">,</span> legend.text <span class="operator">=</span> element_text<span class="punctuation">(</span>face <span class="operator">=</span> <span class="string">&#x27;italic&#x27;</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&#x27;&#x27;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&#x27;&#x27;</span><span class="punctuation">,</span> title <span class="operator">=</span> <span class="string">&#x27;&#x27;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">phylum_pie <span class="operator">&lt;-</span> phylum <span class="operator">+</span> theme<span class="punctuation">(</span>legend.position <span class="operator">=</span> <span class="string">&#x27;none&#x27;</span><span class="punctuation">)</span></span><br><span class="line">phylum_legend <span class="operator">&lt;-</span> g_legend<span class="punctuation">(</span>phylum<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##grid 组合</span></span><br><span class="line"><span class="comment">#pdf(&#x27;grid_plot.pdf&#x27;, width = 7, height = 5)</span></span><br><span class="line">png<span class="punctuation">(</span><span class="string">&#x27;grid_plot.png&#x27;</span><span class="punctuation">,</span> width <span class="operator">=</span> <span class="number">2500</span><span class="punctuation">,</span> height <span class="operator">=</span> <span class="number">1500</span><span class="punctuation">,</span> res <span class="operator">=</span> <span class="number">300</span><span class="punctuation">,</span> units <span class="operator">=</span> <span class="string">&#x27;px&#x27;</span><span class="punctuation">)</span></span><br><span class="line">grid.newpage<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">print<span class="punctuation">(</span>phylum_pie<span class="punctuation">,</span> vp <span class="operator">=</span> viewport<span class="punctuation">(</span>x <span class="operator">=</span> <span class="number">0.3</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="number">0.5</span><span class="punctuation">,</span> width <span class="operator">=</span> <span class="number">1.6</span><span class="punctuation">,</span> height <span class="operator">=</span> <span class="number">1.6</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">print<span class="punctuation">(</span>genus_pie<span class="punctuation">,</span> vp <span class="operator">=</span> viewport<span class="punctuation">(</span>x <span class="operator">=</span> <span class="number">0.3</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="number">0.5</span><span class="punctuation">,</span> width <span class="operator">=</span> <span class="number">0.7</span><span class="punctuation">,</span> height <span class="operator">=</span> <span class="number">0.7</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">phylum_legend<span class="operator">$</span>vp<span class="operator">$</span>x <span class="operator">&lt;-</span> unit<span class="punctuation">(</span><span class="number">0.7</span><span class="punctuation">,</span> <span class="string">&#x27;npc&#x27;</span><span class="punctuation">)</span></span><br><span class="line">phylum_legend<span class="operator">$</span>vp<span class="operator">$</span>y <span class="operator">&lt;-</span> unit<span class="punctuation">(</span><span class="number">0.57</span><span class="punctuation">,</span> <span class="string">&#x27;npc&#x27;</span><span class="punctuation">)</span></span><br><span class="line">grid.draw<span class="punctuation">(</span>phylum_legend<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">genus_legend<span class="operator">$</span>vp<span class="operator">$</span>x <span class="operator">&lt;-</span> unit<span class="punctuation">(</span><span class="number">0.9</span><span class="punctuation">,</span> <span class="string">&#x27;npc&#x27;</span><span class="punctuation">)</span></span><br><span class="line">genus_legend<span class="operator">$</span>vp<span class="operator">$</span>y <span class="operator">&lt;-</span> unit<span class="punctuation">(</span><span class="number">0.5</span><span class="punctuation">,</span> <span class="string">&#x27;npc&#x27;</span><span class="punctuation">)</span></span><br><span class="line">grid.draw<span class="punctuation">(</span>genus_legend<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">dev.off<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="venn图"><strong>Venn图</strong></h3>
<h4 id="先制作分组文件-输入otu表类型文件"><strong>先制作分组文件  输入OTU表类型文件</strong></h4>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># make_veen_flower.R</span></span><br><span class="line"><span class="comment">#!/usr/bin/env Rscript</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#用法参考</span></span><br><span class="line"><span class="comment">#Rscript make_venn_flower.r otu_table.txt group1.txt venn.txt</span></span><br><span class="line"><span class="comment">#Rscript make_venn_flower.r otu_table.txt group2.txt flower.txt</span></span><br><span class="line"><span class="comment">#flower.txt 为单样品的分组   </span></span><br><span class="line"><span class="comment">#venn.txt 为每组的样品</span></span><br><span class="line">args <span class="operator">&lt;-</span> commandArgs<span class="punctuation">(</span><span class="built_in">T</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">otu <span class="operator">&lt;-</span> read.delim<span class="punctuation">(</span>args<span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">,</span> header <span class="operator">=</span> <span class="built_in">T</span><span class="punctuation">,</span> row.names <span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span> sep <span class="operator">=</span> <span class="string">&#x27;\t&#x27;</span><span class="punctuation">,</span> stringsAsFactors <span class="operator">=</span> <span class="built_in">F</span><span class="punctuation">,</span> check.names <span class="operator">=</span> <span class="built_in">F</span><span class="punctuation">)</span></span><br><span class="line">group <span class="operator">&lt;-</span> read.delim<span class="punctuation">(</span>args<span class="punctuation">[</span><span class="number">2</span><span class="punctuation">]</span><span class="punctuation">,</span> header <span class="operator">=</span> <span class="built_in">F</span><span class="punctuation">,</span> sep <span class="operator">=</span> <span class="string">&#x27;\t&#x27;</span><span class="punctuation">,</span> stringsAsFactors <span class="operator">=</span> <span class="built_in">F</span><span class="punctuation">)</span></span><br><span class="line"><span class="built_in">names</span><span class="punctuation">(</span>group<span class="punctuation">)</span> <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;sample&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;group&#x27;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">group_id <span class="operator">&lt;-</span> unique<span class="punctuation">(</span>group<span class="punctuation">[</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">]</span><span class="punctuation">)</span></span><br><span class="line">result <span class="operator">&lt;-</span> <span class="literal">NULL</span></span><br><span class="line">len <span class="operator">=</span> <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> <span class="punctuation">(</span>i <span class="keyword">in</span> group_id<span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">	group_i <span class="operator">&lt;-</span> subset<span class="punctuation">(</span>group<span class="punctuation">,</span> group <span class="operator">==</span> i<span class="punctuation">)</span></span><br><span class="line">	otu_i <span class="operator">&lt;-</span> otu<span class="punctuation">[</span>group_i<span class="operator">$</span>sample<span class="punctuation">]</span></span><br><span class="line">	otu_i <span class="operator">&lt;-</span> subset<span class="punctuation">(</span>otu_i<span class="punctuation">,</span> rowSums<span class="punctuation">(</span>otu_i<span class="punctuation">)</span> <span class="operator">&gt;</span> <span class="number">0</span><span class="punctuation">)</span></span><br><span class="line">	otu_select <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span>i<span class="punctuation">,</span> rownames<span class="punctuation">(</span>otu_i<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">	<span class="keyword">if</span> <span class="punctuation">(</span><span class="built_in">length</span><span class="punctuation">(</span>otu_select<span class="punctuation">)</span> <span class="operator">&gt;</span> len<span class="punctuation">)</span> len <span class="operator">&lt;-</span> <span class="built_in">length</span><span class="punctuation">(</span>otu_select<span class="punctuation">)</span></span><br><span class="line">	<span class="built_in">length</span><span class="punctuation">(</span>otu_select<span class="punctuation">)</span> <span class="operator">=</span> nrow<span class="punctuation">(</span>otu<span class="punctuation">)</span></span><br><span class="line">	result <span class="operator">&lt;-</span> cbind<span class="punctuation">(</span>result<span class="punctuation">,</span> otu_select<span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line">result <span class="operator">&lt;-</span> result<span class="punctuation">[</span><span class="number">1</span><span class="operator">:</span>len<span class="punctuation">,</span> <span class="punctuation">]</span></span><br><span class="line">write.table<span class="punctuation">(</span>result<span class="punctuation">,</span> args<span class="punctuation">[</span><span class="number">3</span><span class="punctuation">]</span><span class="punctuation">,</span> sep <span class="operator">=</span> <span class="string">&#x27;\t&#x27;</span><span class="punctuation">,</span> col.names <span class="operator">=</span> <span class="built_in">F</span><span class="punctuation">,</span>row.names <span class="operator">=</span> <span class="built_in">F</span><span class="punctuation">,</span> na <span class="operator">=</span> <span class="string">&#x27;&#x27;</span><span class="punctuation">,</span> <span class="built_in">quote</span> <span class="operator">=</span> <span class="built_in">F</span><span class="punctuation">)</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="制作venn图"><strong>制作Venn图</strong></h4>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">####韦恩图（VennDiagram 包，适用样本数 2-5）</span></span><br><span class="line">library<span class="punctuation">(</span>VennDiagram<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#读入作图文件，预处理</span></span><br><span class="line">venn_dat <span class="operator">&lt;-</span> read.delim<span class="punctuation">(</span><span class="string">&#x27;venn.txt&#x27;</span><span class="punctuation">,</span> header <span class="operator">=</span> <span class="built_in">T</span><span class="punctuation">,</span> sep <span class="operator">=</span> <span class="string">&#x27;\t&#x27;</span><span class="punctuation">,</span> stringsAsFactors <span class="operator">=</span> <span class="built_in">F</span><span class="punctuation">,</span> check.names <span class="operator">=</span> <span class="built_in">F</span><span class="punctuation">)</span></span><br><span class="line">venn_list <span class="operator">&lt;-</span> <span class="built_in">list</span><span class="punctuation">(</span>venn_dat<span class="punctuation">[</span><span class="punctuation">,</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">,</span> venn_dat<span class="punctuation">[</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">]</span><span class="punctuation">)</span></span><br><span class="line"><span class="built_in">names</span><span class="punctuation">(</span>venn_list<span class="punctuation">)</span> <span class="operator">&lt;-</span> colnames<span class="punctuation">(</span>venn_dat<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#作图</span></span><br><span class="line">venn.diagram<span class="punctuation">(</span>venn_list<span class="punctuation">,</span> filename <span class="operator">=</span> <span class="string">&#x27;venn.png&#x27;</span><span class="punctuation">,</span> fill <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;red&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;blue&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span> alpha <span class="operator">=</span> <span class="number">0.50</span><span class="punctuation">,</span> col <span class="operator">=</span> <span class="string">&#x27;black&#x27;</span><span class="punctuation">,</span> cex <span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span> fontfamily <span class="operator">=</span> <span class="string">&#x27;serif&#x27;</span><span class="punctuation">,</span> cat.col <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;black&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;black&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span> cat.cex <span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span> cat.fontfamily <span class="operator">=</span> <span class="string">&#x27;serif&#x27;</span><span class="punctuation">,</span> margin <span class="operator">=</span> <span class="number">0.2</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">####韦恩图（venn 包，适用样本数 2-7）</span></span><br><span class="line">library<span class="punctuation">(</span>venn<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#读入作图文件，预处理</span></span><br><span class="line">venn_dat <span class="operator">&lt;-</span> read.delim<span class="punctuation">(</span><span class="string">&#x27;flower.txt&#x27;</span><span class="punctuation">,</span> header <span class="operator">=</span> <span class="built_in">T</span><span class="punctuation">,</span> sep <span class="operator">=</span> <span class="string">&#x27;\t&#x27;</span><span class="punctuation">,</span> stringsAsFactors <span class="operator">=</span> <span class="built_in">F</span><span class="punctuation">,</span> check.names <span class="operator">=</span> <span class="built_in">F</span><span class="punctuation">)</span><span class="punctuation">[</span><span class="number">1</span><span class="operator">:</span><span class="number">7</span><span class="punctuation">]</span></span><br><span class="line">venn_list <span class="operator">&lt;-</span> <span class="built_in">list</span><span class="punctuation">(</span>venn_dat<span class="punctuation">[</span><span class="punctuation">,</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">,</span> venn_dat<span class="punctuation">[</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">]</span><span class="punctuation">,</span> venn_dat<span class="punctuation">[</span><span class="punctuation">,</span><span class="number">3</span><span class="punctuation">]</span><span class="punctuation">,</span> venn_dat<span class="punctuation">[</span><span class="punctuation">,</span><span class="number">4</span><span class="punctuation">]</span><span class="punctuation">,</span> venn_dat<span class="punctuation">[</span><span class="punctuation">,</span><span class="number">5</span><span class="punctuation">]</span><span class="punctuation">,</span> venn_dat<span class="punctuation">[</span><span class="punctuation">,</span><span class="number">6</span><span class="punctuation">]</span><span class="punctuation">,</span> venn_dat<span class="punctuation">[</span><span class="punctuation">,</span><span class="number">7</span><span class="punctuation">]</span><span class="punctuation">)</span></span><br><span class="line"><span class="built_in">names</span><span class="punctuation">(</span>venn_list<span class="punctuation">)</span> <span class="operator">&lt;-</span> colnames<span class="punctuation">(</span>venn_dat<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#作图</span></span><br><span class="line">png<span class="punctuation">(</span><span class="string">&#x27;venn_7.png&#x27;</span><span class="punctuation">,</span> width <span class="operator">=</span> <span class="number">1500</span><span class="punctuation">,</span> height <span class="operator">=</span> <span class="number">1500</span><span class="punctuation">,</span> res <span class="operator">=</span> <span class="number">200</span><span class="punctuation">,</span> units <span class="operator">=</span> <span class="string">&#x27;px&#x27;</span><span class="punctuation">)</span></span><br><span class="line">venn<span class="punctuation">(</span>venn_list<span class="punctuation">,</span>zcolor<span class="operator">=</span><span class="string">&#x27;style&#x27;</span><span class="punctuation">)</span></span><br><span class="line">dev.off<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">####韦恩图（UpSetR 包，不受样本数限制）</span></span><br><span class="line">library<span class="punctuation">(</span>UpSetR<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#读入作图文件，预处理</span></span><br><span class="line">otu <span class="operator">&lt;-</span> read.delim<span class="punctuation">(</span><span class="string">&#x27;otu_table.txt&#x27;</span><span class="punctuation">,</span> header <span class="operator">=</span> <span class="built_in">T</span><span class="punctuation">,</span> row.names <span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span> sep <span class="operator">=</span> <span class="string">&#x27;\t&#x27;</span><span class="punctuation">,</span> stringsAsFactors <span class="operator">=</span> <span class="built_in">F</span><span class="punctuation">,</span> check.names <span class="operator">=</span> <span class="built_in">F</span><span class="punctuation">)</span><span class="punctuation">[</span><span class="number">1</span><span class="operator">:</span><span class="number">10</span><span class="punctuation">]</span></span><br><span class="line">otu<span class="punctuation">[</span>otu <span class="operator">&gt;</span> <span class="number">0</span><span class="punctuation">]</span> <span class="operator">&lt;-</span> <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#作图</span></span><br><span class="line">png<span class="punctuation">(</span><span class="string">&#x27;venn_10.png&#x27;</span><span class="punctuation">,</span> width <span class="operator">=</span> <span class="number">1500</span><span class="punctuation">,</span> height <span class="operator">=</span> <span class="number">1500</span><span class="punctuation">,</span> res <span class="operator">=</span> <span class="number">200</span><span class="punctuation">,</span> units <span class="operator">=</span> <span class="string">&#x27;px&#x27;</span><span class="punctuation">)</span></span><br><span class="line">upset<span class="punctuation">(</span>otu<span class="punctuation">,</span> nsets <span class="operator">=</span> <span class="number">12</span><span class="punctuation">,</span> order.by <span class="operator">=</span> <span class="string">&quot;freq&quot;</span><span class="punctuation">,</span>mainbar.y.label <span class="operator">=</span> <span class="string">&quot;IntersectionSize&quot;</span><span class="punctuation">,</span>sets.x.label <span class="operator">=</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span>point.size <span class="operator">=</span> <span class="number">2</span><span class="punctuation">,</span>line.size <span class="operator">=</span> <span class="number">0.8</span><span class="punctuation">)</span></span><br><span class="line">dev.off<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">####花瓣图</span></span><br><span class="line">library<span class="punctuation">(</span>plotrix<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#读入做图文件，预处理</span></span><br><span class="line">flower_dat <span class="operator">&lt;-</span> read.delim<span class="punctuation">(</span><span class="string">&#x27;flower.txt&#x27;</span><span class="punctuation">,</span> header <span class="operator">=</span> <span class="built_in">T</span><span class="punctuation">,</span> sep <span class="operator">=</span> <span class="string">&#x27;\t&#x27;</span><span class="punctuation">,</span> stringsAsFactors <span class="operator">=</span> <span class="built_in">F</span><span class="punctuation">,</span> check.names <span class="operator">=</span> <span class="built_in">F</span><span class="punctuation">)</span></span><br><span class="line">sample_id <span class="operator">&lt;-</span> colnames<span class="punctuation">(</span>flower_dat<span class="punctuation">)</span></span><br><span class="line">otu_id <span class="operator">&lt;-</span> unique<span class="punctuation">(</span>flower_dat<span class="punctuation">[</span><span class="punctuation">,</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">)</span></span><br><span class="line">otu_id <span class="operator">&lt;-</span> otu_id<span class="punctuation">[</span>otu_id <span class="operator">!=</span> <span class="string">&#x27;&#x27;</span><span class="punctuation">]</span></span><br><span class="line">core_otu_id <span class="operator">&lt;-</span> otu_id</span><br><span class="line">otu_num <span class="operator">&lt;-</span> <span class="built_in">length</span><span class="punctuation">(</span>otu_id<span class="punctuation">)</span></span><br><span class="line">ellipse_col <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;#6181BD4E&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;#F348004E&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;#64A10E4E&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;#9300264E&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;#464E044E&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;#049a0b4E&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;#4E0C664E&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;#D000004E&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;#FF6C004E&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;#FF00FF4E&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;#c7475b4E&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;#00F5FF4E&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;#BDA5004E&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;#A5CFED4E&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;#f0301c4E&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;#2B8BC34E&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;#FDA1004E&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;#54adf54E&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;#CDD7E24E&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;#9295C14E&#x27;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> <span class="punctuation">(</span>i <span class="keyword">in</span> <span class="number">2</span><span class="operator">:</span>ncol<span class="punctuation">(</span>flower_dat<span class="punctuation">)</span><span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">	otu_id <span class="operator">&lt;-</span> unique<span class="punctuation">(</span>flower_dat<span class="punctuation">[</span><span class="punctuation">,</span>i<span class="punctuation">]</span><span class="punctuation">)</span></span><br><span class="line">	otu_id <span class="operator">&lt;-</span> otu_id<span class="punctuation">[</span>otu_id <span class="operator">!=</span> <span class="string">&#x27;&#x27;</span><span class="punctuation">]</span></span><br><span class="line">	core_otu_id <span class="operator">&lt;-</span> intersect<span class="punctuation">(</span>core_otu_id<span class="punctuation">,</span> otu_id<span class="punctuation">)</span></span><br><span class="line">	otu_num <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span>otu_num<span class="punctuation">,</span> <span class="built_in">length</span><span class="punctuation">(</span>otu_id<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line">core_num <span class="operator">&lt;-</span> <span class="built_in">length</span><span class="punctuation">(</span>core_otu_id<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#构建作图函数（参考自 https://www.cnblogs.com/xudongliang/p/7884667.html）</span></span><br><span class="line">flower_plot <span class="operator">&lt;-</span> <span class="keyword">function</span><span class="punctuation">(</span>sample<span class="punctuation">,</span> otu_num<span class="punctuation">,</span> core_otu<span class="punctuation">,</span> start<span class="punctuation">,</span> a<span class="punctuation">,</span> b<span class="punctuation">,</span> r<span class="punctuation">,</span> ellipse_col<span class="punctuation">,</span> circle_col<span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">	par<span class="punctuation">(</span> bty <span class="operator">=</span> <span class="string">&#x27;n&#x27;</span><span class="punctuation">,</span> ann <span class="operator">=</span> <span class="built_in">F</span><span class="punctuation">,</span> xaxt <span class="operator">=</span> <span class="string">&#x27;n&#x27;</span><span class="punctuation">,</span> yaxt <span class="operator">=</span> <span class="string">&#x27;n&#x27;</span><span class="punctuation">,</span> mar <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span><span class="number">1</span><span class="punctuation">,</span><span class="number">1</span><span class="punctuation">,</span><span class="number">1</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">	plot<span class="punctuation">(</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span><span class="number">10</span><span class="punctuation">)</span><span class="punctuation">,</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span><span class="number">10</span><span class="punctuation">)</span><span class="punctuation">,</span>type<span class="operator">=</span><span class="string">&#x27;n&#x27;</span><span class="punctuation">)</span></span><br><span class="line">	n   <span class="operator">&lt;-</span> <span class="built_in">length</span><span class="punctuation">(</span>sample<span class="punctuation">)</span></span><br><span class="line">	deg <span class="operator">&lt;-</span> 360 <span class="operator">/</span> n</span><br><span class="line">	res <span class="operator">&lt;-</span> lapply<span class="punctuation">(</span><span class="number">1</span><span class="operator">:</span>n<span class="punctuation">,</span> <span class="keyword">function</span><span class="punctuation">(</span>t<span class="punctuation">)</span><span class="punctuation">&#123;</span></span><br><span class="line">		draw.ellipse<span class="punctuation">(</span>x <span class="operator">=</span> <span class="number">5</span> <span class="operator">+</span> <span class="built_in">cos</span><span class="punctuation">(</span><span class="punctuation">(</span>start <span class="operator">+</span> deg <span class="operator">*</span> <span class="punctuation">(</span>t <span class="operator">-</span> <span class="number">1</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">*</span> <span class="built_in">pi</span> <span class="operator">/</span> <span class="number">180</span><span class="punctuation">)</span><span class="punctuation">,</span> </span><br><span class="line">			y <span class="operator">=</span> <span class="number">5</span> <span class="operator">+</span> <span class="built_in">sin</span><span class="punctuation">(</span><span class="punctuation">(</span>start <span class="operator">+</span> deg <span class="operator">*</span> <span class="punctuation">(</span>t <span class="operator">-</span> <span class="number">1</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">*</span> <span class="built_in">pi</span> <span class="operator">/</span> <span class="number">180</span><span class="punctuation">)</span><span class="punctuation">,</span> </span><br><span class="line">			col <span class="operator">=</span> ellipse_col<span class="punctuation">[</span>t<span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">			border <span class="operator">=</span> ellipse_col<span class="punctuation">[</span>t<span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">			a <span class="operator">=</span> a<span class="punctuation">,</span> b <span class="operator">=</span> b<span class="punctuation">,</span> angle <span class="operator">=</span> deg <span class="operator">*</span> <span class="punctuation">(</span>t <span class="operator">-</span> <span class="number">1</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">		text<span class="punctuation">(</span>x <span class="operator">=</span> <span class="number">5</span> <span class="operator">+</span> <span class="number">2.5</span> <span class="operator">*</span> <span class="built_in">cos</span><span class="punctuation">(</span><span class="punctuation">(</span>start <span class="operator">+</span> deg <span class="operator">*</span> <span class="punctuation">(</span>t <span class="operator">-</span> <span class="number">1</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">*</span> <span class="built_in">pi</span> <span class="operator">/</span> <span class="number">180</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">			y <span class="operator">=</span> <span class="number">5</span> <span class="operator">+</span> <span class="number">2.5</span> <span class="operator">*</span> <span class="built_in">sin</span><span class="punctuation">(</span><span class="punctuation">(</span>start <span class="operator">+</span> deg <span class="operator">*</span> <span class="punctuation">(</span>t <span class="operator">-</span> <span class="number">1</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">*</span> <span class="built_in">pi</span> <span class="operator">/</span> <span class="number">180</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">			otu_num<span class="punctuation">[</span>t<span class="punctuation">]</span><span class="punctuation">)</span></span><br><span class="line">		</span><br><span class="line">		<span class="keyword">if</span> <span class="punctuation">(</span>deg <span class="operator">*</span> <span class="punctuation">(</span>t <span class="operator">-</span> <span class="number">1</span><span class="punctuation">)</span> <span class="operator">&lt;</span> <span class="number">180</span> <span class="operator">&amp;&amp;</span> deg <span class="operator">*</span> <span class="punctuation">(</span>t <span class="operator">-</span> <span class="number">1</span><span class="punctuation">)</span> <span class="operator">&gt;</span> <span class="number">0</span> <span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">			text<span class="punctuation">(</span>x <span class="operator">=</span> <span class="number">5</span> <span class="operator">+</span> <span class="number">3.3</span> <span class="operator">*</span> <span class="built_in">cos</span><span class="punctuation">(</span><span class="punctuation">(</span>start <span class="operator">+</span> deg <span class="operator">*</span> <span class="punctuation">(</span>t <span class="operator">-</span> <span class="number">1</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">*</span> <span class="built_in">pi</span> <span class="operator">/</span> <span class="number">180</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">				y <span class="operator">=</span> <span class="number">5</span> <span class="operator">+</span> <span class="number">3.3</span> <span class="operator">*</span> <span class="built_in">sin</span><span class="punctuation">(</span><span class="punctuation">(</span>start <span class="operator">+</span> deg <span class="operator">*</span> <span class="punctuation">(</span>t <span class="operator">-</span> <span class="number">1</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">*</span> <span class="built_in">pi</span> <span class="operator">/</span> <span class="number">180</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">				sample<span class="punctuation">[</span>t<span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">				srt <span class="operator">=</span> deg <span class="operator">*</span> <span class="punctuation">(</span>t <span class="operator">-</span> <span class="number">1</span><span class="punctuation">)</span> <span class="operator">-</span> start<span class="punctuation">,</span></span><br><span class="line">				adj <span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">				cex <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">				<span class="punctuation">)</span></span><br><span class="line">		<span class="punctuation">&#125;</span> <span class="keyword">else</span> <span class="punctuation">&#123;</span></span><br><span class="line">			text<span class="punctuation">(</span>x <span class="operator">=</span> <span class="number">5</span> <span class="operator">+</span> <span class="number">3.3</span> <span class="operator">*</span> <span class="built_in">cos</span><span class="punctuation">(</span><span class="punctuation">(</span>start <span class="operator">+</span> deg <span class="operator">*</span> <span class="punctuation">(</span>t <span class="operator">-</span> <span class="number">1</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">*</span> <span class="built_in">pi</span> <span class="operator">/</span> <span class="number">180</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">				y <span class="operator">=</span> <span class="number">5</span> <span class="operator">+</span> <span class="number">3.3</span> <span class="operator">*</span> <span class="built_in">sin</span><span class="punctuation">(</span><span class="punctuation">(</span>start <span class="operator">+</span> deg <span class="operator">*</span> <span class="punctuation">(</span>t <span class="operator">-</span> <span class="number">1</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">*</span> <span class="built_in">pi</span> <span class="operator">/</span> <span class="number">180</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">				sample<span class="punctuation">[</span>t<span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">				srt <span class="operator">=</span> deg <span class="operator">*</span> <span class="punctuation">(</span>t <span class="operator">-</span> <span class="number">1</span><span class="punctuation">)</span> <span class="operator">+</span> start<span class="punctuation">,</span></span><br><span class="line">				adj <span class="operator">=</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">				cex <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">				<span class="punctuation">)</span></span><br><span class="line">		<span class="punctuation">&#125;</span>			</span><br><span class="line">	<span class="punctuation">&#125;</span><span class="punctuation">)</span></span><br><span class="line">	draw.circle<span class="punctuation">(</span>x <span class="operator">=</span> <span class="number">5</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="number">5</span><span class="punctuation">,</span> r <span class="operator">=</span> r<span class="punctuation">,</span> col <span class="operator">=</span> circle_col<span class="punctuation">,</span> border <span class="operator">=</span> <span class="literal">NA</span><span class="punctuation">)</span></span><br><span class="line">	text<span class="punctuation">(</span>x <span class="operator">=</span> <span class="number">5</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="number">5</span><span class="punctuation">,</span> paste<span class="punctuation">(</span><span class="string">&#x27;Core:&#x27;</span><span class="punctuation">,</span> core_otu<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#作图</span></span><br><span class="line">png<span class="punctuation">(</span><span class="string">&#x27;flower.png&#x27;</span><span class="punctuation">,</span> width <span class="operator">=</span> <span class="number">1500</span><span class="punctuation">,</span> height <span class="operator">=</span> <span class="number">1500</span><span class="punctuation">,</span> res <span class="operator">=</span> <span class="number">200</span><span class="punctuation">,</span> units <span class="operator">=</span> <span class="string">&#x27;px&#x27;</span><span class="punctuation">)</span></span><br><span class="line">flower_plot<span class="punctuation">(</span>sample <span class="operator">=</span> sample_id<span class="punctuation">,</span> otu_num <span class="operator">=</span> otu_num<span class="punctuation">,</span> core_otu <span class="operator">=</span> core_num<span class="punctuation">,</span> </span><br><span class="line">	start <span class="operator">=</span> <span class="number">90</span><span class="punctuation">,</span> a <span class="operator">=</span> <span class="number">0.5</span><span class="punctuation">,</span> b <span class="operator">=</span> <span class="number">2</span><span class="punctuation">,</span> r <span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span> ellipse_col <span class="operator">=</span> ellipse_col<span class="punctuation">,</span> circle_col <span class="operator">=</span> <span class="string">&#x27;white&#x27;</span><span class="punctuation">)</span></span><br><span class="line">dev.off<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment">#注：参数a和b用于设置花瓣椭圆的尺寸，ellipse_col用于设置花瓣椭圆的颜色；参数r用于设置中心圆圈尺寸，circle_col用于设置中心圆圈的颜色</span></span><br></pre></td></tr></table></figure>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#Upset也可以自自己</span></span><br><span class="line">library<span class="punctuation">(</span>UpSetR<span class="punctuation">)</span></span><br><span class="line">require<span class="punctuation">(</span>ggplot2<span class="punctuation">)</span>;</span><br><span class="line">require<span class="punctuation">(</span>plyr<span class="punctuation">)</span>;</span><br><span class="line">require<span class="punctuation">(</span>gridExtra<span class="punctuation">)</span>; </span><br><span class="line">require<span class="punctuation">(</span>grid<span class="punctuation">)</span>;</span><br><span class="line">input <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span></span><br><span class="line">  <span class="string">&#x27;cancer1&#x27;</span><span class="operator">=</span>  <span class="number">1578</span><span class="punctuation">,</span></span><br><span class="line">  <span class="string">&#x27;cancer2&#x27;</span> <span class="operator">=</span>  <span class="number">1284</span><span class="punctuation">,</span></span><br><span class="line">  <span class="string">&#x27;cancer3&#x27;</span> <span class="operator">=</span> <span class="number">2488</span><span class="punctuation">,</span></span><br><span class="line">  <span class="string">&#x27;cancer1&amp;cancer2&#x27;</span>  <span class="operator">=</span><span class="number">205</span><span class="punctuation">,</span></span><br><span class="line">  <span class="string">&#x27;cancer1&amp;cancer3&#x27;</span>  <span class="operator">=</span> <span class="number">828</span><span class="punctuation">,</span></span><br><span class="line">  <span class="string">&#x27;cancer2&amp;cancer3&#x27;</span>  <span class="operator">=</span><span class="number">589</span><span class="punctuation">,</span></span><br><span class="line">  <span class="string">&#x27;cancer1&amp;cancer2&amp;cancer3&#x27;</span>   <span class="operator">=</span><span class="number">120</span></span><br><span class="line"><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">data <span class="operator">&lt;-</span> fromExpression<span class="punctuation">(</span>input<span class="punctuation">)</span></span><br><span class="line">p1 <span class="operator">&lt;-</span> upset<span class="punctuation">(</span>data<span class="punctuation">,</span> nsets <span class="operator">=</span> <span class="number">9</span><span class="punctuation">,</span> </span><br><span class="line">            sets <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;cancer1&#x27;</span><span class="punctuation">,</span></span><br><span class="line">                     <span class="string">&#x27;cancer2&#x27;</span> <span class="punctuation">,</span></span><br><span class="line">                     <span class="string">&#x27;cancer3&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">            keep.order <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">,</span></span><br><span class="line">            <span class="comment"># number.angles = 30, </span></span><br><span class="line">            point.size <span class="operator">=</span> <span class="number">5</span><span class="punctuation">,</span> </span><br><span class="line">            line.size <span class="operator">=</span> <span class="number">1.3</span><span class="punctuation">,</span> </span><br><span class="line">            mainbar.y.label <span class="operator">=</span> <span class="string">&quot;IntersectionSize&quot;</span><span class="punctuation">,</span> </span><br><span class="line">            sets.x.label <span class="operator">=</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">            mb.ratio <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">0.60</span><span class="punctuation">,</span> <span class="number">0.40</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">            text.scale <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">4</span><span class="punctuation">,</span> <span class="number">4</span><span class="punctuation">,</span> <span class="number">0.5</span><span class="punctuation">,</span> <span class="number">0.5</span><span class="punctuation">,</span><span class="number">3</span><span class="punctuation">,</span> <span class="number">4</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">p1</span><br><span class="line"></span><br><span class="line"><span class="comment">#例如我们关注所有分组的交集、c1 分组的特有集，以及 Proteobacteria 在各交集中所含 OTUs 的种类数量</span></span><br><span class="line"><span class="comment">#默认最多展示 5 组数据（nset = 5）的 40 种交集（nintersects = 40）</span></span><br><span class="line">upset<span class="punctuation">(</span>phylum1<span class="punctuation">,</span> nset <span class="operator">=</span> <span class="number">8</span><span class="punctuation">,</span> nintersects <span class="operator">=</span> <span class="number">100</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment">#也可自定义指定数据集名称</span></span><br><span class="line">upset<span class="punctuation">(</span>phylum1<span class="punctuation">,</span> sets <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;B1&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;C1&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span> nintersects <span class="operator">=</span> <span class="number">100</span><span class="punctuation">)</span></span><br><span class="line">upset<span class="punctuation">(</span>phylum1<span class="punctuation">,</span> nset <span class="operator">=</span> <span class="number">6</span><span class="punctuation">,</span> nintersects <span class="operator">=</span> <span class="number">100</span><span class="punctuation">,</span> order.by <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;freq&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;degree&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span> decreasing <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="literal">TRUE</span><span class="punctuation">,</span> <span class="literal">TRUE</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">      queries <span class="operator">=</span> <span class="built_in">list</span><span class="punctuation">(</span><span class="built_in">list</span><span class="punctuation">(</span>query <span class="operator">=</span> intersects<span class="punctuation">,</span> params <span class="operator">=</span> <span class="string">&#x27;H2&#x27;</span><span class="punctuation">,</span> color <span class="operator">=</span> <span class="string">&#x27;red&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">                     <span class="built_in">list</span><span class="punctuation">(</span>query <span class="operator">=</span> intersects<span class="punctuation">,</span> params <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;H1&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;H2&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;H3&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;H4&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;H5&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;H6&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span> color <span class="operator">=</span> <span class="string">&#x27;blue&#x27;</span><span class="punctuation">)</span></span><br><span class="line">                     <span class="punctuation">)</span><span class="punctuation">)</span><span class="comment">#list(query = elements, params = c(&#x27;taxonomy&#x27;, &#x27;Proteobacteria&#x27;), color = &#x27;orange&#x27;, active = TRUE) 增加一列分类</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="排序类型图"><strong>排序类型图</strong></h3>
<p><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s?__biz=MzAwOTg5ODYyNQ==&amp;mid=2247484064&amp;idx=1&amp;sn=1ef21a14e077128c6b9d373a905ee99e&amp;chksm=9b59dd4eac2e5458871af146e9b5fe7c85947c0cf3ebb75880b18a897abf3dedcd1ab38141a3&amp;mpshare=1&amp;scene=1&amp;srcid=&amp;sharer_sharetime=1591547318282&amp;sharer_shareid=59b64c339c4e339bb243a53b299dcf8d&amp;key=983943efdc6388ddfc3c7ab4677aa5f8aca09b18bbe6c3eb13769eb1d5dd9d7fe3df7379cbb2d48564056b6e0cbb71bff8ff9b41309e35e5608bdcb97519dbb6f57a3781cd64c2fc4d4b0e064064ee7c&amp;ascene=1&amp;uin=Mjc2NjUwNjgzOA%3D%3D&amp;devicetype=Windows+10+x64&amp;version=62090070&amp;lang=zh_CN&amp;exportkey=Awbo2jQq6WoFdR7ln9U%2Bbu8%3D&amp;pass_ticket=OgFI03cbOodZF9BCd6N4rzrUDZTAvGjmnuNy2Ome2pNqRzYbuy8inleYEzRU7qCf">排序分析简介</a></p>
<p><a target="_blank" rel="noopener" href="https://www.omicshare.com/forum/thread-6351-1-1.html">PCA、PCoA和NMDS有什么区别</a></p>
<ul>
<li>**在非限制性排序中，16S和宏基因组数据分析通常用到的是PCA分析和PCoA分析。两者的区别在于：****PCA分析是基于原始的物种组成矩阵所做的排序分析，而PCoA分析则是基于由物种组成计算得到的距离矩阵得出的。</li>
<li>如果大于4.0，就应该选单峰模型；</li>
<li>如果3.0-4.0之间，选线性模型或者单峰模型均可；</li>
<li>如果小于3.0, 线性模型的结果要好于单峰模型</li>
<li>查看结果中的“Axis lengths”的第一轴DCA1的值，根据该值判断该采用线性模型还是单峰模型：</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#判断选择用单峰模型还是线性模型 decorana()</span></span><br><span class="line">install.packages<span class="punctuation">(</span><span class="string">&#x27;vegan&#x27;</span><span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span><span class="string">&#x27;vegan&#x27;</span><span class="punctuation">)</span></span><br><span class="line">data<span class="punctuation">(</span>varespec<span class="punctuation">)</span></span><br><span class="line">vare_dca<span class="operator">&lt;-</span>decorana<span class="punctuation">(</span>varespec<span class="punctuation">)</span></span><br><span class="line">vare_dca</span><br></pre></td></tr></table></figure>
<p><strong>输入文件一般都为分组文件及丰度表</strong></p>
<p><img src="/2023/10/31/ggplot-picture/C:%5CUsers%5CAdministrator%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200608104456601.png" alt="image-20200608104456601"></p>
<h4 id="pls-da分析"><strong>PLS-DA分析</strong></h4>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">library<span class="punctuation">(</span>mixOmics<span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>ggplot2<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##读入文件</span></span><br><span class="line"><span class="comment">#门水平丰度表</span></span><br><span class="line">phylum <span class="operator">&lt;-</span> read.delim<span class="punctuation">(</span><span class="string">&#x27;phylum_table.txt&#x27;</span><span class="punctuation">,</span> row.names <span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span> sep <span class="operator">=</span> <span class="string">&#x27;\t&#x27;</span><span class="punctuation">,</span> stringsAsFactors <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">,</span> check.names <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span></span><br><span class="line">phylum <span class="operator">&lt;-</span> data.frame<span class="punctuation">(</span>t<span class="punctuation">(</span>phylum<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#样本分组文件</span></span><br><span class="line">group <span class="operator">&lt;-</span> read.delim<span class="punctuation">(</span><span class="string">&#x27;group.txt&#x27;</span><span class="punctuation">,</span> sep <span class="operator">=</span> <span class="string">&#x27;\t&#x27;</span><span class="punctuation">,</span> stringsAsFactors <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##PLS-DA 分析</span></span><br><span class="line"><span class="comment">#基于门水平丰度表，只展示前 3 个排序轴</span></span><br><span class="line">phylum <span class="operator">&lt;-</span> phylum<span class="punctuation">[</span>group<span class="operator">$</span><span class="built_in">names</span><span class="punctuation">,</span> <span class="punctuation">]</span></span><br><span class="line">plsda_result <span class="operator">&lt;-</span>plsda<span class="punctuation">(</span>phylum<span class="punctuation">,</span> group<span class="operator">$</span>group<span class="punctuation">,</span> ncomp <span class="operator">=</span> <span class="number">3</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#简要查看结果</span></span><br><span class="line">plsda_result</span><br><span class="line"><span class="comment">#或</span></span><br><span class="line"><span class="built_in">names</span><span class="punctuation">(</span>plsda_result<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#查看排序轴解释量</span></span><br><span class="line">plsda_result<span class="operator">$</span>explained_variance<span class="operator">$</span>X</span><br><span class="line"><span class="comment">#查看样本排序坐标</span></span><br><span class="line">plsda_result<span class="operator">$</span>variates<span class="operator">$</span>X</span><br><span class="line"><span class="comment">#查看细菌门类群排序坐标</span></span><br><span class="line">plsda_result<span class="operator">$</span>loadings<span class="operator">$</span>X</span><br><span class="line"></span><br><span class="line"><span class="comment">#使用 plotIndiv() 绘制 PLS-DA 分析结果</span></span><br><span class="line">plotIndiv<span class="punctuation">(</span>plsda_result<span class="punctuation">,</span> ind.names <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">,</span> style <span class="operator">=</span> <span class="string">&#x27;ggplot2&#x27;</span><span class="punctuation">)</span></span><br><span class="line">plotIndiv<span class="punctuation">(</span>plsda_result<span class="punctuation">,</span> ind.names <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">,</span> style <span class="operator">=</span> <span class="string">&#x27;3d&#x27;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#提取坐标轴解释量（前两轴）</span></span><br><span class="line">plsda_result_eig <span class="operator">&lt;-</span> <span class="punctuation">&#123;</span>plsda_result<span class="operator">$</span>explained_variance<span class="operator">$</span>X<span class="punctuation">&#125;</span><span class="punctuation">[</span><span class="number">1</span><span class="operator">:</span><span class="number">2</span><span class="punctuation">]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#提取样本点坐标（前两轴）</span></span><br><span class="line">sample_site <span class="operator">&lt;-</span> data.frame<span class="punctuation">(</span>plsda_result<span class="operator">$</span>variates<span class="punctuation">)</span><span class="punctuation">[</span><span class="number">1</span><span class="operator">:</span><span class="number">2</span><span class="punctuation">]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#为样本点坐标添加分组信息</span></span><br><span class="line">sample_site<span class="operator">$</span><span class="built_in">names</span> <span class="operator">&lt;-</span> rownames<span class="punctuation">(</span>sample_site<span class="punctuation">)</span></span><br><span class="line"><span class="built_in">names</span><span class="punctuation">(</span>sample_site<span class="punctuation">)</span><span class="punctuation">[</span><span class="number">1</span><span class="operator">:</span><span class="number">2</span><span class="punctuation">]</span> <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;plsda1&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;plsda2&#x27;</span><span class="punctuation">)</span></span><br><span class="line">sample_site <span class="operator">&lt;-</span> merge<span class="punctuation">(</span>sample_site<span class="punctuation">,</span> group<span class="punctuation">,</span> by <span class="operator">=</span> <span class="string">&#x27;names&#x27;</span><span class="punctuation">,</span> all.x <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#可选输出各样本的 PLS-DA 分析结果</span></span><br><span class="line">write.table<span class="punctuation">(</span>sample_site<span class="punctuation">,</span> <span class="string">&#x27;plsda_sample.txt&#x27;</span><span class="punctuation">,</span> row.names <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">,</span> sep <span class="operator">=</span> <span class="string">&#x27;\t&#x27;</span><span class="punctuation">,</span> <span class="built_in">quote</span> <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#使用 ggplot2 简单绘制 PLS-DA 结果图</span></span><br><span class="line">plsda_plot <span class="operator">&lt;-</span> ggplot<span class="punctuation">(</span>sample_site<span class="punctuation">,</span> aes<span class="punctuation">(</span>plsda1<span class="punctuation">,</span> plsda2<span class="punctuation">,</span> color <span class="operator">=</span> group<span class="punctuation">,</span> label <span class="operator">=</span> <span class="built_in">names</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">geom_point<span class="punctuation">(</span>size <span class="operator">=</span> <span class="number">1.5</span><span class="punctuation">,</span> alpha <span class="operator">=</span> <span class="number">0.6</span><span class="punctuation">)</span> <span class="operator">+</span> </span><br><span class="line">stat_ellipse<span class="punctuation">(</span>show.legend <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span> <span class="operator">+</span>	<span class="comment">#添加 95% 置信椭圆</span></span><br><span class="line">scale_color_manual<span class="punctuation">(</span>values <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;#1D7ACC&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;#F67433&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;#00815F&#x27;</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">theme<span class="punctuation">(</span>panel.grid <span class="operator">=</span> element_line<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&#x27;grey50&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span> panel.background <span class="operator">=</span> element_rect<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&#x27;black&#x27;</span><span class="punctuation">,</span> fill <span class="operator">=</span> <span class="string">&#x27;transparent&#x27;</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span> </span><br><span class="line">theme<span class="punctuation">(</span>legend.title <span class="operator">=</span> element_blank<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">,</span> legend.key <span class="operator">=</span> element_rect<span class="punctuation">(</span>fill <span class="operator">=</span> <span class="string">&#x27;transparent&#x27;</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">labs<span class="punctuation">(</span>x <span class="operator">=</span> paste<span class="punctuation">(</span><span class="string">&#x27;PLS-DA axis1 ( explained variance &#x27;</span><span class="punctuation">,</span> <span class="built_in">round</span><span class="punctuation">(</span><span class="number">100</span> <span class="operator">*</span> plsda_result_eig<span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">,</span> <span class="number">2</span><span class="punctuation">)</span><span class="punctuation">,</span> <span class="string">&#x27;% )&#x27;</span><span class="punctuation">,</span> sep <span class="operator">=</span> <span class="string">&#x27;&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span> y <span class="operator">=</span> paste<span class="punctuation">(</span><span class="string">&#x27;PLS-DA axis2 ( explained variance &#x27;</span><span class="punctuation">,</span> <span class="built_in">round</span><span class="punctuation">(</span><span class="number">100</span> <span class="operator">*</span> plsda_result_eig<span class="punctuation">[</span><span class="number">2</span><span class="punctuation">]</span><span class="punctuation">,</span> <span class="number">2</span><span class="punctuation">)</span><span class="punctuation">,</span> <span class="string">&#x27;% )&#x27;</span><span class="punctuation">,</span> sep <span class="operator">=</span> <span class="string">&#x27;&#x27;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#ggsave(&#x27;plsda_plot.pdf&#x27;, plsda_plot, width = 6, height = 5)</span></span><br><span class="line">ggsave<span class="punctuation">(</span><span class="string">&#x27;plsda_plot.png&#x27;</span><span class="punctuation">,</span> plsda_plot<span class="punctuation">,</span> width <span class="operator">=</span> <span class="number">6</span><span class="punctuation">,</span> height <span class="operator">=</span> <span class="number">5</span><span class="punctuation">)</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="nmds分析"><strong>NMDS分析</strong></h4>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br></pre></td><td class="code"><pre><span class="line">library<span class="punctuation">(</span>vegan<span class="punctuation">)</span>	<span class="comment">#排序分析</span></span><br><span class="line"><span class="comment">#使用OTU丰度表作为输入文件还是现有的距离矩阵作为输入文件，NMDS排序的结果是不一致的。</span></span><br><span class="line"><span class="comment">#使用OTU丰度表作为输入文件的NMDS排序分析能够更充分地进行信息挖掘</span></span><br><span class="line">rm<span class="punctuation">(</span><span class="built_in">list</span> <span class="operator">=</span> ls<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>GUniFrac<span class="punctuation">)</span></span><br><span class="line">setwd<span class="punctuation">(</span><span class="string">&quot;./Abundance/Nr_abundance/Distance/&quot;</span><span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>ggplot2<span class="punctuation">)</span>	<span class="comment">#作图</span></span><br><span class="line">library<span class="punctuation">(</span>ape<span class="punctuation">)</span>	<span class="comment">#可选，用于读取进化树文件，见最后</span></span><br><span class="line"><span class="comment">##############################</span></span><br><span class="line"><span class="comment">##NMDS 排序（基于 OTU 丰度表）</span></span><br><span class="line"><span class="comment">#读入 OTU 丰度表</span></span><br><span class="line">otu <span class="operator">&lt;-</span> read.delim<span class="punctuation">(</span><span class="string">&#x27;Genu_0.001.txt&#x27;</span><span class="punctuation">,</span> row.names <span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span> sep <span class="operator">=</span> <span class="string">&#x27;\t&#x27;</span><span class="punctuation">,</span> stringsAsFactors <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">,</span> check.names <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span></span><br><span class="line">otu <span class="operator">&lt;-</span> data.frame<span class="punctuation">(</span>t<span class="punctuation">(</span>otu<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">distance <span class="operator">&lt;-</span> vegdist<span class="punctuation">(</span>otu<span class="punctuation">,</span> method <span class="operator">=</span> <span class="string">&#x27;bray&#x27;</span><span class="punctuation">)</span></span><br><span class="line">distance <span class="operator">&lt;-</span> as.matrix<span class="punctuation">(</span>distance<span class="punctuation">)</span></span><br><span class="line">write.table<span class="punctuation">(</span>distance<span class="punctuation">,</span> <span class="string">&#x27;bray-curtis_distance.txt&#x27;</span><span class="punctuation">,</span> col.names <span class="operator">=</span> <span class="literal">NA</span><span class="punctuation">,</span> sep <span class="operator">=</span> <span class="string">&#x27;\t&#x27;</span><span class="punctuation">,</span> <span class="built_in">quote</span> <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment">#排序，预设 4 个排序轴</span></span><br><span class="line">nmds1 <span class="operator">&lt;-</span> metaMDS<span class="punctuation">(</span>otu<span class="punctuation">,</span> distance <span class="operator">=</span> <span class="string">&#x27;bray&#x27;</span><span class="punctuation">,</span> k <span class="operator">=</span> <span class="number">2</span><span class="punctuation">)</span></span><br><span class="line"><span class="operator">?</span>metaMDS<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment">#可简要查看结果</span></span><br><span class="line">nmds1</span><br><span class="line"><span class="comment">#或</span></span><br><span class="line">summary<span class="punctuation">(</span>nmds1<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#提取应力函数值（stress）</span></span><br><span class="line">nmds1.stress <span class="operator">&lt;-</span> nmds1<span class="operator">$</span>stress</span><br><span class="line"><span class="comment">#提取样本排序坐标</span></span><br><span class="line">nmds1.point <span class="operator">&lt;-</span> data.frame<span class="punctuation">(</span>nmds1<span class="operator">$</span>point<span class="punctuation">)</span></span><br><span class="line"><span class="comment">#提取物种（OTU）排序坐标</span></span><br><span class="line">nmds1.species <span class="operator">&lt;-</span> data.frame<span class="punctuation">(</span>nmds1<span class="operator">$</span>species<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#可选择将结果输出并保存在本地，例如将样本坐标输出为 csv 格式</span></span><br><span class="line">write.csv<span class="punctuation">(</span>nmds1.point<span class="punctuation">,</span> <span class="string">&#x27;nmds.sample.csv&#x27;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#简要绘图展示</span></span><br><span class="line">nmds_plot <span class="operator">&lt;-</span> nmds1</span><br><span class="line">nmds_plot<span class="operator">$</span>species <span class="operator">&lt;-</span> <span class="punctuation">&#123;</span>nmds_plot<span class="operator">$</span>species<span class="punctuation">&#125;</span><span class="punctuation">[</span><span class="number">1</span><span class="operator">:</span><span class="number">10</span><span class="punctuation">,</span> <span class="punctuation">]</span></span><br><span class="line">plot<span class="punctuation">(</span>nmds_plot<span class="punctuation">,</span> type <span class="operator">=</span> <span class="string">&#x27;t&#x27;</span><span class="punctuation">,</span> main <span class="operator">=</span> paste<span class="punctuation">(</span><span class="string">&#x27;Stress =&#x27;</span><span class="punctuation">,</span> <span class="built_in">round</span><span class="punctuation">(</span>nmds1<span class="operator">$</span>stress<span class="punctuation">,</span> <span class="number">4</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##############################</span></span><br><span class="line"><span class="comment">##NMDS 排序（基于现有的距离矩阵）</span></span><br><span class="line"><span class="comment">#读入现有的距离矩阵</span></span><br><span class="line">dis <span class="operator">&lt;-</span> read.delim<span class="punctuation">(</span><span class="string">&#x27;bray-curtis_distance.txt&#x27;</span><span class="punctuation">,</span> row.names <span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span> sep <span class="operator">=</span> <span class="string">&#x27;\t&#x27;</span><span class="punctuation">,</span> stringsAsFactors <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">,</span> check.names <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment">#排序，预设 4 个排序轴 dis为读入的距离矩阵</span></span><br><span class="line">nmds2 <span class="operator">&lt;-</span> metaMDS<span class="punctuation">(</span>as.dist<span class="punctuation">(</span>dis<span class="punctuation">)</span><span class="punctuation">,</span> k <span class="operator">=</span> <span class="number">2</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment">#可简要查看结果</span></span><br><span class="line">summary<span class="punctuation">(</span>nmds2<span class="punctuation">)</span></span><br><span class="line"><span class="comment">#可发现“species”信息中为“1”，打印出来为“NA”</span></span><br><span class="line">nmds2<span class="operator">$</span>species</span><br><span class="line"><span class="comment">#简要绘图展示，可发现与基于 OTU 丰度表的 NMDS 排序结果不同</span></span><br><span class="line">plot<span class="punctuation">(</span>nmds2<span class="punctuation">,</span> type <span class="operator">=</span> <span class="string">&#x27;t&#x27;</span><span class="punctuation">,</span> main <span class="operator">=</span> paste<span class="punctuation">(</span><span class="string">&#x27;Stress =&#x27;</span><span class="punctuation">,</span> <span class="built_in">round</span><span class="punctuation">(</span>nmds2<span class="operator">$</span>stress<span class="punctuation">,</span> <span class="number">4</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment">#可使用 wascores() 将 OTU “被动地”加入 NMDS 排序图</span></span><br><span class="line">species <span class="operator">&lt;-</span> wascores<span class="punctuation">(</span>nmds2<span class="operator">$</span>points<span class="punctuation">,</span> otu<span class="punctuation">)</span></span><br><span class="line">text<span class="punctuation">(</span>species<span class="punctuation">[</span><span class="number">1</span><span class="operator">:</span><span class="number">10</span><span class="punctuation">,</span> <span class="punctuation">]</span><span class="punctuation">,</span> rownames<span class="punctuation">(</span>species<span class="punctuation">)</span><span class="punctuation">[</span><span class="number">1</span><span class="operator">:</span><span class="number">10</span><span class="punctuation">]</span><span class="punctuation">,</span> col <span class="operator">=</span> <span class="string">&#x27;red&#x27;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##############################</span></span><br><span class="line"><span class="comment">##NMDS 评估  可以通过比较NMDS排序图内对象的距离与原始对象距离去评估NMDS结果（Shepard图）。若R2越大，则NMDS结果越合理。</span></span><br><span class="line">stressplot<span class="punctuation">(</span>nmds_plot<span class="punctuation">,</span> main <span class="operator">=</span> <span class="string">&#x27;Shepard 图&#x27;</span><span class="punctuation">)</span></span><br><span class="line">gof <span class="operator">&lt;-</span> goodness<span class="punctuation">(</span>nmds_plot<span class="punctuation">)</span></span><br><span class="line">plot<span class="punctuation">(</span>nmds_plot<span class="punctuation">,</span>type <span class="operator">=</span> <span class="string">&#x27;t&#x27;</span><span class="punctuation">,</span> main <span class="operator">=</span> <span class="string">&#x27;拟合度&#x27;</span><span class="punctuation">)</span></span><br><span class="line">points<span class="punctuation">(</span>nmds_plot<span class="punctuation">,</span> display <span class="operator">=</span> <span class="string">&#x27;sites&#x27;</span><span class="punctuation">,</span> cex <span class="operator">=</span> gof <span class="operator">*</span> <span class="number">200</span><span class="punctuation">,</span> col <span class="operator">=</span> <span class="string">&#x27;red&#x27;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##############################</span></span><br><span class="line"><span class="comment">##ggplot2 作图（使用基于 OTU 丰度表的 NMDS 排序结果，预设 2 个排序轴）</span></span><br><span class="line"><span class="comment">#读入 OTU 丰度表</span></span><br><span class="line">otu <span class="operator">&lt;-</span> read.delim<span class="punctuation">(</span><span class="string">&#x27;Genu_0.001.txt&#x27;</span><span class="punctuation">,</span> row.names <span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span> sep <span class="operator">=</span> <span class="string">&#x27;\t&#x27;</span><span class="punctuation">,</span> stringsAsFactors <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">,</span> check.names <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span></span><br><span class="line">otu <span class="operator">&lt;-</span> data.frame<span class="punctuation">(</span>t<span class="punctuation">(</span>otu<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#读入样本分组文件</span></span><br><span class="line">group <span class="operator">&lt;-</span> read.delim<span class="punctuation">(</span><span class="string">&#x27;sample.txt&#x27;</span><span class="punctuation">,</span> sep <span class="operator">=</span> <span class="string">&#x27;\t&#x27;</span><span class="punctuation">,</span> stringsAsFactors <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#排序，预设 2 个排序轴</span></span><br><span class="line">nmds1 <span class="operator">&lt;-</span> metaMDS<span class="punctuation">(</span>otu<span class="punctuation">,</span> distance <span class="operator">=</span> <span class="string">&#x27;bray&#x27;</span><span class="punctuation">,</span> k <span class="operator">=</span> <span class="number">2</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#提取样本点坐标（前两轴）</span></span><br><span class="line">sample_site <span class="operator">&lt;-</span> nmds1.point<span class="punctuation">[</span><span class="number">1</span><span class="operator">:</span><span class="number">2</span><span class="punctuation">]</span></span><br><span class="line">sample_site<span class="operator">$</span><span class="built_in">names</span> <span class="operator">&lt;-</span> rownames<span class="punctuation">(</span>sample_site<span class="punctuation">)</span></span><br><span class="line"><span class="built_in">names</span><span class="punctuation">(</span>sample_site<span class="punctuation">)</span><span class="punctuation">[</span><span class="number">1</span><span class="operator">:</span><span class="number">2</span><span class="punctuation">]</span> <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;NMDS1&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;NMDS2&#x27;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#为样本点坐标添加分组信息</span></span><br><span class="line">sample_site <span class="operator">&lt;-</span> merge<span class="punctuation">(</span>sample_site<span class="punctuation">,</span> group<span class="punctuation">,</span> by <span class="operator">=</span> <span class="string">&#x27;names&#x27;</span><span class="punctuation">,</span> all.x <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#使用 ggplot2 绘制 NMDS 排序图</span></span><br><span class="line">nmds_plot <span class="operator">&lt;-</span> ggplot<span class="punctuation">(</span>sample_site<span class="punctuation">,</span> aes<span class="punctuation">(</span>NMDS1<span class="punctuation">,</span> NMDS2<span class="punctuation">,</span> group <span class="operator">=</span> group<span class="punctuation">,</span>color<span class="operator">=</span>group<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_point<span class="punctuation">(</span>aes<span class="punctuation">(</span>color <span class="operator">=</span> group<span class="punctuation">)</span><span class="punctuation">,</span> size <span class="operator">=</span> <span class="number">1.5</span><span class="punctuation">,</span> alpha <span class="operator">=</span> <span class="number">0.8</span><span class="punctuation">)</span> <span class="operator">+</span> <span class="comment">#可在这里修改点的透明度、大小</span></span><br><span class="line">  scale_shape_manual<span class="punctuation">(</span>values <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">17</span><span class="punctuation">,</span> <span class="number">16</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span> <span class="comment">#可在这里修改点的形状</span></span><br><span class="line">  stat_ellipse<span class="punctuation">(</span>level <span class="operator">=</span> <span class="number">0.95</span><span class="punctuation">,</span> show.legend <span class="operator">=</span> <span class="built_in">F</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  scale_color_manual<span class="punctuation">(</span>values <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;red&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;blue&#x27;</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span> <span class="comment">#可在这里修改点的颜色</span></span><br><span class="line">  theme<span class="punctuation">(</span>panel.grid <span class="operator">=</span> element_blank<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">,</span> panel.background <span class="operator">=</span> element_rect<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&#x27;black&#x27;</span><span class="punctuation">,</span> fill <span class="operator">=</span> <span class="string">&#x27;transparent&#x27;</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span> <span class="comment">#去掉背景框</span></span><br><span class="line">  theme<span class="punctuation">(</span>legend.key <span class="operator">=</span> element_rect<span class="punctuation">(</span>fill <span class="operator">=</span> <span class="string">&#x27;transparent&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span> legend.title <span class="operator">=</span> element_blank<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span> <span class="comment">#去掉图例标题及标签背景</span></span><br><span class="line">  labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&#x27;NMDS axis1&#x27;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&#x27;NMDS axis2&#x27;</span><span class="punctuation">,</span> title <span class="operator">=</span> paste<span class="punctuation">(</span><span class="string">&#x27;Stress =&#x27;</span><span class="punctuation">,</span> <span class="built_in">round</span><span class="punctuation">(</span>nmds1<span class="operator">$</span>stress<span class="punctuation">,</span> <span class="number">4</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  theme<span class="punctuation">(</span>plot.title <span class="operator">=</span> element_text<span class="punctuation">(</span>hjust <span class="operator">=</span> <span class="number">0.5</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="operator">+</span> <span class="comment">#标题居中</span></span><br><span class="line">  annotate<span class="punctuation">(</span><span class="string">&#x27;text&#x27;</span><span class="punctuation">,</span> label <span class="operator">=</span> <span class="string">&#x27;Diarrhea&#x27;</span><span class="punctuation">,</span> x <span class="operator">=</span> <span class="operator">-</span><span class="number">0.3</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="number">0.06</span><span class="punctuation">,</span> size <span class="operator">=</span> <span class="number">5</span><span class="punctuation">,</span> colour <span class="operator">=</span> <span class="string">&#x27;red&#x27;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  annotate<span class="punctuation">(</span><span class="string">&#x27;text&#x27;</span><span class="punctuation">,</span> label <span class="operator">=</span> <span class="string">&#x27;Healthy&#x27;</span><span class="punctuation">,</span> x <span class="operator">=</span> <span class="number">0.25</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="number">0.25</span><span class="punctuation">,</span> size <span class="operator">=</span> <span class="number">5</span><span class="punctuation">,</span> colour <span class="operator">=</span> <span class="string">&#x27;blue&#x27;</span><span class="punctuation">)</span> </span><br><span class="line">  <span class="comment">#geom_text(aes(label = group), data = species_site, color = &#x27;green4&#x27;, size = 2) #添加物种排序（top10 OTU，展示为标签）</span></span><br><span class="line">nmds_plot</span><br><span class="line"><span class="comment">#ggsave(&#x27;Genu_nmds.pdf&#x27;, nmds_plot, width = 6, height = 5)</span></span><br><span class="line">ggsave<span class="punctuation">(</span><span class="string">&#x27;NMDS.png&#x27;</span><span class="punctuation">,</span> nmds_plot<span class="punctuation">,</span> width <span class="operator">=</span> <span class="number">6</span><span class="punctuation">,</span> height <span class="operator">=</span> <span class="number">5</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##############################</span></span><br><span class="line"><span class="comment">##基于 Weighted UniFrac 距离的 NMDS 排序（测试）</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#加载函数</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#OTU 丰度表</span></span><br><span class="line">otu <span class="operator">&lt;-</span> read.delim<span class="punctuation">(</span><span class="string">&#x27;test_otu.txt&#x27;</span><span class="punctuation">,</span> row.names <span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span> sep <span class="operator">=</span> <span class="string">&#x27;\t&#x27;</span><span class="punctuation">,</span> stringsAsFactors <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">,</span> check.names <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span></span><br><span class="line">otu <span class="operator">&lt;-</span> data.frame<span class="punctuation">(</span>t<span class="punctuation">(</span>otu<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#进化树（使用 ape 包中的 read.tree() 读取，此处进化树必须为有根树）</span></span><br><span class="line">otu_tree <span class="operator">&lt;-</span> read.tree<span class="punctuation">(</span><span class="string">&#x27;test_tree.tre&#x27;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#距离矩阵（weighted unifrac 距离矩阵，使用 GUniFrac 包中的命令计算）</span></span><br><span class="line">unifrac <span class="operator">&lt;-</span> GUniFrac<span class="punctuation">(</span>otu<span class="punctuation">,</span> otu_tree<span class="punctuation">)</span><span class="operator">$</span>unifracs</span><br><span class="line">wei_unif_dis <span class="operator">&lt;-</span> as.dist<span class="punctuation">(</span>unifrac<span class="punctuation">[</span><span class="punctuation">,</span> <span class="punctuation">,</span> <span class="string">&#x27;d_1&#x27;</span><span class="punctuation">]</span><span class="punctuation">)</span> <span class="comment">#加权</span></span><br><span class="line">unwei_unif_dis <span class="operator">&lt;-</span> as.dist<span class="punctuation">(</span>unifrac<span class="punctuation">[</span><span class="punctuation">,</span> <span class="punctuation">,</span> <span class="string">&#x27;d_UW&#x27;</span><span class="punctuation">]</span><span class="punctuation">)</span> <span class="comment">#非加权</span></span><br><span class="line"><span class="comment">#以非加权为例矩阵形式保存</span></span><br><span class="line">unwei_unif_dis <span class="operator">&lt;-</span> as.matrix<span class="punctuation">(</span>unwei_unif_dis<span class="punctuation">)</span></span><br><span class="line">write.table<span class="punctuation">(</span>unwei_unif_dis<span class="punctuation">,</span><span class="string">&#x27;unweighted-unifrac_distance.txt&#x27;</span><span class="punctuation">,</span>col.names <span class="operator">=</span> <span class="literal">NA</span> <span class="punctuation">,</span> sep <span class="operator">=</span> <span class="string">&#x27;\t&#x27;</span><span class="punctuation">,</span><span class="built_in">quote</span><span class="operator">=</span><span class="literal">FALSE</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#分组文件</span></span><br><span class="line">group <span class="operator">&lt;-</span> read.delim<span class="punctuation">(</span><span class="string">&#x27;test_group.txt&#x27;</span><span class="punctuation">,</span> sep <span class="operator">=</span> <span class="string">&#x27;\t&#x27;</span><span class="punctuation">,</span> stringsAsFactors <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#NMDS 排序（基于 OTU 丰度表和进化树文件，使用 weighted unifrac 距离）</span></span><br><span class="line">nmds_un1 <span class="operator">&lt;-</span> metaMDS2<span class="punctuation">(</span>wei_unif_dis<span class="punctuation">)</span></span><br><span class="line">plot<span class="punctuation">(</span>nmds_un1<span class="punctuation">,</span> type <span class="operator">=</span> <span class="string">&#x27;t&#x27;</span><span class="punctuation">,</span> main <span class="operator">=</span> paste<span class="punctuation">(</span><span class="string">&#x27;Stress =&#x27;</span><span class="punctuation">,</span> <span class="built_in">round</span><span class="punctuation">(</span>nmds2<span class="operator">$</span>stress<span class="punctuation">,</span> <span class="number">4</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment">#NMDS 排序（直接基于 unweighted unifrac 距离矩阵）</span></span><br><span class="line">nmds_un2 <span class="operator">&lt;-</span> metaMDS<span class="punctuation">(</span>unwei_unif_dis<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#分别作图展示</span></span><br><span class="line">sample_site2<span class="operator">&lt;-</span> data.frame<span class="punctuation">(</span>nmds_un1<span class="operator">$</span>point<span class="punctuation">)</span>; sample_site2 <span class="operator">&lt;-</span> data.frame<span class="punctuation">(</span>nmds_un2<span class="operator">$</span>point<span class="punctuation">)</span></span><br><span class="line">sample_site1<span class="operator">$</span><span class="built_in">names</span> <span class="operator">&lt;-</span> rownames<span class="punctuation">(</span>sample_site1<span class="punctuation">)</span>; sample_site2<span class="operator">$</span><span class="built_in">names</span> <span class="operator">&lt;-</span> rownames<span class="punctuation">(</span>sample_site2<span class="punctuation">)</span></span><br><span class="line"><span class="built_in">names</span><span class="punctuation">(</span>sample_site1<span class="punctuation">)</span><span class="punctuation">[</span><span class="number">1</span><span class="operator">:</span><span class="number">2</span><span class="punctuation">]</span> <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;NMDS1&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;NMDS2&#x27;</span><span class="punctuation">)</span>; <span class="built_in">names</span><span class="punctuation">(</span>sample_site2<span class="punctuation">)</span><span class="punctuation">[</span><span class="number">1</span><span class="operator">:</span><span class="number">2</span><span class="punctuation">]</span> <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;NMDS1&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;NMDS2&#x27;</span><span class="punctuation">)</span></span><br><span class="line">sample_site1 <span class="operator">&lt;-</span> merge<span class="punctuation">(</span>sample_site1<span class="punctuation">,</span> group<span class="punctuation">,</span> by <span class="operator">=</span> <span class="string">&#x27;names&#x27;</span><span class="punctuation">,</span> all.x <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span>; sample_site2 <span class="operator">&lt;-</span> merge<span class="punctuation">(</span>sample_site2<span class="punctuation">,</span> group<span class="punctuation">,</span> by <span class="operator">=</span> <span class="string">&#x27;names&#x27;</span><span class="punctuation">,</span> all.x <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">ggplot<span class="punctuation">(</span>sample_site1<span class="punctuation">,</span> aes<span class="punctuation">(</span>NMDS1<span class="punctuation">,</span> NMDS2<span class="punctuation">,</span> color <span class="operator">=</span> group<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span> geom_point<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line">ggplot<span class="punctuation">(</span>sample_site2<span class="punctuation">,</span> aes<span class="punctuation">(</span>NMDS1<span class="punctuation">,</span> NMDS2<span class="punctuation">,</span> color <span class="operator">=</span> group<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span> geom_point<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong>nmds实战例子（基于OTU表）</strong></p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#载入分析包</span></span><br><span class="line">library<span class="punctuation">(</span>vegan<span class="punctuation">)</span></span><br><span class="line"><span class="comment">#载入分析数据</span></span><br><span class="line">otu <span class="operator">&lt;-</span> read.table<span class="punctuation">(</span><span class="string">&quot;otu.txt&quot;</span><span class="punctuation">,</span>header<span class="operator">=</span><span class="built_in">T</span><span class="punctuation">,</span>row.names<span class="operator">=</span><span class="number">1</span><span class="punctuation">,</span>sep<span class="operator">=</span><span class="string">&quot;\t&quot;</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment">#对分析数据进行转置</span></span><br><span class="line">otu <span class="operator">&lt;-</span> t<span class="punctuation">(</span>otu<span class="punctuation">)</span></span><br><span class="line"><span class="comment">#进行NMDS分析</span></span><br><span class="line">nmds <span class="operator">&lt;-</span> metaMDS<span class="punctuation">(</span>otu<span class="punctuation">)</span></span><br><span class="line"><span class="comment">#保存stress结果</span></span><br><span class="line">capture.output<span class="punctuation">(</span>nmds<span class="punctuation">,</span>file <span class="operator">=</span> <span class="string">&quot;Stress.txt&quot;</span> <span class="punctuation">)</span></span><br><span class="line"><span class="comment">#保存scores结果</span></span><br><span class="line">nmds_scores<span class="operator">=</span>scores<span class="punctuation">(</span>nmds<span class="punctuation">,</span> choices <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">write.table<span class="punctuation">(</span>nmds_scores<span class="punctuation">,</span>file<span class="operator">=</span><span class="string">&quot;NMDS_scores.txt&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">scores <span class="operator">&lt;-</span>  read.table<span class="punctuation">(</span><span class="string">&quot;NMDS_scores.txt&quot;</span><span class="punctuation">,</span>header<span class="operator">=</span><span class="built_in">T</span><span class="punctuation">)</span></span><br><span class="line">groups <span class="operator">&lt;-</span> read.table<span class="punctuation">(</span><span class="string">&quot;group1.txt&quot;</span><span class="punctuation">,</span> head<span class="operator">=</span><span class="built_in">F</span><span class="punctuation">,</span>sep <span class="operator">=</span> <span class="string">&quot;\t&quot;</span><span class="punctuation">,</span>colClasses <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;character&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">pich<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">21</span><span class="operator">:</span><span class="number">24</span><span class="punctuation">)</span></span><br><span class="line">cbbPalette <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;#E69F00&quot;</span><span class="punctuation">,</span> <span class="string">&quot;#56B4E9&quot;</span><span class="punctuation">,</span> <span class="string">&quot;#009E73&quot;</span><span class="punctuation">,</span> <span class="string">&quot;#F0E442&quot;</span><span class="punctuation">)</span></span><br><span class="line">Palette <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;#000000&quot;</span><span class="punctuation">,</span><span class="string">&quot;#000000&quot;</span><span class="punctuation">,</span><span class="string">&quot;#000000&quot;</span><span class="punctuation">,</span><span class="string">&quot;#000000&quot;</span><span class="punctuation">)</span></span><br><span class="line">plotdata <span class="operator">&lt;-</span> data.frame<span class="punctuation">(</span>rownames<span class="punctuation">(</span>scores<span class="punctuation">)</span><span class="punctuation">,</span>scores<span class="operator">$</span>NMDS1<span class="punctuation">,</span>scores<span class="operator">$</span>NMDS2<span class="punctuation">,</span>groups<span class="operator">$</span>V2<span class="punctuation">)</span></span><br><span class="line">colnames<span class="punctuation">(</span>plotdata<span class="punctuation">)</span><span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;sample&quot;</span><span class="punctuation">,</span><span class="string">&quot;MDS1&quot;</span><span class="punctuation">,</span><span class="string">&quot;MDS2&quot;</span><span class="punctuation">,</span><span class="string">&quot;group&quot;</span><span class="punctuation">)</span></span><br><span class="line">plotdata<span class="operator">$</span>sample <span class="operator">&lt;-</span> factor<span class="punctuation">(</span>plotdata<span class="operator">$</span>sample<span class="punctuation">)</span></span><br><span class="line">plotdata<span class="operator">$</span>MDS1 <span class="operator">&lt;-</span> <span class="built_in">as.numeric</span><span class="punctuation">(</span>as.vector<span class="punctuation">(</span>plotdata<span class="operator">$</span>MDS1<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">plotdata<span class="operator">$</span>MDS2 <span class="operator">&lt;-</span> <span class="built_in">as.numeric</span><span class="punctuation">(</span>as.vector<span class="punctuation">(</span>plotdata<span class="operator">$</span>MDS2<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">library<span class="punctuation">(</span>ggplot2<span class="punctuation">)</span></span><br><span class="line">ggplot<span class="punctuation">(</span>plotdata<span class="punctuation">,</span> aes<span class="punctuation">(</span>MDS1<span class="punctuation">,</span> MDS2<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_point<span class="punctuation">(</span>aes<span class="punctuation">(</span>colour<span class="operator">=</span>group<span class="punctuation">,</span>shape<span class="operator">=</span>group<span class="punctuation">,</span>fill<span class="operator">=</span>group<span class="punctuation">)</span><span class="punctuation">,</span>size<span class="operator">=</span><span class="number">10</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  scale_shape_manual<span class="punctuation">(</span>values<span class="operator">=</span>pich<span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  scale_colour_manual<span class="punctuation">(</span>values<span class="operator">=</span>Palette<span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  scale_fill_manual<span class="punctuation">(</span>values<span class="operator">=</span>cbbPalette<span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  labs<span class="punctuation">(</span>title<span class="operator">=</span><span class="string">&quot;NMDS Plot&quot;</span><span class="punctuation">)</span> <span class="operator">+</span> xlab<span class="punctuation">(</span>paste<span class="punctuation">(</span><span class="string">&quot;MDS1&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span> ylab<span class="punctuation">(</span>paste<span class="punctuation">(</span><span class="string">&quot;MDS2&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  theme<span class="punctuation">(</span>text<span class="operator">=</span>element_text<span class="punctuation">(</span>size<span class="operator">=</span><span class="number">18</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  geom_vline<span class="punctuation">(</span>aes<span class="punctuation">(</span>xintercept <span class="operator">=</span> <span class="number">0</span><span class="punctuation">)</span><span class="punctuation">,</span>linetype<span class="operator">=</span><span class="string">&quot;dotted&quot;</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  geom_hline<span class="punctuation">(</span>aes<span class="punctuation">(</span>yintercept <span class="operator">=</span> <span class="number">0</span><span class="punctuation">)</span><span class="punctuation">,</span>linetype<span class="operator">=</span><span class="string">&quot;dotted&quot;</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  geom_text<span class="punctuation">(</span>aes<span class="punctuation">(</span>x<span class="operator">=</span><span class="built_in">max</span><span class="punctuation">(</span>MDS1<span class="punctuation">)</span><span class="punctuation">,</span>y<span class="operator">=</span><span class="built_in">max</span><span class="punctuation">(</span>MDS2<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">,</span>hjust<span class="operator">=</span><span class="number">1</span><span class="punctuation">,</span>vjust<span class="operator">=</span><span class="number">0</span><span class="punctuation">,</span>size<span class="operator">=</span><span class="number">8</span><span class="punctuation">,</span>label<span class="operator">=</span>paste<span class="punctuation">(</span><span class="string">&quot;Stress = &quot;</span><span class="punctuation">,</span><span class="built_in">round</span><span class="punctuation">(</span>nmds<span class="operator">$</span>stress<span class="punctuation">,</span><span class="number">3</span><span class="punctuation">)</span><span class="punctuation">,</span>sep <span class="operator">=</span> <span class="string">&quot;&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span>colour<span class="operator">=</span><span class="string">&quot;black&quot;</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  theme<span class="punctuation">(</span>panel.background <span class="operator">=</span> element_rect<span class="punctuation">(</span>fill<span class="operator">=</span><span class="string">&#x27;white&#x27;</span><span class="punctuation">,</span> colour<span class="operator">=</span><span class="string">&#x27;black&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span> panel.grid<span class="operator">=</span>element_blank<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">,</span> </span><br><span class="line">        axis.title <span class="operator">=</span> element_text<span class="punctuation">(</span>color<span class="operator">=</span><span class="string">&#x27;black&#x27;</span><span class="punctuation">,</span>size<span class="operator">=</span><span class="number">18</span><span class="punctuation">)</span><span class="punctuation">,</span>axis.ticks.length <span class="operator">=</span> unit<span class="punctuation">(</span><span class="number">0.4</span><span class="punctuation">,</span><span class="string">&quot;lines&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span> </span><br><span class="line">        axis.ticks <span class="operator">=</span> element_line<span class="punctuation">(</span>color<span class="operator">=</span><span class="string">&#x27;black&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span>axis.line <span class="operator">=</span> element_line<span class="punctuation">(</span>colour <span class="operator">=</span> <span class="string">&quot;black&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span> </span><br><span class="line">        axis.title.x<span class="operator">=</span>element_text<span class="punctuation">(</span>colour<span class="operator">=</span><span class="string">&#x27;black&#x27;</span><span class="punctuation">,</span> size<span class="operator">=</span><span class="number">18</span><span class="punctuation">)</span><span class="punctuation">,</span>axis.title.y<span class="operator">=</span>element_text<span class="punctuation">(</span>colour<span class="operator">=</span><span class="string">&#x27;black&#x27;</span><span class="punctuation">,</span> size<span class="operator">=</span><span class="number">18</span><span class="punctuation">)</span><span class="punctuation">,</span>axis.text<span class="operator">=</span>element_text<span class="punctuation">(</span>colour<span class="operator">=</span><span class="string">&#x27;black&#x27;</span><span class="punctuation">,</span>size<span class="operator">=</span><span class="number">18</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">        legend.title<span class="operator">=</span>element_blank<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">,</span>legend.text<span class="operator">=</span>element_text<span class="punctuation">(</span>family<span class="operator">=</span><span class="string">&quot;Arial&quot;</span><span class="punctuation">,</span> size<span class="operator">=</span><span class="number">18</span><span class="punctuation">)</span><span class="punctuation">,</span>legend.key<span class="operator">=</span>element_blank<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  theme<span class="punctuation">(</span>plot.title <span class="operator">=</span> element_text<span class="punctuation">(</span>size<span class="operator">=</span><span class="number">20</span><span class="punctuation">,</span>colour <span class="operator">=</span> <span class="string">&quot;black&quot;</span><span class="punctuation">,</span>face <span class="operator">=</span> <span class="string">&quot;bold&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="apcoa分析">aPCOA分析</h4>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#用法</span></span><br><span class="line">aPCoA<span class="punctuation">(</span>formula<span class="punctuation">,</span>data<span class="punctuation">,</span>maincov<span class="punctuation">,</span>drawEllipse<span class="operator">=</span><span class="literal">TRUE</span><span class="punctuation">,</span>drawCenter<span class="operator">=</span><span class="literal">TRUE</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#formula：Y~ A,Y为不像似性距离。</span></span><br><span class="line"><span class="comment">#data: 需要包含所有的协变量</span></span><br><span class="line"><span class="comment">#maincov： 研究的目标协变量，必须是因子</span></span><br><span class="line"><span class="comment">#drawEllipse: 95%置信椭圆</span></span><br><span class="line"><span class="comment">#drawCenter：中心点和其他点连线</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#实例</span></span><br><span class="line">library<span class="punctuation">(</span>mvabund<span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>vegan<span class="punctuation">)</span></span><br><span class="line"><span class="comment">#install.packages(&quot;aPCoA&quot;)</span></span><br><span class="line">library<span class="punctuation">(</span>aPCoA<span class="punctuation">)</span></span><br><span class="line">data<span class="punctuation">(</span><span class="string">&quot;Tasmania&quot;</span><span class="punctuation">)</span></span><br><span class="line">data<span class="operator">&lt;-</span>data.frame<span class="punctuation">(</span>treatment<span class="operator">=</span>Tasmania<span class="operator">$</span>treatment<span class="punctuation">,</span>block<span class="operator">=</span>Tasmania<span class="operator">$</span>block<span class="punctuation">)</span></span><br><span class="line">data</span><br><span class="line"></span><br><span class="line">       treatment block</span><br><span class="line">B1D1   Disturbed     <span class="number">1</span></span><br><span class="line">B1D2   Disturbed     <span class="number">1</span></span><br><span class="line"></span><br><span class="line">bray<span class="operator">&lt;-</span>vegdist<span class="punctuation">(</span>Tasmania<span class="operator">$</span>abund<span class="punctuation">,</span> method<span class="operator">=</span><span class="string">&quot;bray&quot;</span><span class="punctuation">)</span></span><br><span class="line">rownames<span class="punctuation">(</span>data<span class="punctuation">)</span><span class="operator">&lt;-</span>rownames<span class="punctuation">(</span>as.matrix<span class="punctuation">(</span>bray<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">opar<span class="operator">&lt;-</span>par<span class="punctuation">(</span>mfrow<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">          mar<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">3.1</span><span class="punctuation">,</span> <span class="number">3.1</span><span class="punctuation">,</span> <span class="number">3.1</span><span class="punctuation">,</span> <span class="number">5.1</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">          mgp<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">2</span><span class="punctuation">,</span> <span class="number">0.5</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">          oma<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">,</span> <span class="number">4</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment">#treatment为研究的目标协变量，排除其他协变量的影响</span></span><br><span class="line">result<span class="operator">&lt;-</span>aPCoA<span class="punctuation">(</span>bray<span class="operator">~</span>block<span class="punctuation">,</span>data<span class="punctuation">,</span>treatment<span class="punctuation">)</span></span><br><span class="line">par<span class="punctuation">(</span>opar<span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<h4 id="pcoa分析"><strong>PCOA分析</strong></h4>
<p><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/aCyx_r81nRd6W2PHVvuSyw">PCOA示例</a></p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line">library<span class="punctuation">(</span>vegan<span class="punctuation">)</span>	<span class="comment">#排序分析</span></span><br><span class="line"><span class="comment">#无论使用OTU丰度表作为输入文件还是现有的距离矩阵作为输入文件，PCoA排序的结果是完全一致的。</span></span><br><span class="line">rm<span class="punctuation">(</span><span class="built_in">list</span> <span class="operator">=</span> ls<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">library<span class="punctuation">(</span>ggplot2<span class="punctuation">)</span>	<span class="comment">#作图</span></span><br><span class="line">library<span class="punctuation">(</span>ape<span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>plyr<span class="punctuation">)</span></span><br><span class="line"><span class="comment">#OTU 丰度表</span></span><br><span class="line">otu <span class="operator">&lt;-</span> read.delim<span class="punctuation">(</span><span class="string">&#x27;Genu_0.001.txt&#x27;</span><span class="punctuation">,</span> row.names <span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span> sep <span class="operator">=</span> <span class="string">&#x27;\t&#x27;</span><span class="punctuation">,</span> stringsAsFactors <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">,</span> check.names <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span></span><br><span class="line">otu <span class="operator">&lt;-</span> data.frame<span class="punctuation">(</span>t<span class="punctuation">(</span>otu<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment">#或者现有的距离矩阵</span></span><br><span class="line">dis <span class="operator">&lt;-</span> read.delim<span class="punctuation">(</span><span class="string">&#x27;bray-curtis_distance.txt&#x27;</span><span class="punctuation">,</span> row.names <span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span> sep <span class="operator">=</span> <span class="string">&#x27;\t&#x27;</span><span class="punctuation">,</span> stringsAsFactors <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">,</span> check.names <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment">#样本分组文件</span></span><br><span class="line">group <span class="operator">&lt;-</span> read.delim<span class="punctuation">(</span><span class="string">&#x27;sample.txt&#x27;</span><span class="punctuation">,</span> sep <span class="operator">=</span> <span class="string">&#x27;\t&#x27;</span><span class="punctuation">,</span> stringsAsFactors <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#物种数据 Hellinger 预转化（处理包含很多 0 值的群落物种数据时，推荐使用）</span></span><br><span class="line">otu<span class="operator">&lt;-</span> decostand<span class="punctuation">(</span>otu<span class="punctuation">,</span> method <span class="operator">=</span> <span class="string">&#x27;hellinger&#x27;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#排序（基于 OTU 丰度表）</span></span><br><span class="line">distance <span class="operator">&lt;-</span> vegdist<span class="punctuation">(</span>otu<span class="punctuation">,</span> method <span class="operator">=</span> <span class="string">&#x27;bray&#x27;</span><span class="punctuation">)</span></span><br><span class="line">bray <span class="operator">&lt;-</span> as.matrix<span class="punctuation">(</span>bray_dis<span class="punctuation">)</span></span><br><span class="line">write.table<span class="punctuation">(</span>bray<span class="punctuation">,</span> <span class="string">&#x27;bray-curtis_distance.txt&#x27;</span><span class="punctuation">,</span> col.names <span class="operator">=</span> <span class="literal">NA</span><span class="punctuation">,</span> sep <span class="operator">=</span> <span class="string">&#x27;\t&#x27;</span><span class="punctuation">,</span> <span class="built_in">quote</span> <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span></span><br><span class="line">pcoa <span class="operator">&lt;-</span> cmdscale<span class="punctuation">(</span>distance<span class="punctuation">,</span> k <span class="operator">=</span> <span class="punctuation">(</span>nrow<span class="punctuation">(</span>otu<span class="punctuation">)</span> <span class="operator">-</span> <span class="number">1</span><span class="punctuation">)</span><span class="punctuation">,</span> eig <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment">#或者（基于现有的距离矩阵）</span></span><br><span class="line">pcoa <span class="operator">&lt;-</span> cmdscale<span class="punctuation">(</span>as.dist<span class="punctuation">(</span>dis<span class="punctuation">)</span><span class="punctuation">,</span> k <span class="operator">=</span> <span class="punctuation">(</span>nrow<span class="punctuation">(</span>dis<span class="punctuation">)</span> <span class="operator">-</span> <span class="number">1</span><span class="punctuation">)</span><span class="punctuation">,</span> eig <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#对于上述计算得到的样本间距离 distance，可转换为矩阵格式后输出，例如输出为 csv 格式</span></span><br><span class="line">write.csv<span class="punctuation">(</span>as.matrix<span class="punctuation">(</span>distance<span class="punctuation">)</span><span class="punctuation">,</span> <span class="string">&#x27;distance.csv&#x27;</span><span class="punctuation">,</span> <span class="built_in">quote</span> <span class="operator">=</span> <span class="built_in">F</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#使用vegan内置命令ordiplot()简要做图展示</span></span><br><span class="line">ordiplot<span class="punctuation">(</span>scores<span class="punctuation">(</span>pcoa<span class="punctuation">)</span><span class="punctuation">[</span> <span class="punctuation">,</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span> <span class="number">2</span><span class="punctuation">)</span><span class="punctuation">]</span><span class="punctuation">,</span> type <span class="operator">=</span> <span class="string">&#x27;t&#x27;</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment">#或者查看排序简要</span></span><br><span class="line">summary<span class="punctuation">(</span>pcoa<span class="punctuation">)</span></span><br><span class="line"><span class="comment">#查看主要排序轴的特征值和各样本在各排序轴中的坐标值</span></span><br><span class="line">pcoa<span class="operator">$</span>eig</span><br><span class="line">point <span class="operator">&lt;-</span> data.frame<span class="punctuation">(</span>pcoa<span class="operator">$</span>point<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#可将样本坐标转化为数据框后导出，例如导出为 csv 格式</span></span><br><span class="line">write.csv<span class="punctuation">(</span>point<span class="punctuation">,</span> <span class="string">&#x27;pcoa.sample.csv&#x27;</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment">#可使用 wascores() 计算物种坐标</span></span><br><span class="line">species <span class="operator">&lt;-</span> wascores<span class="punctuation">(</span>pcoa<span class="operator">$</span>points<span class="punctuation">[</span><span class="punctuation">,</span><span class="number">1</span><span class="operator">:</span><span class="number">2</span><span class="punctuation">]</span><span class="punctuation">,</span> otu<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#可将物种坐标转化为数据框后导出，例如导出为 csv 格式</span></span><br><span class="line">write.csv<span class="punctuation">(</span>species<span class="punctuation">,</span> <span class="string">&#x27;pcoa.otu.csv&#x27;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#使用ggplot2画图</span></span><br><span class="line"><span class="comment">#坐标轴解释量（前两轴）</span></span><br><span class="line">pcoa_eig <span class="operator">&lt;-</span> <span class="punctuation">(</span>pcoa<span class="operator">$</span>eig<span class="punctuation">)</span><span class="punctuation">[</span><span class="number">1</span><span class="operator">:</span><span class="number">2</span><span class="punctuation">]</span> <span class="operator">/</span> <span class="built_in">sum</span><span class="punctuation">(</span>pcoa<span class="operator">$</span>eig<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#提取样本点坐标（前两轴）</span></span><br><span class="line">sample_site <span class="operator">&lt;-</span> data.frame<span class="punctuation">(</span><span class="punctuation">&#123;</span>pcoa<span class="operator">$</span>point<span class="punctuation">&#125;</span><span class="punctuation">)</span><span class="punctuation">[</span><span class="number">1</span><span class="operator">:</span><span class="number">2</span><span class="punctuation">]</span></span><br><span class="line">sample_site<span class="operator">$</span><span class="built_in">names</span> <span class="operator">&lt;-</span> rownames<span class="punctuation">(</span>sample_site<span class="punctuation">)</span></span><br><span class="line"><span class="built_in">names</span><span class="punctuation">(</span>sample_site<span class="punctuation">)</span><span class="punctuation">[</span><span class="number">1</span><span class="operator">:</span><span class="number">2</span><span class="punctuation">]</span> <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;PCoA1&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;PCoA2&#x27;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#为样本点坐标添加分组信息</span></span><br><span class="line">sample_site <span class="operator">&lt;-</span> merge<span class="punctuation">(</span>sample_site<span class="punctuation">,</span> group<span class="punctuation">,</span> by <span class="operator">=</span> <span class="string">&#x27;names&#x27;</span><span class="punctuation">,</span> all.x <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#可选输出，例如输出为 csv 格式</span></span><br><span class="line">write.csv<span class="punctuation">(</span>sample_site<span class="punctuation">,</span> <span class="string">&#x27;sample_site.csv&#x27;</span><span class="punctuation">,</span> <span class="built_in">quote</span> <span class="operator">=</span> <span class="built_in">F</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">sample_site<span class="operator">$</span>group <span class="operator">&lt;-</span> factor<span class="punctuation">(</span>sample_site<span class="operator">$</span>group<span class="punctuation">,</span> levels <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;D&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;H&#x27;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment">##ddply() 计算同分组样本排序坐标顶点</span></span><br><span class="line">group_border <span class="operator">&lt;-</span> ddply<span class="punctuation">(</span>sample_site<span class="punctuation">,</span> <span class="string">&#x27;group&#x27;</span><span class="punctuation">,</span> <span class="keyword">function</span><span class="punctuation">(</span>df<span class="punctuation">)</span> df<span class="punctuation">[</span>chull<span class="punctuation">(</span>df<span class="punctuation">[[</span><span class="number">2</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">,</span> df<span class="punctuation">[[</span><span class="number">3</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">,</span> <span class="punctuation">]</span><span class="punctuation">)</span><span class="comment">##df[[2]]、df[[3]]代表第二、三列，即PCoA1和PCoA2坐标列</span></span><br><span class="line"><span class="comment">#绘图</span></span><br><span class="line">pcoa_plot <span class="operator">&lt;-</span> ggplot<span class="punctuation">(</span>sample_site<span class="punctuation">,</span> aes<span class="punctuation">(</span>PCoA1<span class="punctuation">,</span> PCoA2<span class="punctuation">,</span> group <span class="operator">=</span> group<span class="punctuation">,</span>color<span class="operator">=</span>group<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  theme<span class="punctuation">(</span>panel.grid <span class="operator">=</span> element_line<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&#x27;gray&#x27;</span><span class="punctuation">,</span> linetype <span class="operator">=</span> <span class="number">2</span><span class="punctuation">,</span> size <span class="operator">=</span> <span class="number">0.1</span><span class="punctuation">)</span><span class="punctuation">,</span> panel.background <span class="operator">=</span> element_rect<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&#x27;black&#x27;</span><span class="punctuation">,</span> fill <span class="operator">=</span> <span class="string">&#x27;transparent&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span> legend.key <span class="operator">=</span> element_rect<span class="punctuation">(</span>fill <span class="operator">=</span> <span class="string">&#x27;transparent&#x27;</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span> <span class="comment">#去掉背景框</span></span><br><span class="line">  geom_vline<span class="punctuation">(</span>xintercept <span class="operator">=</span> <span class="number">0</span><span class="punctuation">,</span> color <span class="operator">=</span> <span class="string">&#x27;gray&#x27;</span><span class="punctuation">,</span> size <span class="operator">=</span> <span class="number">0.4</span><span class="punctuation">)</span> <span class="operator">+</span> </span><br><span class="line">  <span class="comment">#geom_polygon(data = group_border, aes(fill = group)) + #绘制多边形区域</span></span><br><span class="line">  stat_ellipse<span class="punctuation">(</span>level <span class="operator">=</span> <span class="number">0.95</span><span class="punctuation">,</span> show.legend <span class="operator">=</span> <span class="built_in">F</span><span class="punctuation">)</span> <span class="operator">+</span> <span class="comment">#绘制置信椭圆</span></span><br><span class="line">  geom_hline<span class="punctuation">(</span>yintercept <span class="operator">=</span> <span class="number">0</span><span class="punctuation">,</span> color <span class="operator">=</span> <span class="string">&#x27;gray&#x27;</span><span class="punctuation">,</span> size <span class="operator">=</span> <span class="number">0.4</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  geom_point<span class="punctuation">(</span>aes<span class="punctuation">(</span>color <span class="operator">=</span> group<span class="punctuation">)</span><span class="punctuation">,</span> size <span class="operator">=</span> <span class="number">2</span><span class="punctuation">,</span> alpha <span class="operator">=</span> <span class="number">0.8</span><span class="punctuation">)</span><span class="operator">+</span><span class="comment">#可在这里修改点的透明度、大小</span></span><br><span class="line"> <span class="comment"># scale_shape_manual(values = c(17, 16))+#可在这里修改点的形状</span></span><br><span class="line">  scale_color_manual<span class="punctuation">(</span>values <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;red&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;blue&#x27;</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span> <span class="comment">#可在这里修改点的颜色</span></span><br><span class="line">  <span class="comment">#theme(legend.position = &#x27;none&#x27;) + # 是否展示图例</span></span><br><span class="line">  scale_fill_manual<span class="punctuation">(</span>values <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;#C673FF2E&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;#73D5FF2E&#x27;</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span> <span class="comment">#可在这里修改区块的颜色</span></span><br><span class="line">  guides<span class="punctuation">(</span>fill <span class="operator">=</span> guide_legend<span class="punctuation">(</span>order <span class="operator">=</span> <span class="number">1</span><span class="punctuation">)</span><span class="punctuation">,</span> shape <span class="operator">=</span> guide_legend<span class="punctuation">(</span>order <span class="operator">=</span> <span class="number">2</span><span class="punctuation">)</span><span class="punctuation">,</span> color <span class="operator">=</span> guide_legend<span class="punctuation">(</span>order <span class="operator">=</span> <span class="number">3</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span> <span class="comment">#设置图例展示顺序</span></span><br><span class="line">  labs<span class="punctuation">(</span>x <span class="operator">=</span> paste<span class="punctuation">(</span><span class="string">&#x27;PCoA axis1: &#x27;</span><span class="punctuation">,</span> <span class="built_in">round</span><span class="punctuation">(</span><span class="number">100</span> <span class="operator">*</span> pcoa_eig<span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">,</span> <span class="number">2</span><span class="punctuation">)</span><span class="punctuation">,</span> <span class="string">&#x27;%&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span> y <span class="operator">=</span> paste<span class="punctuation">(</span><span class="string">&#x27;PCoA axis2: &#x27;</span><span class="punctuation">,</span> <span class="built_in">round</span><span class="punctuation">(</span><span class="number">100</span> <span class="operator">*</span> pcoa_eig<span class="punctuation">[</span><span class="number">2</span><span class="punctuation">]</span><span class="punctuation">,</span> <span class="number">2</span><span class="punctuation">)</span><span class="punctuation">,</span> <span class="string">&#x27;%&#x27;</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">annotate<span class="punctuation">(</span><span class="string">&#x27;text&#x27;</span><span class="punctuation">,</span> label <span class="operator">=</span> <span class="string">&#x27;Diarrhea&#x27;</span><span class="punctuation">,</span> x <span class="operator">=</span> <span class="operator">-</span><span class="number">0.19</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="number">0.06</span><span class="punctuation">,</span> size <span class="operator">=</span> <span class="number">5</span><span class="punctuation">,</span> colour <span class="operator">=</span> <span class="string">&#x27;red&#x27;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  annotate<span class="punctuation">(</span><span class="string">&#x27;text&#x27;</span><span class="punctuation">,</span> label <span class="operator">=</span> <span class="string">&#x27;Healthy&#x27;</span><span class="punctuation">,</span> x <span class="operator">=</span> <span class="number">0.1</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="number">0.20</span><span class="punctuation">,</span> size <span class="operator">=</span> <span class="number">5</span><span class="punctuation">,</span> colour <span class="operator">=</span> <span class="string">&#x27;blue&#x27;</span><span class="punctuation">)</span> </span><br><span class="line"></span><br><span class="line">pcoa_plot</span><br><span class="line">ggsave<span class="punctuation">(</span><span class="string">&#x27;genu_pcoa.pdf&#x27;</span><span class="punctuation">,</span> pcoa_plot<span class="punctuation">,</span> width <span class="operator">=</span> <span class="number">6</span><span class="punctuation">,</span> height <span class="operator">=</span> <span class="number">5</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<p><strong>pcoa实战（基于OTU表）</strong></p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br></pre></td><td class="code"><pre><span class="line">setwd<span class="punctuation">(</span><span class="string">&#x27;./Script/Red_queen/PCOA/&#x27;</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment">#载入绘图所需的包</span></span><br><span class="line">library<span class="punctuation">(</span>vegan<span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>ape<span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>ggplot2<span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>ggrepel<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#分组数较少、组内生物学重复较多</span></span><br><span class="line">data <span class="operator">&lt;-</span> read.csv<span class="punctuation">(</span><span class="string">&quot;otu.txt&quot;</span><span class="punctuation">,</span> head<span class="operator">=</span><span class="literal">TRUE</span><span class="punctuation">,</span>sep<span class="operator">=</span><span class="string">&quot;\t&quot;</span><span class="punctuation">,</span>row.names <span class="operator">=</span> <span class="number">1</span><span class="punctuation">)</span></span><br><span class="line">groups <span class="operator">&lt;-</span> read.table<span class="punctuation">(</span><span class="string">&quot;group1.txt&quot;</span><span class="punctuation">,</span>sep <span class="operator">=</span> <span class="string">&quot;\t&quot;</span><span class="punctuation">,</span>header <span class="operator">=</span> <span class="built_in">F</span><span class="punctuation">,</span>colClasses <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;character&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">groups <span class="operator">&lt;-</span> as.list<span class="punctuation">(</span>groups<span class="punctuation">)</span></span><br><span class="line">data <span class="operator">&lt;-</span> t<span class="punctuation">(</span>data<span class="punctuation">)</span></span><br><span class="line">data<span class="punctuation">[</span><span class="built_in">is.na</span><span class="punctuation">(</span>data<span class="punctuation">)</span><span class="punctuation">]</span> <span class="operator">&lt;-</span> <span class="number">0</span></span><br><span class="line">data <span class="operator">&lt;-</span> vegdist<span class="punctuation">(</span>data<span class="punctuation">,</span>method <span class="operator">=</span> <span class="string">&quot;bray&quot;</span><span class="punctuation">)</span></span><br><span class="line">pcoa<span class="operator">&lt;-</span> pcoa<span class="punctuation">(</span>data<span class="punctuation">,</span> correction <span class="operator">=</span> <span class="string">&quot;none&quot;</span><span class="punctuation">,</span> rn <span class="operator">=</span> <span class="literal">NULL</span><span class="punctuation">)</span></span><br><span class="line">PC1 <span class="operator">=</span> pcoa<span class="operator">$</span>vectors<span class="punctuation">[</span><span class="punctuation">,</span><span class="number">1</span><span class="punctuation">]</span></span><br><span class="line">PC2 <span class="operator">=</span> pcoa<span class="operator">$</span>vectors<span class="punctuation">[</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">]</span></span><br><span class="line">plotdata <span class="operator">&lt;-</span> data.frame<span class="punctuation">(</span>rownames<span class="punctuation">(</span>pcoa<span class="operator">$</span>vectors<span class="punctuation">)</span><span class="punctuation">,</span>PC1<span class="punctuation">,</span>PC2<span class="punctuation">,</span>groups<span class="operator">$</span>V2<span class="punctuation">)</span></span><br><span class="line">colnames<span class="punctuation">(</span>plotdata<span class="punctuation">)</span> <span class="operator">&lt;-</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;sample&quot;</span><span class="punctuation">,</span><span class="string">&quot;PC1&quot;</span><span class="punctuation">,</span><span class="string">&quot;PC2&quot;</span><span class="punctuation">,</span><span class="string">&quot;group&quot;</span><span class="punctuation">)</span></span><br><span class="line">pich<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">21</span><span class="operator">:</span><span class="number">24</span><span class="punctuation">)</span></span><br><span class="line">cbbPalette <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;#E69F00&quot;</span><span class="punctuation">,</span> <span class="string">&quot;#56B4E9&quot;</span><span class="punctuation">,</span> <span class="string">&quot;#009E73&quot;</span><span class="punctuation">,</span> <span class="string">&quot;#F0E442&quot;</span><span class="punctuation">)</span></span><br><span class="line">Palette <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;#000000&quot;</span><span class="punctuation">,</span> <span class="string">&quot;#000000&quot;</span><span class="punctuation">,</span> <span class="string">&quot;#000000&quot;</span><span class="punctuation">,</span> <span class="string">&quot;#000000&quot;</span><span class="punctuation">)</span></span><br><span class="line">pc1 <span class="operator">&lt;-</span><span class="built_in">floor</span><span class="punctuation">(</span>pcoa<span class="operator">$</span>values<span class="operator">$</span>Relative_eig<span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span><span class="operator">*</span><span class="number">100</span><span class="punctuation">)</span></span><br><span class="line">pc2 <span class="operator">&lt;-</span><span class="built_in">floor</span><span class="punctuation">(</span>pcoa<span class="operator">$</span>values<span class="operator">$</span>Relative_eig<span class="punctuation">[</span><span class="number">2</span><span class="punctuation">]</span><span class="operator">*</span><span class="number">100</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">otu.adonis<span class="operator">=</span>adonis<span class="punctuation">(</span>data<span class="operator">~</span>V2<span class="punctuation">,</span>data <span class="operator">=</span> groups<span class="punctuation">,</span>distance <span class="operator">=</span> <span class="string">&quot;bray&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">ggplot<span class="punctuation">(</span>plotdata<span class="punctuation">,</span> aes<span class="punctuation">(</span>PC1<span class="punctuation">,</span> PC2<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_point<span class="punctuation">(</span>aes<span class="punctuation">(</span>colour<span class="operator">=</span>group<span class="punctuation">,</span>shape<span class="operator">=</span>group<span class="punctuation">,</span>fill<span class="operator">=</span>group<span class="punctuation">)</span><span class="punctuation">,</span>size<span class="operator">=</span><span class="number">12</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  geom_text<span class="punctuation">(</span>aes<span class="punctuation">(</span>x <span class="operator">=</span> <span class="number">0.05</span><span class="punctuation">,</span>y <span class="operator">=</span> <span class="number">0.35</span><span class="punctuation">,</span>label <span class="operator">=</span> paste<span class="punctuation">(</span><span class="string">&quot;PERMANOVA:\n    Group_A VS Group_B\n    p-value = &quot;</span><span class="punctuation">,</span>otu.adonis<span class="operator">$</span>aov.tab<span class="operator">$</span>`Pr(&gt;F)`<span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">,</span>sep <span class="operator">=</span> <span class="string">&quot;&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">,</span>size <span class="operator">=</span> <span class="number">10</span><span class="punctuation">,</span>hjust <span class="operator">=</span> <span class="number">0</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  stat_ellipse<span class="punctuation">(</span>aes<span class="punctuation">(</span>fill <span class="operator">=</span> group<span class="punctuation">)</span><span class="punctuation">,</span>geom <span class="operator">=</span> <span class="string">&quot;polygon&quot;</span><span class="punctuation">,</span>level <span class="operator">=</span> <span class="number">0.95</span><span class="punctuation">,</span>alpha <span class="operator">=</span> <span class="number">0.3</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  scale_shape_manual<span class="punctuation">(</span>values<span class="operator">=</span>pich<span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  scale_colour_manual<span class="punctuation">(</span>values<span class="operator">=</span>Palette<span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  scale_fill_manual<span class="punctuation">(</span>values<span class="operator">=</span>cbbPalette<span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  labs<span class="punctuation">(</span>title<span class="operator">=</span><span class="string">&quot;PCoA - The composition of gut microbiome&quot;</span><span class="punctuation">)</span> <span class="operator">+</span> </span><br><span class="line">  xlab<span class="punctuation">(</span>paste<span class="punctuation">(</span><span class="string">&quot;PC1 ( &quot;</span><span class="punctuation">,</span>pc1<span class="punctuation">,</span><span class="string">&quot;%&quot;</span><span class="punctuation">,</span><span class="string">&quot; )&quot;</span><span class="punctuation">,</span>sep<span class="operator">=</span><span class="string">&quot;&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span> </span><br><span class="line">  ylab<span class="punctuation">(</span>paste<span class="punctuation">(</span><span class="string">&quot;PC2 ( &quot;</span><span class="punctuation">,</span>pc2<span class="punctuation">,</span><span class="string">&quot;%&quot;</span><span class="punctuation">,</span><span class="string">&quot; )&quot;</span><span class="punctuation">,</span>sep<span class="operator">=</span><span class="string">&quot;&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  theme<span class="punctuation">(</span>text<span class="operator">=</span>element_text<span class="punctuation">(</span>size<span class="operator">=</span><span class="number">30</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  geom_vline<span class="punctuation">(</span>aes<span class="punctuation">(</span>xintercept <span class="operator">=</span> <span class="number">0</span><span class="punctuation">)</span><span class="punctuation">,</span>linetype<span class="operator">=</span><span class="string">&quot;dotted&quot;</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  geom_hline<span class="punctuation">(</span>aes<span class="punctuation">(</span>yintercept <span class="operator">=</span> <span class="number">0</span><span class="punctuation">)</span><span class="punctuation">,</span>linetype<span class="operator">=</span><span class="string">&quot;dotted&quot;</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  theme<span class="punctuation">(</span>panel.background <span class="operator">=</span> element_rect<span class="punctuation">(</span>fill<span class="operator">=</span><span class="string">&#x27;white&#x27;</span><span class="punctuation">,</span> colour<span class="operator">=</span><span class="string">&#x27;black&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">        panel.grid<span class="operator">=</span>element_blank<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">,</span> </span><br><span class="line">        axis.title <span class="operator">=</span> element_text<span class="punctuation">(</span>color<span class="operator">=</span><span class="string">&#x27;black&#x27;</span><span class="punctuation">,</span>size<span class="operator">=</span><span class="number">34</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">        axis.ticks.length <span class="operator">=</span> unit<span class="punctuation">(</span><span class="number">0.4</span><span class="punctuation">,</span><span class="string">&quot;lines&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span> axis.ticks <span class="operator">=</span> element_line<span class="punctuation">(</span>color<span class="operator">=</span><span class="string">&#x27;black&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">        axis.line <span class="operator">=</span> element_line<span class="punctuation">(</span>colour <span class="operator">=</span> <span class="string">&quot;black&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span> </span><br><span class="line">        axis.title.x<span class="operator">=</span>element_text<span class="punctuation">(</span>colour<span class="operator">=</span><span class="string">&#x27;black&#x27;</span><span class="punctuation">,</span> size<span class="operator">=</span><span class="number">34</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">        axis.title.y<span class="operator">=</span>element_text<span class="punctuation">(</span>colour<span class="operator">=</span><span class="string">&#x27;black&#x27;</span><span class="punctuation">,</span> size<span class="operator">=</span><span class="number">34</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">        axis.text<span class="operator">=</span>element_text<span class="punctuation">(</span>colour<span class="operator">=</span><span class="string">&#x27;black&#x27;</span><span class="punctuation">,</span>size<span class="operator">=</span><span class="number">28</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">        legend.title<span class="operator">=</span>element_blank<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">        legend.text<span class="operator">=</span>element_text<span class="punctuation">(</span>size<span class="operator">=</span><span class="number">34</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">        legend.key<span class="operator">=</span>element_blank<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">,</span>legend.position <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">0.12</span><span class="punctuation">,</span><span class="number">0.88</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">        legend.background <span class="operator">=</span> element_rect<span class="punctuation">(</span>colour <span class="operator">=</span> <span class="string">&quot;black&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">        legend.key.height<span class="operator">=</span>unit<span class="punctuation">(</span><span class="number">1.6</span><span class="punctuation">,</span><span class="string">&quot;cm&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  theme<span class="punctuation">(</span>plot.title <span class="operator">=</span> element_text<span class="punctuation">(</span>size<span class="operator">=</span><span class="number">34</span><span class="punctuation">,</span>colour <span class="operator">=</span> <span class="string">&quot;black&quot;</span><span class="punctuation">,</span>hjust <span class="operator">=</span> <span class="number">0.5</span><span class="punctuation">,</span>face <span class="operator">=</span> <span class="string">&quot;bold&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#同时显示两种分类方法</span></span><br><span class="line">data <span class="operator">&lt;-</span> read.csv<span class="punctuation">(</span><span class="string">&quot;otu_taxa_table.txt&quot;</span><span class="punctuation">,</span> head<span class="operator">=</span><span class="literal">TRUE</span><span class="punctuation">,</span>sep<span class="operator">=</span><span class="string">&quot;\t&quot;</span><span class="punctuation">,</span>row.names <span class="operator">=</span> <span class="number">1</span><span class="punctuation">)</span></span><br><span class="line">groups <span class="operator">&lt;-</span> read.table<span class="punctuation">(</span><span class="string">&quot;group.list.txt&quot;</span><span class="punctuation">,</span>sep <span class="operator">=</span> <span class="string">&quot;\t&quot;</span><span class="punctuation">,</span>header <span class="operator">=</span> <span class="built_in">F</span><span class="punctuation">,</span>colClasses <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;character&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">groups <span class="operator">&lt;-</span> as.list<span class="punctuation">(</span>groups<span class="punctuation">)</span></span><br><span class="line">data <span class="operator">&lt;-</span> t<span class="punctuation">(</span>data<span class="punctuation">)</span></span><br><span class="line">data<span class="punctuation">[</span><span class="built_in">is.na</span><span class="punctuation">(</span>data<span class="punctuation">)</span><span class="punctuation">]</span> <span class="operator">&lt;-</span> <span class="number">0</span></span><br><span class="line">data <span class="operator">&lt;-</span> vegdist<span class="punctuation">(</span>data<span class="punctuation">,</span>method <span class="operator">=</span> <span class="string">&quot;bray&quot;</span><span class="punctuation">)</span></span><br><span class="line">pcoa<span class="operator">&lt;-</span> pcoa<span class="punctuation">(</span>data<span class="punctuation">,</span> correction <span class="operator">=</span> <span class="string">&quot;none&quot;</span><span class="punctuation">,</span> rn <span class="operator">=</span> <span class="literal">NULL</span><span class="punctuation">)</span></span><br><span class="line">PC1 <span class="operator">=</span> pcoa<span class="operator">$</span>vectors<span class="punctuation">[</span><span class="punctuation">,</span><span class="number">1</span><span class="punctuation">]</span></span><br><span class="line">PC2 <span class="operator">=</span> pcoa<span class="operator">$</span>vectors<span class="punctuation">[</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">]</span></span><br><span class="line">plotdata <span class="operator">&lt;-</span> data.frame<span class="punctuation">(</span>rownames<span class="punctuation">(</span>pcoa<span class="operator">$</span>vectors<span class="punctuation">)</span><span class="punctuation">,</span>PC1<span class="punctuation">,</span>PC2<span class="punctuation">,</span>groups<span class="operator">$</span>V2<span class="punctuation">,</span>groups<span class="operator">$</span>V3<span class="punctuation">)</span></span><br><span class="line">colnames<span class="punctuation">(</span>plotdata<span class="punctuation">)</span> <span class="operator">&lt;-</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;sample&quot;</span><span class="punctuation">,</span><span class="string">&quot;PC1&quot;</span><span class="punctuation">,</span><span class="string">&quot;PC2&quot;</span><span class="punctuation">,</span><span class="string">&quot;Treatment&quot;</span><span class="punctuation">,</span><span class="string">&quot;Time&quot;</span><span class="punctuation">)</span></span><br><span class="line">pich<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">21</span><span class="operator">:</span><span class="number">25</span><span class="punctuation">)</span></span><br><span class="line">cbbPalette <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;#E69F00&quot;</span><span class="punctuation">,</span> <span class="string">&quot;#56B4E9&quot;</span><span class="punctuation">,</span> <span class="string">&quot;#009E73&quot;</span><span class="punctuation">,</span> <span class="string">&quot;#F0E442&quot;</span><span class="punctuation">)</span></span><br><span class="line">pc1 <span class="operator">&lt;-</span><span class="built_in">floor</span><span class="punctuation">(</span>pcoa<span class="operator">$</span>values<span class="operator">$</span>Relative_eig<span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span><span class="operator">*</span><span class="number">100</span><span class="punctuation">)</span></span><br><span class="line">pc2 <span class="operator">&lt;-</span><span class="built_in">floor</span><span class="punctuation">(</span>pcoa<span class="operator">$</span>values<span class="operator">$</span>Relative_eig<span class="punctuation">[</span><span class="number">2</span><span class="punctuation">]</span><span class="operator">*</span><span class="number">100</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">ggplot<span class="punctuation">(</span>plotdata<span class="punctuation">,</span> aes<span class="punctuation">(</span>PC1<span class="punctuation">,</span> PC2<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_point<span class="punctuation">(</span>aes<span class="punctuation">(</span>shape<span class="operator">=</span>Time<span class="punctuation">,</span>fill<span class="operator">=</span>Treatment<span class="punctuation">,</span>colour<span class="operator">=</span>Treatment<span class="punctuation">)</span><span class="punctuation">,</span>size<span class="operator">=</span><span class="number">10</span><span class="punctuation">)</span><span class="operator">+</span> </span><br><span class="line">  scale_shape_manual<span class="punctuation">(</span>values<span class="operator">=</span>pich<span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  scale_colour_manual<span class="punctuation">(</span>values<span class="operator">=</span>cbbPalette<span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  scale_fill_manual<span class="punctuation">(</span>values<span class="operator">=</span>cbbPalette<span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  labs<span class="punctuation">(</span>title<span class="operator">=</span><span class="string">&quot;PCoA - PC1-VS-PC2&quot;</span><span class="punctuation">)</span> <span class="operator">+</span> </span><br><span class="line">  xlab<span class="punctuation">(</span>paste<span class="punctuation">(</span><span class="string">&quot;PC1 ( &quot;</span><span class="punctuation">,</span>pc1<span class="punctuation">,</span><span class="string">&quot;%&quot;</span><span class="punctuation">,</span><span class="string">&quot; )&quot;</span><span class="punctuation">,</span>sep<span class="operator">=</span><span class="string">&quot;&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span> </span><br><span class="line">  ylab<span class="punctuation">(</span>paste<span class="punctuation">(</span><span class="string">&quot;PC2 ( &quot;</span><span class="punctuation">,</span>pc2<span class="punctuation">,</span><span class="string">&quot;%&quot;</span><span class="punctuation">,</span><span class="string">&quot; )&quot;</span><span class="punctuation">,</span>sep<span class="operator">=</span><span class="string">&quot;&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  theme<span class="punctuation">(</span>text<span class="operator">=</span>element_text<span class="punctuation">(</span>size<span class="operator">=</span><span class="number">30</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  geom_vline<span class="punctuation">(</span>aes<span class="punctuation">(</span>xintercept <span class="operator">=</span> <span class="number">0</span><span class="punctuation">)</span><span class="punctuation">,</span>linetype<span class="operator">=</span><span class="string">&quot;dotted&quot;</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  geom_hline<span class="punctuation">(</span>aes<span class="punctuation">(</span>yintercept <span class="operator">=</span> <span class="number">0</span><span class="punctuation">)</span><span class="punctuation">,</span>linetype<span class="operator">=</span><span class="string">&quot;dotted&quot;</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  theme<span class="punctuation">(</span>panel.background <span class="operator">=</span> element_rect<span class="punctuation">(</span>fill<span class="operator">=</span><span class="string">&#x27;white&#x27;</span><span class="punctuation">,</span> colour<span class="operator">=</span><span class="string">&#x27;black&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">        panel.grid<span class="operator">=</span>element_blank<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">,</span> </span><br><span class="line">        axis.title <span class="operator">=</span> element_text<span class="punctuation">(</span>color<span class="operator">=</span><span class="string">&#x27;black&#x27;</span><span class="punctuation">,</span>size<span class="operator">=</span><span class="number">34</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">        axis.ticks.length <span class="operator">=</span> unit<span class="punctuation">(</span><span class="number">0.4</span><span class="punctuation">,</span><span class="string">&quot;lines&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span> axis.ticks <span class="operator">=</span> element_line<span class="punctuation">(</span>color<span class="operator">=</span><span class="string">&#x27;black&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">        axis.line <span class="operator">=</span> element_line<span class="punctuation">(</span>colour <span class="operator">=</span> <span class="string">&quot;black&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span> </span><br><span class="line">        axis.title.x<span class="operator">=</span>element_text<span class="punctuation">(</span>colour<span class="operator">=</span><span class="string">&#x27;black&#x27;</span><span class="punctuation">,</span> size<span class="operator">=</span><span class="number">34</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">        axis.title.y<span class="operator">=</span>element_text<span class="punctuation">(</span>colour<span class="operator">=</span><span class="string">&#x27;black&#x27;</span><span class="punctuation">,</span> size<span class="operator">=</span><span class="number">34</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">        axis.text<span class="operator">=</span>element_text<span class="punctuation">(</span>colour<span class="operator">=</span><span class="string">&#x27;black&#x27;</span><span class="punctuation">,</span>size<span class="operator">=</span><span class="number">28</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">        legend.title<span class="operator">=</span>element_text<span class="punctuation">(</span>colour <span class="operator">=</span> <span class="string">&quot;black&quot;</span><span class="punctuation">,</span>size <span class="operator">=</span> <span class="number">34</span><span class="punctuation">,</span>face <span class="operator">=</span> <span class="string">&quot;bold&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">        legend.text<span class="operator">=</span>element_text<span class="punctuation">(</span>size<span class="operator">=</span><span class="number">34</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">        legend.key<span class="operator">=</span>element_blank<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">        legend.background <span class="operator">=</span> element_rect<span class="punctuation">(</span>colour <span class="operator">=</span> <span class="string">&quot;black&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">        legend.key.height<span class="operator">=</span>unit<span class="punctuation">(</span><span class="number">1.6</span><span class="punctuation">,</span><span class="string">&quot;cm&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  theme<span class="punctuation">(</span>plot.title <span class="operator">=</span> element_text<span class="punctuation">(</span>size<span class="operator">=</span><span class="number">34</span><span class="punctuation">,</span>colour <span class="operator">=</span> <span class="string">&quot;black&quot;</span><span class="punctuation">,</span>hjust <span class="operator">=</span> <span class="number">0.5</span><span class="punctuation">,</span>face <span class="operator">=</span> <span class="string">&quot;bold&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#分组数目较多、组内生物学重复较少</span></span><br><span class="line">data <span class="operator">&lt;-</span> read.csv<span class="punctuation">(</span><span class="string">&quot;otu 2.txt&quot;</span><span class="punctuation">,</span> head<span class="operator">=</span><span class="literal">TRUE</span><span class="punctuation">,</span>sep<span class="operator">=</span><span class="string">&quot;\t&quot;</span><span class="punctuation">,</span>row.names <span class="operator">=</span> <span class="number">1</span><span class="punctuation">)</span></span><br><span class="line">data <span class="operator">&lt;-</span> t<span class="punctuation">(</span>data<span class="punctuation">)</span></span><br><span class="line">data<span class="punctuation">[</span><span class="built_in">is.na</span><span class="punctuation">(</span>data<span class="punctuation">)</span><span class="punctuation">]</span> <span class="operator">&lt;-</span> <span class="number">0</span></span><br><span class="line">data <span class="operator">&lt;-</span> vegdist<span class="punctuation">(</span>data<span class="punctuation">)</span></span><br><span class="line">pcoa<span class="operator">&lt;-</span> pcoa<span class="punctuation">(</span>data<span class="punctuation">,</span> correction <span class="operator">=</span> <span class="string">&quot;none&quot;</span><span class="punctuation">,</span> rn <span class="operator">=</span> <span class="literal">NULL</span><span class="punctuation">)</span></span><br><span class="line">groups <span class="operator">&lt;-</span> read.table<span class="punctuation">(</span><span class="string">&quot;group 2.txt&quot;</span><span class="punctuation">,</span>sep <span class="operator">=</span> <span class="string">&quot;\t&quot;</span><span class="punctuation">,</span>header <span class="operator">=</span> <span class="built_in">F</span><span class="punctuation">,</span>colClasses <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;character&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">groups <span class="operator">&lt;-</span> as.list<span class="punctuation">(</span>groups<span class="punctuation">)</span></span><br><span class="line">groups<span class="operator">$</span>V2 <span class="operator">&lt;-</span> factor<span class="punctuation">(</span>groups<span class="operator">$</span>V2<span class="punctuation">,</span>levels <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;Jan&quot;</span><span class="punctuation">,</span><span class="string">&quot;Feb&quot;</span><span class="punctuation">,</span><span class="string">&quot;Mar&quot;</span><span class="punctuation">,</span><span class="string">&quot;Apr&quot;</span><span class="punctuation">,</span><span class="string">&quot;May&quot;</span><span class="punctuation">,</span><span class="string">&quot;Jun&quot;</span><span class="punctuation">,</span><span class="string">&quot;Jul&quot;</span><span class="punctuation">,</span><span class="string">&quot;Aug&quot;</span><span class="punctuation">,</span><span class="string">&quot;Sep&quot;</span><span class="punctuation">,</span><span class="string">&quot;Oct&quot;</span><span class="punctuation">,</span><span class="string">&quot;Nov&quot;</span><span class="punctuation">,</span><span class="string">&quot;Dec&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">PC1 <span class="operator">=</span> pcoa<span class="operator">$</span>vectors<span class="punctuation">[</span><span class="punctuation">,</span><span class="number">1</span><span class="punctuation">]</span></span><br><span class="line">PC2 <span class="operator">=</span> pcoa<span class="operator">$</span>vectors<span class="punctuation">[</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">]</span></span><br><span class="line">plotdata <span class="operator">&lt;-</span> data.frame<span class="punctuation">(</span>rownames<span class="punctuation">(</span>pcoa<span class="operator">$</span>vectors<span class="punctuation">)</span><span class="punctuation">,</span>PC1<span class="punctuation">,</span>PC2<span class="punctuation">,</span>groups<span class="operator">$</span>V2<span class="punctuation">)</span></span><br><span class="line">colnames<span class="punctuation">(</span>plotdata<span class="punctuation">)</span> <span class="operator">&lt;-</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;sample&quot;</span><span class="punctuation">,</span><span class="string">&quot;PC1&quot;</span><span class="punctuation">,</span><span class="string">&quot;PC2&quot;</span><span class="punctuation">,</span><span class="string">&quot;group&quot;</span><span class="punctuation">)</span></span><br><span class="line">pc1 <span class="operator">&lt;-</span><span class="built_in">floor</span><span class="punctuation">(</span>pcoa<span class="operator">$</span>values<span class="operator">$</span>Relative_eig<span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span><span class="operator">*</span><span class="number">100</span><span class="punctuation">)</span></span><br><span class="line">pc2 <span class="operator">&lt;-</span><span class="built_in">floor</span><span class="punctuation">(</span>pcoa<span class="operator">$</span>values<span class="operator">$</span>Relative_eig<span class="punctuation">[</span><span class="number">2</span><span class="punctuation">]</span><span class="operator">*</span><span class="number">100</span><span class="punctuation">)</span></span><br><span class="line">pich<span class="operator">=</span><span class="built_in">rep</span><span class="punctuation">(</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">21</span><span class="operator">:</span><span class="number">24</span><span class="punctuation">)</span><span class="punctuation">,</span><span class="number">3</span><span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>RColorBrewer<span class="punctuation">)</span></span><br><span class="line">cbbPalette <span class="operator">&lt;-</span> brewer.pal<span class="punctuation">(</span><span class="number">12</span><span class="punctuation">,</span><span class="string">&quot;Set3&quot;</span><span class="punctuation">)</span></span><br><span class="line">Palette <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="built_in">rep</span><span class="punctuation">(</span><span class="string">&quot;#000000&quot;</span><span class="punctuation">,</span><span class="number">12</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">ggplot<span class="punctuation">(</span>plotdata<span class="punctuation">,</span> aes<span class="punctuation">(</span>PC1<span class="punctuation">,</span> PC2<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_point<span class="punctuation">(</span>aes<span class="punctuation">(</span>colour<span class="operator">=</span>group<span class="punctuation">,</span>shape<span class="operator">=</span>group<span class="punctuation">,</span>fill<span class="operator">=</span>group<span class="punctuation">)</span><span class="punctuation">,</span>size<span class="operator">=</span><span class="number">8</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  geom_label_repel<span class="punctuation">(</span>aes<span class="punctuation">(</span>PC1<span class="punctuation">,</span>PC2<span class="punctuation">,</span>label <span class="operator">=</span> sample<span class="punctuation">)</span><span class="punctuation">,</span>fill <span class="operator">=</span> <span class="string">&quot;white&quot;</span><span class="punctuation">,</span>color <span class="operator">=</span> <span class="string">&quot;black&quot;</span><span class="punctuation">,</span></span><br><span class="line">                   box.padding <span class="operator">=</span> unit<span class="punctuation">(</span><span class="number">0.6</span><span class="punctuation">,</span><span class="string">&quot;lines&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span>segment.colour <span class="operator">=</span> <span class="string">&quot;grey50&quot;</span><span class="punctuation">,</span></span><br><span class="line">                   label.padding <span class="operator">=</span> unit<span class="punctuation">(</span><span class="number">0.35</span><span class="punctuation">,</span><span class="string">&quot;lines&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  scale_shape_manual<span class="punctuation">(</span>values<span class="operator">=</span>pich<span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  scale_colour_manual<span class="punctuation">(</span>values<span class="operator">=</span>Palette<span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  scale_fill_manual<span class="punctuation">(</span>values<span class="operator">=</span>cbbPalette<span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  labs<span class="punctuation">(</span>title<span class="operator">=</span><span class="string">&quot;PCoA - The composition of microbiome in sediment&quot;</span><span class="punctuation">)</span> <span class="operator">+</span> </span><br><span class="line">  xlab<span class="punctuation">(</span>paste<span class="punctuation">(</span><span class="string">&quot;PC1 ( &quot;</span><span class="punctuation">,</span>pc1<span class="punctuation">,</span><span class="string">&quot;%&quot;</span><span class="punctuation">,</span><span class="string">&quot; )&quot;</span><span class="punctuation">,</span>sep<span class="operator">=</span><span class="string">&quot;&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span> </span><br><span class="line">  ylab<span class="punctuation">(</span>paste<span class="punctuation">(</span><span class="string">&quot;PC2 ( &quot;</span><span class="punctuation">,</span>pc2<span class="punctuation">,</span><span class="string">&quot;%&quot;</span><span class="punctuation">,</span><span class="string">&quot; )&quot;</span><span class="punctuation">,</span>sep<span class="operator">=</span><span class="string">&quot;&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  theme<span class="punctuation">(</span>text<span class="operator">=</span>element_text<span class="punctuation">(</span>size<span class="operator">=</span><span class="number">30</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  geom_vline<span class="punctuation">(</span>aes<span class="punctuation">(</span>xintercept <span class="operator">=</span> <span class="number">0</span><span class="punctuation">)</span><span class="punctuation">,</span>linetype<span class="operator">=</span><span class="string">&quot;dotted&quot;</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  geom_hline<span class="punctuation">(</span>aes<span class="punctuation">(</span>yintercept <span class="operator">=</span> <span class="number">0</span><span class="punctuation">)</span><span class="punctuation">,</span>linetype<span class="operator">=</span><span class="string">&quot;dotted&quot;</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  theme<span class="punctuation">(</span>panel.background <span class="operator">=</span> element_rect<span class="punctuation">(</span>fill<span class="operator">=</span><span class="string">&#x27;white&#x27;</span><span class="punctuation">,</span> colour<span class="operator">=</span><span class="string">&#x27;black&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">        panel.grid<span class="operator">=</span>element_blank<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">,</span> </span><br><span class="line">        axis.title <span class="operator">=</span> element_text<span class="punctuation">(</span>color<span class="operator">=</span><span class="string">&#x27;black&#x27;</span><span class="punctuation">,</span>size<span class="operator">=</span><span class="number">34</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">        axis.ticks.length <span class="operator">=</span> unit<span class="punctuation">(</span><span class="number">0.4</span><span class="punctuation">,</span><span class="string">&quot;lines&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span> axis.ticks <span class="operator">=</span> element_line<span class="punctuation">(</span>color<span class="operator">=</span><span class="string">&#x27;black&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">        axis.line <span class="operator">=</span> element_line<span class="punctuation">(</span>colour <span class="operator">=</span> <span class="string">&quot;black&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span> </span><br><span class="line">        axis.title.x<span class="operator">=</span>element_text<span class="punctuation">(</span>colour<span class="operator">=</span><span class="string">&#x27;black&#x27;</span><span class="punctuation">,</span> size<span class="operator">=</span><span class="number">34</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">        axis.title.y<span class="operator">=</span>element_text<span class="punctuation">(</span>colour<span class="operator">=</span><span class="string">&#x27;black&#x27;</span><span class="punctuation">,</span> size<span class="operator">=</span><span class="number">34</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">        axis.text<span class="operator">=</span>element_text<span class="punctuation">(</span>colour<span class="operator">=</span><span class="string">&#x27;black&#x27;</span><span class="punctuation">,</span>size<span class="operator">=</span><span class="number">28</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">        legend.title<span class="operator">=</span>element_blank<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">        legend.text<span class="operator">=</span>element_text<span class="punctuation">(</span>size<span class="operator">=</span><span class="number">28</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">        legend.key<span class="operator">=</span>element_blank<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">,</span>legend.position <span class="operator">=</span> <span class="string">&quot;right&quot;</span><span class="punctuation">,</span></span><br><span class="line">        legend.background <span class="operator">=</span> element_rect<span class="punctuation">(</span>colour <span class="operator">=</span> <span class="string">&quot;black&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">        legend.key.height<span class="operator">=</span>unit<span class="punctuation">(</span><span class="number">1.55</span><span class="punctuation">,</span><span class="string">&quot;cm&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  theme<span class="punctuation">(</span>plot.title <span class="operator">=</span> element_text<span class="punctuation">(</span>size<span class="operator">=</span><span class="number">34</span><span class="punctuation">,</span>colour <span class="operator">=</span> <span class="string">&quot;black&quot;</span><span class="punctuation">,</span>hjust <span class="operator">=</span> <span class="number">0.5</span><span class="punctuation">,</span>face <span class="operator">=</span> <span class="string">&quot;bold&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="pca分析"><strong>PCA分析</strong></h4>
<p>PCA（principal component analysis）中文名字叫主成分分析：基于特征向量的排序方法，分析对象是原始的定量数据。排序图展示样方之间的欧氏距离。</p>
<p>PCoA（principal coordinate analysis）中文名字叫主坐标分析：分析对象为距离矩阵，而非原始的样方-变量矩阵。因此可以灵活选着关联测度。</p>
<p>这样我们就发现了这两种非约束排序的区别：PCA是基于原始物种所做的排序分析，而PCoA则是基于物种组成计算得到的距离矩阵。</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">library<span class="punctuation">(</span>ggplot2<span class="punctuation">)</span></span><br><span class="line">df <span class="operator">&lt;-</span>  iris<span class="punctuation">[</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">,</span><span class="number">3</span><span class="punctuation">,</span><span class="number">4</span><span class="punctuation">)</span><span class="punctuation">]</span></span><br><span class="line">df_pca <span class="operator">&lt;-</span> prcomp<span class="punctuation">(</span>df<span class="punctuation">)</span> <span class="comment">#计算主成分</span></span><br><span class="line">head<span class="punctuation">(</span>df_pca<span class="punctuation">,</span><span class="number">3</span><span class="punctuation">)</span> <span class="comment">#查看主成分结果</span></span><br><span class="line">plot<span class="punctuation">(</span>df_pca<span class="operator">$</span>x<span class="punctuation">[</span><span class="punctuation">,</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">,</span>df_pca<span class="operator">$</span>x<span class="punctuation">[</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">]</span><span class="punctuation">)</span></span><br><span class="line">df_pcs <span class="operator">&lt;-</span>data.frame<span class="punctuation">(</span>df_pca<span class="operator">$</span>x<span class="punctuation">,</span> Species <span class="operator">=</span> iris<span class="operator">$</span>Species<span class="punctuation">)</span> <span class="comment">#生成数据框</span></span><br><span class="line">df_pcs</span><br><span class="line"><span class="comment">#按Species分颜色</span></span><br><span class="line">ggplot<span class="punctuation">(</span>df_pcs<span class="punctuation">,</span>aes<span class="punctuation">(</span>x<span class="operator">=</span>PC1<span class="punctuation">,</span>y<span class="operator">=</span>PC2<span class="punctuation">,</span>color<span class="operator">=</span>Species<span class="punctuation">)</span><span class="punctuation">)</span><span class="operator">+</span>  <span class="comment">#去除背景及网格线</span></span><br><span class="line">  geom_point<span class="punctuation">(</span><span class="punctuation">)</span><span class="operator">+</span> </span><br><span class="line">  theme_bw<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  theme<span class="punctuation">(</span>panel.border<span class="operator">=</span>element_blank<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">,</span>panel.grid.major<span class="operator">=</span>element_blank<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">,</span>panel.grid.minor<span class="operator">=</span>element_blank<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">,</span>axis.line<span class="operator">=</span> element_line<span class="punctuation">(</span>colour <span class="operator">=</span> <span class="string">&quot;black&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">percentage <span class="operator">&lt;-</span> <span class="built_in">round</span><span class="punctuation">(</span>df_pca<span class="operator">$</span>sdev<span class="operator">/</span><span class="built_in">sum</span><span class="punctuation">(</span>df_pca<span class="operator">$</span>sdev<span class="punctuation">)</span><span class="operator">*</span><span class="number">100</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">)</span></span><br><span class="line">percentage</span><br><span class="line">percentage <span class="operator">&lt;-</span> paste<span class="punctuation">(</span>colnames<span class="punctuation">(</span>df_pcs<span class="punctuation">)</span><span class="punctuation">,</span><span class="string">&quot;(&quot;</span><span class="punctuation">,</span>paste<span class="punctuation">(</span><span class="built_in">as.character</span><span class="punctuation">(</span>percentage<span class="punctuation">)</span><span class="punctuation">,</span><span class="string">&quot;%&quot;</span><span class="punctuation">,</span><span class="string">&quot;)&quot;</span><span class="punctuation">,</span>sep <span class="operator">=</span> <span class="string">&quot;&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">ggplot<span class="punctuation">(</span>df_pcs<span class="punctuation">,</span>aes<span class="punctuation">(</span>x<span class="operator">=</span>PC1<span class="punctuation">,</span>y<span class="operator">=</span>PC2<span class="punctuation">,</span>color <span class="operator">=</span> Species<span class="punctuation">)</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  geom_point<span class="punctuation">(</span><span class="punctuation">)</span><span class="operator">+</span>xlab<span class="punctuation">(</span>percentage<span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  ylab<span class="punctuation">(</span>percentage<span class="punctuation">[</span><span class="number">2</span><span class="punctuation">]</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment">#添加置信椭圆</span></span><br><span class="line">ggplot<span class="punctuation">(</span>df_pcs<span class="punctuation">,</span>aes<span class="punctuation">(</span>x<span class="operator">=</span>PC1<span class="punctuation">,</span>y<span class="operator">=</span>PC2<span class="punctuation">,</span>color <span class="operator">=</span> Species<span class="punctuation">)</span><span class="punctuation">)</span><span class="operator">+</span>geom_point<span class="punctuation">(</span><span class="punctuation">)</span><span class="operator">+</span>stat_ellipse<span class="punctuation">(</span>level <span class="operator">=</span> <span class="number">0.95</span><span class="punctuation">,</span>show.legend <span class="operator">=</span> <span class="built_in">F</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  annotate<span class="punctuation">(</span><span class="string">&#x27;text&#x27;</span><span class="punctuation">,</span> label <span class="operator">=</span> <span class="string">&#x27;setosa&#x27;</span><span class="punctuation">,</span> x <span class="operator">=</span> <span class="operator">-</span><span class="number">2</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="operator">-</span><span class="number">1.25</span><span class="punctuation">,</span> size <span class="operator">=</span> <span class="number">5</span><span class="punctuation">,</span> colour <span class="operator">=</span> <span class="string">&#x27;#f8766d&#x27;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  annotate<span class="punctuation">(</span><span class="string">&#x27;text&#x27;</span><span class="punctuation">,</span> label <span class="operator">=</span> <span class="string">&#x27;versicolor&#x27;</span><span class="punctuation">,</span> x <span class="operator">=</span> <span class="number">0</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="operator">-</span> <span class="number">0.5</span><span class="punctuation">,</span> size <span class="operator">=</span> <span class="number">5</span><span class="punctuation">,</span> colour <span class="operator">=</span> <span class="string">&#x27;#00ba38&#x27;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  annotate<span class="punctuation">(</span><span class="string">&#x27;text&#x27;</span><span class="punctuation">,</span> label <span class="operator">=</span> <span class="string">&#x27;virginica&#x27;</span><span class="punctuation">,</span> x <span class="operator">=</span> <span class="number">3</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="number">0.5</span><span class="punctuation">,</span> size <span class="operator">=</span> <span class="number">5</span><span class="punctuation">,</span> colour <span class="operator">=</span> <span class="string">&#x27;#619cff&#x27;</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment">#查看各变量对于PCA的贡献</span></span><br><span class="line">df_r <span class="operator">&lt;-</span> as.data.frame<span class="punctuation">(</span>df_pca<span class="operator">$</span>rotation<span class="punctuation">)</span></span><br><span class="line">df_r<span class="operator">$</span>feature <span class="operator">&lt;-</span> rownames<span class="punctuation">(</span>df_r<span class="punctuation">)</span></span><br><span class="line"><span class="comment">#贡献度绘图</span></span><br><span class="line">ggplot<span class="punctuation">(</span>df_r<span class="punctuation">,</span>aes<span class="punctuation">(</span>x <span class="operator">=</span> PC1<span class="punctuation">,</span>y<span class="operator">=</span> PC2 <span class="punctuation">,</span>label <span class="operator">=</span> feature <span class="punctuation">,</span>color <span class="operator">=</span> feature<span class="punctuation">)</span><span class="punctuation">)</span><span class="operator">+</span>geom_point<span class="punctuation">(</span><span class="punctuation">)</span><span class="operator">+</span> geom_text<span class="punctuation">(</span>size <span class="operator">=</span> <span class="number">3</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment">#绘图总展示</span></span><br><span class="line">ggplot<span class="punctuation">(</span>df_pcs<span class="punctuation">,</span>aes<span class="punctuation">(</span>x<span class="operator">=</span>PC1<span class="punctuation">,</span>y<span class="operator">=</span>PC2<span class="punctuation">,</span>color<span class="operator">=</span>Species <span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span> geom_point<span class="punctuation">(</span><span class="punctuation">)</span><span class="operator">+</span>xlab<span class="punctuation">(</span>percentage<span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">)</span> <span class="operator">+</span> ylab<span class="punctuation">(</span>percentage<span class="punctuation">[</span><span class="number">2</span><span class="punctuation">]</span><span class="punctuation">)</span> <span class="operator">+</span> stat_ellipse<span class="punctuation">(</span>level <span class="operator">=</span> <span class="number">0.95</span><span class="punctuation">,</span> show.legend <span class="operator">=</span> <span class="built_in">F</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  annotate<span class="punctuation">(</span><span class="string">&#x27;text&#x27;</span><span class="punctuation">,</span> label <span class="operator">=</span> <span class="string">&#x27;setosa&#x27;</span><span class="punctuation">,</span> x <span class="operator">=</span> <span class="operator">-</span><span class="number">2</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="operator">-</span><span class="number">1.25</span><span class="punctuation">,</span> size <span class="operator">=</span> <span class="number">5</span><span class="punctuation">,</span> colour <span class="operator">=</span> <span class="string">&#x27;#f8766d&#x27;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  annotate<span class="punctuation">(</span><span class="string">&#x27;text&#x27;</span><span class="punctuation">,</span> label <span class="operator">=</span> <span class="string">&#x27;versicolor&#x27;</span><span class="punctuation">,</span> x <span class="operator">=</span> <span class="number">0</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="operator">-</span> <span class="number">0.5</span><span class="punctuation">,</span> size <span class="operator">=</span> <span class="number">5</span><span class="punctuation">,</span> colour <span class="operator">=</span> <span class="string">&#x27;#00ba38&#x27;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  annotate<span class="punctuation">(</span><span class="string">&#x27;text&#x27;</span><span class="punctuation">,</span> label <span class="operator">=</span> <span class="string">&#x27;virginica&#x27;</span><span class="punctuation">,</span> x <span class="operator">=</span> <span class="number">3</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="number">0.5</span><span class="punctuation">,</span> size <span class="operator">=</span> <span class="number">5</span><span class="punctuation">,</span> colour <span class="operator">=</span> <span class="string">&#x27;#619cff&#x27;</span><span class="punctuation">)</span> <span class="operator">+</span> labs<span class="punctuation">(</span>title<span class="operator">=</span><span class="string">&quot;Iris PCA Clustering&quot;</span><span class="punctuation">,</span> </span><br><span class="line">                                                                                             subtitle<span class="operator">=</span><span class="string">&quot; PC1 and PC2 principal components &quot;</span><span class="punctuation">,</span>       caption<span class="operator">=</span><span class="string">&quot;Source: Iris&quot;</span><span class="punctuation">)</span> <span class="operator">+</span> theme_classic<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span>一种老方法<span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span></span><br><span class="line">pca_plot <span class="operator">=</span> <span class="keyword">function</span><span class="punctuation">(</span>dddd<span class="punctuation">,</span>ggggg<span class="punctuation">)</span><span class="punctuation">&#123;</span></span><br><span class="line">  library<span class="punctuation">(</span><span class="string">&quot;FactoMineR&quot;</span><span class="punctuation">)</span></span><br><span class="line">  library<span class="punctuation">(</span><span class="string">&quot;factoextra&quot;</span><span class="punctuation">)</span></span><br><span class="line">  df.pca <span class="operator">&lt;-</span> PCA<span class="punctuation">(</span>t<span class="punctuation">(</span>dddd<span class="punctuation">)</span><span class="punctuation">,</span> graph <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span></span><br><span class="line">  fviz_pca_ind<span class="punctuation">(</span>df.pca<span class="punctuation">,</span></span><br><span class="line">               <span class="comment">#axes = c(2,3),</span></span><br><span class="line">               geom.ind <span class="operator">=</span> <span class="string">&quot;point&quot;</span><span class="punctuation">,</span></span><br><span class="line">               col.ind <span class="operator">=</span> ggggg <span class="punctuation">,</span><span class="comment">#分组</span></span><br><span class="line">               addEllipses <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">,</span></span><br><span class="line">               legend.title <span class="operator">=</span> <span class="string">&quot;Groups&quot;</span></span><br><span class="line">  <span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line">pca_plot<span class="punctuation">(</span>otu_file<span class="punctuation">,</span>group<span class="operator">$</span>group<span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<p><strong>另一种PCA方法(基于ggbiplot包)</strong></p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">library<span class="punctuation">(</span>devtools<span class="punctuation">)</span></span><br><span class="line">install_github<span class="punctuation">(</span><span class="string">&quot;vqv/ggbiplot&quot;</span><span class="punctuation">)</span> <span class="comment">#安装</span></span><br><span class="line">library<span class="punctuation">(</span>ggbiplot<span class="punctuation">)</span></span><br><span class="line">design <span class="operator">&lt;-</span> read.table<span class="punctuation">(</span><span class="string">&quot;sample.txt&quot;</span><span class="punctuation">,</span> header<span class="operator">=</span><span class="built_in">T</span><span class="punctuation">,</span> row.names<span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span> sep<span class="operator">=</span><span class="string">&quot;\t&quot;</span><span class="punctuation">)</span>  <span class="comment">#导入分组信息表 </span></span><br><span class="line">count <span class="operator">&lt;-</span> read.delim<span class="punctuation">(</span><span class="string">&quot;Genu_0.001.txt&quot;</span><span class="punctuation">,</span> row.names<span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span>  header<span class="operator">=</span><span class="built_in">T</span><span class="punctuation">,</span> sep<span class="operator">=</span><span class="string">&quot;\t&quot;</span><span class="punctuation">)</span> <span class="comment">#导入相对丰度表</span></span><br><span class="line"><span class="comment"># 转换原始数据为百分比 norm = t(t(count)/colSums(count,na=T)) * 100</span></span><br><span class="line">otu.pca <span class="operator">&lt;-</span> prcomp<span class="punctuation">(</span>t<span class="punctuation">(</span>count<span class="punctuation">)</span><span class="punctuation">,</span> scale. <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span> </span><br><span class="line">ggbiplot<span class="punctuation">(</span>otu.pca<span class="punctuation">,</span> obs.scale <span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span> var.scale <span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span>groups <span class="operator">=</span> design<span class="operator">$</span>group<span class="punctuation">,</span> ellipse <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">,</span>var.axes <span class="operator">=</span> <span class="built_in">F</span><span class="punctuation">)</span></span><br><span class="line">OTUs_mad.5 <span class="operator">=</span> head<span class="punctuation">(</span>count<span class="punctuation">[</span>order<span class="punctuation">(</span>apply<span class="punctuation">(</span>count<span class="punctuation">,</span><span class="number">1</span><span class="punctuation">,</span>mad<span class="punctuation">)</span><span class="punctuation">,</span> decreasing<span class="operator">=</span><span class="built_in">T</span><span class="punctuation">)</span><span class="punctuation">,</span><span class="punctuation">]</span><span class="punctuation">,</span>n<span class="operator">=</span><span class="number">8</span><span class="punctuation">)</span> </span><br><span class="line">otu.pca <span class="operator">&lt;-</span> prcomp<span class="punctuation">(</span>t<span class="punctuation">(</span>OTUs_mad.5<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">ggbiplot<span class="punctuation">(</span>otu.pca<span class="punctuation">,</span> obs.scale <span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span> var.scale <span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span> groups <span class="operator">=</span> design<span class="operator">$</span>group<span class="punctuation">,</span> ellipse <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">,</span>var.axes <span class="operator">=</span> <span class="built_in">T</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 我们仅用中值绝对偏差(mad)最大的8个OTUs进行主成分分析，即可将三组样品明显分开。</span></span><br><span class="line"><span class="comment"># 图中向量长短代表差异贡献，方向为与主成分的相关性。可以看到最长的向量Streptophyta与X轴近平行，</span></span><br><span class="line"><span class="comment"># 表示PC1的差异主要由此菌贡献。其它菌与其方向相反代表OTUs间可能负相关；夹角小于90%的代表两个OTUs有正相关</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong>另外基于ggord的PCA</strong></p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">library<span class="punctuation">(</span>ggord<span class="punctuation">)</span> <span class="comment">#使用geom_ord_ellipse这个图层呢，随便你加置信区间，想加几个就加几个</span></span><br><span class="line"><span class="comment">#不仅针对LDA，也支持其它的ordination plot</span></span><br><span class="line">devtools<span class="operator">::</span>install_github<span class="punctuation">(</span><span class="string">&#x27;fawda123/ggord&#x27;</span><span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>ggord<span class="punctuation">)</span> </span><br><span class="line">library<span class="punctuation">(</span>MASS<span class="punctuation">)</span></span><br><span class="line">ord <span class="operator">&lt;-</span> prcomp<span class="punctuation">(</span>iris<span class="punctuation">[</span><span class="punctuation">,</span> <span class="operator">-</span><span class="number">5</span><span class="punctuation">]</span><span class="punctuation">)</span></span><br><span class="line">p <span class="operator">&lt;-</span> ggord<span class="punctuation">(</span>ord<span class="punctuation">,</span> iris<span class="operator">$</span>Species<span class="punctuation">)</span> ;p</span><br><span class="line">library<span class="punctuation">(</span>yyplot<span class="punctuation">)</span> </span><br><span class="line">p <span class="operator">+</span> geom_ord_ellipse<span class="punctuation">(</span>ellipse_pro <span class="operator">=</span> <span class="number">.96</span><span class="punctuation">,</span> color<span class="operator">=</span><span class="string">&#x27;firebrick&#x27;</span><span class="punctuation">,</span> size<span class="operator">=</span><span class="number">1</span><span class="punctuation">,</span> lty<span class="operator">=</span><span class="number">3</span><span class="punctuation">)</span> <span class="operator">+</span> </span><br><span class="line">  geom_ord_ellipse<span class="punctuation">(</span>ellipse_pro <span class="operator">=</span> <span class="number">.99</span><span class="punctuation">,</span> lty<span class="operator">=</span><span class="number">2</span><span class="punctuation">)</span>  </span><br></pre></td></tr></table></figure>
<p><strong>PCA</strong></p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#载入分析包</span></span><br><span class="line">library<span class="punctuation">(</span>FactoMineR<span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>ggrepel<span class="punctuation">)</span></span><br><span class="line"><span class="comment">#载入绘图数据</span></span><br><span class="line">df <span class="operator">&lt;-</span> read.table<span class="punctuation">(</span><span class="string">&quot;otu_taxa_table.txt&quot;</span><span class="punctuation">,</span>header <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">,</span>row.names <span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span>sep <span class="operator">=</span> <span class="string">&quot;\t&quot;</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment">#载入分组数据</span></span><br><span class="line">groups <span class="operator">&lt;-</span> read.table<span class="punctuation">(</span><span class="string">&quot;group.list.txt&quot;</span><span class="punctuation">,</span>header <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">,</span>sep <span class="operator">=</span> <span class="string">&quot;\t&quot;</span><span class="punctuation">,</span></span><br><span class="line">                     colClasses<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;character&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment">#绝对丰度表转化为相对丰度表</span></span><br><span class="line">df1 <span class="operator">&lt;-</span> matrix<span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span>nrow <span class="operator">=</span> nrow<span class="punctuation">(</span>df<span class="punctuation">)</span><span class="punctuation">,</span> ncol <span class="operator">=</span> ncol<span class="punctuation">(</span>df<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"><span class="keyword">for</span><span class="punctuation">(</span>i <span class="keyword">in</span> <span class="number">1</span><span class="operator">:</span>ncol<span class="punctuation">(</span>df<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">&#123;</span></span><br><span class="line">  df1<span class="punctuation">[</span><span class="punctuation">,</span>i<span class="punctuation">]</span> <span class="operator">=</span> df<span class="punctuation">[</span> <span class="punctuation">,</span>i<span class="punctuation">]</span><span class="operator">/</span><span class="built_in">sum</span><span class="punctuation">(</span>df<span class="punctuation">[</span> <span class="punctuation">,</span>i<span class="punctuation">]</span><span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line">colnames<span class="punctuation">(</span>df1<span class="punctuation">)</span> <span class="operator">&lt;-</span> colnames<span class="punctuation">(</span>df<span class="punctuation">)</span></span><br><span class="line">rownames<span class="punctuation">(</span>df1<span class="punctuation">)</span> <span class="operator">&lt;-</span> rownames<span class="punctuation">(</span>df<span class="punctuation">)</span></span><br><span class="line">df <span class="operator">&lt;-</span> t<span class="punctuation">(</span>df1<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#PCA        </span></span><br><span class="line">pca <span class="operator">&lt;-</span> PCA<span class="punctuation">(</span>df<span class="punctuation">[</span><span class="punctuation">,</span><span class="number">1</span><span class="operator">:</span>ncol<span class="punctuation">(</span>df<span class="punctuation">)</span><span class="punctuation">]</span><span class="punctuation">,</span>scale.unit <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">,</span>graph <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment">#PCA结果保存</span></span><br><span class="line">write.csv<span class="punctuation">(</span>pca<span class="operator">$</span>ind<span class="operator">$</span>coord<span class="punctuation">,</span>file<span class="operator">=</span><span class="string">&quot;pca.csv&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#支持一种分组方式和两种分组方式，</span></span><br><span class="line">pc1 <span class="operator">&lt;-</span> pca<span class="operator">$</span>ind<span class="operator">$</span>coord<span class="punctuation">[</span><span class="punctuation">,</span><span class="number">1</span><span class="punctuation">]</span></span><br><span class="line">pc2 <span class="operator">&lt;-</span> pca<span class="operator">$</span>ind<span class="operator">$</span>coord<span class="punctuation">[</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">]</span></span><br><span class="line">ncol <span class="operator">&lt;-</span> ncol<span class="punctuation">(</span>groups<span class="punctuation">)</span></span><br><span class="line">group1 <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line">group2 <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="punctuation">)</span> </span><br><span class="line"><span class="comment">#通过循环式的分组文件中样本的顺序与pca结果文件中一致</span></span><br><span class="line"><span class="keyword">for</span><span class="punctuation">(</span>i <span class="keyword">in</span> <span class="number">1</span><span class="operator">:</span><span class="built_in">length</span><span class="punctuation">(</span>groups<span class="operator">$</span>V1<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">&#123;</span></span><br><span class="line">  Order <span class="operator">&lt;-</span> grep<span class="punctuation">(</span>rownames<span class="punctuation">(</span>pca<span class="operator">$</span>ind<span class="operator">$</span>coord<span class="punctuation">)</span><span class="punctuation">[</span>i<span class="punctuation">]</span><span class="punctuation">,</span>groups<span class="operator">$</span>V1<span class="punctuation">)</span></span><br><span class="line">  group1<span class="punctuation">[</span>i<span class="punctuation">]</span> <span class="operator">&lt;-</span> groups<span class="operator">$</span>V2<span class="punctuation">[</span>Order<span class="punctuation">]</span></span><br><span class="line">  <span class="keyword">if</span><span class="punctuation">(</span>ncol<span class="operator">==</span><span class="number">3</span><span class="punctuation">)</span><span class="punctuation">&#123;</span></span><br><span class="line">    group2<span class="punctuation">[</span>i<span class="punctuation">]</span> <span class="operator">&lt;-</span> groups<span class="operator">$</span>V3<span class="punctuation">[</span>Order<span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="comment">#使用if来根据分组文件中的分组方式分别建立绘图文件</span></span><br><span class="line"><span class="keyword">if</span><span class="punctuation">(</span>ncol<span class="operator">==</span><span class="number">2</span><span class="punctuation">)</span><span class="punctuation">&#123;</span></span><br><span class="line">  plotdata <span class="operator">&lt;-</span> data.frame<span class="punctuation">(</span>rownames<span class="punctuation">(</span>pca<span class="operator">$</span>ind<span class="operator">$</span>coord<span class="punctuation">)</span><span class="punctuation">,</span>pc1<span class="punctuation">,</span>pc2<span class="punctuation">,</span>group1<span class="punctuation">)</span></span><br><span class="line">  colnames<span class="punctuation">(</span>plotdata<span class="punctuation">)</span> <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;sample&quot;</span><span class="punctuation">,</span><span class="string">&quot;PC1&quot;</span><span class="punctuation">,</span><span class="string">&quot;PC2&quot;</span><span class="punctuation">,</span><span class="string">&quot;group&quot;</span><span class="punctuation">)</span></span><br><span class="line">  point <span class="operator">&lt;-</span> geom_point<span class="punctuation">(</span>aes<span class="punctuation">(</span>color <span class="operator">=</span> group<span class="punctuation">,</span>fill <span class="operator">=</span> group<span class="punctuation">,</span>shape <span class="operator">=</span> group<span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">                      size <span class="operator">=</span> <span class="number">8</span><span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="keyword">else</span> <span class="keyword">if</span><span class="punctuation">(</span>ncol<span class="operator">==</span><span class="number">3</span><span class="punctuation">)</span><span class="punctuation">&#123;</span></span><br><span class="line">  plotdata <span class="operator">&lt;-</span> data.frame<span class="punctuation">(</span>rownames<span class="punctuation">(</span>pca<span class="operator">$</span>ind<span class="operator">$</span>coord<span class="punctuation">)</span><span class="punctuation">,</span>pc1<span class="punctuation">,</span>pc2<span class="punctuation">,</span>group1<span class="punctuation">,</span>group2<span class="punctuation">)</span></span><br><span class="line">  colnames<span class="punctuation">(</span>plotdata<span class="punctuation">)</span> <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;sample&quot;</span><span class="punctuation">,</span><span class="string">&quot;PC1&quot;</span><span class="punctuation">,</span><span class="string">&quot;PC2&quot;</span><span class="punctuation">,</span><span class="string">&quot;group1&quot;</span><span class="punctuation">,</span><span class="string">&quot;group2&quot;</span><span class="punctuation">)</span></span><br><span class="line">  point <span class="operator">&lt;-</span> geom_point<span class="punctuation">(</span>aes<span class="punctuation">(</span>color <span class="operator">=</span> group1<span class="punctuation">,</span>fill <span class="operator">=</span> group1<span class="punctuation">,</span>shape <span class="operator">=</span> group2<span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">                      size <span class="operator">=</span> <span class="number">8</span><span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#通过向量指定绘图中的一些参数，包括坐标轴文字、样本点形状和颜色。</span></span><br><span class="line">pc1 <span class="operator">&lt;-</span> <span class="built_in">floor</span><span class="punctuation">(</span>pca<span class="operator">$</span>eig<span class="punctuation">[</span><span class="number">1</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">]</span><span class="operator">*</span><span class="number">100</span><span class="punctuation">)</span><span class="operator">/</span><span class="number">100</span></span><br><span class="line">pc2 <span class="operator">&lt;-</span> <span class="built_in">floor</span><span class="punctuation">(</span>pca<span class="operator">$</span>eig<span class="punctuation">[</span><span class="number">2</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">]</span><span class="operator">*</span><span class="number">100</span><span class="punctuation">)</span><span class="operator">/</span><span class="number">100</span></span><br><span class="line">pich <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">22</span><span class="operator">:</span><span class="number">26</span><span class="punctuation">)</span></span><br><span class="line">cbbPalette <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;#E69F00&quot;</span><span class="punctuation">,</span> <span class="string">&quot;#56B4E9&quot;</span><span class="punctuation">,</span> <span class="string">&quot;#009E73&quot;</span><span class="punctuation">,</span> <span class="string">&quot;#F0E442&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#计算与PCA中前两轴相关的物种</span></span><br><span class="line">di <span class="operator">&lt;-</span> dimdesc<span class="punctuation">(</span>pca<span class="punctuation">,</span> axes <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">)</span><span class="punctuation">,</span> proba <span class="operator">=</span> <span class="number">0.05</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment">#根据相关性结果从大到小排序，每个轴选择排名前3的物种</span></span><br><span class="line">dim1.cor <span class="operator">&lt;-</span> pca<span class="operator">$</span>var<span class="operator">$</span>cor<span class="punctuation">[</span>row.names<span class="punctuation">(</span>pca<span class="operator">$</span>var<span class="operator">$</span>coord<span class="punctuation">)</span> <span class="operator">%in%</span> </span><br><span class="line">                          row.names<span class="punctuation">(</span>di<span class="operator">$</span>Dim.1<span class="operator">$</span>quanti<span class="punctuation">[</span>order<span class="punctuation">(</span>di<span class="operator">$</span>Dim.1<span class="operator">$</span>quanti<span class="punctuation">[</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">[</span><span class="number">1</span><span class="operator">:</span><span class="number">3</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">,</span><span class="punctuation">]</span> </span><br><span class="line">dim2.cor <span class="operator">&lt;-</span> pca<span class="operator">$</span>var<span class="operator">$</span>cor<span class="punctuation">[</span>row.names<span class="punctuation">(</span>pca<span class="operator">$</span>var<span class="operator">$</span>coord<span class="punctuation">)</span> <span class="operator">%in%</span> </span><br><span class="line">                          row.names<span class="punctuation">(</span>di<span class="operator">$</span>Dim.2<span class="operator">$</span>quanti<span class="punctuation">[</span>order<span class="punctuation">(</span>di<span class="operator">$</span>Dim.2<span class="operator">$</span>quanti<span class="punctuation">[</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">[</span><span class="number">1</span><span class="operator">:</span><span class="number">3</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">,</span><span class="punctuation">]</span></span><br><span class="line"><span class="comment">#建立绘图所需文件</span></span><br><span class="line">dim12.cor <span class="operator">&lt;-</span> rbind<span class="punctuation">(</span>dim1.cor<span class="punctuation">,</span>dim2.cor<span class="punctuation">)</span></span><br><span class="line">di.cor <span class="operator">&lt;-</span> dim12.cor<span class="punctuation">[</span><span class="punctuation">,</span><span class="number">1</span><span class="operator">:</span><span class="number">2</span><span class="punctuation">]</span></span><br><span class="line">di.cor <span class="operator">&lt;-</span> as.data.frame<span class="punctuation">(</span>di.cor<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#载入绘图包</span></span><br><span class="line">library<span class="punctuation">(</span>ggplot2<span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>ggrepel<span class="punctuation">)</span></span><br><span class="line"><span class="comment">#图像绘制</span></span><br><span class="line">p <span class="operator">&lt;-</span> ggplot<span class="punctuation">(</span>plotdata<span class="punctuation">,</span>aes<span class="punctuation">(</span>PC1<span class="punctuation">,</span>PC2<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  <span class="comment">#添加样本名称</span></span><br><span class="line">  geom_label_repel<span class="punctuation">(</span>aes<span class="punctuation">(</span>PC1<span class="punctuation">,</span>PC2<span class="punctuation">,</span>label <span class="operator">=</span> sample<span class="punctuation">)</span><span class="punctuation">,</span>fill <span class="operator">=</span> <span class="string">&quot;white&quot;</span><span class="punctuation">,</span>color <span class="operator">=</span> <span class="string">&quot;black&quot;</span><span class="punctuation">,</span></span><br><span class="line">                   box.padding <span class="operator">=</span> unit<span class="punctuation">(</span><span class="number">0.6</span><span class="punctuation">,</span><span class="string">&quot;lines&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span>segment.colour <span class="operator">=</span> <span class="string">&quot;grey50&quot;</span><span class="punctuation">,</span></span><br><span class="line">                   label.padding <span class="operator">=</span> unit<span class="punctuation">(</span><span class="number">0.35</span><span class="punctuation">,</span><span class="string">&quot;lines&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span>family <span class="operator">=</span> <span class="string">&quot;Arial&quot;</span><span class="punctuation">)</span> <span class="operator">+</span> </span><br><span class="line">  point <span class="operator">+</span> </span><br><span class="line">  scale_shape_manual<span class="punctuation">(</span>values <span class="operator">=</span> pich<span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  scale_fill_manual<span class="punctuation">(</span>values<span class="operator">=</span>cbbPalette<span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  scale_color_manual<span class="punctuation">(</span>values<span class="operator">=</span>cbbPalette<span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  labs<span class="punctuation">(</span>title<span class="operator">=</span><span class="string">&quot;PCA Plot&quot;</span><span class="punctuation">)</span> <span class="operator">+</span> </span><br><span class="line">  xlab<span class="punctuation">(</span>paste<span class="punctuation">(</span><span class="string">&quot;PC1 ( &quot;</span><span class="punctuation">,</span>pc1<span class="punctuation">,</span><span class="string">&quot;%&quot;</span><span class="punctuation">,</span><span class="string">&quot; )&quot;</span><span class="punctuation">,</span>sep<span class="operator">=</span><span class="string">&quot;&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span> </span><br><span class="line">  ylab<span class="punctuation">(</span>paste<span class="punctuation">(</span><span class="string">&quot;PC2 ( &quot;</span><span class="punctuation">,</span>pc2<span class="punctuation">,</span><span class="string">&quot;%&quot;</span><span class="punctuation">,</span><span class="string">&quot; )&quot;</span><span class="punctuation">,</span>sep<span class="operator">=</span><span class="string">&quot;&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  <span class="comment">#添加区分物种箭头</span></span><br><span class="line">  geom_segment<span class="punctuation">(</span>data <span class="operator">=</span> di.cor<span class="punctuation">,</span>aes<span class="punctuation">(</span>x <span class="operator">=</span> <span class="number">0</span><span class="punctuation">,</span>y <span class="operator">=</span> <span class="number">0</span><span class="punctuation">,</span>xend <span class="operator">=</span> di.cor<span class="punctuation">[</span><span class="punctuation">,</span><span class="number">1</span><span class="punctuation">]</span><span class="operator">*</span><span class="number">0.06</span><span class="punctuation">,</span></span><br><span class="line">                                 yend <span class="operator">=</span> di.cor<span class="punctuation">[</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">]</span><span class="operator">*</span><span class="number">0.06</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">               arrow <span class="operator">=</span> arrow<span class="punctuation">(</span>angle <span class="operator">=</span> <span class="number">40</span><span class="punctuation">,</span><span class="built_in">length</span> <span class="operator">=</span> unit<span class="punctuation">(</span><span class="number">0.4</span><span class="punctuation">,</span><span class="string">&quot;cm&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">,</span>size <span class="operator">=</span> <span class="number">1.5</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  <span class="comment">#添加区分物种名称</span></span><br><span class="line">  geom_label_repel<span class="punctuation">(</span>data <span class="operator">=</span> di.cor<span class="punctuation">,</span>aes<span class="punctuation">(</span>x <span class="operator">=</span> di.cor<span class="punctuation">[</span><span class="punctuation">,</span><span class="number">1</span><span class="punctuation">]</span><span class="operator">*</span><span class="number">0.06</span><span class="punctuation">,</span>y <span class="operator">=</span> di.cor<span class="punctuation">[</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">]</span><span class="operator">*</span><span class="number">0.06</span><span class="punctuation">,</span></span><br><span class="line">                                     label <span class="operator">=</span> rownames<span class="punctuation">(</span>di.cor<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">                   fill <span class="operator">=</span> <span class="string">&quot;grey50&quot;</span><span class="punctuation">,</span>color <span class="operator">=</span> <span class="string">&quot;white&quot;</span><span class="punctuation">,</span>box.padding <span class="operator">=</span> unit<span class="punctuation">(</span><span class="number">0.6</span><span class="punctuation">,</span><span class="string">&quot;lines&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">                   segment.colour <span class="operator">=</span> <span class="string">&quot;grey50&quot;</span><span class="punctuation">,</span>label.padding <span class="operator">=</span> unit<span class="punctuation">(</span><span class="number">0.35</span><span class="punctuation">,</span><span class="string">&quot;lines&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">                   family <span class="operator">=</span> <span class="string">&quot;Arial&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  theme<span class="punctuation">(</span>text<span class="operator">=</span>element_text<span class="punctuation">(</span>family <span class="operator">=</span> <span class="string">&quot;Arial&quot;</span><span class="punctuation">,</span>size <span class="operator">=</span> <span class="number">34</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  geom_vline<span class="punctuation">(</span>aes<span class="punctuation">(</span>xintercept <span class="operator">=</span> <span class="number">0</span><span class="punctuation">)</span><span class="punctuation">,</span>linetype <span class="operator">=</span> <span class="string">&quot;dotted&quot;</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  geom_hline<span class="punctuation">(</span>aes<span class="punctuation">(</span>yintercept <span class="operator">=</span> <span class="number">0</span><span class="punctuation">)</span><span class="punctuation">,</span>linetype <span class="operator">=</span> <span class="string">&quot;dotted&quot;</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  theme<span class="punctuation">(</span>panel.background <span class="operator">=</span> element_rect<span class="punctuation">(</span>fill <span class="operator">=</span> <span class="string">&#x27;white&#x27;</span><span class="punctuation">,</span> colour <span class="operator">=</span> <span class="string">&#x27;black&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">        panel.grid<span class="operator">=</span>element_blank<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">,</span> </span><br><span class="line">        axis.title <span class="operator">=</span> element_text<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&quot;black&quot;</span><span class="punctuation">,</span>size <span class="operator">=</span> <span class="number">34</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">        axis.ticks.length <span class="operator">=</span> unit<span class="punctuation">(</span><span class="number">0.4</span><span class="punctuation">,</span><span class="string">&quot;lines&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span> </span><br><span class="line">        axis.ticks <span class="operator">=</span> element_line<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&quot;black&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">        axis.line <span class="operator">=</span> element_line<span class="punctuation">(</span>colour <span class="operator">=</span> <span class="string">&quot;black&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span> </span><br><span class="line">        axis.title.x<span class="operator">=</span>element_text<span class="punctuation">(</span>colour <span class="operator">=</span> <span class="string">&quot;black&quot;</span><span class="punctuation">,</span> size <span class="operator">=</span> <span class="number">34</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">        axis.title.y<span class="operator">=</span>element_text<span class="punctuation">(</span>colour <span class="operator">=</span> <span class="string">&quot;black&quot;</span><span class="punctuation">,</span> size <span class="operator">=</span> <span class="number">34</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">        axis.text<span class="operator">=</span>element_text<span class="punctuation">(</span>colour <span class="operator">=</span> <span class="string">&quot;black&quot;</span><span class="punctuation">,</span>size<span class="operator">=</span><span class="number">28</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">        legend.title<span class="operator">=</span>element_text<span class="punctuation">(</span>colour <span class="operator">=</span> <span class="string">&quot;black&quot;</span><span class="punctuation">,</span>size <span class="operator">=</span> <span class="number">34</span><span class="punctuation">,</span>face <span class="operator">=</span> <span class="string">&quot;bold&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">        legend.key<span class="operator">=</span>element_blank<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">        legend.background <span class="operator">=</span> element_rect<span class="punctuation">(</span>colour <span class="operator">=</span> <span class="string">&quot;black&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">        legend.key.height<span class="operator">=</span>unit<span class="punctuation">(</span><span class="number">1.2</span><span class="punctuation">,</span><span class="string">&quot;cm&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">        plot.title <span class="operator">=</span> element_text<span class="punctuation">(</span>size<span class="operator">=</span><span class="number">34</span><span class="punctuation">,</span>colour <span class="operator">=</span> <span class="string">&quot;black&quot;</span><span class="punctuation">,</span>hjust <span class="operator">=</span> <span class="number">0.5</span><span class="punctuation">,</span></span><br><span class="line">                                  face <span class="operator">=</span> <span class="string">&quot;bold&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment">#保存为png图片</span></span><br><span class="line">png<span class="punctuation">(</span>filename<span class="operator">=</span><span class="string">&quot;PCA.png&quot;</span><span class="punctuation">,</span>res<span class="operator">=</span><span class="number">700</span><span class="punctuation">,</span>height<span class="operator">=</span><span class="number">5400</span><span class="punctuation">,</span>width<span class="operator">=</span><span class="number">7200</span><span class="punctuation">)</span></span><br><span class="line">p</span><br><span class="line">dev.off<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment">#保存为pdf格式</span></span><br><span class="line">cairo_pdf<span class="punctuation">(</span>filename<span class="operator">=</span><span class="string">&quot;PCA.pdf&quot;</span><span class="punctuation">,</span>height<span class="operator">=</span><span class="number">10</span><span class="punctuation">,</span>width<span class="operator">=</span><span class="number">10</span><span class="punctuation">)</span></span><br><span class="line">p</span><br><span class="line">dev.off<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#通过ggsymbol包添加更多点样式</span></span><br><span class="line">ggplot<span class="punctuation">(</span>plotdata<span class="punctuation">,</span> aes<span class="punctuation">(</span>PC1<span class="punctuation">,</span> PC2<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_symbol<span class="punctuation">(</span>aes<span class="punctuation">(</span>symbol<span class="operator">=</span>group2<span class="punctuation">,</span>fill<span class="operator">=</span>group1<span class="punctuation">,</span>colour<span class="operator">=</span>group1<span class="punctuation">)</span><span class="punctuation">,</span>size<span class="operator">=</span><span class="number">10</span><span class="punctuation">)</span><span class="operator">+</span> </span><br><span class="line">  scale_symbol_manual<span class="punctuation">(</span>values<span class="operator">=</span>pich<span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  scale_colour_manual<span class="punctuation">(</span>values<span class="operator">=</span>cbbPalette<span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  scale_fill_manual<span class="punctuation">(</span>values<span class="operator">=</span>cbbPalette<span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  geom_label_repel<span class="punctuation">(</span>aes<span class="punctuation">(</span>PC1<span class="punctuation">,</span>PC2<span class="punctuation">,</span>label <span class="operator">=</span> sample<span class="punctuation">)</span><span class="punctuation">,</span>fill <span class="operator">=</span> <span class="string">&quot;white&quot;</span><span class="punctuation">,</span>color <span class="operator">=</span> <span class="string">&quot;black&quot;</span><span class="punctuation">,</span></span><br><span class="line">                   box.padding <span class="operator">=</span> unit<span class="punctuation">(</span><span class="number">0.6</span><span class="punctuation">,</span><span class="string">&quot;lines&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span>segment.colour <span class="operator">=</span> <span class="string">&quot;grey50&quot;</span><span class="punctuation">,</span></span><br><span class="line">                   label.padding <span class="operator">=</span> unit<span class="punctuation">(</span><span class="number">0.35</span><span class="punctuation">,</span><span class="string">&quot;lines&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span>family <span class="operator">=</span> <span class="string">&quot;Arial&quot;</span><span class="punctuation">)</span> <span class="operator">+</span> </span><br><span class="line">  <span class="comment">#添加区分物种箭头</span></span><br><span class="line">  geom_segment<span class="punctuation">(</span>data <span class="operator">=</span> di.cor<span class="punctuation">,</span>aes<span class="punctuation">(</span>x <span class="operator">=</span> <span class="number">0</span><span class="punctuation">,</span>y <span class="operator">=</span> <span class="number">0</span><span class="punctuation">,</span>xend <span class="operator">=</span> di.cor<span class="punctuation">[</span><span class="punctuation">,</span><span class="number">1</span><span class="punctuation">]</span><span class="operator">*</span><span class="number">0.06</span><span class="punctuation">,</span></span><br><span class="line">                                 yend <span class="operator">=</span> di.cor<span class="punctuation">[</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">]</span><span class="operator">*</span><span class="number">0.06</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">               arrow <span class="operator">=</span> arrow<span class="punctuation">(</span>angle <span class="operator">=</span> <span class="number">40</span><span class="punctuation">,</span><span class="built_in">length</span> <span class="operator">=</span> unit<span class="punctuation">(</span><span class="number">0.4</span><span class="punctuation">,</span><span class="string">&quot;cm&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">,</span>size <span class="operator">=</span> <span class="number">1.5</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  <span class="comment">#添加区分物种名称</span></span><br><span class="line">  geom_label_repel<span class="punctuation">(</span>data <span class="operator">=</span> di.cor<span class="punctuation">,</span>aes<span class="punctuation">(</span>x <span class="operator">=</span> di.cor<span class="punctuation">[</span><span class="punctuation">,</span><span class="number">1</span><span class="punctuation">]</span><span class="operator">*</span><span class="number">0.06</span><span class="punctuation">,</span>y <span class="operator">=</span> di.cor<span class="punctuation">[</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">]</span><span class="operator">*</span><span class="number">0.06</span><span class="punctuation">,</span></span><br><span class="line">                                     label <span class="operator">=</span> rownames<span class="punctuation">(</span>di.cor<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">                   fill <span class="operator">=</span> <span class="string">&quot;grey50&quot;</span><span class="punctuation">,</span>color <span class="operator">=</span> <span class="string">&quot;white&quot;</span><span class="punctuation">,</span>box.padding <span class="operator">=</span> unit<span class="punctuation">(</span><span class="number">0.6</span><span class="punctuation">,</span><span class="string">&quot;lines&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">                   segment.colour <span class="operator">=</span> <span class="string">&quot;grey50&quot;</span><span class="punctuation">,</span>label.padding <span class="operator">=</span> unit<span class="punctuation">(</span><span class="number">0.35</span><span class="punctuation">,</span><span class="string">&quot;lines&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">                   family <span class="operator">=</span> <span class="string">&quot;Arial&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  labs<span class="punctuation">(</span>title<span class="operator">=</span><span class="string">&quot;PCoA - PC1-VS-PC2&quot;</span><span class="punctuation">)</span> <span class="operator">+</span> </span><br><span class="line">  xlab<span class="punctuation">(</span>paste<span class="punctuation">(</span><span class="string">&quot;PC1 ( &quot;</span><span class="punctuation">,</span>pc1<span class="punctuation">,</span><span class="string">&quot;%&quot;</span><span class="punctuation">,</span><span class="string">&quot; )&quot;</span><span class="punctuation">,</span>sep<span class="operator">=</span><span class="string">&quot;&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span> </span><br><span class="line">  ylab<span class="punctuation">(</span>paste<span class="punctuation">(</span><span class="string">&quot;PC2 ( &quot;</span><span class="punctuation">,</span>pc2<span class="punctuation">,</span><span class="string">&quot;%&quot;</span><span class="punctuation">,</span><span class="string">&quot; )&quot;</span><span class="punctuation">,</span>sep<span class="operator">=</span><span class="string">&quot;&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  theme<span class="punctuation">(</span>text<span class="operator">=</span>element_text<span class="punctuation">(</span>size<span class="operator">=</span><span class="number">30</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  geom_vline<span class="punctuation">(</span>aes<span class="punctuation">(</span>xintercept <span class="operator">=</span> <span class="number">0</span><span class="punctuation">)</span><span class="punctuation">,</span>linetype<span class="operator">=</span><span class="string">&quot;dotted&quot;</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  geom_hline<span class="punctuation">(</span>aes<span class="punctuation">(</span>yintercept <span class="operator">=</span> <span class="number">0</span><span class="punctuation">)</span><span class="punctuation">,</span>linetype<span class="operator">=</span><span class="string">&quot;dotted&quot;</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  theme<span class="punctuation">(</span>panel.background <span class="operator">=</span> element_rect<span class="punctuation">(</span>fill<span class="operator">=</span><span class="string">&#x27;white&#x27;</span><span class="punctuation">,</span> colour<span class="operator">=</span><span class="string">&#x27;black&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">        panel.grid<span class="operator">=</span>element_blank<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">        axis.title <span class="operator">=</span> element_text<span class="punctuation">(</span>color<span class="operator">=</span><span class="string">&#x27;black&#x27;</span><span class="punctuation">,</span>size<span class="operator">=</span><span class="number">34</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">        axis.ticks.length <span class="operator">=</span> unit<span class="punctuation">(</span><span class="number">0.4</span><span class="punctuation">,</span><span class="string">&quot;lines&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span> axis.ticks <span class="operator">=</span> element_line<span class="punctuation">(</span>color<span class="operator">=</span><span class="string">&#x27;black&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">        axis.line <span class="operator">=</span> element_line<span class="punctuation">(</span>colour <span class="operator">=</span> <span class="string">&quot;black&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">        axis.title.x<span class="operator">=</span>element_text<span class="punctuation">(</span>colour<span class="operator">=</span><span class="string">&#x27;black&#x27;</span><span class="punctuation">,</span> size<span class="operator">=</span><span class="number">34</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">        axis.title.y<span class="operator">=</span>element_text<span class="punctuation">(</span>colour<span class="operator">=</span><span class="string">&#x27;black&#x27;</span><span class="punctuation">,</span> size<span class="operator">=</span><span class="number">34</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">        axis.text<span class="operator">=</span>element_text<span class="punctuation">(</span>colour<span class="operator">=</span><span class="string">&#x27;black&#x27;</span><span class="punctuation">,</span>size<span class="operator">=</span><span class="number">28</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">        legend.title<span class="operator">=</span>element_text<span class="punctuation">(</span>colour <span class="operator">=</span> <span class="string">&quot;black&quot;</span><span class="punctuation">,</span>size <span class="operator">=</span> <span class="number">34</span><span class="punctuation">,</span>face <span class="operator">=</span> <span class="string">&quot;bold&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">        legend.text<span class="operator">=</span>element_text<span class="punctuation">(</span>size<span class="operator">=</span><span class="number">34</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">        legend.key<span class="operator">=</span>element_blank<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">        legend.background <span class="operator">=</span> element_rect<span class="punctuation">(</span>colour <span class="operator">=</span> <span class="string">&quot;black&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">        legend.key.height<span class="operator">=</span>unit<span class="punctuation">(</span><span class="number">1.6</span><span class="punctuation">,</span><span class="string">&quot;cm&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  theme<span class="punctuation">(</span>plot.title <span class="operator">=</span> element_text<span class="punctuation">(</span>size<span class="operator">=</span><span class="number">34</span><span class="punctuation">,</span>colour <span class="operator">=</span> <span class="string">&quot;black&quot;</span><span class="punctuation">,</span>hjust <span class="operator">=</span> <span class="number">0.5</span><span class="punctuation">,</span>face <span class="operator">=</span> <span class="string">&quot;bold&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="群落bar图"><strong>群落bar图</strong></h3>
<p><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s?__biz=MzIxNzc1Mzk3NQ==&amp;mid=2247483757&amp;idx=1&amp;sn=e3f6e387d6afef876dbd2af8b34e69dd&amp;chksm=97f5b175a0823863f9bf0ccc3272d1360a0b12869511dc82a0704a9aeeb5f4fb9fdaff8ed89a&amp;token=497100570&amp;lang=zh_CN&amp;scene=21#wechat_redirect">R语言画堆叠图实例</a></p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line">setwd<span class="punctuation">(</span><span class="string">&quot;./Abundance/Nr_abundance/&quot;</span><span class="punctuation">)</span></span><br><span class="line">getwd<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment">####读取并挑选 top10 丰度门 </span></span><br><span class="line"><span class="comment">#读取数据 </span></span><br><span class="line">rm<span class="punctuation">(</span><span class="built_in">list</span> <span class="operator">=</span> ls<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">phylum_top10 <span class="operator">&lt;-</span> read.delim<span class="punctuation">(</span><span class="string">&#x27;Genu.txt&#x27;</span><span class="punctuation">,</span> row.names <span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span> sep <span class="operator">=</span> <span class="string">&#x27;\t&#x27;</span><span class="punctuation">,</span> stringsAsFactors <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">,</span> check.names <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span></span><br><span class="line">phylum <span class="operator">&lt;-</span> apply<span class="punctuation">(</span>phylum_top10<span class="punctuation">,</span> <span class="number">2</span><span class="punctuation">,</span> <span class="keyword">function</span><span class="punctuation">(</span>x<span class="punctuation">)</span><span class="punctuation">&#123;</span>x<span class="operator">/</span><span class="built_in">sum</span><span class="punctuation">(</span>x<span class="punctuation">)</span><span class="punctuation">&#125;</span><span class="punctuation">)</span><span class="comment">#百分比化</span></span><br><span class="line">relative_abund_table<span class="operator">&lt;-</span>decostand<span class="punctuation">(</span>abund_table<span class="punctuation">,</span> method <span class="operator">=</span> <span class="string">&quot;total&quot;</span><span class="punctuation">)</span><span class="comment">#该方法也可直接计算百分比</span></span><br><span class="line">phylum_filter <span class="operator">&lt;-</span> data.frame<span class="punctuation">(</span>phylum<span class="punctuation">[</span>which<span class="punctuation">(</span>apply<span class="punctuation">(</span>phylum<span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">,</span> <span class="keyword">function</span><span class="punctuation">(</span>x<span class="punctuation">)</span><span class="punctuation">&#123;</span>mean<span class="punctuation">(</span>x<span class="punctuation">)</span><span class="punctuation">&#125;</span><span class="punctuation">)</span></span><br><span class="line">                                <span class="operator">&gt;</span><span class="number">0.001</span><span class="punctuation">)</span><span class="punctuation">,</span><span class="punctuation">]</span><span class="punctuation">,</span> check.names<span class="operator">=</span><span class="built_in">F</span><span class="punctuation">)</span> <span class="comment">#mean abundance &gt; 0.001</span></span><br><span class="line">phylum_filter <span class="operator">&lt;-</span>data.frame<span class="punctuation">(</span>phylum<span class="punctuation">[</span>apply<span class="punctuation">(</span>phylum<span class="punctuation">,</span><span class="number">1</span><span class="punctuation">,</span><span class="built_in">max</span><span class="punctuation">)</span><span class="operator">&gt;</span><span class="number">0.001</span><span class="punctuation">,</span><span class="punctuation">]</span><span class="punctuation">)</span><span class="comment">#去除至少有1个样品中大于%0.1的物种</span></span><br><span class="line">phylum_filter<span class="operator">$</span><span class="built_in">sum</span> <span class="operator">&lt;-</span> rowSums<span class="punctuation">(</span>phylum_filter<span class="punctuation">)</span><span class="comment">#求各类群的丰度总和，并排序</span></span><br><span class="line">phylum_filter <span class="operator">&lt;-</span> phylum_filter<span class="punctuation">[</span>order<span class="punctuation">(</span>phylum_filter<span class="operator">$</span><span class="built_in">sum</span><span class="punctuation">,</span> decreasing <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span><span class="punctuation">,</span> <span class="punctuation">]</span></span><br><span class="line"><span class="comment">#挑选 top10 门类群，并将 top10 外的类群合并为“Others”</span></span><br><span class="line">phylum_top10 <span class="operator">&lt;-</span> phylum_filter<span class="punctuation">[</span><span class="operator">-</span>ncol<span class="punctuation">(</span>phylum_filter<span class="punctuation">)</span><span class="punctuation">]</span></span><br><span class="line">phylum_top10<span class="punctuation">[</span><span class="string">&#x27;Others&#x27;</span><span class="punctuation">,</span> <span class="punctuation">]</span> <span class="operator">&lt;-</span> <span class="number">1</span> <span class="operator">-</span> colSums<span class="punctuation">(</span>phylum_top10<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#可选输出（如 csv 格式）</span></span><br><span class="line">write.table<span class="punctuation">(</span>phylum_top10<span class="punctuation">,</span> <span class="string">&#x27;Genu_0.001.txt&#x27;</span><span class="punctuation">,</span> <span class="built_in">quote</span> <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">,</span>sep <span class="operator">=</span> <span class="string">&#x27;\t&#x27;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">####barplot 作图（一个简单示例）</span></span><br><span class="line"><span class="comment">#定义作图整体分布</span></span><br><span class="line">tiff<span class="punctuation">(</span><span class="string">&#x27;barplot_plot.tiff&#x27;</span><span class="punctuation">,</span> width <span class="operator">=</span> <span class="number">1000</span><span class="punctuation">,</span> height <span class="operator">=</span> <span class="number">600</span><span class="punctuation">)</span></span><br><span class="line">par<span class="punctuation">(</span>xpd <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">,</span> mar <span class="operator">=</span> par<span class="punctuation">(</span><span class="punctuation">)</span><span class="operator">$</span>mar <span class="operator">+</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span> <span class="number">3</span><span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">,</span> <span class="number">16</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">par<span class="punctuation">(</span>mar<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">6</span><span class="punctuation">,</span><span class="number">8</span><span class="punctuation">,</span><span class="number">5</span><span class="punctuation">,</span><span class="number">5</span><span class="punctuation">)</span><span class="punctuation">,</span>xpd<span class="operator">=</span><span class="built_in">T</span><span class="punctuation">,</span>las<span class="operator">=</span><span class="number">2</span><span class="punctuation">,</span>mgp<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">4</span><span class="punctuation">,</span><span class="number">1</span><span class="punctuation">,</span><span class="number">0</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="comment">#mpg三个值分别控制轴标签、轴刻度值、轴刻度线与轴的距离</span></span><br><span class="line"><span class="comment">#barplot作图，包含了颜色、字体大小、图例位置等信息</span></span><br><span class="line">barplot<span class="punctuation">(</span>as.matrix<span class="punctuation">(</span><span class="number">100</span> <span class="operator">*</span> phylum_top10<span class="punctuation">)</span><span class="punctuation">,</span> col <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;blue&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;orange&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;green&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;yellow&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;red&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;hotpink&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;cyan&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;purple&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;burlywood1&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;skyblue&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;#8b8378&#x27;</span> <span class="punctuation">,</span><span class="string">&#x27;#458b74&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;#f0ffff&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;#eeb422&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;#ee6aa7&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;#8b3a62&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;#cd5c5c&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;#ee6363&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;#f0e68c&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;#e6e6fa&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;#add8e6&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;#bfefff&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;#f08080&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;#d1eeee&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;#7a8b8b&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;#8b814c&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;#8b5f65&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;gray&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">        legend <span class="operator">=</span> rownames<span class="punctuation">(</span>phylum_top10<span class="punctuation">)</span><span class="punctuation">,</span> </span><br><span class="line">        cex.axis <span class="operator">=</span> <span class="number">2</span><span class="punctuation">,</span> cex.names <span class="operator">=</span> <span class="number">2</span><span class="punctuation">,</span> ylim <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span> <span class="number">100</span><span class="punctuation">)</span><span class="punctuation">,</span> las <span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span> width <span class="operator">=</span> <span class="number">0.5</span><span class="punctuation">,</span> space <span class="operator">=</span> <span class="number">0.5</span><span class="punctuation">,</span> beside <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">,</span></span><br><span class="line">        args.legend <span class="operator">=</span> <span class="built_in">list</span><span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&#x27;right&#x27;</span><span class="punctuation">,</span> bty <span class="operator">=</span> <span class="string">&#x27;n&#x27;</span><span class="punctuation">,</span> inset <span class="operator">=</span> <span class="operator">-</span><span class="number">0.18</span><span class="punctuation">,</span> cex <span class="operator">=</span> <span class="number">2</span><span class="punctuation">,</span> y.intersp <span class="operator">=</span> <span class="number">1.2</span><span class="punctuation">,</span> x.intersp <span class="operator">=</span> <span class="number">0.7</span><span class="punctuation">,</span> text.width <span class="operator">=</span> <span class="number">1</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">mtext<span class="punctuation">(</span><span class="string">&#x27;Relative Abundance(%)&#x27;</span><span class="punctuation">,</span> cex <span class="operator">=</span> <span class="number">2</span><span class="punctuation">,</span> side <span class="operator">=</span> <span class="number">2</span><span class="punctuation">,</span> line <span class="operator">=</span> <span class="number">4</span><span class="punctuation">)</span></span><br><span class="line">dev.off<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">####ggplot2 作图（一个简单示例）</span></span><br><span class="line">library<span class="punctuation">(</span>reshape2<span class="punctuation">)</span>	<span class="comment">#用于排列数据</span></span><br><span class="line">library<span class="punctuation">(</span>ggplot2<span class="punctuation">)</span>	<span class="comment">#ggplot2 作图</span></span><br><span class="line"><span class="comment">#可以提前预设一个色板</span></span><br><span class="line">Palette1 <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;#B2182B&quot;</span><span class="punctuation">,</span><span class="string">&quot;#E69F00&quot;</span><span class="punctuation">,</span><span class="string">&quot;#56B4E9&quot;</span><span class="punctuation">,</span><span class="string">&quot;#009E73&quot;</span><span class="punctuation">,</span><span class="string">&quot;#F0E442&quot;</span><span class="punctuation">,</span><span class="string">&quot;#0072B2&quot;</span><span class="punctuation">,</span><span class="string">&quot;#D55E00&quot;</span><span class="punctuation">,</span><span class="string">&quot;#CC79A7&quot;</span><span class="punctuation">,</span><span class="string">&quot;#CC6666&quot;</span><span class="punctuation">,</span><span class="string">&quot;#9999CC&quot;</span><span class="punctuation">,</span><span class="string">&quot;#66CC99&quot;</span><span class="punctuation">,</span><span class="string">&quot;#999999&quot;</span><span class="punctuation">,</span><span class="string">&quot;#ADD1E5&quot;</span><span class="punctuation">)</span></span><br><span class="line">Palette2 <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;blue&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;orange&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;green&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;yellow&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;red&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;hotpink&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;cyan&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;purple&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;burlywood1&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;skyblue&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;#8b8378&#x27;</span> <span class="punctuation">,</span><span class="string">&#x27;#458b74&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;#f0ffff&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;#eeb422&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;#ee6aa7&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;#8b3a62&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;#cd5c5c&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;#ee6363&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;#f0e68c&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;#e6e6fa&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;#add8e6&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;#bfefff&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;#f08080&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;#d1eeee&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;#7a8b8b&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;#8b814c&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;#8b5f65&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;gray&#x27;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#调整数据布局</span></span><br><span class="line">phylum_top10<span class="operator">$</span>Taxonomy <span class="operator">&lt;-</span> factor<span class="punctuation">(</span>rownames<span class="punctuation">(</span>phylum_top10<span class="punctuation">)</span><span class="punctuation">,</span> levels <span class="operator">=</span> rev<span class="punctuation">(</span>rownames<span class="punctuation">(</span>phylum_top10<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">phylum_top10 <span class="operator">&lt;-</span> melt<span class="punctuation">(</span>phylum_top10<span class="punctuation">,</span> id <span class="operator">=</span> <span class="string">&#x27;Taxonomy&#x27;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#添加分组</span></span><br><span class="line">group <span class="operator">&lt;-</span> read.delim<span class="punctuation">(</span><span class="string">&#x27;sample.txt&#x27;</span><span class="punctuation">,</span> sep <span class="operator">=</span> <span class="string">&#x27;\t&#x27;</span><span class="punctuation">,</span> stringsAsFactors <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span></span><br><span class="line"><span class="built_in">names</span><span class="punctuation">(</span>group<span class="punctuation">)</span><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="operator">&lt;-</span> <span class="string">&#x27;variable&#x27;</span></span><br><span class="line">phylum_top10 <span class="operator">&lt;-</span> merge<span class="punctuation">(</span>phylum_top10<span class="punctuation">,</span> group<span class="punctuation">,</span> by <span class="operator">=</span> <span class="string">&#x27;variable&#x27;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#绘制带分面的柱状图</span></span><br><span class="line">p <span class="operator">&lt;-</span> ggplot<span class="punctuation">(</span>phylum_top10<span class="punctuation">,</span> aes<span class="punctuation">(</span>variable<span class="punctuation">,</span> <span class="number">100</span> <span class="operator">*</span> value<span class="punctuation">,</span> fill <span class="operator">=</span> Taxonomy<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_col<span class="punctuation">(</span>position <span class="operator">=</span> <span class="string">&#x27;stack&#x27;</span><span class="punctuation">,</span> width <span class="operator">=</span> <span class="number">0.6</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  scale_fill_manual<span class="punctuation">(</span>values <span class="operator">=</span>  Palette2<span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&#x27;&#x27;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&#x27;Relative Abundance(%)&#x27;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  theme<span class="punctuation">(</span>panel.grid <span class="operator">=</span> element_blank<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">,</span> panel.background <span class="operator">=</span> element_rect<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&#x27;black&#x27;</span><span class="punctuation">,</span> fill <span class="operator">=</span> <span class="string">&#x27;transparent&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span> strip.text <span class="operator">=</span> element_text<span class="punctuation">(</span>size <span class="operator">=</span> <span class="number">12</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  theme<span class="punctuation">(</span>axis.text <span class="operator">=</span> element_text<span class="punctuation">(</span>size <span class="operator">=</span> <span class="number">12</span><span class="punctuation">)</span><span class="punctuation">,</span> axis.title <span class="operator">=</span> element_text<span class="punctuation">(</span>size <span class="operator">=</span> <span class="number">13</span><span class="punctuation">)</span><span class="punctuation">,</span> legend.title <span class="operator">=</span> element_blank<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">,</span> legend.text <span class="operator">=</span> element_text<span class="punctuation">(</span>size <span class="operator">=</span> <span class="number">11</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  theme_classic<span class="punctuation">(</span><span class="punctuation">)</span><span class="operator">+</span>scale_y_continuous<span class="punctuation">(</span>expand <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span><span class="number">0</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment">#scale_y_continuous(labels = scales::percent) 设置Y轴数值为百分比数值</span></span><br><span class="line"></span><br><span class="line">p1 <span class="operator">&lt;-</span> p<span class="operator">+</span> theme<span class="punctuation">(</span>text <span class="operator">=</span> element_text<span class="punctuation">(</span>family <span class="operator">=</span> <span class="string">&quot;Times&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="operator">+</span>scale_y_continuous<span class="punctuation">(</span>limits <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span><span class="number">1</span><span class="punctuation">)</span><span class="punctuation">,</span>expand <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span><span class="number">0</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="comment">#去除空白及设置字体</span></span><br><span class="line"><span class="operator">+</span> theme<span class="punctuation">(</span>axis.text.x<span class="operator">=</span>element_text<span class="punctuation">(</span>colour<span class="operator">=</span><span class="string">&quot;black&quot;</span><span class="punctuation">,</span>size<span class="operator">=</span><span class="number">12</span><span class="punctuation">,</span>face <span class="operator">=</span> <span class="string">&quot;bold&quot;</span><span class="punctuation">,</span>angle <span class="operator">=</span> <span class="operator">-</span><span class="number">90</span><span class="punctuation">,</span>vjust <span class="operator">=</span> <span class="number">0.5</span><span class="punctuation">,</span>hjust <span class="operator">=</span> <span class="number">0</span><span class="punctuation">)</span><span class="punctuation">)</span> </span><br><span class="line"> <span class="punctuation">,</span></span><br><span class="line">p</span><br><span class="line">ggsave<span class="punctuation">(</span><span class="string">&#x27;Order_plot.pdf&#x27;</span><span class="punctuation">,</span> p<span class="punctuation">,</span> width <span class="operator">=</span> <span class="number">10</span><span class="punctuation">,</span> height <span class="operator">=</span> <span class="number">6</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##冲击图</span></span><br><span class="line">p2 <span class="operator">&lt;-</span> ggplot<span class="punctuation">(</span>data <span class="operator">=</span> phylum_top10<span class="punctuation">,</span>aes<span class="punctuation">(</span>x <span class="operator">=</span> variable<span class="punctuation">,</span> y <span class="operator">=</span> value<span class="punctuation">,</span> alluvium <span class="operator">=</span> Taxonomy<span class="punctuation">,</span> stratum <span class="operator">=</span> Taxonomy<span class="punctuation">)</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  geom_alluvium<span class="punctuation">(</span>aes<span class="punctuation">(</span>fill <span class="operator">=</span> Taxonomy<span class="punctuation">)</span><span class="punctuation">,</span>alpha <span class="operator">=</span> <span class="number">.5</span><span class="punctuation">,</span>width <span class="operator">=</span> <span class="number">0.6</span><span class="punctuation">)</span> <span class="operator">+</span> </span><br><span class="line">  geom_stratum<span class="punctuation">(</span>aes<span class="punctuation">(</span>fill <span class="operator">=</span> Taxonomy<span class="punctuation">)</span><span class="punctuation">,</span>width <span class="operator">=</span> <span class="number">0.6</span><span class="punctuation">)</span><span class="operator">+</span>scale_fill_manual<span class="punctuation">(</span>values <span class="operator">=</span> rev<span class="punctuation">(</span><span class="built_in">c</span><span class="punctuation">(</span>colour<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">theme_classic<span class="punctuation">(</span><span class="punctuation">)</span><span class="operator">+</span>scale_y_continuous<span class="punctuation">(</span>expand <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span><span class="number">0</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">   theme<span class="punctuation">(</span>panel.grid <span class="operator">=</span> element_blank<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">,</span> panel.background <span class="operator">=</span> element_rect<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&#x27;black&#x27;</span><span class="punctuation">,</span> fill <span class="operator">=</span> <span class="string">&#x27;transparent&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span> strip.text <span class="operator">=</span> element_text<span class="punctuation">(</span>size <span class="operator">=</span> <span class="number">12</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  theme<span class="punctuation">(</span>axis.text <span class="operator">=</span> element_text<span class="punctuation">(</span>size <span class="operator">=</span> <span class="number">12</span><span class="punctuation">)</span><span class="punctuation">,</span> axis.title <span class="operator">=</span> element_text<span class="punctuation">(</span>size <span class="operator">=</span> <span class="number">13</span><span class="punctuation">)</span><span class="punctuation">,</span> legend.title <span class="operator">=</span> element_blank<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">,</span> legend.text <span class="operator">=</span> element_text<span class="punctuation">(</span>size <span class="operator">=</span> <span class="number">11</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">ggsave<span class="punctuation">(</span><span class="string">&#x27;plpt.tiff&#x27;</span><span class="punctuation">,</span> p2<span class="punctuation">,</span> width <span class="operator">=</span> <span class="number">10</span><span class="punctuation">,</span> height <span class="operator">=</span> <span class="number">6</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<h4 id="带聚类树的bar图">带聚类树的bar图</h4>
<p><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s?__biz=MzIxNzc1Mzk3NQ==&amp;mid=2247484616&amp;idx=1&amp;sn=b7ed9e20bac5d8a8b3b72ded3d28227f&amp;chksm=97f5b4d0a0823dc6a365108ec7c5daf76a9402d28f1188b963fe307401eec3a52e8118e2570e&amp;token=497100570&amp;lang=zh_CN&amp;scene=21#wechat_redirect">R语言画聚类数实例</a></p>
<p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/f28d9fbd99f3">R语言聚类树图小例子</a></p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">hc<span class="operator">&lt;-</span>hclust<span class="punctuation">(</span>dist<span class="punctuation">(</span>USArrests<span class="punctuation">)</span><span class="punctuation">,</span>method<span class="operator">=</span><span class="string">&quot;ave&quot;</span><span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>ggdendro<span class="punctuation">)</span></span><br><span class="line">df1<span class="operator">&lt;-</span>dendro_data<span class="punctuation">(</span>hc<span class="punctuation">,</span>type<span class="operator">=</span><span class="string">&quot;rectangle&quot;</span><span class="punctuation">)</span></span><br><span class="line">ggplot<span class="punctuation">(</span>segment<span class="punctuation">(</span>df1<span class="punctuation">)</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  geom_segment<span class="punctuation">(</span>aes<span class="punctuation">(</span>x<span class="operator">=</span>x<span class="punctuation">,</span>y<span class="operator">=</span>y<span class="punctuation">,</span>xend<span class="operator">=</span>xend<span class="punctuation">,</span>yend<span class="operator">=</span>yend<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">ggplot<span class="punctuation">(</span>segment<span class="punctuation">(</span>df1<span class="punctuation">)</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  geom_segment<span class="punctuation">(</span>aes<span class="punctuation">(</span>x<span class="operator">=</span>x<span class="punctuation">,</span>y<span class="operator">=</span>y<span class="punctuation">,</span>xend<span class="operator">=</span>xend<span class="punctuation">,</span>yend<span class="operator">=</span>yend<span class="punctuation">)</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  geom_text<span class="punctuation">(</span>data<span class="operator">=</span>df1<span class="operator">$</span>labels<span class="punctuation">,</span>aes<span class="punctuation">(</span>x<span class="operator">=</span>x<span class="punctuation">,</span>y<span class="operator">=</span>y<span class="operator">-</span><span class="number">1</span><span class="punctuation">,</span>label<span class="operator">=</span>label<span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">            angle<span class="operator">=</span><span class="number">90</span><span class="punctuation">,</span>hjust<span class="operator">=</span><span class="number">1</span><span class="punctuation">,</span>vjust<span class="operator">=</span><span class="number">0.3</span><span class="punctuation">,</span>size<span class="operator">=</span><span class="number">3</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  scale_y_continuous<span class="punctuation">(</span>expand<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">0.2</span><span class="punctuation">,</span><span class="number">0</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  theme_bw<span class="punctuation">(</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  geom_point<span class="punctuation">(</span>data<span class="operator">=</span>df1<span class="operator">$</span>labels<span class="punctuation">,</span>aes<span class="punctuation">(</span>x<span class="operator">=</span>x<span class="punctuation">,</span>y<span class="operator">=</span>y<span class="punctuation">)</span><span class="punctuation">,</span>color<span class="operator">=</span><span class="string">&quot;red&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#给不同样品添加颜色</span></span><br><span class="line">df1<span class="operator">$</span>labels<span class="operator">$</span>Group<span class="operator">&lt;-</span><span class="built_in">c</span><span class="punctuation">(</span><span class="built_in">rep</span><span class="punctuation">(</span><span class="string">&quot;A&quot;</span><span class="punctuation">,</span><span class="number">16</span><span class="punctuation">)</span><span class="punctuation">,</span><span class="built_in">rep</span><span class="punctuation">(</span><span class="string">&quot;B&quot;</span><span class="punctuation">,</span><span class="number">14</span><span class="punctuation">)</span><span class="punctuation">,</span><span class="built_in">rep</span><span class="punctuation">(</span><span class="string">&quot;C&quot;</span><span class="punctuation">,</span><span class="number">20</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">ggplot<span class="punctuation">(</span>segment<span class="punctuation">(</span>df1<span class="punctuation">)</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  geom_segment<span class="punctuation">(</span>aes<span class="punctuation">(</span>x<span class="operator">=</span>x<span class="punctuation">,</span>y<span class="operator">=</span>y<span class="punctuation">,</span>xend<span class="operator">=</span>xend<span class="punctuation">,</span>yend<span class="operator">=</span>yend<span class="punctuation">)</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  geom_text<span class="punctuation">(</span>data<span class="operator">=</span>df1<span class="operator">$</span>labels<span class="punctuation">,</span>aes<span class="punctuation">(</span>x<span class="operator">=</span>x<span class="punctuation">,</span>y<span class="operator">=</span>y<span class="operator">-</span><span class="number">1</span><span class="punctuation">,</span>label<span class="operator">=</span>label<span class="punctuation">,</span>color<span class="operator">=</span>Group<span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">            angle<span class="operator">=</span><span class="number">90</span><span class="punctuation">,</span>hjust<span class="operator">=</span><span class="number">1</span><span class="punctuation">,</span>vjust<span class="operator">=</span><span class="number">0.3</span><span class="punctuation">,</span>size<span class="operator">=</span><span class="number">3</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  scale_y_continuous<span class="punctuation">(</span>expand<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">0.2</span><span class="punctuation">,</span><span class="number">0</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  theme_bw<span class="punctuation">(</span><span class="punctuation">)</span><span class="operator">+</span>labs<span class="punctuation">(</span>x<span class="operator">=</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span>y<span class="operator">=</span><span class="string">&quot;&quot;</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  geom_point<span class="punctuation">(</span>data<span class="operator">=</span>df1<span class="operator">$</span>labels<span class="punctuation">,</span>aes<span class="punctuation">(</span>x<span class="operator">=</span>x<span class="punctuation">,</span>y<span class="operator">=</span>y<span class="punctuation">,</span>color<span class="operator">=</span>Group<span class="punctuation">,</span>shape<span class="operator">=</span>Group<span class="punctuation">)</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  scale_color_brewer<span class="punctuation">(</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span>palette <span class="operator">=</span> <span class="string">&quot;Set1&quot;</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  theme<span class="punctuation">(</span>legend.position<span class="operator">=</span><span class="string">&quot;none&quot;</span><span class="punctuation">,</span></span><br><span class="line">        panel.grid<span class="operator">=</span>element_blank<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">        panel.border<span class="operator">=</span>element_blank<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">        axis.text <span class="operator">=</span> element_blank<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">        axis.ticks <span class="operator">=</span> element_blank<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#不同样品加上阴影效果</span></span><br><span class="line">ggplot<span class="punctuation">(</span>segment<span class="punctuation">(</span>df1<span class="punctuation">)</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  geom_segment<span class="punctuation">(</span>aes<span class="punctuation">(</span>x<span class="operator">=</span>x<span class="punctuation">,</span>y<span class="operator">=</span>y<span class="punctuation">,</span>xend<span class="operator">=</span>xend<span class="punctuation">,</span>yend<span class="operator">=</span>yend<span class="punctuation">)</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  geom_text<span class="punctuation">(</span>data<span class="operator">=</span>df1<span class="operator">$</span>labels<span class="punctuation">,</span>aes<span class="punctuation">(</span>x<span class="operator">=</span>x<span class="punctuation">,</span>y<span class="operator">=</span>y<span class="operator">-</span><span class="number">1</span><span class="punctuation">,</span>label<span class="operator">=</span>label<span class="punctuation">,</span>color<span class="operator">=</span>Group<span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">            angle<span class="operator">=</span><span class="number">90</span><span class="punctuation">,</span>hjust<span class="operator">=</span><span class="number">1</span><span class="punctuation">,</span>vjust<span class="operator">=</span><span class="number">0.3</span><span class="punctuation">,</span>size<span class="operator">=</span><span class="number">3</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  scale_y_continuous<span class="punctuation">(</span>expand<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">0.2</span><span class="punctuation">,</span><span class="number">0</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  theme_bw<span class="punctuation">(</span><span class="punctuation">)</span><span class="operator">+</span>labs<span class="punctuation">(</span>x<span class="operator">=</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span>y<span class="operator">=</span><span class="string">&quot;&quot;</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  geom_point<span class="punctuation">(</span>data<span class="operator">=</span>df1<span class="operator">$</span>labels<span class="punctuation">,</span>aes<span class="punctuation">(</span>x<span class="operator">=</span>x<span class="punctuation">,</span>y<span class="operator">=</span>y<span class="punctuation">,</span>color<span class="operator">=</span>Group<span class="punctuation">,</span>shape<span class="operator">=</span>Group<span class="punctuation">)</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  scale_color_brewer<span class="punctuation">(</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span>palette <span class="operator">=</span> <span class="string">&quot;Set1&quot;</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  theme<span class="punctuation">(</span>legend.position<span class="operator">=</span><span class="string">&quot;none&quot;</span><span class="punctuation">,</span></span><br><span class="line">        panel.grid<span class="operator">=</span>element_blank<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">        panel.border<span class="operator">=</span>element_blank<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">        axis.text <span class="operator">=</span> element_blank<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">        axis.ticks <span class="operator">=</span> element_blank<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  geom_rect<span class="punctuation">(</span>aes<span class="punctuation">(</span>xmin<span class="operator">=</span><span class="number">0</span><span class="punctuation">,</span>xmax<span class="operator">=</span><span class="number">16.5</span><span class="punctuation">,</span>ymin<span class="operator">=</span><span class="number">0</span><span class="punctuation">,</span>ymax<span class="operator">=</span><span class="number">90</span><span class="punctuation">)</span><span class="punctuation">,</span>color<span class="operator">=</span><span class="string">&quot;red&quot;</span><span class="punctuation">,</span>fill<span class="operator">=</span><span class="string">&quot;red&quot;</span><span class="punctuation">,</span>alpha<span class="operator">=</span><span class="number">0.005</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  geom_rect<span class="punctuation">(</span>aes<span class="punctuation">(</span>xmin<span class="operator">=</span><span class="number">16.5</span><span class="punctuation">,</span>xmax<span class="operator">=</span><span class="number">30.5</span><span class="punctuation">,</span>ymin<span class="operator">=</span><span class="number">0</span><span class="punctuation">,</span>ymax<span class="operator">=</span><span class="number">90</span><span class="punctuation">)</span><span class="punctuation">,</span>color<span class="operator">=</span><span class="string">&quot;blue&quot;</span><span class="punctuation">,</span>fill<span class="operator">=</span><span class="string">&quot;blue&quot;</span><span class="punctuation">,</span>alpha<span class="operator">=</span><span class="number">0.003</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  geom_rect<span class="punctuation">(</span>aes<span class="punctuation">(</span>xmin<span class="operator">=</span><span class="number">30.5</span><span class="punctuation">,</span>xmax<span class="operator">=</span><span class="number">50</span><span class="punctuation">,</span>ymin<span class="operator">=</span><span class="number">0</span><span class="punctuation">,</span>ymax<span class="operator">=</span><span class="number">90</span><span class="punctuation">)</span><span class="punctuation">,</span>color<span class="operator">=</span><span class="string">&quot;green&quot;</span><span class="punctuation">,</span>fill<span class="operator">=</span><span class="string">&quot;green&quot;</span><span class="punctuation">,</span>alpha<span class="operator">=</span><span class="number">0.005</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<img src="/2023/10/31/ggplot-picture/Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20200707161125971.png" alt="image-20200707161125971" style="zoom:50%;">
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#导入分组文件及丰度表文件</span></span><br><span class="line"><span class="comment">#层次聚类</span></span><br><span class="line"><span class="comment">#读取 OTU 丰度表</span></span><br><span class="line">dat <span class="operator">&lt;-</span> read.delim<span class="punctuation">(</span><span class="string">&#x27;phylum_top10.txt&#x27;</span><span class="punctuation">,</span> row.names <span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span> sep <span class="operator">=</span> <span class="string">&#x27;\t&#x27;</span><span class="punctuation">,</span> head <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">,</span> check.names <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">#计算样本间距离，以群落分析中常用的 Bray-curtis 距离为例</span></span><br><span class="line">dis_bray <span class="operator">&lt;-</span> vegan<span class="operator">::</span>vegdist<span class="punctuation">(</span>t<span class="punctuation">(</span>dat<span class="punctuation">)</span><span class="punctuation">,</span> method <span class="operator">=</span> <span class="string">&#x27;bray&#x27;</span><span class="punctuation">)</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">#层次聚类，以 UPGMA 为例</span></span><br><span class="line">tree <span class="operator">&lt;-</span> hclust<span class="punctuation">(</span>dis_bray<span class="punctuation">,</span> method <span class="operator">=</span> <span class="string">&#x27;average&#x27;</span><span class="punctuation">)</span></span><br><span class="line">tree</span><br><span class="line"> </span><br><span class="line">plot<span class="punctuation">(</span>tree<span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#接下来就是对聚类树进行调整。</span></span><br><span class="line">具体做法，首先定义一个画板，将聚类树放在画板的左侧，并按样本的已知分组信息给分支上色。聚类树的一些常见的可视化调整方法</span><br><span class="line"><span class="comment">##聚类树绘制</span></span><br><span class="line"><span class="comment">#样本分组颜色、名称等</span></span><br><span class="line">group <span class="operator">&lt;-</span> read.delim<span class="punctuation">(</span><span class="string">&#x27;group.txt&#x27;</span><span class="punctuation">,</span> row.names <span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span> sep <span class="operator">=</span> <span class="string">&#x27;\t&#x27;</span><span class="punctuation">,</span> head <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">,</span> check.names <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">,</span> stringsAsFactors <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span></span><br><span class="line">grp <span class="operator">&lt;-</span> group<span class="punctuation">[</span><span class="number">2</span><span class="punctuation">]</span></span><br><span class="line">group_col <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;red&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;blue&#x27;</span><span class="punctuation">)</span></span><br><span class="line"><span class="built_in">names</span><span class="punctuation">(</span>group_col<span class="punctuation">)</span> <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;1&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;2&#x27;</span><span class="punctuation">)</span></span><br><span class="line">group_name <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;Control&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;Treat&#x27;</span><span class="punctuation">)</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">#样本分组标签</span></span><br><span class="line">layout<span class="punctuation">(</span>t<span class="punctuation">(</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span> <span class="number">2</span><span class="punctuation">,</span> <span class="number">2</span><span class="punctuation">,</span> <span class="number">2</span><span class="punctuation">,</span> <span class="number">3</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">par<span class="punctuation">(</span>mar <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">5</span><span class="punctuation">,</span> <span class="number">2</span><span class="punctuation">,</span> <span class="number">5</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"> </span><br><span class="line">plot<span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span> type <span class="operator">=</span> <span class="string">&#x27;n&#x27;</span><span class="punctuation">,</span> xaxt <span class="operator">=</span> <span class="string">&#x27;n&#x27;</span><span class="punctuation">,</span> yaxt <span class="operator">=</span> <span class="string">&#x27;n&#x27;</span><span class="punctuation">,</span> frame.plot <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">,</span> xlab <span class="operator">=</span> <span class="string">&#x27;&#x27;</span><span class="punctuation">,</span> ylab <span class="operator">=</span> <span class="string">&#x27;&#x27;</span><span class="punctuation">,</span></span><br><span class="line">    xlim <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="operator">-</span><span class="built_in">max</span><span class="punctuation">(</span>tree<span class="operator">$</span>height<span class="punctuation">)</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">)</span><span class="punctuation">,</span> ylim <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span> <span class="built_in">length</span><span class="punctuation">(</span>tree<span class="operator">$</span>order<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">legend<span class="punctuation">(</span><span class="string">&#x27;topleft&#x27;</span><span class="punctuation">,</span> legend <span class="operator">=</span> group_name<span class="punctuation">,</span> pch <span class="operator">=</span> <span class="number">15</span><span class="punctuation">,</span> col <span class="operator">=</span> group_col<span class="punctuation">,</span> bty <span class="operator">=</span> <span class="string">&#x27;n&#x27;</span><span class="punctuation">,</span> cex <span class="operator">=</span> <span class="number">1</span><span class="punctuation">)</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">#聚类树绘制，按分组给分支上色</span></span><br><span class="line">treeline <span class="operator">&lt;-</span> <span class="keyword">function</span><span class="punctuation">(</span>pos1<span class="punctuation">,</span> pos2<span class="punctuation">,</span> height<span class="punctuation">,</span> col1<span class="punctuation">,</span> col2<span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">    meanpos <span class="operator">=</span> <span class="punctuation">(</span>pos1<span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="operator">+</span> pos2<span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">)</span> <span class="operator">/</span> <span class="number">2</span></span><br><span class="line">    segments<span class="punctuation">(</span>y0 <span class="operator">=</span> pos1<span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="operator">-</span> <span class="number">0.4</span><span class="punctuation">,</span> x0 <span class="operator">=</span> <span class="operator">-</span>pos1<span class="punctuation">[</span><span class="number">2</span><span class="punctuation">]</span><span class="punctuation">,</span> y1 <span class="operator">=</span> pos1<span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="operator">-</span> <span class="number">0.4</span><span class="punctuation">,</span> x1 <span class="operator">=</span> <span class="operator">-</span>height<span class="punctuation">,</span>  col <span class="operator">=</span> col1<span class="punctuation">,</span>lwd <span class="operator">=</span> <span class="number">2</span><span class="punctuation">)</span></span><br><span class="line">    segments<span class="punctuation">(</span>y0 <span class="operator">=</span> pos1<span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="operator">-</span> <span class="number">0.4</span><span class="punctuation">,</span> x0 <span class="operator">=</span> <span class="operator">-</span>height<span class="punctuation">,</span>  y1 <span class="operator">=</span> meanpos <span class="operator">-</span> <span class="number">0.4</span><span class="punctuation">,</span> x1 <span class="operator">=</span> <span class="operator">-</span>height<span class="punctuation">,</span>  col <span class="operator">=</span> col1<span class="punctuation">,</span>lwd <span class="operator">=</span> <span class="number">2</span><span class="punctuation">)</span></span><br><span class="line">    segments<span class="punctuation">(</span>y0 <span class="operator">=</span> meanpos <span class="operator">-</span> <span class="number">0.4</span><span class="punctuation">,</span> x0 <span class="operator">=</span> <span class="operator">-</span>height<span class="punctuation">,</span>  y1 <span class="operator">=</span> pos2<span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="operator">-</span> <span class="number">0.4</span><span class="punctuation">,</span> x1 <span class="operator">=</span> <span class="operator">-</span>height<span class="punctuation">,</span>  col <span class="operator">=</span> col2<span class="punctuation">,</span>lwd <span class="operator">=</span> <span class="number">2</span><span class="punctuation">)</span></span><br><span class="line">    segments<span class="punctuation">(</span>y0 <span class="operator">=</span> pos2<span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="operator">-</span> <span class="number">0.4</span><span class="punctuation">,</span> x0 <span class="operator">=</span> <span class="operator">-</span>height<span class="punctuation">,</span>  y1 <span class="operator">=</span> pos2<span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="operator">-</span> <span class="number">0.4</span><span class="punctuation">,</span> x1 <span class="operator">=</span> <span class="operator">-</span>pos2<span class="punctuation">[</span><span class="number">2</span><span class="punctuation">]</span><span class="punctuation">,</span> col <span class="operator">=</span> col2<span class="punctuation">,</span>lwd <span class="operator">=</span> <span class="number">2</span><span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"> </span><br><span class="line">meanpos <span class="operator">=</span> matrix<span class="punctuation">(</span><span class="built_in">rep</span><span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span> <span class="number">2</span> <span class="operator">*</span> <span class="built_in">length</span><span class="punctuation">(</span>tree<span class="operator">$</span>order<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">,</span> ncol <span class="operator">=</span> <span class="number">2</span><span class="punctuation">)</span></span><br><span class="line">meancol <span class="operator">=</span> <span class="built_in">rep</span><span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span> <span class="built_in">length</span><span class="punctuation">(</span>tree<span class="operator">$</span>order<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"><span class="keyword">for</span> <span class="punctuation">(</span>step <span class="keyword">in</span> <span class="number">1</span><span class="operator">:</span>nrow<span class="punctuation">(</span>tree<span class="operator">$</span>merge<span class="punctuation">)</span><span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="keyword">if</span><span class="punctuation">(</span>tree<span class="operator">$</span>merge<span class="punctuation">[</span>step<span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">]</span> <span class="operator">&lt;</span> <span class="number">0</span><span class="punctuation">)</span><span class="punctuation">&#123;</span></span><br><span class="line">        pos1 <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span>which<span class="punctuation">(</span>tree<span class="operator">$</span>order <span class="operator">==</span> <span class="operator">-</span>tree<span class="operator">$</span>merge<span class="punctuation">[</span>step<span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">)</span></span><br><span class="line">        col1 <span class="operator">&lt;-</span> group_col<span class="punctuation">[</span><span class="built_in">as.character</span><span class="punctuation">(</span>grp<span class="punctuation">[</span>tree<span class="operator">$</span>labels<span class="punctuation">[</span><span class="operator">-</span>tree<span class="operator">$</span>merge<span class="punctuation">[</span>step<span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span> <span class="keyword">else</span> <span class="punctuation">&#123;</span></span><br><span class="line">        pos1 <span class="operator">&lt;-</span> meanpos<span class="punctuation">[</span>tree<span class="operator">$</span>merge<span class="punctuation">[</span>step<span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">]</span><span class="punctuation">,</span> <span class="punctuation">]</span></span><br><span class="line">        col1 <span class="operator">&lt;-</span> meancol<span class="punctuation">[</span>tree<span class="operator">$</span>merge<span class="punctuation">[</span>step<span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">]</span><span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="keyword">if</span> <span class="punctuation">(</span>tree<span class="operator">$</span>merge<span class="punctuation">[</span>step<span class="punctuation">,</span> <span class="number">2</span><span class="punctuation">]</span> <span class="operator">&lt;</span> <span class="number">0</span><span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">        pos2 <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span>which<span class="punctuation">(</span>tree<span class="operator">$</span>order <span class="operator">==</span> <span class="operator">-</span>tree<span class="operator">$</span>merge<span class="punctuation">[</span>step<span class="punctuation">,</span> <span class="number">2</span><span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">)</span></span><br><span class="line">        col2 <span class="operator">&lt;-</span> group_col<span class="punctuation">[</span><span class="built_in">as.character</span><span class="punctuation">(</span>grp<span class="punctuation">[</span>tree<span class="operator">$</span>labels<span class="punctuation">[</span><span class="operator">-</span>tree<span class="operator">$</span>merge<span class="punctuation">[</span>step<span class="punctuation">,</span> <span class="number">2</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span> <span class="keyword">else</span> <span class="punctuation">&#123;</span></span><br><span class="line">        pos2 <span class="operator">&lt;-</span> meanpos<span class="punctuation">[</span>tree<span class="operator">$</span>merge<span class="punctuation">[</span>step<span class="punctuation">,</span> <span class="number">2</span><span class="punctuation">]</span><span class="punctuation">,</span> <span class="punctuation">]</span></span><br><span class="line">        col2 <span class="operator">&lt;-</span> meancol<span class="punctuation">[</span>tree<span class="operator">$</span>merge<span class="punctuation">[</span>step<span class="punctuation">,</span> <span class="number">2</span><span class="punctuation">]</span><span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">    height <span class="operator">&lt;-</span> tree<span class="operator">$</span>height<span class="punctuation">[</span>step<span class="punctuation">]</span></span><br><span class="line">    treeline<span class="punctuation">(</span>pos1<span class="punctuation">,</span> pos2<span class="punctuation">,</span> height<span class="punctuation">,</span> col1<span class="punctuation">,</span> col2<span class="punctuation">)</span></span><br><span class="line">    meanpos<span class="punctuation">[</span>step<span class="punctuation">,</span> <span class="punctuation">]</span> <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="punctuation">(</span>pos1<span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="operator">+</span> pos2<span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">)</span> <span class="operator">/</span> <span class="number">2</span><span class="punctuation">,</span> height<span class="punctuation">)</span></span><br><span class="line">    <span class="keyword">if</span> <span class="punctuation">(</span>col1 <span class="operator">==</span> col2<span class="punctuation">)</span> meancol<span class="punctuation">[</span>step<span class="punctuation">]</span> <span class="operator">&lt;-</span> col1 <span class="keyword">else</span> meancol<span class="punctuation">[</span>step<span class="punctuation">]</span> <span class="operator">&lt;-</span> <span class="string">&#x27;grey&#x27;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##堆叠柱形图</span></span><br><span class="line"><span class="comment">#样本顺序调整为和聚类树中的顺序一致</span></span><br><span class="line">dat <span class="operator">&lt;-</span> dat<span class="punctuation">[</span> <span class="punctuation">,</span>tree<span class="operator">$</span>order<span class="punctuation">]</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">#物种颜色设置</span></span><br><span class="line">phylum_color <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;#8DD3C7&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;#FFFFB3&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;#BEBADA&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;#FB8072&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;#80B1D3&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;#FDB462&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;#B3DE69&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;#FCCDE5&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;#BC80BD&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;#CCEBC5&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;gray&#x27;</span><span class="punctuation">)</span></span><br><span class="line"><span class="built_in">names</span><span class="punctuation">(</span>phylum_color<span class="punctuation">)</span> <span class="operator">&lt;-</span> rownames<span class="punctuation">(</span>dat<span class="punctuation">)</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">#堆叠柱形图</span></span><br><span class="line">par<span class="punctuation">(</span>mar <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">5</span><span class="punctuation">,</span> <span class="number">2</span><span class="punctuation">,</span> <span class="number">5</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"> </span><br><span class="line">bar <span class="operator">&lt;-</span> barplot<span class="punctuation">(</span>as.matrix<span class="punctuation">(</span>dat<span class="punctuation">)</span><span class="punctuation">,</span> col <span class="operator">=</span> phylum_color<span class="punctuation">,</span> space <span class="operator">=</span> <span class="number">0.4</span><span class="punctuation">,</span> width <span class="operator">=</span> <span class="number">0.7</span><span class="punctuation">,</span> cex.axis <span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span> horiz <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">,</span> cex.lab <span class="operator">=</span> <span class="number">1.2</span><span class="punctuation">,</span></span><br><span class="line">    xlab <span class="operator">=</span> <span class="string">&#x27;Relative Abundance&#x27;</span><span class="punctuation">,</span> yaxt <span class="operator">=</span> <span class="string">&#x27;n&#x27;</span><span class="punctuation">,</span> las <span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span> ylim <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span> ncol<span class="punctuation">(</span>dat<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">,</span> family <span class="operator">=</span> <span class="string">&#x27;mono&#x27;</span><span class="punctuation">)</span></span><br><span class="line"> </span><br><span class="line">mtext<span class="punctuation">(</span><span class="string">&#x27;Top 10 phylums&#x27;</span><span class="punctuation">,</span> side <span class="operator">=</span> <span class="number">3</span><span class="punctuation">,</span> line <span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span> cex <span class="operator">=</span> <span class="number">1</span><span class="punctuation">)</span></span><br><span class="line">text<span class="punctuation">(</span>x <span class="operator">=</span> <span class="operator">-</span><span class="number">0.05</span><span class="punctuation">,</span> y <span class="operator">=</span> bar<span class="punctuation">,</span> labels <span class="operator">=</span> colnames<span class="punctuation">(</span>dat<span class="punctuation">)</span><span class="punctuation">,</span> col <span class="operator">=</span> group_col<span class="punctuation">[</span>group<span class="punctuation">[</span>tree_order<span class="punctuation">,</span> <span class="number">2</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">,</span> xpd <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment">#首先按聚类树中样本的顺序重新调整丰度表中样本的顺序，以保持二者能够对应，并定义颜色属性。之后绘制堆叠柱形图，放置在画板右侧区域</span></span><br></pre></td></tr></table></figure>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#柱形图图例</span></span><br><span class="line">par<span class="punctuation">(</span>mar <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">5</span><span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">,</span> <span class="number">5</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">plot<span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span> type <span class="operator">=</span> <span class="string">&#x27;n&#x27;</span><span class="punctuation">,</span> xaxt <span class="operator">=</span> <span class="string">&#x27;n&#x27;</span><span class="punctuation">,</span> yaxt <span class="operator">=</span> <span class="string">&#x27;n&#x27;</span><span class="punctuation">,</span> bty <span class="operator">=</span> <span class="string">&#x27;n&#x27;</span><span class="punctuation">,</span> xlab <span class="operator">=</span> <span class="string">&#x27;&#x27;</span><span class="punctuation">,</span> ylab <span class="operator">=</span> <span class="string">&#x27;&#x27;</span><span class="punctuation">)</span></span><br><span class="line">legend<span class="punctuation">(</span><span class="string">&#x27;left&#x27;</span><span class="punctuation">,</span> pch <span class="operator">=</span> <span class="number">15</span><span class="punctuation">,</span> col <span class="operator">=</span> phylum_color<span class="punctuation">,</span> legend <span class="operator">=</span> <span class="built_in">names</span><span class="punctuation">(</span>phylum_color<span class="punctuation">)</span><span class="punctuation">,</span> bty <span class="operator">=</span> <span class="string">&#x27;n&#x27;</span><span class="punctuation">,</span> cex <span class="operator">=</span> <span class="number">1</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<p><strong>另一种方法聚类树柱图</strong></p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">rm<span class="punctuation">(</span><span class="built_in">list</span> <span class="operator">=</span> ls<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">getwd<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">library<span class="punctuation">(</span>tidyverse<span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>ggplot2<span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>ggtree<span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>treeio<span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>ggsci<span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>cowplot<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 导入OTU文件</span></span><br><span class="line">otu <span class="operator">=</span> read.table<span class="punctuation">(</span><span class="string">&#x27;phylum_top10.txt&#x27;</span><span class="punctuation">,</span> header <span class="operator">=</span>  <span class="built_in">T</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 计算距离后均值聚类并建树及可视化</span></span><br><span class="line">tree <span class="operator">=</span> hclust<span class="punctuation">(</span>vegan<span class="operator">::</span>vegdist<span class="punctuation">(</span>t<span class="punctuation">(</span>otu<span class="punctuation">)</span><span class="punctuation">,</span> method <span class="operator">=</span> <span class="string">&#x27;bray&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span> </span><br><span class="line">              method <span class="operator">=</span> <span class="string">&#x27;average&#x27;</span><span class="punctuation">)</span> <span class="operator">%&gt;%</span></span><br><span class="line">  as.phylo<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line">tree</span><br><span class="line"><span class="comment"># 选择节点，方便后续分开上色</span></span><br><span class="line">tree <span class="operator">=</span> groupClade<span class="punctuation">(</span>tree<span class="punctuation">,</span> .node<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">16</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 绘制聚类图</span></span><br><span class="line">p1 <span class="operator">=</span> ggtree<span class="punctuation">(</span>tree<span class="punctuation">,</span> aes<span class="punctuation">(</span>color<span class="operator">=</span>group<span class="punctuation">,</span> linetype<span class="operator">=</span>group<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span> </span><br><span class="line">  geom_tiplab<span class="punctuation">(</span>aes<span class="punctuation">(</span>color<span class="operator">=</span>group<span class="punctuation">)</span><span class="punctuation">)</span><span class="operator">+</span>geom_point<span class="punctuation">(</span>color<span class="operator">=</span><span class="string">&#x27;firebrick&#x27;</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">scale_color_manual<span class="punctuation">(</span>values <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;red&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;blue&#x27;</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="operator">+</span>theme<span class="punctuation">(</span>legend.position <span class="operator">=</span> <span class="string">&quot;none&quot;</span><span class="punctuation">)</span></span><br><span class="line">p1</span><br><span class="line"><span class="comment">#+geom_text2(aes(subset=!isTip, label=node), hjust=-.3)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 绘制物种组成柱状图</span></span><br><span class="line">otu<span class="operator">$</span>mean <span class="operator">=</span> apply<span class="punctuation">(</span>otu<span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">,</span> mean<span class="punctuation">)</span></span><br><span class="line">otu <span class="operator">=</span> otu<span class="punctuation">[</span>order<span class="punctuation">(</span>otu<span class="operator">$</span>mean<span class="punctuation">)</span><span class="punctuation">,</span><span class="punctuation">]</span></span><br><span class="line">otu<span class="operator">$</span>phylum <span class="operator">=</span> factor<span class="punctuation">(</span>rownames<span class="punctuation">(</span>otu<span class="punctuation">)</span><span class="punctuation">,</span> levels <span class="operator">=</span> rownames<span class="punctuation">(</span>otu<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">otu <span class="operator">=</span> otu<span class="punctuation">[</span><span class="punctuation">,</span> <span class="operator">-</span><span class="built_in">c</span><span class="punctuation">(</span>ncol<span class="punctuation">(</span>otu<span class="punctuation">)</span><span class="operator">-</span><span class="number">1</span><span class="punctuation">)</span><span class="punctuation">]</span></span><br><span class="line">p2 <span class="operator">=</span> otu <span class="operator">%&gt;%</span></span><br><span class="line">  reshape2<span class="operator">::</span>melt<span class="punctuation">(</span>id.vars <span class="operator">=</span> <span class="string">&#x27;phylum&#x27;</span><span class="punctuation">)</span> <span class="operator">%&gt;%</span></span><br><span class="line">  ggplot<span class="punctuation">(</span>aes<span class="punctuation">(</span>variable<span class="punctuation">,</span> value<span class="punctuation">,</span> fill <span class="operator">=</span> phylum<span class="punctuation">)</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  geom_bar<span class="punctuation">(</span>stat <span class="operator">=</span> <span class="string">&#x27;identity&#x27;</span><span class="punctuation">,</span> position <span class="operator">=</span> <span class="string">&#x27;fill&#x27;</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  scale_x_discrete<span class="punctuation">(</span>limits <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;t1&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;t2&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;t5&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;t4&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;t3&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;t6&#x27;</span><span class="punctuation">,</span></span><br><span class="line">                              <span class="string">&#x27;c1&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;c2&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;c6&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;c4&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;c3&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;c5&#x27;</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  scale_fill_igv<span class="punctuation">(</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  scale_y_continuous<span class="punctuation">(</span>expand <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span><span class="number">0</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line"> scale_y_continuous<span class="punctuation">(</span>labels <span class="operator">=</span> scales<span class="operator">::</span>percent<span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  coord_flip<span class="punctuation">(</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  theme_classic<span class="punctuation">(</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  theme<span class="punctuation">(</span>axis.ticks.y <span class="operator">=</span> element_blank<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">        axis.title.y <span class="operator">=</span> element_blank<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">        axis.text.y <span class="operator">=</span> element_blank<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">        axis.line <span class="operator">=</span> element_blank<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  labs<span class="punctuation">(</span>y <span class="operator">=</span> <span class="string">&#x27;Percentage&#x27;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">ggdraw<span class="punctuation">(</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  draw_plot<span class="punctuation">(</span>p1<span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">,</span> <span class="number">0.06</span><span class="punctuation">,</span> <span class="number">0.5</span><span class="punctuation">,</span> <span class="number">0.95</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  draw_plot<span class="punctuation">(</span>p2<span class="punctuation">,</span> <span class="number">0.49</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">,</span> <span class="number">0.5</span><span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<h4 id="堆叠面积图">堆叠面积图</h4>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">library<span class="punctuation">(</span>reshape2<span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>ggplot2<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##读取并挑选 top10 丰度门</span></span><br><span class="line"><span class="comment">#读取数据</span></span><br><span class="line">phylum <span class="operator">&lt;-</span> read.delim<span class="punctuation">(</span><span class="string">&#x27;phylum_table.txt&#x27;</span><span class="punctuation">,</span> row.names <span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span> sep <span class="operator">=</span> <span class="string">&#x27;\t&#x27;</span><span class="punctuation">,</span> stringsAsFactors <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">,</span> check.names <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#求各类群的丰度总和，并排序</span></span><br><span class="line">phylum<span class="operator">$</span><span class="built_in">sum</span> <span class="operator">&lt;-</span> rowSums<span class="punctuation">(</span>phylum<span class="punctuation">)</span></span><br><span class="line">phylum <span class="operator">&lt;-</span> phylum<span class="punctuation">[</span>order<span class="punctuation">(</span>phylum<span class="operator">$</span><span class="built_in">sum</span><span class="punctuation">,</span> decreasing <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span><span class="punctuation">,</span> <span class="punctuation">]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#挑选 top10 门类群，并将 top10 外的类群合并为“Others”</span></span><br><span class="line">phylum_top10 <span class="operator">&lt;-</span> phylum<span class="punctuation">[</span><span class="number">1</span><span class="operator">:</span><span class="number">10</span><span class="punctuation">,</span> <span class="operator">-</span>ncol<span class="punctuation">(</span>phylum<span class="punctuation">)</span><span class="punctuation">]</span></span><br><span class="line">phylum_top10<span class="punctuation">[</span><span class="string">&#x27;Others&#x27;</span><span class="punctuation">,</span> <span class="punctuation">]</span> <span class="operator">&lt;-</span> <span class="number">1</span> <span class="operator">-</span> colSums<span class="punctuation">(</span>phylum_top10<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#可选输出（如 csv 格式）</span></span><br><span class="line">write.csv<span class="punctuation">(</span>phylum_top10<span class="punctuation">,</span> <span class="string">&#x27;phylum_top10.csv&#x27;</span><span class="punctuation">,</span> <span class="built_in">quote</span> <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#表格样式重排，借助 reshape2 包 melt() 实现</span></span><br><span class="line">phylum_top10<span class="operator">$</span>Taxonomy <span class="operator">&lt;-</span> factor<span class="punctuation">(</span>rownames<span class="punctuation">(</span>phylum_top10<span class="punctuation">)</span><span class="punctuation">,</span> levels <span class="operator">=</span> rev<span class="punctuation">(</span>rownames<span class="punctuation">(</span>phylum_top10<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">phylum_top10 <span class="operator">&lt;-</span> melt<span class="punctuation">(</span>phylum_top10<span class="punctuation">,</span> id <span class="operator">=</span> <span class="string">&#x27;Taxonomy&#x27;</span><span class="punctuation">)</span></span><br><span class="line"><span class="built_in">names</span><span class="punctuation">(</span>phylum_top10<span class="punctuation">)</span><span class="punctuation">[</span><span class="number">2</span><span class="punctuation">]</span> <span class="operator">&lt;-</span> <span class="string">&#x27;sample&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#合并分组信息</span></span><br><span class="line">group <span class="operator">&lt;-</span> read.delim<span class="punctuation">(</span><span class="string">&#x27;group.txt&#x27;</span><span class="punctuation">,</span> sep <span class="operator">=</span> <span class="string">&#x27;\t&#x27;</span><span class="punctuation">,</span> stringsAsFactors <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">,</span> check.names <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span></span><br><span class="line">phylum_top10 <span class="operator">&lt;-</span> merge<span class="punctuation">(</span>phylum_top10<span class="punctuation">,</span> group<span class="punctuation">,</span> by <span class="operator">=</span> <span class="string">&#x27;sample&#x27;</span><span class="punctuation">,</span> all.x <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##ggplot2 堆叠面积图</span></span><br><span class="line"><span class="comment">#初始</span></span><br><span class="line">p <span class="operator">&lt;-</span> ggplot<span class="punctuation">(</span>phylum_top10<span class="punctuation">,</span> aes<span class="punctuation">(</span>x <span class="operator">=</span> times<span class="punctuation">,</span> y <span class="operator">=</span> <span class="number">100</span> <span class="operator">*</span> value<span class="punctuation">,</span> fill <span class="operator">=</span> Taxonomy<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">geom_area<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&#x27;Times&#x27;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&#x27;Relative Abundance(%)&#x27;</span><span class="punctuation">,</span> title <span class="operator">=</span> <span class="string">&#x27;&#x27;</span><span class="punctuation">,</span> fill <span class="operator">=</span> <span class="string">&#x27;Top10 Phylum&#x27;</span><span class="punctuation">)</span></span><br><span class="line">p</span><br><span class="line"></span><br><span class="line"><span class="comment">#稍作调整后</span></span><br><span class="line">p <span class="operator">&lt;-</span> p <span class="operator">+</span> </span><br><span class="line">scale_fill_manual<span class="punctuation">(</span>values <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;gray&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;skyblue&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;burlywood1&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;purple&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;cyan&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;hotpink&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;red&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;yellow&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;green&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;orange&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;blue&#x27;</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span>	<span class="comment">#设置颜色</span></span><br><span class="line">theme<span class="punctuation">(</span>panel.grid <span class="operator">=</span> element_blank<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">,</span> panel.background <span class="operator">=</span> element_rect<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&#x27;black&#x27;</span><span class="punctuation">,</span> fill <span class="operator">=</span> <span class="string">&#x27;transparent&#x27;</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span>	<span class="comment">#调整背景</span></span><br><span class="line">scale_x_continuous<span class="punctuation">(</span>breaks <span class="operator">=</span> <span class="number">1</span><span class="operator">:</span><span class="number">15</span><span class="punctuation">,</span> labels <span class="operator">=</span> <span class="built_in">as.character</span><span class="punctuation">(</span><span class="number">1</span><span class="operator">:</span><span class="number">15</span><span class="punctuation">)</span><span class="punctuation">,</span> expand <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span>	<span class="comment">#调整坐标轴轴刻度</span></span><br><span class="line">scale_y_continuous<span class="punctuation">(</span>expand <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">p</span><br><span class="line"></span><br><span class="line"><span class="comment">#ggsave(&#x27;ggplot2_area.pdf&#x27;, p, width = 7.5, height = 4.5)</span></span><br><span class="line">ggsave<span class="punctuation">(</span><span class="string">&#x27;ggplot2_area.png&#x27;</span><span class="punctuation">,</span> p<span class="punctuation">,</span> width <span class="operator">=</span> <span class="number">7.5</span><span class="punctuation">,</span> height <span class="operator">=</span> <span class="number">4.5</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#展示部分类群，例如挑选出 top5 丰度类群，其余（包括 Others）去除不展示</span></span><br><span class="line">phylum_top5 <span class="operator">&lt;-</span> subset<span class="punctuation">(</span>phylum_top10<span class="punctuation">,</span> Taxonomy <span class="operator">%in%</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;Proteobacteria&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;Acidobacteria&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;Bacteroidetes&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;Actinobacteria&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;Gemmatimonadetes&#x27;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">p <span class="operator">&lt;-</span> ggplot<span class="punctuation">(</span>phylum_top5<span class="punctuation">,</span> aes<span class="punctuation">(</span>x <span class="operator">=</span> times<span class="punctuation">,</span> y <span class="operator">=</span> <span class="number">100</span> <span class="operator">*</span> value<span class="punctuation">,</span> fill <span class="operator">=</span> Taxonomy<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">geom_area<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&#x27;Times&#x27;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&#x27;Relative Abundance(%)&#x27;</span><span class="punctuation">,</span> title <span class="operator">=</span> <span class="string">&#x27;&#x27;</span><span class="punctuation">,</span> fill <span class="operator">=</span> <span class="string">&#x27;Top5 Phylum&#x27;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">scale_fill_manual<span class="punctuation">(</span>values <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;red&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;yellow&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;green&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;orange&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;blue&#x27;</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span>	<span class="comment">#设置颜色</span></span><br><span class="line">theme<span class="punctuation">(</span>panel.grid <span class="operator">=</span> element_blank<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">,</span> panel.background <span class="operator">=</span> element_blank<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">,</span> axis.line <span class="operator">=</span> element_line<span class="punctuation">(</span>colour <span class="operator">=</span> <span class="string">&#x27;black&#x27;</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span>	<span class="comment">#调整背景</span></span><br><span class="line">scale_x_continuous<span class="punctuation">(</span>breaks <span class="operator">=</span> <span class="number">1</span><span class="operator">:</span><span class="number">15</span><span class="punctuation">,</span> labels <span class="operator">=</span> <span class="built_in">as.character</span><span class="punctuation">(</span><span class="number">1</span><span class="operator">:</span><span class="number">15</span><span class="punctuation">)</span><span class="punctuation">,</span> expand <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span>	<span class="comment">#调整坐标轴轴刻度</span></span><br><span class="line">scale_y_continuous<span class="punctuation">(</span>expand <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#ggsave(&#x27;ggplot2_area2.pdf&#x27;, p, width = 7.5, height = 4.5)</span></span><br><span class="line">ggsave<span class="punctuation">(</span><span class="string">&#x27;ggplot2_area2.png&#x27;</span><span class="punctuation">,</span> p<span class="punctuation">,</span> width <span class="operator">=</span> <span class="number">7.5</span><span class="punctuation">,</span> height <span class="operator">=</span> <span class="number">4.5</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<h4 id="丰度星星图">丰度星星图</h4>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##读取并挑选 top10 丰度门</span></span><br><span class="line"><span class="comment">#读取数据</span></span><br><span class="line">phylum <span class="operator">&lt;-</span> read.delim<span class="punctuation">(</span><span class="string">&#x27;phylum_table.txt&#x27;</span><span class="punctuation">,</span> row.names <span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span> sep <span class="operator">=</span> <span class="string">&#x27;\t&#x27;</span><span class="punctuation">,</span> stringsAsFactors <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">,</span> check.names <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#求各类群的丰度总和，并排序</span></span><br><span class="line">phylum<span class="operator">$</span><span class="built_in">sum</span> <span class="operator">&lt;-</span> rowSums<span class="punctuation">(</span>phylum<span class="punctuation">)</span></span><br><span class="line">phylum <span class="operator">&lt;-</span> phylum<span class="punctuation">[</span>order<span class="punctuation">(</span>phylum<span class="operator">$</span><span class="built_in">sum</span><span class="punctuation">,</span> decreasing <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span><span class="punctuation">,</span> <span class="punctuation">]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#挑选 top10 门类群，并将 top10 外的类群合并为“Others”</span></span><br><span class="line">phylum_top10 <span class="operator">&lt;-</span> phylum<span class="punctuation">[</span><span class="number">1</span><span class="operator">:</span><span class="number">10</span><span class="punctuation">,</span> <span class="operator">-</span>ncol<span class="punctuation">(</span>phylum<span class="punctuation">)</span><span class="punctuation">]</span></span><br><span class="line">phylum_top10<span class="punctuation">[</span><span class="string">&#x27;Others&#x27;</span><span class="punctuation">,</span> <span class="punctuation">]</span> <span class="operator">&lt;-</span> <span class="number">1</span> <span class="operator">-</span> colSums<span class="punctuation">(</span>phylum_top10<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#可选输出（如 csv 格式）</span></span><br><span class="line">write.csv<span class="punctuation">(</span>phylum_top10<span class="punctuation">,</span> <span class="string">&#x27;phylum_top10.csv&#x27;</span><span class="punctuation">,</span> <span class="built_in">quote</span> <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##stars() 作图（一个简单示例）</span></span><br><span class="line">t_phylum_top10 <span class="operator">&lt;-</span> data.frame<span class="punctuation">(</span>t<span class="punctuation">(</span>phylum_top10<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">color <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;blue&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;orange&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;green&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;yellow&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;red&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;hotpink&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;cyan&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;purple&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;burlywood1&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;skyblue&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;gray&#x27;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">png<span class="punctuation">(</span><span class="string">&#x27;stars_plot.png&#x27;</span><span class="punctuation">,</span> width <span class="operator">=</span> <span class="number">1500</span><span class="punctuation">,</span> height <span class="operator">=</span> <span class="number">1500</span><span class="punctuation">,</span> res <span class="operator">=</span> <span class="number">300</span><span class="punctuation">,</span> units <span class="operator">=</span> <span class="string">&#x27;px&#x27;</span><span class="punctuation">)</span></span><br><span class="line">stars<span class="punctuation">(</span>t_phylum_top10<span class="punctuation">,</span> scale <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">,</span> draw.segments <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">,</span> col.segments <span class="operator">=</span> color<span class="punctuation">,</span> nrow <span class="operator">=</span> <span class="number">2</span><span class="punctuation">,</span> ylim <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span> <span class="number">2</span><span class="punctuation">)</span><span class="punctuation">,</span> key.loc <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">6</span><span class="punctuation">,</span> <span class="operator">-</span><span class="number">1</span><span class="punctuation">)</span> <span class="punctuation">,</span> frame.plot <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">,</span> main <span class="operator">=</span> <span class="string">&#x27;Top10 Phylum&#x27;</span><span class="punctuation">)</span></span><br><span class="line">dev.off<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##ggplot2 作图（一个简单示例）</span></span><br><span class="line">library<span class="punctuation">(</span>reshape2<span class="punctuation">)</span>	<span class="comment">#用于排列数据</span></span><br><span class="line">library<span class="punctuation">(</span>ggplot2<span class="punctuation">)</span>	<span class="comment">#ggplot2 作图</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#调整数据布局</span></span><br><span class="line">phylum_top10<span class="operator">$</span>Taxonomy <span class="operator">&lt;-</span> factor<span class="punctuation">(</span>rownames<span class="punctuation">(</span>phylum_top10<span class="punctuation">)</span><span class="punctuation">,</span> levels <span class="operator">=</span> rownames<span class="punctuation">(</span>phylum_top10<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">phylum_top10_melt <span class="operator">&lt;-</span> melt<span class="punctuation">(</span>phylum_top10<span class="punctuation">,</span> id <span class="operator">=</span> <span class="string">&#x27;Taxonomy&#x27;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#以样本 c1 为例的星图，单一柱形图的坐标转换</span></span><br><span class="line">phylum_top10_c1 <span class="operator">&lt;-</span> subset<span class="punctuation">(</span>phylum_top10_melt<span class="punctuation">,</span> variable <span class="operator">==</span> <span class="string">&#x27;c1&#x27;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">p_c1 <span class="operator">&lt;-</span> ggplot<span class="punctuation">(</span>phylum_top10_c1<span class="punctuation">,</span> aes<span class="punctuation">(</span>Taxonomy<span class="punctuation">,</span> value<span class="punctuation">,</span> fill <span class="operator">=</span> Taxonomy<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">geom_bar<span class="punctuation">(</span>stat <span class="operator">=</span> <span class="string">&#x27;identity&#x27;</span><span class="punctuation">,</span> width <span class="operator">=</span> <span class="number">1</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">coord_polar<span class="punctuation">(</span>theta <span class="operator">=</span> <span class="string">&#x27;x&#x27;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">scale_fill_manual<span class="punctuation">(</span>values <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;blue&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;orange&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;green&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;yellow&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;red&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;hotpink&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;cyan&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;purple&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;burlywood1&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;skyblue&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;gray&#x27;</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&#x27;&#x27;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&#x27;&#x27;</span><span class="punctuation">,</span> title <span class="operator">=</span> <span class="string">&#x27;Sample: c1&#x27;</span><span class="punctuation">,</span> fill <span class="operator">=</span> <span class="string">&#x27;Top10 Phylum&#x27;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">theme<span class="punctuation">(</span>panel.grid <span class="operator">=</span> element_blank<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">,</span> panel.background <span class="operator">=</span> element_blank<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">,</span> axis.text <span class="operator">=</span> element_blank<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">,</span> axis.ticks <span class="operator">=</span> element_blank<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">,</span> plot.title <span class="operator">=</span> element_text<span class="punctuation">(</span>hjust <span class="operator">=</span> <span class="number">0.5</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#ggsave(&#x27;ggplot2_c1_plot.pdf&#x27;, p_c1, width = 5, height = 5)</span></span><br><span class="line">ggsave<span class="punctuation">(</span><span class="string">&#x27;ggplot2_c1_plot.png&#x27;</span><span class="punctuation">,</span> p_c1<span class="punctuation">,</span> width <span class="operator">=</span> <span class="number">5</span><span class="punctuation">,</span> height <span class="operator">=</span> <span class="number">5</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#所有样本，堆叠柱形图的坐标转换</span></span><br><span class="line">p_all <span class="operator">&lt;-</span> ggplot<span class="punctuation">(</span>phylum_top10_melt<span class="punctuation">,</span> aes<span class="punctuation">(</span>variable<span class="punctuation">,</span> value<span class="punctuation">,</span> fill <span class="operator">=</span> Taxonomy<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">geom_bar<span class="punctuation">(</span>stat <span class="operator">=</span> <span class="string">&#x27;identity&#x27;</span><span class="punctuation">,</span> width <span class="operator">=</span> <span class="number">0.6</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">coord_polar<span class="punctuation">(</span>theta <span class="operator">=</span> <span class="string">&#x27;x&#x27;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">scale_fill_manual<span class="punctuation">(</span>values <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;blue&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;orange&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;green&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;yellow&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;red&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;hotpink&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;cyan&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;purple&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;burlywood1&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;skyblue&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;gray&#x27;</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&#x27;&#x27;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&#x27;&#x27;</span><span class="punctuation">,</span> fill <span class="operator">=</span> <span class="string">&#x27;Top10 Phylum&#x27;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">theme<span class="punctuation">(</span>panel.grid <span class="operator">=</span> element_blank<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">,</span> panel.background <span class="operator">=</span> element_blank<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">,</span> axis.text.y <span class="operator">=</span> element_blank<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">,</span> axis.ticks <span class="operator">=</span> element_blank<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#ggsave(&#x27;ggplot2_all_plot.pdf&#x27;, p_all, width = 5, height = 5)</span></span><br><span class="line">ggsave<span class="punctuation">(</span><span class="string">&#x27;ggplot2_all_plot.png&#x27;</span><span class="punctuation">,</span> p_all<span class="punctuation">,</span> width <span class="operator">=</span> <span class="number">5</span><span class="punctuation">,</span> height <span class="operator">=</span> <span class="number">5</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##一个 ggplot2 的多图组合样式，借助 grid 包完成</span></span><br><span class="line">library<span class="punctuation">(</span>grid<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#获取所有样本名称</span></span><br><span class="line">sample_name <span class="operator">&lt;-</span> levels<span class="punctuation">(</span>phylum_top10_melt<span class="operator">$</span>variable<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#创建画板，根据样本数（此处为 8 个）预设图片位置</span></span><br><span class="line"><span class="comment">#pdf(&#x27;grid_plot.pdf&#x27;, width = 9, height = 5)</span></span><br><span class="line">png<span class="punctuation">(</span><span class="string">&#x27;grid_plot.png&#x27;</span><span class="punctuation">,</span> width <span class="operator">=</span> <span class="number">3000</span><span class="punctuation">,</span> height <span class="operator">=</span> <span class="number">1500</span><span class="punctuation">,</span> res <span class="operator">=</span> <span class="number">300</span><span class="punctuation">,</span> units <span class="operator">=</span> <span class="string">&#x27;px&#x27;</span><span class="punctuation">)</span></span><br><span class="line">grid.newpage<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">n <span class="operator">&lt;-</span> 8</span><br><span class="line">split_x <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">0.1</span><span class="punctuation">,</span> <span class="number">0.3</span><span class="punctuation">,</span> <span class="number">0.5</span><span class="punctuation">,</span> <span class="number">0.7</span><span class="punctuation">,</span> <span class="number">0.1</span><span class="punctuation">,</span> <span class="number">0.3</span><span class="punctuation">,</span> <span class="number">0.5</span><span class="punctuation">,</span> <span class="number">0.7</span><span class="punctuation">)</span>	<span class="comment">#预设 8 张子图的横坐标</span></span><br><span class="line">split_y <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">0.6</span><span class="punctuation">,</span> <span class="number">0.6</span><span class="punctuation">,</span> <span class="number">0.6</span><span class="punctuation">,</span> <span class="number">0.6</span><span class="punctuation">,</span> <span class="number">0.1</span><span class="punctuation">,</span> <span class="number">0.1</span><span class="punctuation">,</span> <span class="number">0.1</span><span class="punctuation">,</span> <span class="number">0.1</span><span class="punctuation">)</span>	<span class="comment">#预设 8 张子图的纵坐标</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#使用循环，使用 ggplot2 分别绘制 8 个样本的物种丰度星图，并放置在画板对应的位置中</span></span><br><span class="line"><span class="keyword">for</span> <span class="punctuation">(</span>i <span class="keyword">in</span> <span class="number">1</span><span class="operator">:</span>n<span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">	p_i <span class="operator">&lt;-</span> ggplot<span class="punctuation">(</span>subset<span class="punctuation">(</span>phylum_top10_melt<span class="punctuation">,</span> variable <span class="operator">==</span> sample_name<span class="punctuation">[</span>i<span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">,</span> aes<span class="punctuation">(</span>Taxonomy<span class="punctuation">,</span> value<span class="punctuation">,</span> fill <span class="operator">=</span> Taxonomy<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">		geom_bar<span class="punctuation">(</span>stat <span class="operator">=</span> <span class="string">&#x27;identity&#x27;</span><span class="punctuation">,</span> width <span class="operator">=</span> <span class="number">1</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">		coord_polar<span class="punctuation">(</span>theta <span class="operator">=</span> <span class="string">&#x27;x&#x27;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">		scale_fill_manual<span class="punctuation">(</span>values <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;blue&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;orange&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;green&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;yellow&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;red&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;hotpink&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;cyan&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;purple&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;burlywood1&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;skyblue&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;gray&#x27;</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">		labs<span class="punctuation">(</span>title <span class="operator">=</span> paste<span class="punctuation">(</span><span class="string">&#x27;Sample:&#x27;</span><span class="punctuation">,</span> sample_name<span class="punctuation">[</span>i<span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&#x27;&#x27;</span><span class="punctuation">,</span> x <span class="operator">=</span> <span class="string">&#x27;&#x27;</span><span class="punctuation">,</span> fill <span class="operator">=</span> <span class="string">&#x27;Top10 Phylum&#x27;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">		theme<span class="punctuation">(</span>plot.background <span class="operator">=</span> element_blank<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">,</span> panel.grid <span class="operator">=</span> element_blank<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">,</span> panel.background <span class="operator">=</span> element_blank<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">,</span> axis.text <span class="operator">=</span> element_blank<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">,</span> axis.ticks <span class="operator">=</span> element_blank<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">,</span> plot.title <span class="operator">=</span> element_text<span class="punctuation">(</span>hjust <span class="operator">=</span> <span class="number">0.5</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">	</span><br><span class="line">	print<span class="punctuation">(</span>p_i <span class="operator">+</span> theme<span class="punctuation">(</span>legend.position <span class="operator">=</span> <span class="string">&#x27;none&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span> vp <span class="operator">=</span> viewport<span class="punctuation">(</span>x <span class="operator">=</span> split_x<span class="punctuation">[</span>i<span class="punctuation">]</span><span class="punctuation">,</span> y <span class="operator">=</span> split_y<span class="punctuation">[</span>i<span class="punctuation">]</span><span class="punctuation">,</span> width <span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span> height <span class="operator">=</span> <span class="number">0.8</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#该函数用于在 ggplot2 中提取图例，参考自 https://stackoverflow.com/questions/13712574/how-to-change-position-of-grid-draw</span></span><br><span class="line"><span class="comment">#前述博文“饼图（扇形图）”中也使用到了这个方法提取 ggplot2 的图例，可参见 http://blog.sciencenet.cn/blog-3406804-1170610.html</span></span><br><span class="line">g_legend <span class="operator">&lt;-</span> <span class="keyword">function</span><span class="punctuation">(</span>gg_plot<span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">	tmp <span class="operator">&lt;-</span> ggplot_gtable<span class="punctuation">(</span>ggplot_build<span class="punctuation">(</span>gg_plot<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">	leg <span class="operator">&lt;-</span> which<span class="punctuation">(</span>sapply<span class="punctuation">(</span>tmp<span class="operator">$</span>grobs<span class="punctuation">,</span> <span class="keyword">function</span><span class="punctuation">(</span>x<span class="punctuation">)</span> x<span class="operator">$</span>name<span class="punctuation">)</span> <span class="operator">==</span> <span class="string">&#x27;guide-box&#x27;</span><span class="punctuation">)</span></span><br><span class="line">	leg <span class="operator">&lt;-</span> tmp<span class="operator">$</span>grobs<span class="punctuation">[[</span>leg<span class="punctuation">]</span><span class="punctuation">]</span></span><br><span class="line">	leg</span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#截取图例添加至组合图中</span></span><br><span class="line">phylum_legend <span class="operator">&lt;-</span> g_legend<span class="punctuation">(</span>p_i<span class="punctuation">)</span></span><br><span class="line">phylum_legend<span class="operator">$</span>vp<span class="operator">$</span>x <span class="operator">&lt;-</span> unit<span class="punctuation">(</span><span class="number">0.92</span><span class="punctuation">,</span> <span class="string">&#x27;npc&#x27;</span><span class="punctuation">)</span>	<span class="comment">#指定图例在 grid 画板中的横坐标位置</span></span><br><span class="line">phylum_legend<span class="operator">$</span>vp<span class="operator">$</span>y <span class="operator">&lt;-</span> unit<span class="punctuation">(</span><span class="number">0.5</span><span class="punctuation">,</span> <span class="string">&#x27;npc&#x27;</span><span class="punctuation">)</span>	<span class="comment">#指定图例在 grid 画板中的纵坐标位置</span></span><br><span class="line">grid.draw<span class="punctuation">(</span>phylum_legend<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#完成后关闭</span></span><br><span class="line">dev.off<span class="punctuation">(</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<h4 id="圆角柱形图">圆角柱形图</h4>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">library<span class="punctuation">(</span>ggplot2<span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>RColorBrewer<span class="punctuation">)</span></span><br><span class="line">install.packages<span class="punctuation">(</span><span class="string">&quot;ggchicklet&quot;</span><span class="punctuation">,</span> repos <span class="operator">=</span> <span class="string">&quot;https://cinc.rud.is&quot;</span><span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>ggchicklet<span class="punctuation">)</span></span><br><span class="line">x<span class="operator">&lt;-</span><span class="built_in">LETTERS</span><span class="punctuation">[</span><span class="number">1</span><span class="operator">:</span><span class="number">14</span><span class="punctuation">]</span></span><br><span class="line">y<span class="operator">&lt;-</span><span class="number">1</span><span class="operator">:</span><span class="number">14</span></span><br><span class="line">df<span class="operator">&lt;-</span>data.frame<span class="punctuation">(</span>x<span class="punctuation">,</span>y<span class="punctuation">)</span></span><br><span class="line">df</span><br><span class="line"></span><br><span class="line">ggplot<span class="punctuation">(</span>df<span class="punctuation">,</span>aes<span class="punctuation">(</span>x<span class="punctuation">,</span>y<span class="punctuation">)</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  geom_chicklet<span class="punctuation">(</span>aes<span class="punctuation">(</span>fill<span class="operator">=</span>x<span class="punctuation">)</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  scale_fill_manual<span class="punctuation">(</span>name<span class="operator">=</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    values <span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span>brewer.pal<span class="punctuation">(</span><span class="number">4</span><span class="punctuation">,</span><span class="string">&quot;Paired&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">                              brewer.pal<span class="punctuation">(</span><span class="number">10</span><span class="punctuation">,</span><span class="string">&quot;Paired&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  theme_bw<span class="punctuation">(</span><span class="punctuation">)</span><span class="operator">+</span>labs<span class="punctuation">(</span>x<span class="operator">=</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span>y<span class="operator">=</span><span class="string">&quot;&quot;</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment">#实现圆角柱形图只需要将geom_col()函数换成geom_chicklet()函数就可以了,ggchicklet包下载</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#组成图</span></span><br><span class="line">df<span class="operator">&lt;-</span>data.frame<span class="punctuation">(</span>Year<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="built_in">rep</span><span class="punctuation">(</span><span class="string">&quot;2019&quot;</span><span class="punctuation">,</span><span class="number">12</span><span class="punctuation">)</span><span class="punctuation">,</span><span class="built_in">rep</span><span class="punctuation">(</span><span class="string">&quot;2018&quot;</span><span class="punctuation">,</span><span class="number">12</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">                      <span class="built_in">rep</span><span class="punctuation">(</span><span class="string">&quot;2017&quot;</span><span class="punctuation">,</span><span class="number">12</span><span class="punctuation">)</span><span class="punctuation">,</span><span class="built_in">rep</span><span class="punctuation">(</span><span class="string">&quot;2017&quot;</span><span class="punctuation">,</span><span class="number">12</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">                      <span class="built_in">rep</span><span class="punctuation">(</span><span class="string">&quot;2016&quot;</span><span class="punctuation">,</span><span class="number">12</span><span class="punctuation">)</span><span class="punctuation">,</span><span class="built_in">rep</span><span class="punctuation">(</span><span class="string">&quot;2015&quot;</span><span class="punctuation">,</span><span class="number">12</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">               Month<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="built_in">rep</span><span class="punctuation">(</span><span class="number">1</span><span class="operator">:</span><span class="number">12</span><span class="punctuation">,</span><span class="number">6</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">               n<span class="operator">=</span>sample<span class="punctuation">(</span><span class="number">1</span><span class="operator">:</span><span class="number">15</span><span class="punctuation">,</span><span class="number">12</span><span class="operator">*</span><span class="number">6</span><span class="punctuation">,</span>replace <span class="operator">=</span> <span class="built_in">T</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"><span class="built_in">dim</span><span class="punctuation">(</span>df<span class="punctuation">)</span></span><br><span class="line">head<span class="punctuation">(</span>df<span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>ggplot2<span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>RColorBrewer<span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>ggchicklet<span class="punctuation">)</span></span><br><span class="line">ggplot<span class="punctuation">(</span>df<span class="punctuation">,</span>aes<span class="punctuation">(</span>x <span class="operator">=</span> factor<span class="punctuation">(</span>Year<span class="punctuation">)</span><span class="punctuation">,</span> y <span class="operator">=</span> n<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span> </span><br><span class="line">  geom_chicklet<span class="punctuation">(</span>aes<span class="punctuation">(</span>fill <span class="operator">=</span> factor<span class="punctuation">(</span>Month<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">                width <span class="operator">=</span> <span class="number">0.25</span><span class="punctuation">,</span> </span><br><span class="line">                radius <span class="operator">=</span> grid<span class="operator">::</span>unit<span class="punctuation">(</span><span class="number">3</span><span class="punctuation">,</span> <span class="string">&quot;pt&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span> </span><br><span class="line">  theme_bw<span class="punctuation">(</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  scale_fill_brewer<span class="punctuation">(</span>name <span class="operator">=</span> <span class="string">&quot;Month&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    palette <span class="operator">=</span> <span class="string">&quot;Paired&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    breaks <span class="operator">=</span> <span class="number">1</span><span class="operator">:</span><span class="number">12</span><span class="punctuation">,</span></span><br><span class="line">                    labels <span class="operator">=</span> <span class="built_in">month.name</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  labs<span class="punctuation">(</span>x<span class="operator">=</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span>y<span class="operator">=</span><span class="string">&quot;&quot;</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<h3 id="批量差异检验"><strong>批量差异检验</strong></h3>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##wilcox 检验批处理示例</span></span><br><span class="line">setwd<span class="punctuation">(</span><span class="string">&quot;../metagenomic/Abundance/Nr_abundance/&quot;</span><span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>doBy<span class="punctuation">)</span>	<span class="comment">#使用其中的 summaryBy() 以方便按分组计算均值、中位数</span></span><br><span class="line">rm<span class="punctuation">(</span><span class="built_in">list</span> <span class="operator">=</span> ls<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">getwd<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line">gene <span class="operator">&lt;-</span> read.table<span class="punctuation">(</span><span class="string">&#x27;pathway_0.01.txt&#x27;</span><span class="punctuation">,</span> sep <span class="operator">=</span> <span class="string">&#x27;\t&#x27;</span><span class="punctuation">,</span> row.names <span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span> header <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">,</span> stringsAsFactors <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">,</span> check.names <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span></span><br><span class="line">group <span class="operator">&lt;-</span> read.table<span class="punctuation">(</span><span class="string">&#x27;sample.txt&#x27;</span><span class="punctuation">,</span> sep <span class="operator">=</span> <span class="string">&#x27;\t&#x27;</span><span class="punctuation">,</span> header <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">,</span> stringsAsFactors <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">,</span> check.names <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span></span><br><span class="line">gene <span class="operator">&lt;-</span> gene<span class="punctuation">[</span><span class="operator">-</span>nrow<span class="punctuation">(</span>gene<span class="punctuation">)</span><span class="punctuation">,</span><span class="punctuation">]</span></span><br><span class="line">result <span class="operator">&lt;-</span> <span class="literal">NULL</span></span><br><span class="line"><span class="keyword">for</span> <span class="punctuation">(</span>n <span class="keyword">in</span> <span class="number">1</span><span class="operator">:</span>nrow<span class="punctuation">(</span>gene<span class="punctuation">)</span><span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">  gene_n <span class="operator">&lt;-</span> data.frame<span class="punctuation">(</span>t<span class="punctuation">(</span>gene<span class="punctuation">[</span>n<span class="punctuation">,</span>subset<span class="punctuation">(</span>group<span class="punctuation">,</span> group <span class="operator">%in%</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;D&quot;</span><span class="punctuation">,</span> <span class="string">&quot;H&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="operator">$</span>sample<span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">  gene_id <span class="operator">&lt;-</span> <span class="built_in">names</span><span class="punctuation">(</span>gene_n<span class="punctuation">)</span><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span></span><br><span class="line">  <span class="built_in">names</span><span class="punctuation">(</span>gene_n<span class="punctuation">)</span><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="operator">&lt;-</span> <span class="string">&#x27;gene&#x27;</span></span><br><span class="line">  gene_n<span class="operator">$</span>sample <span class="operator">&lt;-</span> rownames<span class="punctuation">(</span>gene_n<span class="punctuation">)</span></span><br><span class="line">  gene_n <span class="operator">&lt;-</span> merge<span class="punctuation">(</span>gene_n<span class="punctuation">,</span> group<span class="punctuation">,</span> by <span class="operator">=</span> <span class="string">&#x27;sample&#x27;</span><span class="punctuation">,</span> all.x <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span></span><br><span class="line">  gene_n<span class="operator">$</span>group <span class="operator">&lt;-</span> factor<span class="punctuation">(</span>gene_n<span class="operator">$</span>group<span class="punctuation">)</span></span><br><span class="line">  p_value <span class="operator">&lt;-</span> wilcox.test<span class="punctuation">(</span>gene<span class="operator">~</span>group<span class="punctuation">,</span> gene_n<span class="punctuation">,</span>exact <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span><span class="operator">$</span>p.value</span><br><span class="line">  <span class="keyword">if</span> <span class="punctuation">(</span><span class="operator">!</span><span class="built_in">is.na</span><span class="punctuation">(</span>p_value<span class="punctuation">)</span> <span class="operator">&amp;</span> p_value <span class="operator">&lt;</span> <span class="number">0.05</span><span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">    stat <span class="operator">&lt;-</span> summaryBy<span class="punctuation">(</span>gene<span class="operator">~</span>group<span class="punctuation">,</span> gene_n<span class="punctuation">,</span> FUN <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span>mean<span class="punctuation">,</span> sd<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">    result <span class="operator">&lt;-</span> rbind<span class="punctuation">(</span>result<span class="punctuation">,</span> <span class="built_in">c</span><span class="punctuation">(</span>gene_id<span class="punctuation">,</span> <span class="built_in">as.character</span><span class="punctuation">(</span>stat<span class="punctuation">[</span><span class="number">1</span><span class="punctuation">,</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">,</span> stat<span class="punctuation">[</span><span class="number">1</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">]</span><span class="punctuation">,</span> stat<span class="punctuation">[</span><span class="number">1</span><span class="punctuation">,</span><span class="number">3</span><span class="punctuation">]</span><span class="punctuation">,</span> <span class="built_in">as.character</span><span class="punctuation">(</span>stat<span class="punctuation">[</span><span class="number">2</span><span class="punctuation">,</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">,</span> stat<span class="punctuation">[</span><span class="number">2</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">]</span><span class="punctuation">,</span> stat<span class="punctuation">[</span><span class="number">2</span><span class="punctuation">,</span><span class="number">3</span><span class="punctuation">]</span><span class="punctuation">,</span> p_value<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line">result <span class="operator">&lt;-</span> data.frame<span class="punctuation">(</span>result<span class="punctuation">)</span></span><br><span class="line"><span class="built_in">names</span><span class="punctuation">(</span>result<span class="punctuation">)</span> <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;Species&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;group1&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;mean1&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;sd1&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;group2&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;mean2&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;sd2&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;p_value&#x27;</span><span class="punctuation">)</span></span><br><span class="line">result <span class="operator">&lt;-</span> result<span class="punctuation">[</span>order<span class="punctuation">(</span>result<span class="operator">$</span>p_value<span class="punctuation">)</span><span class="punctuation">,</span><span class="punctuation">]</span>  <span class="comment"># 从小到大排序</span></span><br><span class="line"><span class="comment"># P.adjust  p 值校正的过程 </span></span><br><span class="line"><span class="comment">#先将p值那列提出转换为矩阵形式 </span></span><br><span class="line">a <span class="operator">&lt;-</span> as.matrix<span class="punctuation">(</span>result<span class="operator">$</span>p_value<span class="punctuation">)</span></span><br><span class="line">p_adjust <span class="operator">&lt;-</span> p.adjust<span class="punctuation">(</span>a<span class="punctuation">,</span>method <span class="operator">=</span> <span class="string">&#x27;BH&#x27;</span><span class="punctuation">,</span>n <span class="operator">=</span> <span class="built_in">length</span><span class="punctuation">(</span>a<span class="punctuation">)</span><span class="punctuation">)</span> <span class="comment"># 这里使用BH 方法 和fdr结果相似</span></span><br><span class="line">result <span class="operator">&lt;-</span> cbind<span class="punctuation">(</span>result<span class="punctuation">,</span>p_adjust<span class="punctuation">)</span></span><br><span class="line">write.table<span class="punctuation">(</span>result<span class="punctuation">,</span> <span class="string">&#x27;pathway_0.01_diff.txt&#x27;</span><span class="punctuation">,</span> sep <span class="operator">=</span> <span class="string">&#x27;\t&#x27;</span><span class="punctuation">,</span> row.names <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">,</span> <span class="built_in">quote</span> <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="绘制箱线图"><strong>绘制箱线图</strong></h3>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#Create data</span></span><br><span class="line"><span class="built_in">names</span> <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="built_in">rep</span><span class="punctuation">(</span><span class="string">&quot;Maestro&quot;</span><span class="punctuation">,</span> <span class="number">20</span><span class="punctuation">)</span> <span class="punctuation">,</span> <span class="built_in">rep</span><span class="punctuation">(</span><span class="string">&quot;Presto&quot;</span><span class="punctuation">,</span> <span class="number">20</span><span class="punctuation">)</span> <span class="punctuation">,</span> </span><br><span class="line">      <span class="built_in">rep</span><span class="punctuation">(</span><span class="string">&quot;Nerak&quot;</span><span class="punctuation">,</span> <span class="number">20</span><span class="punctuation">)</span><span class="punctuation">,</span> <span class="built_in">rep</span><span class="punctuation">(</span><span class="string">&quot;Eskimo&quot;</span><span class="punctuation">,</span> <span class="number">20</span><span class="punctuation">)</span><span class="punctuation">,</span> <span class="built_in">rep</span><span class="punctuation">(</span><span class="string">&quot;Nairobi&quot;</span><span class="punctuation">,</span> <span class="number">20</span><span class="punctuation">)</span><span class="punctuation">,</span> <span class="built_in">rep</span><span class="punctuation">(</span><span class="string">&quot;Artiko&quot;</span><span class="punctuation">,</span> <span class="number">20</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">value <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span>  sample<span class="punctuation">(</span><span class="number">3</span><span class="operator">:</span><span class="number">10</span><span class="punctuation">,</span> <span class="number">20</span> <span class="punctuation">,</span> replace<span class="operator">=</span><span class="built_in">T</span><span class="punctuation">)</span> <span class="punctuation">,</span> sample<span class="punctuation">(</span><span class="number">2</span><span class="operator">:</span><span class="number">5</span><span class="punctuation">,</span> <span class="number">20</span> <span class="punctuation">,</span> replace<span class="operator">=</span><span class="built_in">T</span><span class="punctuation">)</span> <span class="punctuation">,</span> </span><br><span class="line">      sample<span class="punctuation">(</span><span class="number">6</span><span class="operator">:</span><span class="number">10</span><span class="punctuation">,</span> <span class="number">20</span> <span class="punctuation">,</span> replace<span class="operator">=</span><span class="built_in">T</span><span class="punctuation">)</span><span class="punctuation">,</span> sample<span class="punctuation">(</span><span class="number">6</span><span class="operator">:</span><span class="number">10</span><span class="punctuation">,</span> <span class="number">20</span> <span class="punctuation">,</span> replace<span class="operator">=</span><span class="built_in">T</span><span class="punctuation">)</span> <span class="punctuation">,</span> </span><br><span class="line">      sample<span class="punctuation">(</span><span class="number">1</span><span class="operator">:</span><span class="number">7</span><span class="punctuation">,</span> <span class="number">20</span> <span class="punctuation">,</span> replace<span class="operator">=</span><span class="built_in">T</span><span class="punctuation">)</span><span class="punctuation">,</span> sample<span class="punctuation">(</span><span class="number">3</span><span class="operator">:</span><span class="number">10</span><span class="punctuation">,</span> <span class="number">20</span> <span class="punctuation">,</span> replace<span class="operator">=</span><span class="built_in">T</span><span class="punctuation">)</span> <span class="punctuation">)</span></span><br><span class="line">data <span class="operator">&lt;-</span> data.frame<span class="punctuation">(</span><span class="built_in">names</span><span class="punctuation">,</span>value<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Prepare a vector of colors with specific color for Nairobi and Eskimo</span></span><br><span class="line">myColors <span class="operator">&lt;-</span> ifelse<span class="punctuation">(</span>levels<span class="punctuation">(</span>data<span class="operator">$</span><span class="built_in">names</span><span class="punctuation">)</span><span class="operator">==</span><span class="string">&quot;Nairobi&quot;</span> <span class="punctuation">,</span> rgb<span class="punctuation">(</span><span class="number">0.1</span><span class="punctuation">,</span><span class="number">0.1</span><span class="punctuation">,</span><span class="number">0.7</span><span class="punctuation">,</span><span class="number">0.5</span><span class="punctuation">)</span> <span class="punctuation">,</span> </span><br><span class="line">              ifelse<span class="punctuation">(</span>levels<span class="punctuation">(</span>data<span class="operator">$</span><span class="built_in">names</span><span class="punctuation">)</span><span class="operator">==</span><span class="string">&quot;Eskimo&quot;</span><span class="punctuation">,</span> rgb<span class="punctuation">(</span><span class="number">0.8</span><span class="punctuation">,</span><span class="number">0.1</span><span class="punctuation">,</span><span class="number">0.3</span><span class="punctuation">,</span><span class="number">0.6</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">              <span class="string">&quot;grey90&quot;</span> <span class="punctuation">)</span> <span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Build the plot</span></span><br><span class="line">boxplot<span class="punctuation">(</span>data<span class="operator">$</span>value <span class="operator">~</span> data<span class="operator">$</span><span class="built_in">names</span> <span class="punctuation">,</span> </span><br><span class="line">    col<span class="operator">=</span>myColors <span class="punctuation">,</span> </span><br><span class="line">    ylab<span class="operator">=</span><span class="string">&quot;disease&quot;</span> <span class="punctuation">,</span> xlab<span class="operator">=</span><span class="string">&quot;- variety -&quot;</span><span class="punctuation">)</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># Add a legend</span></span><br><span class="line">legend<span class="punctuation">(</span><span class="string">&quot;bottomleft&quot;</span><span class="punctuation">,</span> legend <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;Positiv control&quot;</span><span class="punctuation">,</span><span class="string">&quot;Negativ control&quot;</span><span class="punctuation">)</span> <span class="punctuation">,</span> </span><br><span class="line">    col <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span>rgb<span class="punctuation">(</span><span class="number">0.1</span><span class="punctuation">,</span><span class="number">0.1</span><span class="punctuation">,</span><span class="number">0.7</span><span class="punctuation">,</span><span class="number">0.5</span><span class="punctuation">)</span> <span class="punctuation">,</span> rgb<span class="punctuation">(</span><span class="number">0.8</span><span class="punctuation">,</span><span class="number">0.1</span><span class="punctuation">,</span><span class="number">0.3</span><span class="punctuation">,</span><span class="number">0.6</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="punctuation">,</span> bty <span class="operator">=</span> <span class="string">&quot;n&quot;</span><span class="punctuation">,</span> pch<span class="operator">=</span><span class="number">20</span> <span class="punctuation">,</span> pt.cex <span class="operator">=</span> <span class="number">3</span><span class="punctuation">,</span> cex <span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span> horiz <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">,</span> inset <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">0.03</span><span class="punctuation">,</span> <span class="number">0.1</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#循环箱线图</span></span><br><span class="line">par<span class="punctuation">(</span>mfrow<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">3</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">)</span><span class="punctuation">,</span> mar<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">2</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">)</span><span class="punctuation">)</span>; 分区画图，mfrow：<span class="number">3</span>行<span class="number">2</span>列，mar每组图的边界设置。</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span><span class="punctuation">(</span>i <span class="keyword">in</span> <span class="number">1</span><span class="operator">:</span><span class="number">6</span><span class="punctuation">)</span><span class="punctuation">&#123;</span></span><br><span class="line">boxplot<span class="punctuation">(</span>a<span class="punctuation">[</span><span class="punctuation">(</span>i<span class="operator">*</span><span class="number">2</span><span class="punctuation">)</span><span class="operator">:</span><span class="punctuation">(</span>i<span class="operator">*</span><span class="number">2</span><span class="operator">+</span><span class="number">1</span><span class="punctuation">)</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="built_in">range</span><span class="operator">=</span><span class="number">1.5</span><span class="punctuation">,</span>width<span class="operator">=</span><span class="literal">NULL</span><span class="punctuation">,</span>varwidth<span class="operator">=</span><span class="literal">FALSE</span><span class="punctuation">,</span>notch<span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">,</span>outline<span class="operator">=</span><span class="literal">TRUE</span><span class="punctuation">,</span><span class="built_in">names</span><span class="punctuation">(</span>a<span class="punctuation">[</span><span class="punctuation">(</span>i<span class="operator">*</span><span class="number">2</span><span class="punctuation">)</span><span class="operator">:</span><span class="punctuation">(</span>i<span class="operator">*</span><span class="number">2</span><span class="operator">+</span><span class="number">1</span><span class="punctuation">)</span><span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">,</span>plot<span class="operator">=</span><span class="literal">TRUE</span><span class="punctuation">,</span>col<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;green&quot;</span><span class="punctuation">,</span><span class="string">&quot;orange&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span><span class="built_in">log</span><span class="operator">=</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span>horizontal<span class="operator">=</span><span class="literal">FALSE</span><span class="punctuation">,</span>add<span class="operator">=</span><span class="literal">FALSE</span><span class="punctuation">,</span>at<span class="operator">=</span><span class="literal">NULL</span><span class="punctuation">)</span>;<span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#画特定物种的Boxplot</span></span><br><span class="line"></span><br><span class="line">library<span class="punctuation">(</span>doBy<span class="punctuation">)</span>	<span class="comment">#使用其中的 summaryBy() 以方便按分组计算均值、中位数</span></span><br><span class="line">rm<span class="punctuation">(</span><span class="built_in">list</span> <span class="operator">=</span> ls<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>dplyr<span class="punctuation">)</span></span><br><span class="line">gene <span class="operator">&lt;-</span> read.table<span class="punctuation">(</span><span class="string">&#x27;Phylum.txt&#x27;</span><span class="punctuation">,</span> sep <span class="operator">=</span> <span class="string">&#x27;\t&#x27;</span><span class="punctuation">,</span> row.names <span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span> header <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">,</span> stringsAsFactors <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">,</span> check.names <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span></span><br><span class="line">group <span class="operator">&lt;-</span> read.table<span class="punctuation">(</span><span class="string">&#x27;sample.txt&#x27;</span><span class="punctuation">,</span> sep <span class="operator">=</span> <span class="string">&#x27;\t&#x27;</span><span class="punctuation">,</span> header <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">,</span> stringsAsFactors <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">,</span> check.names <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">library<span class="punctuation">(</span>reshape2<span class="punctuation">)</span>	<span class="comment">#用于排列数据</span></span><br><span class="line">library<span class="punctuation">(</span>ggplot2<span class="punctuation">)</span>	<span class="comment">#ggplot2 作图</span></span><br><span class="line">gene<span class="operator">$</span>Taxonomy <span class="operator">&lt;-</span> factor<span class="punctuation">(</span>rownames<span class="punctuation">(</span>gene<span class="punctuation">)</span><span class="punctuation">,</span> levels <span class="operator">=</span> rownames<span class="punctuation">(</span>gene<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">gene <span class="operator">&lt;-</span> melt<span class="punctuation">(</span>gene<span class="punctuation">,</span> id <span class="operator">=</span> <span class="string">&#x27;Taxonomy&#x27;</span><span class="punctuation">)</span></span><br><span class="line"><span class="built_in">names</span><span class="punctuation">(</span>group<span class="punctuation">)</span><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="operator">&lt;-</span> <span class="string">&#x27;variable&#x27;</span></span><br><span class="line">gene <span class="operator">&lt;-</span> merge<span class="punctuation">(</span>gene<span class="punctuation">,</span> group<span class="punctuation">,</span> by <span class="operator">=</span> <span class="string">&#x27;variable&#x27;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">gene<span class="operator">$</span>Taxonomy <span class="operator">&lt;-</span> factor<span class="punctuation">(</span>gene<span class="operator">$</span>Taxonomy<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">p2 <span class="operator">&lt;-</span> filter<span class="punctuation">(</span>gene<span class="punctuation">,</span>Taxonomy<span class="operator">%in%</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;g_Faecalibacterium&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;g_Escherichia-Shigella&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;g_Alloprevotella&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;g_Clostridium_sensu_stricto_1&#x27;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">p <span class="operator">&lt;-</span> ggplot<span class="punctuation">(</span>data<span class="operator">=</span>p2<span class="punctuation">,</span>aes<span class="punctuation">(</span>x<span class="operator">=</span>group<span class="punctuation">,</span>y<span class="operator">=</span>value<span class="punctuation">,</span>fill<span class="operator">=</span>group<span class="punctuation">)</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  stat_boxplot<span class="punctuation">(</span>geom <span class="operator">=</span> <span class="string">&quot;errorbar&quot;</span><span class="punctuation">)</span><span class="operator">+</span>geom_boxplot<span class="punctuation">(</span>outlier.colour <span class="operator">=</span> <span class="literal">NA</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  scale_fill_manual<span class="punctuation">(</span>values <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;red&quot;</span><span class="punctuation">,</span> <span class="string">&quot;blue&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  xlab<span class="punctuation">(</span><span class="string">&quot;&quot;</span><span class="punctuation">)</span><span class="operator">+</span>ylab<span class="punctuation">(</span><span class="string">&quot;Relative abundance&quot;</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  facet_grid<span class="punctuation">(</span><span class="operator">~</span>Taxonomy<span class="punctuation">)</span><span class="operator">+</span><span class="comment">#legend.title = element_blank()</span></span><br><span class="line">  theme<span class="punctuation">(</span>panel.grid <span class="operator">=</span> element_blank<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">,</span> panel.background <span class="operator">=</span> element_rect<span class="punctuation">(</span>fill <span class="operator">=</span> <span class="string">&#x27;transparent&#x27;</span><span class="punctuation">,</span> color <span class="operator">=</span> <span class="string">&#x27;black&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span> legend.title <span class="operator">=</span> element_blank<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">,</span>legend.key <span class="operator">=</span> element_blank<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">p</span><br><span class="line">ggsave<span class="punctuation">(</span>plot<span class="operator">=</span>p<span class="punctuation">,</span><span class="string">&quot;E:/g_Alloprevotella.pdf&quot;</span><span class="punctuation">,</span>height<span class="operator">=</span><span class="number">5</span><span class="punctuation">,</span>width<span class="operator">=</span><span class="number">7</span><span class="punctuation">,</span>dpi<span class="operator">=</span><span class="number">300</span><span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>export<span class="punctuation">)</span></span><br><span class="line">graph2ppt<span class="punctuation">(</span>file<span class="operator">=</span><span class="string">&quot;2.pptx&quot;</span><span class="punctuation">,</span> width<span class="operator">=</span><span class="number">7</span><span class="punctuation">,</span> height<span class="operator">=</span><span class="number">5</span> <span class="comment">#导入ppt中 相当于AI</span></span><br><span class="line">          </span><br><span class="line">          <span class="comment">#可以写个函数</span></span><br><span class="line">plotGeneCounts <span class="operator">&lt;-</span> <span class="keyword">function</span><span class="punctuation">(</span>genes<span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line"> </span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line">那么画图就是plotGeneCounts<span class="punctuation">(</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;STM&quot;</span><span class="punctuation">,</span><span class="string">&quot;KNAT1&quot;</span><span class="punctuation">,</span><span class="string">&quot;CLV1&quot;</span><span class="punctuation">,</span><span class="string">&quot;CLV3&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<h3 id="曼哈顿图">曼哈顿图</h3>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line">library<span class="punctuation">(</span>ggplot2<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#读取数据</span></span><br><span class="line">otu_stat <span class="operator">&lt;-</span> read.delim<span class="punctuation">(</span><span class="string">&#x27;otu_sign.txt&#x27;</span><span class="punctuation">,</span> sep <span class="operator">=</span> <span class="string">&#x27;\t&#x27;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#门水平排序，这里直接按首字母排序了</span></span><br><span class="line">otu_stat <span class="operator">&lt;-</span> otu_stat<span class="punctuation">[</span>order<span class="punctuation">(</span>otu_stat<span class="operator">$</span>phylum<span class="punctuation">)</span><span class="punctuation">,</span> <span class="punctuation">]</span></span><br><span class="line">otu_stat<span class="operator">$</span>otu_sort <span class="operator">&lt;-</span> 1<span class="operator">:</span>nrow<span class="punctuation">(</span>otu_stat<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#其它自定义排序，例如你想根据 OTU 数量降序排序</span></span><br><span class="line"><span class="comment">#phylum_num &lt;- phylum_num[order(phylum_num, decreasing = TRUE)]</span></span><br><span class="line"><span class="comment">#otu_stat$phylum &lt;- factor(otu_stat$phylum, levels = names(phylum_num))</span></span><br><span class="line"><span class="comment">#otu_stat &lt;- otu_stat[order(otu_stat$phylum), ]</span></span><br><span class="line"><span class="comment">#otu_stat$otu_sort &lt;- 1:nrow(otu_stat)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##ggplot2 作图示例</span></span><br><span class="line"><span class="comment">#初始</span></span><br><span class="line">p <span class="operator">&lt;-</span> ggplot<span class="punctuation">(</span>otu_stat<span class="punctuation">,</span> aes<span class="punctuation">(</span>otu_sort<span class="punctuation">,</span> <span class="operator">-</span><span class="built_in">log</span><span class="punctuation">(</span>p_value<span class="punctuation">,</span> <span class="number">10</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span>	<span class="comment">#</span></span><br><span class="line">geom_point<span class="punctuation">(</span>aes<span class="punctuation">(</span>size <span class="operator">=</span> abundance<span class="punctuation">,</span> color <span class="operator">=</span> phylum<span class="punctuation">,</span> shape <span class="operator">=</span> enrich<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span>	<span class="comment">#点的大小表示 OTUs 丰度，颜色表示分类，形状表示是否为富集 OTUs</span></span><br><span class="line">scale_size<span class="punctuation">(</span><span class="built_in">range</span> <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span> <span class="number">5</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="operator">+</span>	<span class="comment">#点大小范围</span></span><br><span class="line">scale_shape_manual<span class="punctuation">(</span>limits <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;sign&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;no-sign&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span> values <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">16</span><span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span>	<span class="comment">#点形状，实心点为富集 OTUs，空心点为非富集 OTUs	</span></span><br><span class="line">labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="literal">NULL</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&#x27;-log10(P)&#x27;</span><span class="punctuation">,</span> size <span class="operator">=</span> <span class="string">&#x27;relative abundance (%)&#x27;</span><span class="punctuation">,</span> shape <span class="operator">=</span> <span class="string">&#x27;enriched&#x27;</span><span class="punctuation">)</span> <span class="operator">+</span>	<span class="comment">#坐标轴标题、图例标题等</span></span><br><span class="line">theme<span class="punctuation">(</span>panel.grid <span class="operator">=</span> element_blank<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">,</span> axis.line <span class="operator">=</span> element_line<span class="punctuation">(</span>colour <span class="operator">=</span> <span class="string">&#x27;black&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span> panel.background <span class="operator">=</span> element_rect<span class="punctuation">(</span>fill <span class="operator">=</span> <span class="string">&#x27;transparent&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span> legend.key <span class="operator">=</span> element_rect<span class="punctuation">(</span>fill <span class="operator">=</span> <span class="string">&#x27;transparent&#x27;</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span>	<span class="comment">#主题调整，去除背景线等</span></span><br><span class="line">guides<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&#x27;none&#x27;</span><span class="punctuation">)</span> <span class="operator">+</span>	<span class="comment">#隐藏颜色图例（OTUs 分类）</span></span><br><span class="line">geom_hline<span class="punctuation">(</span>yintercept <span class="operator">=</span> <span class="operator">-</span>log10<span class="punctuation">(</span><span class="number">0.01</span><span class="punctuation">)</span><span class="punctuation">,</span> color <span class="operator">=</span> <span class="string">&#x27;gray&#x27;</span><span class="punctuation">,</span> linetype <span class="operator">=</span> <span class="number">2</span><span class="punctuation">,</span> size <span class="operator">=</span> <span class="number">1</span><span class="punctuation">)</span>	<span class="comment">#在 p=0.01 处的 -log10 位置（即 y = 2）绘制条横虚线，表示 p&lt;0.01 为差异 OTUs 的判定标准之一</span></span><br><span class="line"></span><br><span class="line">p</span><br><span class="line"></span><br><span class="line"><span class="comment">#计算 x 轴标签、矩形区块对应的 x 轴位置</span></span><br><span class="line">phylum_num <span class="operator">&lt;-</span> summary<span class="punctuation">(</span>otu_stat<span class="operator">$</span>phylum<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">phylum_range <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span> phylum_num<span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">)</span></span><br><span class="line">phylum_name <span class="operator">&lt;-</span> phylum_num<span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="operator">/</span> <span class="number">2</span></span><br><span class="line"><span class="keyword">for</span> <span class="punctuation">(</span>i <span class="keyword">in</span> <span class="number">2</span><span class="operator">:</span><span class="built_in">length</span><span class="punctuation">(</span>phylum_num<span class="punctuation">)</span><span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">	phylum_range<span class="punctuation">[</span>i<span class="operator">+</span><span class="number">1</span><span class="punctuation">]</span> <span class="operator">&lt;-</span> phylum_range<span class="punctuation">[</span>i<span class="punctuation">]</span> <span class="operator">+</span> phylum_num<span class="punctuation">[</span>i<span class="punctuation">]</span></span><br><span class="line">	phylum_name<span class="punctuation">[</span>i<span class="punctuation">]</span> <span class="operator">&lt;-</span> phylum_range<span class="punctuation">[</span>i<span class="punctuation">]</span> <span class="operator">+</span> phylum_num<span class="punctuation">[</span>i<span class="punctuation">]</span> <span class="operator">/</span> <span class="number">2</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#添加 x 轴刻度标签</span></span><br><span class="line">p <span class="operator">&lt;-</span> p <span class="operator">+</span></span><br><span class="line">scale_x_continuous<span class="punctuation">(</span>breaks <span class="operator">=</span> phylum_name<span class="punctuation">,</span> labels <span class="operator">=</span> <span class="built_in">names</span><span class="punctuation">(</span>phylum_num<span class="punctuation">)</span><span class="punctuation">,</span> expand <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">theme<span class="punctuation">(</span>axis.text.x <span class="operator">=</span> element_text<span class="punctuation">(</span>angle <span class="operator">=</span> <span class="number">45</span><span class="punctuation">,</span> hjust <span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span> vjust <span class="operator">=</span> <span class="number">1</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#添加矩形区块，交替绘制为不同深度的灰色</span></span><br><span class="line"><span class="comment">#由于先绘制的散点，后绘制的矩形，即矩形图层在上，故需要设置很高的透明度才可</span></span><br><span class="line"><span class="keyword">for</span> <span class="punctuation">(</span>i <span class="keyword">in</span> <span class="number">1</span><span class="operator">:</span><span class="punctuation">(</span><span class="built_in">length</span><span class="punctuation">(</span>phylum_range<span class="punctuation">)</span> <span class="operator">-</span> <span class="number">1</span><span class="punctuation">)</span><span class="punctuation">)</span> p <span class="operator">&lt;-</span> p <span class="operator">+</span> annotate<span class="punctuation">(</span><span class="string">&#x27;rect&#x27;</span><span class="punctuation">,</span> xmin <span class="operator">=</span> phylum_range<span class="punctuation">[</span>i<span class="punctuation">]</span><span class="punctuation">,</span> xmax <span class="operator">=</span> phylum_range<span class="punctuation">[</span>i<span class="operator">+</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">,</span> ymin <span class="operator">=</span> <span class="operator">-</span><span class="literal">Inf</span><span class="punctuation">,</span> ymax <span class="operator">=</span> <span class="literal">Inf</span><span class="punctuation">,</span> alpha <span class="operator">=</span> <span class="number">0.1</span><span class="punctuation">,</span> fill <span class="operator">=</span> ifelse<span class="punctuation">(</span>i <span class="operator">%%</span> <span class="number">2</span> <span class="operator">==</span> <span class="number">0</span><span class="punctuation">,</span> <span class="string">&#x27;gray60&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;gray40&#x27;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">p</span><br><span class="line"></span><br><span class="line"><span class="comment">##推荐先调整好背景（矩形区块），再绘制散点，这样散点位于矩形区块图层的上面，更清晰</span></span><br><span class="line"><span class="comment">#背景、标签布局</span></span><br><span class="line">p <span class="operator">&lt;-</span> ggplot<span class="punctuation">(</span>otu_stat<span class="punctuation">,</span> aes<span class="punctuation">(</span>otu_sort<span class="punctuation">,</span> <span class="operator">-</span><span class="built_in">log</span><span class="punctuation">(</span>p_value<span class="punctuation">,</span> <span class="number">10</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="literal">NULL</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&#x27;-log10(P)&#x27;</span><span class="punctuation">,</span> size <span class="operator">=</span> <span class="string">&#x27;relative abundance (%)&#x27;</span><span class="punctuation">,</span> shape <span class="operator">=</span> <span class="string">&#x27;significantly enriched&#x27;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">theme<span class="punctuation">(</span>panel.grid <span class="operator">=</span> element_blank<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">,</span> axis.line <span class="operator">=</span> element_line<span class="punctuation">(</span>colour <span class="operator">=</span> <span class="string">&#x27;black&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span> panel.background <span class="operator">=</span> element_rect<span class="punctuation">(</span>fill <span class="operator">=</span> <span class="string">&#x27;transparent&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span> legend.key <span class="operator">=</span> element_rect<span class="punctuation">(</span>fill <span class="operator">=</span> <span class="string">&#x27;transparent&#x27;</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">scale_x_continuous<span class="punctuation">(</span>breaks <span class="operator">=</span> phylum_name<span class="punctuation">,</span> labels <span class="operator">=</span> <span class="built_in">names</span><span class="punctuation">(</span>phylum_num<span class="punctuation">)</span><span class="punctuation">,</span> expand <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">theme<span class="punctuation">(</span>axis.text.x <span class="operator">=</span> element_text<span class="punctuation">(</span>angle <span class="operator">=</span> <span class="number">45</span><span class="punctuation">,</span> hjust <span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span> vjust <span class="operator">=</span> <span class="number">1</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#这样也没必要再为矩形设置透明度了</span></span><br><span class="line"><span class="keyword">for</span> <span class="punctuation">(</span>i <span class="keyword">in</span> <span class="number">1</span><span class="operator">:</span><span class="punctuation">(</span><span class="built_in">length</span><span class="punctuation">(</span>phylum_range<span class="punctuation">)</span> <span class="operator">-</span> <span class="number">1</span><span class="punctuation">)</span><span class="punctuation">)</span> p <span class="operator">&lt;-</span> p <span class="operator">+</span> annotate<span class="punctuation">(</span><span class="string">&#x27;rect&#x27;</span><span class="punctuation">,</span> xmin <span class="operator">=</span> phylum_range<span class="punctuation">[</span>i<span class="punctuation">]</span><span class="punctuation">,</span> xmax <span class="operator">=</span> phylum_range<span class="punctuation">[</span>i<span class="operator">+</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">,</span> ymin <span class="operator">=</span> <span class="operator">-</span><span class="literal">Inf</span><span class="punctuation">,</span> ymax <span class="operator">=</span> <span class="literal">Inf</span><span class="punctuation">,</span> fill <span class="operator">=</span> ifelse<span class="punctuation">(</span>i <span class="operator">%%</span> <span class="number">2</span> <span class="operator">==</span> <span class="number">0</span><span class="punctuation">,</span> <span class="string">&#x27;gray95&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;gray85&#x27;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#最后绘制散点</span></span><br><span class="line">p <span class="operator">&lt;-</span> p <span class="operator">+</span> </span><br><span class="line">geom_point<span class="punctuation">(</span>aes<span class="punctuation">(</span>size <span class="operator">=</span> abundance<span class="punctuation">,</span> color <span class="operator">=</span> phylum<span class="punctuation">,</span> shape <span class="operator">=</span> enrich<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">scale_size<span class="punctuation">(</span><span class="built_in">range</span> <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span> <span class="number">5</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">scale_shape_manual<span class="punctuation">(</span>limits <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;sign&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;no-sign&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span> values <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">16</span><span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span>	</span><br><span class="line">guides<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&#x27;none&#x27;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">geom_hline<span class="punctuation">(</span>yintercept <span class="operator">=</span> <span class="operator">-</span>log10<span class="punctuation">(</span><span class="number">0.01</span><span class="punctuation">)</span><span class="punctuation">,</span> color <span class="operator">=</span> <span class="string">&#x27;gray&#x27;</span><span class="punctuation">,</span> linetype <span class="operator">=</span> <span class="number">2</span><span class="punctuation">,</span> size <span class="operator">=</span> <span class="number">1</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">p</span><br><span class="line"></span><br><span class="line"><span class="comment">#输出图片至本地</span></span><br><span class="line">ggsave<span class="punctuation">(</span><span class="string">&#x27;manhattan.pdf&#x27;</span><span class="punctuation">,</span> p<span class="punctuation">,</span> width <span class="operator">=</span> <span class="number">10</span><span class="punctuation">,</span> height <span class="operator">=</span> <span class="number">5</span><span class="punctuation">)</span></span><br><span class="line">ggsave<span class="punctuation">(</span><span class="string">&#x27;manhattan.png&#x27;</span><span class="punctuation">,</span> p<span class="punctuation">,</span> width <span class="operator">=</span> <span class="number">10</span><span class="punctuation">,</span> height <span class="operator">=</span> <span class="number">5</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##可再使用 AI、PS 等后期调整</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##再来个 GWAS 的数据</span></span><br><span class="line"><span class="comment">#直接使用了 qqman 包中的 gwasResults 数据集</span></span><br><span class="line">gwasResults <span class="operator">&lt;-</span> qqman<span class="operator">::</span>gwasResults</span><br><span class="line">fix<span class="punctuation">(</span>gwasResults<span class="punctuation">)</span>	<span class="comment">#查看</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#qqman 包 manhattan()绘制曼哈顿图</span></span><br><span class="line">library<span class="punctuation">(</span>qqman<span class="punctuation">)</span></span><br><span class="line">manhattan<span class="punctuation">(</span>gwasResults<span class="punctuation">,</span> col <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;gray90&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;gray80&#x27;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#这里借助 doBy 中的 summaryBy() 计算各染色体中 SNP 序号的中值位置，以放置染色体标签</span></span><br><span class="line">library<span class="punctuation">(</span>doBy<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">gwasResults<span class="operator">$</span>SNP1 <span class="operator">&lt;-</span> seq<span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span> nrow<span class="punctuation">(</span>gwasResults<span class="punctuation">)</span><span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">)</span></span><br><span class="line">gwasResults<span class="operator">$</span>CHR <span class="operator">&lt;-</span> factor<span class="punctuation">(</span>gwasResults<span class="operator">$</span>CHR<span class="punctuation">,</span> levels <span class="operator">=</span> unique<span class="punctuation">(</span>gwasResults<span class="operator">$</span>CHR<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">chr <span class="operator">&lt;-</span> summaryBy<span class="punctuation">(</span>SNP1<span class="operator">~</span>CHR<span class="punctuation">,</span> gwasResults<span class="punctuation">,</span> FUN <span class="operator">=</span> median<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#ggplot2 作图</span></span><br><span class="line">p <span class="operator">&lt;-</span> ggplot<span class="punctuation">(</span>gwasResults<span class="punctuation">,</span> aes<span class="punctuation">(</span>SNP1<span class="punctuation">,</span> <span class="operator">-</span><span class="built_in">log</span><span class="punctuation">(</span>P<span class="punctuation">,</span> <span class="number">10</span><span class="punctuation">)</span><span class="punctuation">,</span> color <span class="operator">=</span> CHR<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">theme<span class="punctuation">(</span>panel.grid <span class="operator">=</span> element_blank<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">,</span> axis.line <span class="operator">=</span> element_line<span class="punctuation">(</span>colour <span class="operator">=</span> <span class="string">&#x27;black&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span> panel.background <span class="operator">=</span> element_rect<span class="punctuation">(</span>fill <span class="operator">=</span> <span class="string">&#x27;transparent&#x27;</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">geom_point<span class="punctuation">(</span>aes<span class="punctuation">(</span>color <span class="operator">=</span> CHR<span class="punctuation">)</span><span class="punctuation">,</span> show.legend <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&#x27;Chromosome&#x27;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="built_in">expression</span><span class="punctuation">(</span><span class="string">&#x27;&#x27;</span><span class="operator">~</span><span class="operator">-</span><span class="built_in">log</span><span class="punctuation">[</span><span class="number">10</span><span class="punctuation">]</span><span class="operator">~</span><span class="string">&#x27;(P)&#x27;</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">scale_x_continuous<span class="punctuation">(</span>breaks <span class="operator">=</span> chr<span class="operator">$</span>SNP1.median<span class="punctuation">,</span> labels <span class="operator">=</span> chr<span class="operator">$</span>CHR<span class="punctuation">,</span> expand <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">geom_hline<span class="punctuation">(</span>yintercept <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">5</span><span class="punctuation">,</span> <span class="number">7</span><span class="punctuation">)</span><span class="punctuation">,</span> color <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;blue&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;red&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span> size <span class="operator">=</span> <span class="number">0.5</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">p</span><br><span class="line"></span><br><span class="line"><span class="comment">#保存</span></span><br><span class="line">ggsave<span class="punctuation">(</span><span class="string">&#x27;GWAS.pdf&#x27;</span><span class="punctuation">,</span> p<span class="punctuation">,</span> width <span class="operator">=</span> <span class="number">10</span><span class="punctuation">,</span> height <span class="operator">=</span> <span class="number">4</span><span class="punctuation">)</span></span><br><span class="line">ggsave<span class="punctuation">(</span><span class="string">&#x27;GWAS.png&#x27;</span><span class="punctuation">,</span> p<span class="punctuation">,</span> width <span class="operator">=</span> <span class="number">10</span><span class="punctuation">,</span> height <span class="operator">=</span> <span class="number">4</span><span class="punctuation">)</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="桑葚图"><strong>桑葚图</strong></h3>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#install.packages(&quot;ggalluvial&quot;)</span></span><br><span class="line">library<span class="punctuation">(</span>ggalluvial<span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>ggplot2<span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>dplyr<span class="punctuation">)</span></span><br><span class="line"><span class="comment">#读入LIHC临床数据</span></span><br><span class="line">LIHC <span class="operator">&lt;-</span> read.csv<span class="punctuation">(</span><span class="string">&quot;TCGA_lihc.csv&quot;</span><span class="punctuation">,</span>header<span class="operator">=</span><span class="literal">TRUE</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment">#展示数据情况</span></span><br><span class="line">head<span class="punctuation">(</span>LIHC<span class="punctuation">)</span></span><br><span class="line">summary<span class="punctuation">(</span>LIHC<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#分组计算频数</span></span><br><span class="line">LIHCData <span class="operator">&lt;-</span> group_by<span class="punctuation">(</span>LIHC<span class="punctuation">,</span>AGE<span class="punctuation">,</span>SEX<span class="punctuation">,</span>AJCC_PATHOLOGIC_TUMOR_STAGE<span class="punctuation">,</span>OS_STATUS<span class="punctuation">)</span> <span class="operator">%&gt;%</span> summarise<span class="punctuation">(</span>.<span class="punctuation">,</span> count <span class="operator">=</span> n<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment">#查看宽数据格式</span></span><br><span class="line">head<span class="punctuation">(</span>LIHCData<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#绘制桑基图</span></span><br><span class="line"></span><br><span class="line">ggplot<span class="punctuation">(</span>as.data.frame<span class="punctuation">(</span>LIHCData<span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">       aes<span class="punctuation">(</span>axis1 <span class="operator">=</span> AJCC_PATHOLOGIC_TUMOR_STAGE<span class="punctuation">,</span> axis2 <span class="operator">=</span> SEX<span class="punctuation">,</span> axis3 <span class="operator">=</span> AGE<span class="punctuation">,</span></span><br><span class="line">           y<span class="operator">=</span> count<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  scale_x_discrete<span class="punctuation">(</span>limits <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;AJCC_STAGE&quot;</span><span class="punctuation">,</span> <span class="string">&quot;SEX&quot;</span><span class="punctuation">,</span> <span class="string">&quot;AGE&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span> expand <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">.1</span><span class="punctuation">,</span> <span class="number">.05</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_alluvium<span class="punctuation">(</span>aes<span class="punctuation">(</span>fill <span class="operator">=</span> OS_STATUS<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_stratum<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">+</span> geom_text<span class="punctuation">(</span>stat <span class="operator">=</span> <span class="string">&quot;stratum&quot;</span><span class="punctuation">,</span> label.strata <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  theme_minimal<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  ggtitle<span class="punctuation">(</span><span class="string">&quot;Patients in the TCGA-LIHC cohort&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="string">&quot;stratified by demographics and survival&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#2 长数据示例</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#to_lodes_form生成alluvium和stratum列，主分组位于key列中</span></span><br><span class="line">LIHC_long <span class="operator">&lt;-</span> to_lodes_form<span class="punctuation">(</span>data.frame<span class="punctuation">(</span>LIHCData<span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">                           key <span class="operator">=</span> <span class="string">&quot;Demographic&quot;</span><span class="punctuation">,</span></span><br><span class="line">                           axes <span class="operator">=</span> <span class="number">1</span><span class="operator">:</span><span class="number">3</span><span class="punctuation">)</span></span><br><span class="line">head<span class="punctuation">(</span>LIHC_long<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 绘制桑基图</span></span><br><span class="line">ggplot<span class="punctuation">(</span>data <span class="operator">=</span> LIHC_long<span class="punctuation">,</span></span><br><span class="line">       aes<span class="punctuation">(</span>x <span class="operator">=</span> Demographic<span class="punctuation">,</span> stratum <span class="operator">=</span> stratum<span class="punctuation">,</span> alluvium <span class="operator">=</span> alluvium<span class="punctuation">,</span></span><br><span class="line">           y <span class="operator">=</span> count<span class="punctuation">,</span> label <span class="operator">=</span> stratum<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_alluvium<span class="punctuation">(</span>aes<span class="punctuation">(</span>fill <span class="operator">=</span> OS_STATUS<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_stratum<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">+</span> geom_text<span class="punctuation">(</span>stat <span class="operator">=</span> <span class="string">&quot;stratum&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  theme_minimal<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  ggtitle<span class="punctuation">(</span><span class="string">&quot;Patients in the TCGA-LIHC cohort&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="string">&quot;stratified by demographics and survival&quot;</span><span class="punctuation">)</span>		 </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#3 状态变化的趋势</span></span><br><span class="line"></span><br><span class="line">data<span class="punctuation">(</span>vaccinations<span class="punctuation">)</span></span><br><span class="line">levels<span class="punctuation">(</span>vaccinations<span class="operator">$</span>response<span class="punctuation">)</span> <span class="operator">&lt;-</span> rev<span class="punctuation">(</span>levels<span class="punctuation">(</span>vaccinations<span class="operator">$</span>response<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">ggplot<span class="punctuation">(</span>vaccinations<span class="punctuation">,</span></span><br><span class="line">       aes<span class="punctuation">(</span>x <span class="operator">=</span> survey<span class="punctuation">,</span> stratum <span class="operator">=</span> response<span class="punctuation">,</span> alluvium <span class="operator">=</span> subject<span class="punctuation">,</span></span><br><span class="line">           y <span class="operator">=</span> freq<span class="punctuation">,</span></span><br><span class="line">           fill <span class="operator">=</span> response<span class="punctuation">,</span> label <span class="operator">=</span> response<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  scale_x_discrete<span class="punctuation">(</span>expand <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">.1</span><span class="punctuation">,</span> <span class="number">.1</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_flow<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_stratum<span class="punctuation">(</span>alpha <span class="operator">=</span> <span class="number">.5</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_text<span class="punctuation">(</span>stat <span class="operator">=</span> <span class="string">&quot;stratum&quot;</span><span class="punctuation">,</span> size <span class="operator">=</span> <span class="number">3</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  theme<span class="punctuation">(</span>legend.position <span class="operator">=</span> <span class="string">&quot;none&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  ggtitle<span class="punctuation">(</span><span class="string">&quot;vaccination survey responses at three points in time&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#4 更多细节</span></span><br><span class="line"></span><br><span class="line">vignette<span class="punctuation">(</span>topic <span class="operator">=</span> <span class="string">&quot;ggalluvial&quot;</span><span class="punctuation">,</span> package <span class="operator">=</span> <span class="string">&quot;ggalluvial&quot;</span><span class="punctuation">)</span> </span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="散点图"><strong>散点图</strong></h3>
<p><a target="_blank" rel="noopener" href="http://t-redactyl.io/blog/2016/05/creating-plots-in-r-using-ggplot2-part-11-linear-regression-plots.html">回归曲线添加方程</a></p>
<p>!</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">setwd<span class="punctuation">(</span><span class="string">&#x27;./Script/scatterplot/&#x27;</span><span class="punctuation">)</span></span><br><span class="line">rm<span class="punctuation">(</span><span class="built_in">list</span> <span class="operator">=</span> ls<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>readxl<span class="punctuation">)</span>  <span class="comment"># 加载readxl包</span></span><br><span class="line">Scatter <span class="operator">&lt;-</span> read.delim<span class="punctuation">(</span><span class="string">&quot;111.txt&quot;</span><span class="punctuation">,</span>sep <span class="operator">=</span> <span class="string">&#x27;\t&#x27;</span><span class="punctuation">)</span> <span class="comment"># 读取Scatter数据</span></span><br><span class="line">View<span class="punctuation">(</span>Scatter<span class="punctuation">)</span>  <span class="comment"># 预览数据  也可运行  head(Scatter) 显示数据框前六行</span></span><br><span class="line"><span class="built_in">names</span><span class="punctuation">(</span>Scatter<span class="punctuation">)</span><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="operator">&lt;-</span> <span class="string">&#x27;Height&#x27;</span></span><br><span class="line">attach<span class="punctuation">(</span>Scatter<span class="punctuation">)</span>  <span class="comment"># 绑定Scatter数据框</span></span><br><span class="line">opar <span class="operator">&lt;-</span> par<span class="punctuation">(</span>no.readonly <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span> <span class="comment">#修改图形参数</span></span><br><span class="line">pdf<span class="punctuation">(</span><span class="string">&quot;Scatter plot.pdf&quot;</span><span class="punctuation">,</span> width <span class="operator">=</span> <span class="number">5</span><span class="punctuation">,</span> height <span class="operator">=</span> <span class="number">5</span><span class="punctuation">)</span>  <span class="comment">## 输出名为Scatter plot，宽度和高度为5的PDF格式的图形</span></span><br><span class="line">plot<span class="punctuation">(</span>Height<span class="punctuation">,</span>high<span class="punctuation">,</span>  <span class="comment"># 变量为x1，y1</span></span><br><span class="line">     xlab <span class="operator">=</span> <span class="string">&quot;X-axis of scatter plot&quot;</span><span class="punctuation">,</span>  <span class="comment">#添加X轴标签</span></span><br><span class="line">     ylab <span class="operator">=</span> <span class="string">&quot;Y-axis of scatter plot&quot;</span><span class="punctuation">,</span>  <span class="comment">#添加Y轴标签</span></span><br><span class="line">     main <span class="operator">=</span> <span class="string">&quot;Scatter plot title&quot;</span><span class="punctuation">,</span> <span class="comment"># 添加标题</span></span><br><span class="line">     font.axis<span class="operator">=</span><span class="number">2</span><span class="punctuation">,</span>font.lab<span class="operator">=</span><span class="number">2</span><span class="punctuation">,</span>  <span class="comment">#设置坐标轴和标签字体（2为粗体）</span></span><br><span class="line">     cex.lab<span class="operator">=</span><span class="number">1.30</span><span class="punctuation">,</span> cex.main<span class="operator">=</span><span class="number">1.55</span><span class="punctuation">,</span>cex.axis<span class="operator">=</span><span class="number">1.15</span><span class="punctuation">,</span>  <span class="comment">#设置标签、标题和坐标轴缩放倍数</span></span><br><span class="line">     family<span class="operator">=</span> <span class="string">&quot;serif&quot;</span><span class="punctuation">)</span>   <span class="comment">#设置字体为衬线，如 Time new roman字体</span></span><br><span class="line">detach<span class="punctuation">(</span>Scatter<span class="punctuation">)</span></span><br><span class="line">par<span class="punctuation">(</span>opar<span class="punctuation">)</span></span><br><span class="line">dev.off<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#ggplot画图</span></span><br><span class="line">library<span class="punctuation">(</span>ggplot2<span class="punctuation">)</span></span><br><span class="line">sp1 <span class="operator">&lt;-</span> ggplot<span class="punctuation">(</span>Scatter<span class="punctuation">,</span> aes<span class="punctuation">(</span>x <span class="operator">=</span> Height<span class="punctuation">,</span> y <span class="operator">=</span> high<span class="punctuation">,</span> shape <span class="operator">=</span> sex<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span> geom_point<span class="punctuation">(</span><span class="punctuation">)</span>; sp1</span><br><span class="line"><span class="comment"># 指定 Scatter 数据框和 X 和 Y 轴，将分组变量 sex 映射给shape</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#添加拟合线</span></span><br><span class="line">sp2 <span class="operator">&lt;-</span> sp1 <span class="operator">+</span>  geom_point<span class="punctuation">(</span>size <span class="operator">=</span> <span class="number">6</span><span class="punctuation">,</span> colour <span class="operator">=</span> <span class="string">&quot;grey60&quot;</span><span class="punctuation">)</span> <span class="operator">+</span>   <span class="comment"># 散点</span></span><br><span class="line">  scale_shape_manual<span class="punctuation">(</span>values <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">16</span><span class="punctuation">,</span><span class="number">17</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span>   <span class="comment"># 设置分组 散点 形状</span></span><br><span class="line">  stat_smooth<span class="punctuation">(</span>method <span class="operator">=</span> lm<span class="punctuation">,</span>   <span class="comment"># 添加线性拟合线，默认拟合 loess 曲线</span></span><br><span class="line">              se <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">,</span>  <span class="comment"># 添加置信区间，FALSE则不添加</span></span><br><span class="line">              level <span class="operator">=</span> <span class="number">0.95</span><span class="punctuation">,</span>  <span class="comment"># 设置CI水平</span></span><br><span class="line">              colour <span class="operator">=</span> <span class="string">&quot;black&quot;</span><span class="punctuation">)</span>  <span class="comment"># 线的颜色，默认为蓝色</span></span><br><span class="line">sp2</span><br><span class="line"></span><br><span class="line"><span class="comment">#去除背景网格</span></span><br><span class="line">sp3 <span class="operator">&lt;-</span> sp2 <span class="operator">+</span> theme_bw<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">+</span>  <span class="comment"># 移除背景</span></span><br><span class="line">  theme<span class="punctuation">(</span>panel.grid<span class="operator">=</span>element_blank<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">,</span>  <span class="comment"># 去除网格</span></span><br><span class="line">        panel.border<span class="operator">=</span>element_blank<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">        axis.line<span class="operator">=</span>element_line<span class="punctuation">(</span>size<span class="operator">=</span><span class="number">1</span><span class="punctuation">,</span>colour<span class="operator">=</span><span class="string">&quot;black&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span>; sp3  <span class="comment"># 添加 x轴和 y轴</span></span><br><span class="line"><span class="comment">#修改坐标轴</span></span><br><span class="line">windowsFonts<span class="punctuation">(</span>myFont1 <span class="operator">=</span> windowsFont<span class="punctuation">(</span><span class="string">&quot;Times New Roman&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span>  <span class="comment"># 设定文字字体</span></span><br><span class="line">sp4 <span class="operator">&lt;-</span> sp3 <span class="operator">+</span> scale_y_continuous<span class="punctuation">(</span>expand <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span><span class="number">0</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="operator">+</span>   <span class="comment"># y轴起点从0开始</span></span><br><span class="line">  theme<span class="punctuation">(</span>axis.text.x <span class="operator">=</span> element_text<span class="punctuation">(</span>size <span class="operator">=</span> <span class="number">10</span><span class="punctuation">,</span> color <span class="operator">=</span> <span class="string">&quot;black&quot;</span><span class="punctuation">,</span> face <span class="operator">=</span> <span class="string">&quot;bold&quot;</span><span class="punctuation">,</span> family <span class="operator">=</span> <span class="string">&quot;myFont1&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span>  <span class="comment"># X、Y坐标轴文字格式</span></span><br><span class="line">  theme<span class="punctuation">(</span>axis.title.x <span class="operator">=</span> element_text<span class="punctuation">(</span>size <span class="operator">=</span> <span class="number">10</span><span class="punctuation">,</span> color <span class="operator">=</span> <span class="string">&quot;black&quot;</span><span class="punctuation">,</span> face <span class="operator">=</span> <span class="string">&quot;bold&quot;</span><span class="punctuation">,</span> family <span class="operator">=</span> <span class="string">&quot;myFont1&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  theme<span class="punctuation">(</span>axis.text.y <span class="operator">=</span> element_text<span class="punctuation">(</span>size <span class="operator">=</span> <span class="number">10</span><span class="punctuation">,</span> color <span class="operator">=</span> <span class="string">&quot;black&quot;</span><span class="punctuation">,</span> face <span class="operator">=</span> <span class="string">&quot;bold&quot;</span><span class="punctuation">,</span> family <span class="operator">=</span> <span class="string">&quot;myFont1&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  theme<span class="punctuation">(</span>axis.title.y <span class="operator">=</span> element_text<span class="punctuation">(</span>size <span class="operator">=</span> <span class="number">10</span><span class="punctuation">,</span> color <span class="operator">=</span> <span class="string">&quot;black&quot;</span><span class="punctuation">,</span> face <span class="operator">=</span> <span class="string">&quot;bold&quot;</span><span class="punctuation">,</span> family <span class="operator">=</span> <span class="string">&quot;myFont1&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span>; sp4</span><br><span class="line"></span><br><span class="line"><span class="comment">#添加标签</span></span><br><span class="line">sp5 <span class="operator">&lt;-</span> sp4 <span class="operator">+</span> geom_text<span class="punctuation">(</span>aes<span class="punctuation">(</span>y <span class="operator">=</span> high<span class="operator">+</span><span class="number">0.8</span><span class="punctuation">,</span> label<span class="operator">=</span> ID<span class="punctuation">)</span><span class="punctuation">,</span>  <span class="comment"># 将ID 映射给 label 属性，增加y的取值</span></span><br><span class="line">                       size <span class="operator">=</span> <span class="number">4</span><span class="punctuation">,</span>  <span class="comment"># 设置标签大小</span></span><br><span class="line">                       vjust <span class="operator">=</span> <span class="number">0</span><span class="punctuation">,</span>  <span class="comment"># 调节标签上下位置</span></span><br><span class="line">                       hjust <span class="operator">=</span> <span class="number">0.5</span><span class="punctuation">,</span></span><br><span class="line">                       color <span class="operator">=</span> <span class="string">&quot;black&quot;</span><span class="punctuation">,</span></span><br><span class="line">                       family <span class="operator">=</span> <span class="string">&quot;myFont1&quot;</span><span class="punctuation">)</span>; sp5  <span class="comment"># 调节标签左右位置</span></span><br><span class="line">ggsave<span class="punctuation">(</span><span class="string">&quot;output1.tiff&quot;</span><span class="punctuation">,</span> sp4<span class="punctuation">,</span>  <span class="comment"># 保存的图片文件名及格式</span></span><br><span class="line">       width <span class="operator">=</span> <span class="number">15</span><span class="punctuation">,</span> height <span class="operator">=</span> <span class="number">12</span><span class="punctuation">,</span> units <span class="operator">=</span> <span class="string">&quot;cm&quot;</span><span class="punctuation">,</span> <span class="comment"># 图片宽度、高度和单位，默认输出当前图形的大小，单位英寸。</span></span><br><span class="line">       dpi <span class="operator">=</span> <span class="number">1200</span><span class="punctuation">,</span>  <span class="comment"># 图片分辨率</span></span><br><span class="line">       compression <span class="operator">=</span> <span class="string">&quot;lzw&quot;</span><span class="punctuation">)</span>  <span class="comment"># tiff格式压缩类型</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s?src=11&amp;timestamp=1585557391&amp;ver=2247&amp;signature=yOovH*r9fbYYqVM0C*Bw5zR7-6gXYTG8FYtcO3gicvTEVbhIfdhFMTEorSI30FiTKT6BgJooR5wKA6UvsPy0phrO02WJJrUSPqAb1U*iwBPbdddynq0l0qvrCq6u2d9J&amp;new=1">ggstar绘制星星散点图</a></p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span><span class="punctuation">(</span><span class="operator">!</span>requireNamespace<span class="punctuation">(</span><span class="string">&quot;remotes&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">  install.packages<span class="punctuation">(</span><span class="string">&quot;remotes&quot;</span><span class="punctuation">)</span></span><br><span class="line">remotes<span class="operator">::</span>install_github<span class="punctuation">(</span><span class="string">&quot;xiangpin/ggstar&quot;</span><span class="punctuation">)</span><span class="comment">#不行就多试几次</span></span><br><span class="line">ggplot<span class="punctuation">(</span>data<span class="operator">=</span>iris<span class="punctuation">,</span> aes<span class="punctuation">(</span>x<span class="operator">=</span>Sepal.Length<span class="punctuation">,</span>y<span class="operator">=</span>Sepal.Width<span class="punctuation">,</span></span><br><span class="line">                           starshape<span class="operator">=</span>Species<span class="punctuation">,</span> fill<span class="operator">=</span>Species<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span> geom_star<span class="punctuation">(</span>show.legend<span class="operator">=</span><span class="literal">FALSE</span><span class="punctuation">,</span> size<span class="operator">=</span><span class="number">5</span><span class="punctuation">,</span>starshape <span class="operator">=</span> <span class="number">1</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  scale_fill_manual<span class="punctuation">(</span>values<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;#66C2A5&quot;</span><span class="punctuation">,</span> <span class="string">&quot;#FC8D62&quot;</span><span class="punctuation">,</span> <span class="string">&quot;#8DACB&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<h4 id="ggsymbol绘制更多点样式">ggsymbol绘制更多点样式</h4>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">library<span class="punctuation">(</span>ggplot2<span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>ggsymbol<span class="punctuation">)</span></span><br><span class="line">d <span class="operator">&lt;-</span> data.frame<span class="punctuation">(</span>p<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">0</span><span class="operator">:</span><span class="number">127</span><span class="punctuation">)</span><span class="punctuation">,</span>f<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="built_in">rep</span><span class="punctuation">(</span><span class="string">&quot;g&quot;</span><span class="punctuation">,</span><span class="number">26</span><span class="punctuation">)</span><span class="punctuation">,</span> <span class="built_in">rep</span><span class="punctuation">(</span><span class="string">&quot;s&quot;</span><span class="punctuation">,</span> <span class="number">7</span><span class="punctuation">)</span><span class="punctuation">,</span> <span class="built_in">rep</span><span class="punctuation">(</span><span class="string">&quot;g&quot;</span><span class="punctuation">,</span> <span class="number">95</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">d<span class="operator">$</span>f <span class="operator">&lt;-</span> factor<span class="punctuation">(</span>d<span class="operator">$</span>f<span class="punctuation">,</span> levels<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;g&quot;</span><span class="punctuation">,</span> <span class="string">&quot;s&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">p <span class="operator">&lt;-</span> ggplot<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">+</span> </span><br><span class="line">  geom_symbol<span class="punctuation">(</span>data<span class="operator">=</span>d<span class="punctuation">,</span> </span><br><span class="line">              mapping<span class="operator">=</span>aes<span class="punctuation">(</span>x<span class="operator">=</span>p<span class="operator">%%</span><span class="number">16</span><span class="punctuation">,</span> y<span class="operator">=</span>p<span class="operator">%/%</span><span class="number">16</span><span class="punctuation">,</span> symbol<span class="operator">=</span>p<span class="punctuation">,</span> fill<span class="operator">=</span>f<span class="punctuation">)</span><span class="punctuation">,</span> </span><br><span class="line">              size<span class="operator">=</span><span class="number">4</span><span class="punctuation">,</span> stroke<span class="operator">=</span><span class="number">0.5</span><span class="punctuation">,</span> show.legend<span class="operator">=</span><span class="literal">FALSE</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_text<span class="punctuation">(</span>data<span class="operator">=</span>d<span class="punctuation">,</span> </span><br><span class="line">            mapping<span class="operator">=</span>aes<span class="punctuation">(</span>x<span class="operator">=</span>p<span class="operator">%%</span><span class="number">16</span><span class="punctuation">,</span> y<span class="operator">=</span>p<span class="operator">%/%</span><span class="number">16</span><span class="operator">+</span><span class="number">0.25</span><span class="punctuation">,</span> label<span class="operator">=</span>p<span class="punctuation">)</span><span class="punctuation">,</span> </span><br><span class="line">            size<span class="operator">=</span><span class="number">3</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  scale_symbol_identity<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  scale_fill_manual<span class="punctuation">(</span>values<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;red&quot;</span><span class="punctuation">,</span> <span class="string">&quot;blue&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  xlab<span class="punctuation">(</span><span class="literal">NULL</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  ylab<span class="punctuation">(</span><span class="literal">NULL</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  theme<span class="punctuation">(</span>axis.ticks<span class="operator">=</span>element_blank<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">        axis.text<span class="operator">=</span>element_blank<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">p</span><br><span class="line"><span class="comment">#例子</span></span><br><span class="line">p <span class="operator">&lt;-</span> ggplot<span class="punctuation">(</span>data<span class="operator">=</span>iris<span class="punctuation">,</span> aes<span class="punctuation">(</span>x<span class="operator">=</span>Sepal.Width<span class="punctuation">,</span>y<span class="operator">=</span>Sepal.Length<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_symbol<span class="punctuation">(</span>aes<span class="punctuation">(</span>symbol<span class="operator">=</span>Species<span class="punctuation">,</span> fill<span class="operator">=</span>Species<span class="punctuation">)</span><span class="punctuation">,</span> </span><br><span class="line">              color<span class="operator">=</span><span class="string">&quot;grey60&quot;</span><span class="punctuation">,</span> size<span class="operator">=</span><span class="number">2.5</span><span class="punctuation">,</span></span><br><span class="line">              stroke<span class="operator">=</span><span class="number">0.5</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  scale_fill_manual<span class="punctuation">(</span>values<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;#E41A1C&quot;</span><span class="punctuation">,</span> <span class="string">&quot;#377EB8&quot;</span><span class="punctuation">,</span> <span class="string">&quot;#4DAF4A&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  scale_symbol_manual<span class="punctuation">(</span>values<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">28</span><span class="punctuation">,</span> <span class="number">10</span><span class="punctuation">,</span> <span class="number">31</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">p</span><br></pre></td></tr></table></figure>
<h3 id="箱线图和小提琴图">箱线图和小提琴图</h3>
<h4 id="ggplot2配对散点箱线图">ggplot2配对散点箱线图</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">x &lt;-  rnorm(10)</span><br><span class="line">y &lt;- rnorm(10)</span><br><span class="line">d &lt;- data.frame(x=x, y=y)</span><br><span class="line">d$g &lt;- rownames(d)</span><br><span class="line">require(tidyr)</span><br><span class="line">dd &lt;- pivot_longer(d, 1:2)</span><br><span class="line"></span><br><span class="line">require(ggplot2)</span><br><span class="line">ggplot(dd, aes(name, value)) + geom_boxplot() +</span><br><span class="line">  geom_line(aes(group=g), color=&#x27;firebrick&#x27;) +</span><br><span class="line">  geom_point(aes(color=name), size=3)</span><br><span class="line"></span><br><span class="line">t1 &lt;- rnorm(10)</span><br><span class="line">t2 &lt;- rnorm(10) + 1</span><br><span class="line">t3 &lt;- rnorm(10) + 2</span><br><span class="line">t4 &lt;- rnorm(10) + 3</span><br><span class="line"></span><br><span class="line">d &lt;- data.frame(t1=t1, t2=t2, t3=t3, t4=t4)</span><br><span class="line">d$g &lt;- rownames(d)</span><br><span class="line">require(tidyr)</span><br><span class="line">dd &lt;- pivot_longer(d, 1:4)</span><br><span class="line">require(ggplot2)</span><br><span class="line">ggplot(dd, aes(name, value)) + geom_boxplot() +</span><br><span class="line">  geom_line(aes(group=g), color=&#x27;firebrick&#x27;) +</span><br><span class="line">  geom_point(aes(color=name), size=3)</span><br></pre></td></tr></table></figure>
<h4 id="箱线图实例">箱线图实例</h4>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#读取数据</span></span><br><span class="line">library<span class="punctuation">(</span>reshape2<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">alpha <span class="operator">&lt;-</span> read.csv<span class="punctuation">(</span><span class="string">&#x27;alpha.csv&#x27;</span><span class="punctuation">)</span></span><br><span class="line">alpha<span class="operator">$</span>group2 <span class="operator">&lt;-</span> factor<span class="punctuation">(</span>alpha<span class="operator">$</span>group2<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">alpha1 <span class="operator">&lt;-</span> melt<span class="punctuation">(</span>alpha<span class="punctuation">,</span> id <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;samples&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;group1&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;group2&#x27;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">alpha2 <span class="operator">&lt;-</span> subset<span class="punctuation">(</span>alpha1<span class="punctuation">,</span> variable <span class="operator">==</span> <span class="string">&#x27;chao1&#x27;</span><span class="punctuation">)</span></span><br><span class="line">alpha3 <span class="operator">&lt;-</span> subset<span class="punctuation">(</span>alpha2<span class="punctuation">,</span> group1 <span class="operator">==</span> <span class="string">&#x27;c&#x27;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##boxplot()，箱线图</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#pdf(&#x27;boxplot.pdf&#x27;, width = 13, height = 5)</span></span><br><span class="line">png<span class="punctuation">(</span><span class="string">&#x27;boxplot.png&#x27;</span><span class="punctuation">,</span> width <span class="operator">=</span> <span class="number">4000</span><span class="punctuation">,</span> height <span class="operator">=</span> <span class="number">1500</span><span class="punctuation">,</span> res <span class="operator">=</span> <span class="number">300</span><span class="punctuation">,</span> units <span class="operator">=</span> <span class="string">&#x27;px&#x27;</span><span class="punctuation">)</span></span><br><span class="line">par<span class="punctuation">(</span>mfrow <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span> <span class="number">2</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">boxplot<span class="punctuation">(</span>value<span class="operator">~</span>group2<span class="punctuation">,</span> data <span class="operator">=</span> alpha3<span class="punctuation">,</span> col <span class="operator">=</span> <span class="string">&#x27;#f8766d&#x27;</span><span class="punctuation">,</span> ylab <span class="operator">=</span> <span class="string">&#x27;Chao1 (group c)&#x27;</span><span class="punctuation">)</span></span><br><span class="line">boxplot<span class="punctuation">(</span>value<span class="operator">~</span>group2<span class="punctuation">,</span> data <span class="operator">=</span> alpha3<span class="punctuation">,</span> col <span class="operator">=</span> <span class="string">&#x27;#f8766d&#x27;</span><span class="punctuation">,</span> notch <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">,</span> varwidth <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">,</span> ylab <span class="operator">=</span> <span class="string">&#x27;Chao1 (group c)&#x27;</span><span class="punctuation">)</span></span><br><span class="line">dev.off<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##vioplot()，提琴图</span></span><br><span class="line">library<span class="punctuation">(</span>vioplot<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">c1 <span class="operator">&lt;-</span> subset<span class="punctuation">(</span>alpha3<span class="punctuation">,</span> group2 <span class="operator">==</span> <span class="string">&#x27;1&#x27;</span><span class="punctuation">)</span><span class="operator">$</span>value</span><br><span class="line">c2 <span class="operator">&lt;-</span> subset<span class="punctuation">(</span>alpha3<span class="punctuation">,</span> group2 <span class="operator">==</span> <span class="string">&#x27;2&#x27;</span><span class="punctuation">)</span><span class="operator">$</span>value</span><br><span class="line">c3 <span class="operator">&lt;-</span> subset<span class="punctuation">(</span>alpha3<span class="punctuation">,</span> group2 <span class="operator">==</span> <span class="string">&#x27;3&#x27;</span><span class="punctuation">)</span><span class="operator">$</span>value</span><br><span class="line">c4 <span class="operator">&lt;-</span> subset<span class="punctuation">(</span>alpha3<span class="punctuation">,</span> group2 <span class="operator">==</span> <span class="string">&#x27;4&#x27;</span><span class="punctuation">)</span><span class="operator">$</span>value</span><br><span class="line">c5 <span class="operator">&lt;-</span> subset<span class="punctuation">(</span>alpha3<span class="punctuation">,</span> group2 <span class="operator">==</span> <span class="string">&#x27;5&#x27;</span><span class="punctuation">)</span><span class="operator">$</span>value</span><br><span class="line"></span><br><span class="line"><span class="comment">#pdf(&#x27;vioplot.pdf&#x27;, width = 6.5, height = 5)</span></span><br><span class="line">png<span class="punctuation">(</span><span class="string">&#x27;vioplot.png&#x27;</span><span class="punctuation">,</span> width <span class="operator">=</span> <span class="number">2000</span><span class="punctuation">,</span> height <span class="operator">=</span> <span class="number">1500</span><span class="punctuation">,</span> res <span class="operator">=</span> <span class="number">300</span><span class="punctuation">,</span> units <span class="operator">=</span> <span class="string">&#x27;px&#x27;</span><span class="punctuation">)</span></span><br><span class="line">vioplot<span class="punctuation">(</span>c1<span class="punctuation">,</span> c2<span class="punctuation">,</span> c3<span class="punctuation">,</span> c4<span class="punctuation">,</span> c5<span class="punctuation">,</span> col <span class="operator">=</span> <span class="string">&#x27;#f8766d&#x27;</span><span class="punctuation">)</span></span><br><span class="line">title<span class="punctuation">(</span>ylab <span class="operator">=</span> <span class="string">&#x27;Chao1 (group c)&#x27;</span><span class="punctuation">)</span></span><br><span class="line">dev.off<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##ggplot2</span></span><br><span class="line">library<span class="punctuation">(</span>ggplot2<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#箱线图</span></span><br><span class="line">p <span class="operator">&lt;-</span> ggplot<span class="punctuation">(</span>alpha2<span class="punctuation">,</span> aes<span class="punctuation">(</span>x <span class="operator">=</span> group2<span class="punctuation">,</span> y <span class="operator">=</span> value<span class="punctuation">,</span> fill <span class="operator">=</span> group1<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span> </span><br><span class="line">geom_boxplot<span class="punctuation">(</span>outlier.size <span class="operator">=</span> <span class="number">0.7</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&#x27;&#x27;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&#x27;Chao1&#x27;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">theme<span class="punctuation">(</span>panel.grid <span class="operator">=</span> element_blank<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">,</span> panel.background <span class="operator">=</span> element_rect<span class="punctuation">(</span>fill <span class="operator">=</span> <span class="string">&#x27;transparent&#x27;</span><span class="punctuation">,</span> color <span class="operator">=</span> <span class="string">&#x27;black&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span> legend.title <span class="operator">=</span> element_blank<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">,</span> legend.key <span class="operator">=</span> element_blank<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#ggsave(&#x27;ggplot2.box.pdf&#x27;, p, width = 6, height = 4)</span></span><br><span class="line">ggsave<span class="punctuation">(</span><span class="string">&#x27;ggplot2.box.png&#x27;</span><span class="punctuation">,</span> p<span class="punctuation">,</span> width <span class="operator">=</span> <span class="number">6</span><span class="punctuation">,</span> height <span class="operator">=</span> <span class="number">4</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#带散点及凹槽的箱线图</span></span><br><span class="line">p <span class="operator">&lt;-</span> ggplot<span class="punctuation">(</span>alpha3<span class="punctuation">,</span> aes<span class="punctuation">(</span>x <span class="operator">=</span> group2<span class="punctuation">,</span> y <span class="operator">=</span> value<span class="punctuation">,</span> fill <span class="operator">=</span> group1<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span> </span><br><span class="line">geom_boxplot<span class="punctuation">(</span>fill <span class="operator">=</span> <span class="string">&#x27;#f8766d&#x27;</span><span class="punctuation">,</span> notch <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">geom_jitter<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&#x27;red&#x27;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&#x27;&#x27;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&#x27;Chao1 (group c)&#x27;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">theme<span class="punctuation">(</span>panel.grid <span class="operator">=</span> element_blank<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">,</span> panel.background <span class="operator">=</span> element_rect<span class="punctuation">(</span>fill <span class="operator">=</span> <span class="string">&#x27;transparent&#x27;</span><span class="punctuation">,</span> color <span class="operator">=</span> <span class="string">&#x27;black&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span> legend.position <span class="operator">=</span> <span class="string">&#x27;none&#x27;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#ggsave(&#x27;ggplot2.box_point.pdf&#x27;, p, width = 6, height = 4)</span></span><br><span class="line">ggsave<span class="punctuation">(</span><span class="string">&#x27;ggplot2.box_point.png&#x27;</span><span class="punctuation">,</span> p<span class="punctuation">,</span> width <span class="operator">=</span> <span class="number">6</span><span class="punctuation">,</span> height <span class="operator">=</span> <span class="number">4</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#内置箱线图的提琴图</span></span><br><span class="line">p <span class="operator">&lt;-</span> ggplot<span class="punctuation">(</span>alpha2<span class="punctuation">,</span> aes<span class="punctuation">(</span>x <span class="operator">=</span> group2<span class="punctuation">,</span> y <span class="operator">=</span> value<span class="punctuation">,</span> fill <span class="operator">=</span> group1<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span> </span><br><span class="line">geom_violin<span class="punctuation">(</span>position <span class="operator">=</span> position_dodge<span class="punctuation">(</span>width <span class="operator">=</span> <span class="number">1</span><span class="punctuation">)</span><span class="punctuation">,</span> scale <span class="operator">=</span> <span class="string">&#x27;width&#x27;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">geom_boxplot<span class="punctuation">(</span>position <span class="operator">=</span> position_dodge<span class="punctuation">(</span>width <span class="operator">=</span> <span class="number">1</span><span class="punctuation">)</span><span class="punctuation">,</span> outlier.size <span class="operator">=</span> <span class="number">0.7</span><span class="punctuation">,</span> width <span class="operator">=</span> <span class="number">0.2</span><span class="punctuation">,</span> show.legend <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&#x27;&#x27;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&#x27;Chao1&#x27;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">theme<span class="punctuation">(</span>panel.grid <span class="operator">=</span> element_blank<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">,</span> panel.background <span class="operator">=</span> element_rect<span class="punctuation">(</span>fill <span class="operator">=</span> <span class="string">&#x27;transparent&#x27;</span><span class="punctuation">,</span> color <span class="operator">=</span> <span class="string">&#x27;black&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span> legend.title <span class="operator">=</span> element_blank<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">,</span> legend.key <span class="operator">=</span> element_blank<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#ggsave(&#x27;ggplot2.box_violin.pdf&#x27;, p, width = 6, height = 4)</span></span><br><span class="line">ggsave<span class="punctuation">(</span><span class="string">&#x27;ggplot2.box_violin.png&#x27;</span><span class="punctuation">,</span> p<span class="punctuation">,</span> width <span class="operator">=</span> <span class="number">6</span><span class="punctuation">,</span> height <span class="operator">=</span> <span class="number">4</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#带分面的箱线图</span></span><br><span class="line">p <span class="operator">&lt;-</span> ggplot<span class="punctuation">(</span>alpha1<span class="punctuation">,</span> aes<span class="punctuation">(</span>x <span class="operator">=</span> group2<span class="punctuation">,</span> y <span class="operator">=</span> value<span class="punctuation">,</span> fill <span class="operator">=</span> group1<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span> </span><br><span class="line">geom_boxplot<span class="punctuation">(</span>outlier.size <span class="operator">=</span> <span class="number">0.3</span><span class="punctuation">,</span> size <span class="operator">=</span> <span class="number">0.25</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">facet_wrap<span class="punctuation">(</span><span class="operator">~</span>variable<span class="punctuation">,</span> <span class="number">2</span><span class="punctuation">,</span> scales <span class="operator">=</span> <span class="string">&#x27;free&#x27;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&#x27;&#x27;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&#x27;&#x27;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">theme<span class="punctuation">(</span>panel.grid <span class="operator">=</span> element_blank<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">,</span> panel.background <span class="operator">=</span> element_rect<span class="punctuation">(</span>fill <span class="operator">=</span> <span class="string">&#x27;transparent&#x27;</span><span class="punctuation">,</span> color <span class="operator">=</span> <span class="string">&#x27;black&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span> legend.title <span class="operator">=</span> element_blank<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">,</span> legend.key <span class="operator">=</span> element_blank<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#ggsave(&#x27;ggplot2.box_facet.pdf&#x27;, p, width = 7, height = 5)</span></span><br><span class="line">ggsave<span class="punctuation">(</span><span class="string">&#x27;ggplot2.box_facet.png&#x27;</span><span class="punctuation">,</span> p<span class="punctuation">,</span> width <span class="operator">=</span> <span class="number">7</span><span class="punctuation">,</span> height <span class="operator">=</span> <span class="number">5</span><span class="punctuation">)</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="ggpubr箱线图">ggpubr箱线图</h4>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line">View<span class="punctuation">(</span>ToothGrowth<span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>ggplot2<span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>ggpubr<span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>ggsignif<span class="punctuation">)</span></span><br><span class="line">ToothGrowth<span class="operator">$</span>dose <span class="operator">&lt;-</span> as.factor<span class="punctuation">(</span>ToothGrowth<span class="operator">$</span>dose<span class="punctuation">)</span></span><br><span class="line">ggboxplot<span class="punctuation">(</span>ToothGrowth<span class="punctuation">,</span> <span class="comment">#数据对象</span></span><br><span class="line">          x <span class="operator">=</span> <span class="string">&quot;dose&quot;</span><span class="punctuation">,</span> <span class="comment"># 选择x轴用那一列数据</span></span><br><span class="line">          y <span class="operator">=</span> <span class="string">&quot;len&quot;</span><span class="punctuation">,</span> <span class="comment">#选择y轴用什么数据</span></span><br><span class="line">          fill <span class="operator">=</span> <span class="string">&quot;dose&quot;</span><span class="punctuation">,</span> <span class="comment">#颜色根据哪一列决定</span></span><br><span class="line">          bxp.errorbar <span class="operator">=</span> <span class="built_in">T</span><span class="punctuation">,</span> <span class="comment">#是否添加error bar</span></span><br><span class="line">          bxp.errorbar.width <span class="operator">=</span> <span class="number">0.2</span><span class="punctuation">,</span> <span class="comment">#error bar的长度</span></span><br><span class="line">          palette <span class="operator">=</span> <span class="string">&quot;npg&quot;</span><span class="punctuation">,</span> <span class="comment">#颜色风格</span></span><br><span class="line">          add <span class="operator">=</span> <span class="string">&quot;point&quot;</span> <span class="comment"># 是否添加boxplot上面的点点</span></span><br><span class="line"><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  labs<span class="punctuation">(</span>title <span class="operator">=</span> <span class="string">&quot;Effect of Vitamin C on Tooth Growth&quot;</span><span class="punctuation">,</span> <span class="comment"># 添加主标题</span></span><br><span class="line">       subtitle <span class="operator">=</span> <span class="string">&quot;Plot of length by dose&quot;</span><span class="punctuation">,</span> <span class="comment"># 添加次标记</span></span><br><span class="line">       caption <span class="operator">=</span> <span class="string">&quot;Data source: ToothGrowth&quot;</span><span class="punctuation">,</span> <span class="comment">#添加脚注</span></span><br><span class="line">       x <span class="operator">=</span> <span class="string">&quot;Dose (mg)&quot;</span><span class="punctuation">,</span> <span class="comment"># x轴的名字</span></span><br><span class="line">       y <span class="operator">=</span> <span class="string">&quot;Teeth length&quot;</span> <span class="comment"># y轴的名字</span></span><br><span class="line">  <span class="punctuation">)</span></span><br><span class="line">ggboxplot<span class="punctuation">(</span>ToothGrowth<span class="punctuation">,</span> <span class="comment">#数据对象</span></span><br><span class="line">          x <span class="operator">=</span> <span class="string">&quot;dose&quot;</span><span class="punctuation">,</span> <span class="comment"># 选择x轴用那一列数据</span></span><br><span class="line">          y <span class="operator">=</span> <span class="string">&quot;len&quot;</span><span class="punctuation">,</span> <span class="comment">#选择y轴用什么数据</span></span><br><span class="line">          fill <span class="operator">=</span> <span class="string">&quot;dose&quot;</span><span class="punctuation">,</span> <span class="comment">#颜色根据哪一列决定</span></span><br><span class="line">          bxp.errorbar <span class="operator">=</span> <span class="built_in">T</span><span class="punctuation">,</span> <span class="comment">#是否添加error bar</span></span><br><span class="line">          bxp.errorbar.width <span class="operator">=</span> <span class="number">0.2</span><span class="punctuation">,</span> <span class="comment">#error bar的长度</span></span><br><span class="line">          palette <span class="operator">=</span> <span class="string">&quot;npg&quot;</span><span class="punctuation">,</span> <span class="comment">#颜色风格</span></span><br><span class="line">          add <span class="operator">=</span> <span class="string">&quot;point&quot;</span> <span class="comment"># 是否添加boxplot上面的点点</span></span><br><span class="line"><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  labs<span class="punctuation">(</span>title <span class="operator">=</span> <span class="string">&quot;Effect of Vitamin C on Tooth Growth&quot;</span><span class="punctuation">,</span> <span class="comment"># 添加主标题</span></span><br><span class="line">       subtitle <span class="operator">=</span> <span class="string">&quot;Plot of length by dose&quot;</span><span class="punctuation">,</span> <span class="comment"># 添加次标记</span></span><br><span class="line">       caption <span class="operator">=</span> <span class="string">&quot;Data source: ToothGrowth&quot;</span><span class="punctuation">,</span> <span class="comment">#添加脚注</span></span><br><span class="line">       x <span class="operator">=</span> <span class="string">&quot;Dose (mg)&quot;</span><span class="punctuation">,</span> <span class="comment"># x轴的名字</span></span><br><span class="line">       y <span class="operator">=</span> <span class="string">&quot;Teeth length&quot;</span> <span class="comment"># y轴的名字</span></span><br><span class="line">  <span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_signif<span class="punctuation">(</span>comparisons <span class="operator">=</span> <span class="built_in">list</span><span class="punctuation">(</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;0.5&quot;</span><span class="punctuation">,</span> <span class="string">&quot;1&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;1&quot;</span><span class="punctuation">,</span><span class="string">&quot;2&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;0.5&quot;</span><span class="punctuation">,</span><span class="string">&quot;2&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">,</span> <span class="comment"># 设置要对比的组</span></span><br><span class="line">              y_position <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">34</span><span class="punctuation">,</span><span class="number">36</span><span class="punctuation">,</span><span class="number">38</span><span class="punctuation">)</span><span class="punctuation">,</span> <span class="comment">#设置3个显著性标记的高度</span></span><br><span class="line">              tip_length <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">0</span><span class="punctuation">)</span><span class="punctuation">,</span> <span class="comment">#设置显著性那条横线两头向下的长度</span></span><br><span class="line">              map_signif_level <span class="operator">=</span> <span class="built_in">T</span><span class="punctuation">,</span> <span class="comment">#设置是否标记显著性的*号，还是直接标记数值</span></span><br><span class="line">              test <span class="operator">=</span> t.test <span class="comment">#设置显著性计算方式</span></span><br><span class="line">  <span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#最后就是设置线宽度和字体大小，及其他的主题theme()参数：</span></span><br><span class="line"></span><br><span class="line">ggboxplot<span class="punctuation">(</span>ToothGrowth<span class="punctuation">,</span> <span class="comment">#数据对象</span></span><br><span class="line">          x <span class="operator">=</span> <span class="string">&quot;dose&quot;</span><span class="punctuation">,</span> <span class="comment"># 选择x轴用那一列数据</span></span><br><span class="line">          y <span class="operator">=</span> <span class="string">&quot;len&quot;</span><span class="punctuation">,</span> <span class="comment">#选择y轴用什么数据</span></span><br><span class="line">          fill <span class="operator">=</span> <span class="string">&quot;dose&quot;</span><span class="punctuation">,</span> <span class="comment">#颜色根据哪一列决定</span></span><br><span class="line">          bxp.errorbar <span class="operator">=</span> <span class="built_in">T</span><span class="punctuation">,</span> <span class="comment">#是否添加error bar</span></span><br><span class="line">          bxp.errorbar.width <span class="operator">=</span> <span class="number">0.2</span><span class="punctuation">,</span> <span class="comment">#error bar的长度</span></span><br><span class="line">          palette <span class="operator">=</span> <span class="string">&quot;npg&quot;</span><span class="punctuation">,</span> <span class="comment">#颜色风格</span></span><br><span class="line">          add <span class="operator">=</span> <span class="string">&quot;point&quot;</span> <span class="comment"># 是否添加boxplot上面的点点</span></span><br><span class="line"><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  labs<span class="punctuation">(</span>title <span class="operator">=</span> <span class="string">&quot;Effect of Vitamin C on Tooth Growth&quot;</span><span class="punctuation">,</span> <span class="comment"># 添加主标题</span></span><br><span class="line">       subtitle <span class="operator">=</span> <span class="string">&quot;Plot of length by dose&quot;</span><span class="punctuation">,</span> <span class="comment"># 添加次标记</span></span><br><span class="line">       caption <span class="operator">=</span> <span class="string">&quot;Data source: ToothGrowth&quot;</span><span class="punctuation">,</span> <span class="comment">#添加脚注</span></span><br><span class="line">       x <span class="operator">=</span> <span class="string">&quot;Dose (mg)&quot;</span><span class="punctuation">,</span> <span class="comment"># x轴的名字</span></span><br><span class="line">       y <span class="operator">=</span> <span class="string">&quot;Teeth length&quot;</span> <span class="comment"># y轴的名字</span></span><br><span class="line">  <span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_signif<span class="punctuation">(</span>comparisons <span class="operator">=</span> <span class="built_in">list</span><span class="punctuation">(</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;0.5&quot;</span><span class="punctuation">,</span> <span class="string">&quot;1&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;1&quot;</span><span class="punctuation">,</span><span class="string">&quot;2&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;0.5&quot;</span><span class="punctuation">,</span><span class="string">&quot;2&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">,</span> <span class="comment"># 设置要对比的组</span></span><br><span class="line">              y_position <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">34</span><span class="punctuation">,</span><span class="number">36</span><span class="punctuation">,</span><span class="number">38</span><span class="punctuation">)</span><span class="punctuation">,</span> <span class="comment">#设置3个显著性标记的高度</span></span><br><span class="line">              tip_length <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">0</span><span class="punctuation">)</span><span class="punctuation">,</span> <span class="comment">#设置显著性那条横线两头向下的长度</span></span><br><span class="line">              map_signif_level <span class="operator">=</span> <span class="built_in">T</span><span class="punctuation">,</span> <span class="comment">#设置是否标记显著性的*号，还是直接标记数值</span></span><br><span class="line">              test <span class="operator">=</span> t.test <span class="comment">#设置显著性计算方式</span></span><br><span class="line">  <span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  theme<span class="punctuation">(</span></span><br><span class="line">    plot.title    <span class="operator">=</span> element_text<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&quot;black&quot;</span><span class="punctuation">,</span> size   <span class="operator">=</span> <span class="number">16</span><span class="punctuation">,</span> hjust <span class="operator">=</span> <span class="number">0.5</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">    plot.subtitle <span class="operator">=</span> element_text<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&quot;black&quot;</span><span class="punctuation">,</span> size   <span class="operator">=</span> <span class="number">16</span><span class="punctuation">,</span>hjust <span class="operator">=</span> <span class="number">0.5</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">    plot.caption  <span class="operator">=</span> element_text<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&quot;black&quot;</span><span class="punctuation">,</span> size   <span class="operator">=</span> <span class="number">16</span><span class="punctuation">,</span>face <span class="operator">=</span> <span class="string">&quot;italic&quot;</span><span class="punctuation">,</span> hjust <span class="operator">=</span> <span class="number">1</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">    axis.text.x   <span class="operator">=</span> element_text<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&quot;black&quot;</span><span class="punctuation">,</span> size <span class="operator">=</span> <span class="number">16</span><span class="punctuation">,</span> angle <span class="operator">=</span> <span class="number">0</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">    axis.text.y   <span class="operator">=</span> element_text<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&quot;black&quot;</span><span class="punctuation">,</span> size <span class="operator">=</span> <span class="number">16</span><span class="punctuation">,</span> angle <span class="operator">=</span> <span class="number">0</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">    axis.title.x  <span class="operator">=</span> element_text<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&quot;black&quot;</span><span class="punctuation">,</span> size <span class="operator">=</span> <span class="number">16</span><span class="punctuation">,</span> angle <span class="operator">=</span> <span class="number">0</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">    axis.title.y  <span class="operator">=</span> element_text<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&quot;black&quot;</span><span class="punctuation">,</span> size <span class="operator">=</span> <span class="number">16</span><span class="punctuation">,</span> angle <span class="operator">=</span> <span class="number">90</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">    legend.title  <span class="operator">=</span> element_text<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&quot;black&quot;</span><span class="punctuation">,</span> size  <span class="operator">=</span> <span class="number">16</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">    legend.text   <span class="operator">=</span> element_text<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&quot;black&quot;</span><span class="punctuation">,</span> size   <span class="operator">=</span> <span class="number">16</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">    axis.line.y <span class="operator">=</span> element_line<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&quot;black&quot;</span><span class="punctuation">,</span> linetype <span class="operator">=</span> <span class="string">&quot;solid&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span> <span class="comment"># y轴线特征</span></span><br><span class="line">    axis.line.x <span class="operator">=</span> element_line <span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&quot;black&quot;</span><span class="punctuation">,</span>linetype <span class="operator">=</span> <span class="string">&quot;solid&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span> <span class="comment"># x轴线特征</span></span><br><span class="line">    panel.border <span class="operator">=</span> element_rect<span class="punctuation">(</span>linetype <span class="operator">=</span> <span class="string">&quot;solid&quot;</span><span class="punctuation">,</span> size <span class="operator">=</span> <span class="number">1.2</span><span class="punctuation">,</span>fill <span class="operator">=</span> <span class="literal">NA</span><span class="punctuation">)</span> <span class="comment"># 图四周框起来</span></span><br><span class="line">  <span class="punctuation">)</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="anosim分析"><strong>Anosim分析</strong></h3>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line">library<span class="punctuation">(</span>vegan<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#若是单纯以计算俩组beta距离值画图的话</span></span><br><span class="line">dist.abun_D <span class="operator">&lt;-</span> as.vector<span class="punctuation">(</span>vegdist<span class="punctuation">(</span>dat_genu<span class="punctuation">[</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">1</span><span class="operator">:</span><span class="number">6</span><span class="punctuation">)</span><span class="punctuation">,</span><span class="punctuation">]</span><span class="punctuation">,</span>method <span class="operator">=</span> <span class="string">&#x27;bray&#x27;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">dist.abun_H <span class="operator">&lt;-</span> as.vector<span class="punctuation">(</span>vegdist<span class="punctuation">(</span>dat_genu<span class="punctuation">[</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">7</span><span class="operator">:</span><span class="number">12</span><span class="punctuation">)</span><span class="punctuation">,</span><span class="punctuation">]</span><span class="punctuation">,</span>method <span class="operator">=</span> <span class="string">&#x27;bray&#x27;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"><span class="built_in">sum</span> <span class="operator">&lt;-</span> data.frame<span class="punctuation">(</span>dist.abun_D<span class="punctuation">,</span>dist.abun_H<span class="punctuation">)</span></span><br><span class="line">boxplot<span class="punctuation">(</span><span class="built_in">sum</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##读入文件</span></span><br><span class="line"><span class="comment">#现有的距离矩阵</span></span><br><span class="line">dis <span class="operator">&lt;-</span> read.delim<span class="punctuation">(</span><span class="string">&#x27;bray.txt&#x27;</span><span class="punctuation">,</span> row.names <span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span> sep <span class="operator">=</span> <span class="string">&#x27;\t&#x27;</span><span class="punctuation">,</span> stringsAsFactors <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">,</span> check.names <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span></span><br><span class="line">dis <span class="operator">&lt;-</span> as.dist<span class="punctuation">(</span>dis<span class="punctuation">)</span>	<span class="comment">#将导入的样本间距离转化为 dist 类型</span></span><br><span class="line"><span class="comment">#或者直接使用 OTU 丰度表</span></span><br><span class="line">otu <span class="operator">&lt;-</span> read.delim<span class="punctuation">(</span><span class="string">&#x27;otu_table.txt&#x27;</span><span class="punctuation">,</span> row.names <span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span> sep <span class="operator">=</span> <span class="string">&#x27;\t&#x27;</span><span class="punctuation">,</span> stringsAsFactors <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">,</span> check.names <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span></span><br><span class="line">otu <span class="operator">&lt;-</span> data.frame<span class="punctuation">(</span>t<span class="punctuation">(</span>otu<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#样本分组文件</span></span><br><span class="line">group <span class="operator">&lt;-</span> read.delim<span class="punctuation">(</span><span class="string">&#x27;group.txt&#x27;</span><span class="punctuation">,</span> sep <span class="operator">=</span> <span class="string">&#x27;\t&#x27;</span><span class="punctuation">,</span> stringsAsFactors <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##ANOSIM 分析（所有分组间比较，即整体差异）</span></span><br><span class="line"><span class="comment">#（1）若是已经提供好了距离矩阵，则直接使用现有的距离矩阵进行分析即可</span></span><br><span class="line">anosim_result_dis <span class="operator">&lt;-</span> anosim<span class="punctuation">(</span>dis<span class="punctuation">,</span> group<span class="operator">$</span>site<span class="punctuation">,</span> permutations <span class="operator">=</span> <span class="number">999</span><span class="punctuation">)</span>	<span class="comment">#根据 group$site 这一列样本分组信息进行 ANOSIM 分析，随机置换检验 999 次</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#（2）若是使用 OTU 丰度表，则需要在计算时指定所依据的距离类型，这里依然使用 Bray-Curtis 距离</span></span><br><span class="line">anosim_result_otu <span class="operator">&lt;-</span> anosim<span class="punctuation">(</span>otu<span class="punctuation">,</span> group<span class="operator">$</span>site<span class="punctuation">,</span> permutations <span class="operator">=</span> <span class="number">999</span><span class="punctuation">,</span> distance <span class="operator">=</span> <span class="string">&#x27;bray&#x27;</span><span class="punctuation">)</span> 	<span class="comment">#这条命令的详情和上述命令所表示的信息一致</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#（3）或者首先根据丰度表计算样本距离，在将所的距离数据作为输入</span></span><br><span class="line">dis1 <span class="operator">&lt;-</span> vegdist<span class="punctuation">(</span>otu<span class="punctuation">,</span> method <span class="operator">=</span> <span class="string">&#x27;bray&#x27;</span><span class="punctuation">)</span></span><br><span class="line">anosim_result_dis1 <span class="operator">&lt;-</span> anosim<span class="punctuation">(</span>dis1<span class="punctuation">,</span> group<span class="operator">$</span>site<span class="punctuation">,</span> permutations <span class="operator">=</span> <span class="number">999</span><span class="punctuation">)</span>	<span class="comment">#同上所述</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#查看结果，上述 3 条命令所计算的内容一致，以其中一个为例</span></span><br><span class="line">anosim_result_dis</span><br><span class="line"><span class="comment">#或者</span></span><br><span class="line">summary<span class="punctuation">(</span>anosim_result_dis<span class="punctuation">)</span></span><br><span class="line"><span class="comment">#或者</span></span><br><span class="line"><span class="built_in">names</span><span class="punctuation">(</span>anosim_result_dis<span class="punctuation">)</span></span><br><span class="line">anosim_result_dis<span class="operator">$</span><span class="built_in">signif</span>	<span class="comment">#p 值</span></span><br><span class="line">anosim_result_dis<span class="operator">$</span>statistic	<span class="comment">#R 值</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#作图展示</span></span><br><span class="line"><span class="comment">#pdf(paste(&#x27;anosim.all.pdf&#x27;, sep = &#x27;&#x27;), width = 10, height = 5)</span></span><br><span class="line">png<span class="punctuation">(</span>paste<span class="punctuation">(</span><span class="string">&#x27;anosim.all.png&#x27;</span><span class="punctuation">,</span> sep <span class="operator">=</span> <span class="string">&#x27;&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span> width <span class="operator">=</span> <span class="number">800</span><span class="punctuation">,</span> height <span class="operator">=</span> <span class="number">400</span><span class="punctuation">)</span></span><br><span class="line">plot<span class="punctuation">(</span>anosim_result_dis<span class="punctuation">,</span> col <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;gray&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;red&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;green&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;blue&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;orange&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;purple&#x27;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">dev.off<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##ANOSIM 分析（使用循环处理，进行小分组间比较，如两组间）</span></span><br><span class="line"><span class="comment">#推荐使用 OTU 丰度表作为输入数据，每次筛选分组后重新计算样本距离，避免由于样本数减少可能导致的距离变动而造成误差</span></span><br><span class="line">group_name <span class="operator">&lt;-</span> unique<span class="punctuation">(</span>group<span class="operator">$</span>site<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">dir.create<span class="punctuation">(</span><span class="string">&#x27;anosim_two&#x27;</span><span class="punctuation">,</span> recursive <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span></span><br><span class="line">anosim_result_two <span class="operator">&lt;-</span> <span class="literal">NULL</span></span><br><span class="line"><span class="keyword">for</span> <span class="punctuation">(</span>i <span class="keyword">in</span> <span class="number">1</span><span class="operator">:</span><span class="punctuation">(</span><span class="built_in">length</span><span class="punctuation">(</span>group_name<span class="punctuation">)</span> <span class="operator">-</span> <span class="number">1</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">	<span class="keyword">for</span> <span class="punctuation">(</span>j <span class="keyword">in</span> <span class="punctuation">(</span>i <span class="operator">+</span> <span class="number">1</span><span class="punctuation">)</span><span class="operator">:</span><span class="built_in">length</span><span class="punctuation">(</span>group_name<span class="punctuation">)</span><span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">		group_ij <span class="operator">&lt;-</span> subset<span class="punctuation">(</span>group<span class="punctuation">,</span> site <span class="operator">%in%</span> <span class="built_in">c</span><span class="punctuation">(</span>group_name<span class="punctuation">[</span>i<span class="punctuation">]</span><span class="punctuation">,</span> group_name<span class="punctuation">[</span>j<span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">		otu_ij <span class="operator">&lt;-</span> otu<span class="punctuation">[</span>group_ij<span class="operator">$</span><span class="built_in">names</span><span class="punctuation">,</span> <span class="punctuation">]</span></span><br><span class="line">		anosim_result_otu_ij <span class="operator">&lt;-</span> anosim<span class="punctuation">(</span>otu_ij<span class="punctuation">,</span> group_ij<span class="operator">$</span>site<span class="punctuation">,</span> permutations <span class="operator">=</span> <span class="number">999</span><span class="punctuation">,</span> distance <span class="operator">=</span> <span class="string">&#x27;bray&#x27;</span><span class="punctuation">)</span>	<span class="comment">#随机置换检验 999 次</span></span><br><span class="line">		</span><br><span class="line">		<span class="comment">#每次循环提取 R 值和 p 值（同时标记 “*” 显著性）</span></span><br><span class="line">		<span class="keyword">if</span> <span class="punctuation">(</span>anosim_result_otu_ij<span class="operator">$</span><span class="built_in">signif</span> <span class="operator">&lt;=</span> <span class="number">0.001</span><span class="punctuation">)</span> Sig <span class="operator">&lt;-</span> <span class="string">&#x27;***&#x27;</span></span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> <span class="punctuation">(</span>anosim_result_otu_ij<span class="operator">$</span><span class="built_in">signif</span> <span class="operator">&lt;=</span> <span class="number">0.01</span><span class="punctuation">)</span> Sig <span class="operator">&lt;-</span> <span class="string">&#x27;**&#x27;</span></span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> <span class="punctuation">(</span>anosim_result_otu_ij<span class="operator">$</span><span class="built_in">signif</span> <span class="operator">&lt;=</span> <span class="number">0.05</span><span class="punctuation">)</span> Sig <span class="operator">&lt;-</span> <span class="string">&#x27;*&#x27;</span></span><br><span class="line">		<span class="keyword">else</span> Sig <span class="operator">&lt;-</span> <span class="literal">NA</span></span><br><span class="line">		anosim_result_two <span class="operator">&lt;-</span> rbind<span class="punctuation">(</span>anosim_result_two<span class="punctuation">,</span> <span class="built_in">c</span><span class="punctuation">(</span>paste<span class="punctuation">(</span>group_name<span class="punctuation">[</span>i<span class="punctuation">]</span><span class="punctuation">,</span> group_name<span class="punctuation">[</span>j<span class="punctuation">]</span><span class="punctuation">,</span> sep <span class="operator">=</span> <span class="string">&#x27;/&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span> <span class="string">&#x27;Bray-Curtis&#x27;</span><span class="punctuation">,</span> anosim_result_otu_ij<span class="operator">$</span>statistic<span class="punctuation">,</span> anosim_result_otu_ij<span class="operator">$</span><span class="built_in">signif</span><span class="punctuation">,</span> Sig<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">		</span><br><span class="line">		<span class="comment">#每次循环输出图片</span></span><br><span class="line">		<span class="comment">#pdf(paste(&#x27;anosim_two/anosim.&#x27;, group_name[i], &#x27;_&#x27;, group_name[j], &#x27;.pdf&#x27;, sep = &#x27;&#x27;), width = 7, height = 5)</span></span><br><span class="line">		png<span class="punctuation">(</span>paste<span class="punctuation">(</span><span class="string">&#x27;anosim_two/anosim.&#x27;</span><span class="punctuation">,</span> group_name<span class="punctuation">[</span>i<span class="punctuation">]</span><span class="punctuation">,</span> <span class="string">&#x27;_&#x27;</span><span class="punctuation">,</span> group_name<span class="punctuation">[</span>j<span class="punctuation">]</span><span class="punctuation">,</span> <span class="string">&#x27;.png&#x27;</span><span class="punctuation">,</span> sep <span class="operator">=</span> <span class="string">&#x27;&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span> width <span class="operator">=</span> <span class="number">600</span><span class="punctuation">,</span> height <span class="operator">=</span> <span class="number">400</span><span class="punctuation">)</span></span><br><span class="line">		plot<span class="punctuation">(</span>anosim_result_otu_ij<span class="punctuation">,</span> col <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;gray&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;red&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;blue&#x27;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">		dev.off<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line">	<span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#输出带 R 值和 p 值的表格</span></span><br><span class="line">anosim_result_two <span class="operator">&lt;-</span> data.frame<span class="punctuation">(</span>anosim_result_two<span class="punctuation">,</span> stringsAsFactors <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span></span><br><span class="line"><span class="built_in">names</span><span class="punctuation">(</span>anosim_result_two<span class="punctuation">)</span> <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;group&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;distance&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;R&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;P_value&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;Sig&#x27;</span><span class="punctuation">)</span></span><br><span class="line">write.table<span class="punctuation">(</span>anosim_result_two<span class="punctuation">,</span> <span class="string">&#x27;anosim_two/ANOSIM.result_two.txt&#x27;</span><span class="punctuation">,</span> row.names <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">,</span> sep <span class="operator">=</span> <span class="string">&#x27;\t&#x27;</span><span class="punctuation">,</span> <span class="built_in">quote</span> <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">,</span> na <span class="operator">=</span> <span class="string">&#x27;&#x27;</span><span class="punctuation">)</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="分面柱状图"><strong>分面柱状图</strong></h3>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">library<span class="punctuation">(</span>ggplot2<span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>reshape2<span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>dplyr<span class="punctuation">)</span></span><br><span class="line">data_m <span class="operator">&lt;-</span> read.table<span class="punctuation">(</span>text<span class="operator">=</span>data_ori<span class="punctuation">,</span> header<span class="operator">=</span><span class="built_in">T</span><span class="punctuation">,</span> sep<span class="operator">=</span><span class="string">&quot;;&quot;</span><span class="punctuation">,</span> <span class="built_in">quote</span><span class="operator">=</span><span class="string">&quot;&quot;</span><span class="punctuation">)</span></span><br><span class="line">head<span class="punctuation">(</span>data_m<span class="punctuation">)</span></span><br><span class="line"><span class="comment">#首先看下每个基因在不同组的表达情况, facet_grid和facet_wrap可以对图形分面显示。</span></span><br><span class="line"><span class="comment"># scales: free_y 表示不同子图之间使用独立的Y轴信息</span></span><br><span class="line"><span class="comment">#         但x轴使用同样的信息。</span></span><br><span class="line"><span class="comment">#         其它可选参数有free_x, free, fixed</span></span><br><span class="line">p <span class="operator">&lt;-</span> ggplot<span class="punctuation">(</span>data_m<span class="punctuation">,</span> aes<span class="punctuation">(</span>x<span class="operator">=</span>Gene<span class="punctuation">,</span> y<span class="operator">=</span>Expr<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span> </span><br><span class="line">  geom_bar<span class="punctuation">(</span>stat<span class="operator">=</span><span class="string">&quot;identity&quot;</span><span class="punctuation">,</span> position<span class="operator">=</span><span class="string">&quot;dodge&quot;</span><span class="punctuation">,</span> aes<span class="punctuation">(</span>fill<span class="operator">=</span>Group<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  facet_grid<span class="punctuation">(</span>Condition<span class="operator">~</span>.<span class="punctuation">,</span> scales<span class="operator">=</span><span class="string">&quot;free_y&quot;</span><span class="punctuation">)</span></span><br><span class="line">p</span><br><span class="line"><span class="comment"># 如果没有图形界面，运行下面的语句把图存在工作目录下的Rplots.pdf文件中</span></span><br><span class="line"><span class="comment">#dev.off()</span></span><br><span class="line"><span class="comment">#柱子有点多，也可以利用mean±SD的形式展现</span></span><br><span class="line"><span class="comment"># 获取平均值和标准差</span></span><br><span class="line"><span class="comment"># 分组时不只Gene一个变量了，还需要考虑Condition</span></span><br><span class="line">data_m_sd_mean <span class="operator">&lt;-</span> data_m <span class="operator">%&gt;%</span> group_by<span class="punctuation">(</span>Gene<span class="punctuation">,</span> Condition<span class="punctuation">)</span> <span class="operator">%&gt;%</span> dplyr<span class="operator">::</span>summarise<span class="punctuation">(</span>sd<span class="operator">=</span>sd<span class="punctuation">(</span>Expr<span class="punctuation">)</span><span class="punctuation">,</span> value<span class="operator">=</span>mean<span class="punctuation">(</span>Expr<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">data_m_sd_mean <span class="operator">&lt;-</span> as.data.frame<span class="punctuation">(</span>data_m_sd_mean<span class="punctuation">)</span></span><br><span class="line">data_m_sd_mean</span><br><span class="line">p <span class="operator">&lt;-</span> ggplot<span class="punctuation">(</span>data_m_sd_mean<span class="punctuation">,</span> aes<span class="punctuation">(</span>x<span class="operator">=</span>Gene<span class="punctuation">,</span> y<span class="operator">=</span>value<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span> </span><br><span class="line">  geom_bar<span class="punctuation">(</span>stat<span class="operator">=</span><span class="string">&quot;identity&quot;</span><span class="punctuation">,</span> aes<span class="punctuation">(</span>fill<span class="operator">=</span>Gene<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_errorbar<span class="punctuation">(</span>aes<span class="punctuation">(</span>ymin<span class="operator">=</span>value<span class="operator">-</span>sd<span class="punctuation">,</span> ymax<span class="operator">=</span>value<span class="operator">+</span>sd<span class="punctuation">)</span><span class="punctuation">,</span> width<span class="operator">=</span><span class="number">0.2</span><span class="punctuation">,</span> position<span class="operator">=</span>position_dodge<span class="punctuation">(</span>width<span class="operator">=</span><span class="number">0.75</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  facet_wrap<span class="punctuation">(</span><span class="operator">~</span>Condition<span class="punctuation">,</span> ncol<span class="operator">=</span><span class="number">1</span><span class="punctuation">)</span></span><br><span class="line">p</span><br><span class="line"><span class="comment">#每组里面各个基因的相对表达, 纵轴的显示改为百分比</span></span><br><span class="line"><span class="comment"># position=&quot;fill&quot; 展示的是堆积柱状图各部分的相对比例</span></span><br><span class="line"><span class="comment"># position=&quot;stack&quot; 展示的是堆积柱状图的原始值，可以自己体现下看卡差别</span></span><br><span class="line">p <span class="operator">&lt;-</span> ggplot<span class="punctuation">(</span>data_m<span class="punctuation">,</span> aes<span class="punctuation">(</span>x<span class="operator">=</span>Group<span class="punctuation">,</span> y<span class="operator">=</span>Expr<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_bar<span class="punctuation">(</span>stat<span class="operator">=</span><span class="string">&quot;identity&quot;</span><span class="punctuation">,</span> position<span class="operator">=</span><span class="string">&quot;fill&quot;</span><span class="punctuation">,</span> aes<span class="punctuation">(</span>fill<span class="operator">=</span>Gene<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  scale_y_continuous<span class="punctuation">(</span>labels <span class="operator">=</span> scales<span class="operator">::</span>percent<span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  facet_wrap<span class="punctuation">(</span><span class="operator">~</span>Condition<span class="punctuation">,</span> ncol<span class="operator">=</span><span class="number">1</span><span class="punctuation">)</span></span><br><span class="line">p</span><br><span class="line"><span class="comment">#在柱子中标记百分比值 (计算百分比值需要注意了, 文本显示位置还是跟之前一致)</span></span><br><span class="line"><span class="comment"># group_by: 按照给定的变量分组，然后按组操作</span></span><br><span class="line"><span class="comment"># mutate: 在当前数据表增加新变量</span></span><br><span class="line"><span class="comment"># 第一步增加每个组 (Group和Condition共同定义分组)的加和，第二步计算比例</span></span><br><span class="line">data_m <span class="operator">&lt;-</span> data_m <span class="operator">%&gt;%</span> group_by<span class="punctuation">(</span>Group<span class="punctuation">,</span> Condition<span class="punctuation">)</span> <span class="operator">%&gt;%</span> mutate<span class="punctuation">(</span>count<span class="operator">=</span><span class="built_in">sum</span><span class="punctuation">(</span>Expr<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">%&gt;%</span> mutate<span class="punctuation">(</span>freq<span class="operator">=</span><span class="built_in">round</span><span class="punctuation">(</span><span class="number">100</span><span class="operator">*</span>Expr<span class="operator">/</span>count<span class="punctuation">,</span><span class="number">2</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">p <span class="operator">&lt;-</span> ggplot<span class="punctuation">(</span>data_m<span class="punctuation">,</span> aes<span class="punctuation">(</span>x<span class="operator">=</span>Group<span class="punctuation">,</span> y<span class="operator">=</span>Expr<span class="punctuation">,</span> group<span class="operator">=</span>Group<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_bar<span class="punctuation">(</span>stat<span class="operator">=</span><span class="string">&quot;identity&quot;</span><span class="punctuation">,</span> position<span class="operator">=</span><span class="string">&quot;fill&quot;</span><span class="punctuation">,</span> aes<span class="punctuation">(</span>fill<span class="operator">=</span>Gene<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  scale_y_continuous<span class="punctuation">(</span>labels <span class="operator">=</span> scales<span class="operator">::</span>percent<span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_text<span class="punctuation">(</span>aes<span class="punctuation">(</span>label<span class="operator">=</span>freq<span class="punctuation">)</span><span class="punctuation">,</span> position<span class="operator">=</span>position_fill<span class="punctuation">(</span>vjust<span class="operator">=</span><span class="number">0.5</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  facet_wrap<span class="punctuation">(</span><span class="operator">~</span>Condition<span class="punctuation">,</span> ncol<span class="operator">=</span><span class="number">1</span><span class="punctuation">)</span></span><br><span class="line">p</span><br><span class="line"><span class="comment">#文本显示位置没有问题，但柱子的位置有些奇怪，使得两组之间不可比。</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#先对数据做下排序，然后再标记文本</span></span><br><span class="line"><span class="comment"># with: 产生一个由data_m组成的局部环境，再这个环境里，列名字可以直接使用</span></span><br><span class="line">data_m <span class="operator">&lt;-</span> data_m<span class="punctuation">[</span>with<span class="punctuation">(</span>data_m<span class="punctuation">,</span> order<span class="punctuation">(</span>Condition<span class="punctuation">,</span> Group<span class="punctuation">,</span> Gene<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">,</span><span class="punctuation">]</span> </span><br><span class="line">p <span class="operator">&lt;-</span> ggplot<span class="punctuation">(</span>data_m<span class="punctuation">,</span> aes<span class="punctuation">(</span>x<span class="operator">=</span>Group<span class="punctuation">,</span> y<span class="operator">=</span>Expr<span class="punctuation">,</span> group<span class="operator">=</span>Group<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_bar<span class="punctuation">(</span>stat<span class="operator">=</span><span class="string">&quot;identity&quot;</span><span class="punctuation">,</span> position<span class="operator">=</span><span class="string">&quot;fill&quot;</span><span class="punctuation">,</span> aes<span class="punctuation">(</span>fill<span class="operator">=</span>Gene<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  scale_y_continuous<span class="punctuation">(</span>labels <span class="operator">=</span> scales<span class="operator">::</span>percent<span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_text<span class="punctuation">(</span>aes<span class="punctuation">(</span>label<span class="operator">=</span>freq<span class="punctuation">)</span><span class="punctuation">,</span> position<span class="operator">=</span>position_fill<span class="punctuation">(</span>vjust<span class="operator">=</span><span class="number">0.5</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  facet_wrap<span class="punctuation">(</span><span class="operator">~</span>Condition<span class="punctuation">,</span> ncol<span class="operator">=</span><span class="number">2</span><span class="punctuation">)</span></span><br><span class="line">p</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="id转换"><strong>ID转换</strong></h3>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#source(&quot;https://bioconductor.org/biocLite.R&quot;) </span></span><br><span class="line"><span class="comment">#biocLite(&#x27;org.Hs.eg.db&#x27;)</span></span><br><span class="line"><span class="comment">#基因的entrez ID 跟symbol等其它ID的转换程序 </span></span><br><span class="line"><span class="comment">#http://www.bio-info-trainee.com/710.html</span></span><br><span class="line">keytypes<span class="punctuation">(</span>org.Hs.eg.db<span class="punctuation">)</span></span><br><span class="line">geneIDannotation <span class="operator">&lt;-</span> <span class="keyword">function</span><span class="punctuation">(</span>geneLists<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">,</span><span class="number">9</span><span class="punctuation">)</span><span class="punctuation">,</span>name<span class="operator">=</span><span class="built_in">T</span><span class="punctuation">,</span>map<span class="operator">=</span><span class="built_in">T</span><span class="punctuation">,</span>ensemble<span class="operator">=</span><span class="built_in">F</span><span class="punctuation">,</span>accnum<span class="operator">=</span><span class="built_in">F</span><span class="punctuation">)</span><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="comment">## input ID type : So far I just accept entrezID or symbol</span></span><br><span class="line">  <span class="comment">## default, we will annotate the entrezID and symbol, chromosone location and gene name </span></span><br><span class="line">  </span><br><span class="line">  suppressMessages<span class="punctuation">(</span>library<span class="punctuation">(</span><span class="string">&quot;org.Hs.eg.db&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">  all_EG<span class="operator">=</span>mappedkeys<span class="punctuation">(</span>org.Hs.egSYMBOL<span class="punctuation">)</span> </span><br><span class="line">  EG2Symbol<span class="operator">=</span>toTable<span class="punctuation">(</span>org.Hs.egSYMBOL<span class="punctuation">)</span></span><br><span class="line">  <span class="keyword">if</span><span class="punctuation">(</span> <span class="built_in">all</span><span class="punctuation">(</span><span class="operator">!</span> geneLists <span class="operator">%in%</span> all_EG<span class="punctuation">)</span> <span class="punctuation">)</span><span class="punctuation">&#123;</span></span><br><span class="line">    inputType<span class="operator">=</span><span class="string">&#x27;symbol&#x27;</span></span><br><span class="line">    geneLists<span class="operator">=</span>data.frame<span class="punctuation">(</span>symbol<span class="operator">=</span>geneLists<span class="punctuation">)</span></span><br><span class="line">    results<span class="operator">=</span>merge<span class="punctuation">(</span>geneLists<span class="punctuation">,</span>EG2Symbol<span class="punctuation">,</span>by<span class="operator">=</span><span class="string">&#x27;symbol&#x27;</span><span class="punctuation">,</span>all.x<span class="operator">=</span><span class="built_in">T</span><span class="punctuation">)</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="keyword">else</span><span class="punctuation">&#123;</span></span><br><span class="line">    inputType<span class="operator">=</span><span class="string">&#x27;entrezID&#x27;</span></span><br><span class="line">    geneLists<span class="operator">=</span>data.frame<span class="punctuation">(</span>gene_id<span class="operator">=</span>geneLists<span class="punctuation">)</span></span><br><span class="line">    results<span class="operator">=</span>merge<span class="punctuation">(</span>geneLists<span class="punctuation">,</span>EG2Symbol<span class="punctuation">,</span>by<span class="operator">=</span><span class="string">&#x27;gene_id&#x27;</span><span class="punctuation">,</span>all.x<span class="operator">=</span><span class="built_in">T</span><span class="punctuation">)</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line">  </span><br><span class="line">  <span class="keyword">if</span> <span class="punctuation">(</span> name <span class="punctuation">)</span><span class="punctuation">&#123;</span></span><br><span class="line">    EG2name<span class="operator">=</span>toTable<span class="punctuation">(</span>org.Hs.egGENENAME<span class="punctuation">)</span></span><br><span class="line">    results<span class="operator">=</span>merge<span class="punctuation">(</span>results<span class="punctuation">,</span>EG2name<span class="punctuation">,</span>by<span class="operator">=</span><span class="string">&#x27;gene_id&#x27;</span><span class="punctuation">,</span>all.x<span class="operator">=</span><span class="built_in">T</span><span class="punctuation">)</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="keyword">if</span><span class="punctuation">(</span>map<span class="punctuation">)</span><span class="punctuation">&#123;</span></span><br><span class="line">    EG2MAP<span class="operator">=</span>toTable<span class="punctuation">(</span>org.Hs.egMAP<span class="punctuation">)</span></span><br><span class="line">    results<span class="operator">=</span>merge<span class="punctuation">(</span>results<span class="punctuation">,</span>EG2MAP<span class="punctuation">,</span>by<span class="operator">=</span><span class="string">&#x27;gene_id&#x27;</span><span class="punctuation">,</span>all.x<span class="operator">=</span><span class="built_in">T</span><span class="punctuation">)</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="keyword">if</span><span class="punctuation">(</span>ensemble<span class="punctuation">)</span><span class="punctuation">&#123;</span></span><br><span class="line">    EG2ENSEMBL<span class="operator">=</span>toTable<span class="punctuation">(</span>org.Hs.egENSEMBL<span class="punctuation">)</span></span><br><span class="line">    results<span class="operator">=</span>merge<span class="punctuation">(</span>results<span class="punctuation">,</span>EG2ENSEMBL<span class="punctuation">,</span>by<span class="operator">=</span><span class="string">&#x27;gene_id&#x27;</span><span class="punctuation">,</span>all.x<span class="operator">=</span><span class="built_in">T</span><span class="punctuation">)</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="keyword">if</span><span class="punctuation">(</span>accnum<span class="punctuation">)</span><span class="punctuation">&#123;</span></span><br><span class="line">    EG2accnum<span class="operator">=</span>toTable<span class="punctuation">(</span>org.Hs.egREFSEQ<span class="punctuation">)</span> </span><br><span class="line">    results<span class="operator">=</span>merge<span class="punctuation">(</span>results<span class="punctuation">,</span>EG2MAP<span class="punctuation">,</span>by<span class="operator">=</span><span class="string">&#x27;gene_id&#x27;</span><span class="punctuation">,</span>all.x<span class="operator">=</span><span class="built_in">T</span><span class="punctuation">)</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="built_in">return</span><span class="punctuation">(</span>results<span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line">geneIDannotation<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line">geneIDannotation<span class="punctuation">(</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;TP53&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;BRCA1&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;KRAS&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;PTEN&#x27;</span><span class="punctuation">)</span><span class="punctuation">)</span>           </span><br></pre></td></tr></table></figure>
<h3 id="稀释-累积曲线和rank-abundance">稀释、累积曲线和Rank_abundance</h3>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#需要用到的 R 包</span></span><br><span class="line">library<span class="punctuation">(</span>vegan<span class="punctuation">)</span>	<span class="comment">#用于计算 Shannon 熵指数、Simpson 指数、Chao1 指数、ACE 指数等，同时用于抽样</span></span><br><span class="line">library<span class="punctuation">(</span>picante<span class="punctuation">)</span>	<span class="comment">#用于计算 PD_whole_tree，若不计算它就无需加载。事实上，picante 包加载时默认同时加载 vegan</span></span><br><span class="line">library<span class="punctuation">(</span>ggplot2<span class="punctuation">)</span>	<span class="comment">#用于 ggplot2 作图</span></span><br><span class="line">library<span class="punctuation">(</span>doBy<span class="punctuation">)</span>	<span class="comment">#用于分组统计（第 97 行使用到）</span></span><br><span class="line">library<span class="punctuation">(</span>ggalt<span class="punctuation">)</span>	<span class="comment">#用于绘制拟合曲线（第 138 行使用到）</span></span><br><span class="line">library<span class="punctuation">(</span>BiodiversityR<span class="punctuation">)</span>	<span class="comment">#用于绘制 Rank-abundance 曲线（第 160 行使用到）</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##定义函数</span></span><br><span class="line"><span class="comment">#计算多种 Alpha 多样性指数，结果返回至向量</span></span><br><span class="line"><span class="comment">#各子函数的用法详见 http://blog.sciencenet.cn/blog-3406804-1179983.html</span></span><br><span class="line">alpha_index <span class="operator">&lt;-</span> <span class="keyword">function</span><span class="punctuation">(</span>x<span class="punctuation">,</span> method <span class="operator">=</span> <span class="string">&#x27;richness&#x27;</span><span class="punctuation">,</span> tree <span class="operator">=</span> <span class="literal">NULL</span><span class="punctuation">,</span> base <span class="operator">=</span> <span class="built_in">exp</span><span class="punctuation">(</span><span class="number">1</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">	<span class="keyword">if</span> <span class="punctuation">(</span>method <span class="operator">==</span> <span class="string">&#x27;richness&#x27;</span><span class="punctuation">)</span> result <span class="operator">&lt;-</span> rowSums<span class="punctuation">(</span>x <span class="operator">&gt;</span> <span class="number">0</span><span class="punctuation">)</span>	<span class="comment">#丰富度指数</span></span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span> <span class="punctuation">(</span>method <span class="operator">==</span> <span class="string">&#x27;chao1&#x27;</span><span class="punctuation">)</span> result <span class="operator">&lt;-</span> estimateR<span class="punctuation">(</span>x<span class="punctuation">)</span><span class="punctuation">[</span><span class="number">3</span><span class="punctuation">,</span> <span class="punctuation">]</span>	<span class="comment">#Chao1 指数</span></span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span> <span class="punctuation">(</span>method <span class="operator">==</span> <span class="string">&#x27;ace&#x27;</span><span class="punctuation">)</span> result <span class="operator">&lt;-</span> estimateR<span class="punctuation">(</span>x<span class="punctuation">)</span><span class="punctuation">[</span><span class="number">5</span><span class="punctuation">,</span> <span class="punctuation">]</span>	<span class="comment">#ACE 指数</span></span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span> <span class="punctuation">(</span>method <span class="operator">==</span> <span class="string">&#x27;shannon&#x27;</span><span class="punctuation">)</span> result <span class="operator">&lt;-</span> diversity<span class="punctuation">(</span>x<span class="punctuation">,</span> index <span class="operator">=</span> <span class="string">&#x27;shannon&#x27;</span><span class="punctuation">,</span> base <span class="operator">=</span> base<span class="punctuation">)</span>	<span class="comment">#Shannon 指数</span></span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span> <span class="punctuation">(</span>method <span class="operator">==</span> <span class="string">&#x27;simpson&#x27;</span><span class="punctuation">)</span> result <span class="operator">&lt;-</span> diversity<span class="punctuation">(</span>x<span class="punctuation">,</span> index <span class="operator">=</span> <span class="string">&#x27;simpson&#x27;</span><span class="punctuation">)</span>	<span class="comment">#Gini-Simpson 指数</span></span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span> <span class="punctuation">(</span>method <span class="operator">==</span> <span class="string">&#x27;pielou&#x27;</span><span class="punctuation">)</span> result <span class="operator">&lt;-</span> diversity<span class="punctuation">(</span>x<span class="punctuation">,</span> index <span class="operator">=</span> <span class="string">&#x27;shannon&#x27;</span><span class="punctuation">,</span> base <span class="operator">=</span> base<span class="punctuation">)</span> <span class="operator">/</span> <span class="built_in">log</span><span class="punctuation">(</span>estimateR<span class="punctuation">(</span>x<span class="punctuation">)</span><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">,</span> <span class="punctuation">]</span><span class="punctuation">,</span> base<span class="punctuation">)</span>	<span class="comment">#Pielou 均匀度</span></span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span> <span class="punctuation">(</span>method <span class="operator">==</span> <span class="string">&#x27;gc&#x27;</span><span class="punctuation">)</span> result <span class="operator">&lt;-</span> 1 <span class="operator">-</span> rowSums<span class="punctuation">(</span>x <span class="operator">==</span> <span class="number">1</span><span class="punctuation">)</span> <span class="operator">/</span> rowSums<span class="punctuation">(</span>x<span class="punctuation">)</span>	<span class="comment">#goods_coverage</span></span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span> <span class="punctuation">(</span>method <span class="operator">==</span> <span class="string">&#x27;pd&#x27;</span> <span class="operator">&amp;</span> <span class="operator">!</span><span class="built_in">is.null</span><span class="punctuation">(</span>tree<span class="punctuation">)</span><span class="punctuation">)</span> <span class="punctuation">&#123;</span>	<span class="comment">#PD_whole_tree</span></span><br><span class="line">		pd <span class="operator">&lt;-</span> pd<span class="punctuation">(</span>x<span class="punctuation">,</span> tree<span class="punctuation">,</span> include.root <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span></span><br><span class="line">		result <span class="operator">&lt;-</span> pd<span class="punctuation">[</span> <span class="punctuation">,</span><span class="number">1</span><span class="punctuation">]</span></span><br><span class="line">		<span class="built_in">names</span><span class="punctuation">(</span>result<span class="punctuation">)</span> <span class="operator">&lt;-</span> rownames<span class="punctuation">(</span>pd<span class="punctuation">)</span></span><br><span class="line">	<span class="punctuation">&#125;</span></span><br><span class="line">	result</span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#根据抽样步长（step），统计每个稀释梯度下的 Alpha 多样性指数，结果返回至列表</span></span><br><span class="line">alpha_curves <span class="operator">&lt;-</span> <span class="keyword">function</span><span class="punctuation">(</span>x<span class="punctuation">,</span> step<span class="punctuation">,</span> method <span class="operator">=</span> <span class="string">&#x27;richness&#x27;</span><span class="punctuation">,</span> rare <span class="operator">=</span> <span class="literal">NULL</span><span class="punctuation">,</span> tree <span class="operator">=</span> <span class="literal">NULL</span><span class="punctuation">,</span> base <span class="operator">=</span> <span class="built_in">exp</span><span class="punctuation">(</span><span class="number">1</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">	x_nrow <span class="operator">&lt;-</span> nrow<span class="punctuation">(</span>x<span class="punctuation">)</span></span><br><span class="line">	<span class="keyword">if</span> <span class="punctuation">(</span><span class="built_in">is.null</span><span class="punctuation">(</span>rare<span class="punctuation">)</span><span class="punctuation">)</span> rare <span class="operator">&lt;-</span> rowSums<span class="punctuation">(</span>x<span class="punctuation">)</span> <span class="keyword">else</span> rare <span class="operator">&lt;-</span> <span class="built_in">rep</span><span class="punctuation">(</span>rare<span class="punctuation">,</span> x_nrow<span class="punctuation">)</span></span><br><span class="line">	alpha_rare <span class="operator">&lt;-</span> <span class="built_in">list</span><span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line">	</span><br><span class="line">	<span class="keyword">for</span> <span class="punctuation">(</span>i <span class="keyword">in</span> <span class="number">1</span><span class="operator">:</span>x_nrow<span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">		step_num <span class="operator">&lt;-</span> seq<span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span> rare<span class="punctuation">[</span>i<span class="punctuation">]</span><span class="punctuation">,</span> step<span class="punctuation">)</span></span><br><span class="line">		<span class="keyword">if</span> <span class="punctuation">(</span><span class="built_in">max</span><span class="punctuation">(</span>step_num<span class="punctuation">)</span> <span class="operator">&lt;</span> rare<span class="punctuation">[</span>i<span class="punctuation">]</span><span class="punctuation">)</span> step_num <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span>step_num<span class="punctuation">,</span> rare<span class="punctuation">[</span>i<span class="punctuation">]</span><span class="punctuation">)</span></span><br><span class="line">		</span><br><span class="line">		alpha_rare_i <span class="operator">&lt;-</span> <span class="literal">NULL</span></span><br><span class="line">		<span class="keyword">for</span> <span class="punctuation">(</span>step_num_n <span class="keyword">in</span> step_num<span class="punctuation">)</span> alpha_rare_i <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span>alpha_rare_i<span class="punctuation">,</span> alpha_index<span class="punctuation">(</span>x <span class="operator">=</span> rrarefy<span class="punctuation">(</span>x<span class="punctuation">[</span>i<span class="punctuation">,</span> <span class="punctuation">]</span><span class="punctuation">,</span> step_num_n<span class="punctuation">)</span><span class="punctuation">,</span> method <span class="operator">=</span> method<span class="punctuation">,</span> tree <span class="operator">=</span> tree<span class="punctuation">,</span> base <span class="operator">=</span> base<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">		<span class="built_in">names</span><span class="punctuation">(</span>alpha_rare_i<span class="punctuation">)</span> <span class="operator">&lt;-</span> step_num</span><br><span class="line">		alpha_rare <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span>alpha_rare<span class="punctuation">,</span> <span class="built_in">list</span><span class="punctuation">(</span>alpha_rare_i<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">	<span class="punctuation">&#125;</span></span><br><span class="line">	</span><br><span class="line">	<span class="built_in">names</span><span class="punctuation">(</span>alpha_rare<span class="punctuation">)</span> <span class="operator">&lt;-</span> rownames<span class="punctuation">(</span>x<span class="punctuation">)</span></span><br><span class="line">	alpha_rare</span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#读取 OTU 丰度表</span></span><br><span class="line">otu <span class="operator">&lt;-</span> read.delim<span class="punctuation">(</span><span class="string">&#x27;otu_table.txt&#x27;</span><span class="punctuation">,</span> row.names <span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span> sep <span class="operator">=</span> <span class="string">&#x27;\t&#x27;</span><span class="punctuation">,</span> stringsAsFactors <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">,</span> check.names <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span></span><br><span class="line">otu <span class="operator">&lt;-</span> t<span class="punctuation">(</span>otu<span class="punctuation">)</span></span><br><span class="line"><span class="comment">#最简单的用vegan包中自带的rarecurve函数制作</span></span><br><span class="line">rarecurve<span class="punctuation">(</span>otu<span class="punctuation">,</span> step<span class="operator">=</span><span class="number">10</span><span class="punctuation">,</span> col <span class="operator">=</span> factor<span class="punctuation">(</span>rownames<span class="punctuation">(</span>otu<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">,</span>lwd<span class="operator">=</span><span class="number">2</span><span class="punctuation">,</span> ylab<span class="operator">=</span><span class="string">&quot;ASVs&quot;</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment">##测试</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#统计 OTU 丰度表中各样本的 Shannon 指数，对数底数使用 e</span></span><br><span class="line">shannon_index <span class="operator">&lt;-</span> alpha_index<span class="punctuation">(</span>otu<span class="punctuation">,</span> method <span class="operator">=</span> <span class="string">&#x27;shannon&#x27;</span><span class="punctuation">,</span> base <span class="operator">=</span> <span class="built_in">exp</span><span class="punctuation">(</span><span class="number">1</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment">#以 1000 条序列为抽样步长，依次对 OTU 表稀释抽样，直到最大序列深度；并统计各抽样梯度下的 OTU 丰度表中各样本的 Shannon 指数，对数底数使用 e</span></span><br><span class="line">shannon_curves <span class="operator">&lt;-</span> alpha_curves<span class="punctuation">(</span>otu<span class="punctuation">,</span> step <span class="operator">=</span> <span class="number">1000</span><span class="punctuation">,</span> method <span class="operator">=</span> <span class="string">&#x27;shannon&#x27;</span><span class="punctuation">,</span> base <span class="operator">=</span> <span class="built_in">exp</span><span class="punctuation">(</span><span class="number">1</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##以下以物种丰富度指数为例绘制 Alpha 多样性曲线（当为丰富度指数时，另一个名称即为常说的稀释曲线，或物种累计曲线）</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#以 2000 步长（step=2000）为例统计</span></span><br><span class="line">richness_curves <span class="operator">&lt;-</span> alpha_curves<span class="punctuation">(</span>otu<span class="punctuation">,</span> step <span class="operator">=</span> <span class="number">2000</span><span class="punctuation">,</span> method <span class="operator">=</span> <span class="string">&#x27;richness&#x27;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#获得 ggplot2 作图文件</span></span><br><span class="line">plot_richness <span class="operator">&lt;-</span> data.frame<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line"><span class="keyword">for</span> <span class="punctuation">(</span>i <span class="keyword">in</span> <span class="built_in">names</span><span class="punctuation">(</span>richness_curves<span class="punctuation">)</span><span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">	richness_curves_i <span class="operator">&lt;-</span> <span class="punctuation">(</span>richness_curves<span class="punctuation">[[</span>i<span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">)</span></span><br><span class="line">	richness_curves_i <span class="operator">&lt;-</span> data.frame<span class="punctuation">(</span>rare <span class="operator">=</span> <span class="built_in">names</span><span class="punctuation">(</span>richness_curves_i<span class="punctuation">)</span><span class="punctuation">,</span> alpha <span class="operator">=</span> richness_curves_i<span class="punctuation">,</span> sample <span class="operator">=</span> i<span class="punctuation">,</span> stringsAsFactors <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span></span><br><span class="line">	plot_richness <span class="operator">&lt;-</span> rbind<span class="punctuation">(</span>plot_richness<span class="punctuation">,</span> richness_curves_i<span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line">rownames<span class="punctuation">(</span>plot_richness<span class="punctuation">)</span> <span class="operator">&lt;-</span> <span class="literal">NULL</span></span><br><span class="line">plot_richness<span class="operator">$</span>rare <span class="operator">&lt;-</span> <span class="built_in">as.numeric</span><span class="punctuation">(</span>plot_richness<span class="operator">$</span>rare<span class="punctuation">)</span></span><br><span class="line">plot_richness<span class="operator">$</span>alpha <span class="operator">&lt;-</span> <span class="built_in">as.numeric</span><span class="punctuation">(</span>plot_richness<span class="operator">$</span>alpha<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#ggplot2 作图</span></span><br><span class="line">ggplot<span class="punctuation">(</span>plot_richness<span class="punctuation">,</span> aes<span class="punctuation">(</span>rare<span class="punctuation">,</span> alpha<span class="punctuation">,</span> color <span class="operator">=</span> sample<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">geom_line<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&#x27;Number of sequences&#x27;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&#x27;Richness&#x27;</span><span class="punctuation">,</span> color <span class="operator">=</span> <span class="literal">NULL</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">theme<span class="punctuation">(</span>panel.grid <span class="operator">=</span> element_blank<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">,</span> panel.background <span class="operator">=</span> element_rect<span class="punctuation">(</span>fill <span class="operator">=</span> <span class="string">&#x27;transparent&#x27;</span><span class="punctuation">,</span> color <span class="operator">=</span> <span class="string">&#x27;black&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span> legend.key <span class="operator">=</span> element_rect<span class="punctuation">(</span>fill <span class="operator">=</span> <span class="string">&#x27;transparent&#x27;</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">geom_vline<span class="punctuation">(</span>xintercept <span class="operator">=</span> <span class="built_in">min</span><span class="punctuation">(</span>rowSums<span class="punctuation">(</span>otu<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">,</span> linetype <span class="operator">=</span> <span class="number">2</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">scale_x_continuous<span class="punctuation">(</span>breaks <span class="operator">=</span> seq<span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span> <span class="number">30000</span><span class="punctuation">,</span> <span class="number">5000</span><span class="punctuation">)</span><span class="punctuation">,</span> labels <span class="operator">=</span> <span class="built_in">as.character</span><span class="punctuation">(</span>seq<span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span> <span class="number">30000</span><span class="punctuation">,</span> <span class="number">5000</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##多计算几次以获取均值 ± 标准差，然后再展示出也是一个不错的选择</span></span><br><span class="line"><span class="comment">#重复抽样 5 次</span></span><br><span class="line">plot_richness <span class="operator">&lt;-</span> data.frame<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> <span class="punctuation">(</span>n <span class="keyword">in</span> <span class="number">1</span><span class="operator">:</span><span class="number">5</span><span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">	richness_curves <span class="operator">&lt;-</span> alpha_curves<span class="punctuation">(</span>otu<span class="punctuation">,</span> step <span class="operator">=</span> <span class="number">2000</span><span class="punctuation">,</span> method <span class="operator">=</span> <span class="string">&#x27;richness&#x27;</span><span class="punctuation">)</span></span><br><span class="line">	</span><br><span class="line">	<span class="keyword">for</span> <span class="punctuation">(</span>i <span class="keyword">in</span> <span class="built_in">names</span><span class="punctuation">(</span>richness_curves<span class="punctuation">)</span><span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">		richness_curves_i <span class="operator">&lt;-</span> <span class="punctuation">(</span>richness_curves<span class="punctuation">[[</span>i<span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">)</span></span><br><span class="line">		richness_curves_i <span class="operator">&lt;-</span> data.frame<span class="punctuation">(</span>rare <span class="operator">=</span> <span class="built_in">names</span><span class="punctuation">(</span>richness_curves_i<span class="punctuation">)</span><span class="punctuation">,</span> alpha <span class="operator">=</span> richness_curves_i<span class="punctuation">,</span> sample <span class="operator">=</span> i<span class="punctuation">,</span> stringsAsFactors <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span></span><br><span class="line">		plot_richness <span class="operator">&lt;-</span> rbind<span class="punctuation">(</span>plot_richness<span class="punctuation">,</span> richness_curves_i<span class="punctuation">)</span></span><br><span class="line">	<span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#计算均值 ± 标准差（doBy 包中的 summaryBy() 函数）</span></span><br><span class="line">plot_richness_stat <span class="operator">&lt;-</span> summaryBy<span class="punctuation">(</span>alpha<span class="operator">~</span>sample<span class="operator">+</span>rare<span class="punctuation">,</span> plot_richness<span class="punctuation">,</span> FUN <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span>mean<span class="punctuation">,</span> sd<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">plot_richness_stat<span class="operator">$</span>rare <span class="operator">&lt;-</span> <span class="built_in">as.numeric</span><span class="punctuation">(</span>plot_richness_stat<span class="operator">$</span>rare<span class="punctuation">)</span></span><br><span class="line">plot_richness_stat<span class="punctuation">[</span>which<span class="punctuation">(</span>plot_richness_stat<span class="operator">$</span>rare <span class="operator">==</span> <span class="number">0</span><span class="punctuation">)</span><span class="punctuation">,</span><span class="string">&#x27;alpha.sd&#x27;</span><span class="punctuation">]</span> <span class="operator">&lt;-</span> <span class="literal">NA</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#ggplot2 作图</span></span><br><span class="line">ggplot<span class="punctuation">(</span>plot_richness_stat<span class="punctuation">,</span> aes<span class="punctuation">(</span>rare<span class="punctuation">,</span> alpha.mean<span class="punctuation">,</span> color <span class="operator">=</span> sample<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">geom_line<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">geom_point<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">geom_errorbar<span class="punctuation">(</span>aes<span class="punctuation">(</span>ymin <span class="operator">=</span> alpha.mean <span class="operator">-</span> alpha.sd<span class="punctuation">,</span> ymax <span class="operator">=</span> alpha.mean <span class="operator">+</span> alpha.sd<span class="punctuation">)</span><span class="punctuation">,</span> width <span class="operator">=</span> <span class="number">500</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&#x27;Number of sequences&#x27;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&#x27;Richness&#x27;</span><span class="punctuation">,</span> color <span class="operator">=</span> <span class="literal">NULL</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">theme<span class="punctuation">(</span>panel.grid <span class="operator">=</span> element_blank<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">,</span> panel.background <span class="operator">=</span> element_rect<span class="punctuation">(</span>fill <span class="operator">=</span> <span class="string">&#x27;transparent&#x27;</span><span class="punctuation">,</span> color <span class="operator">=</span> <span class="string">&#x27;black&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span> legend.key <span class="operator">=</span> element_rect<span class="punctuation">(</span>fill <span class="operator">=</span> <span class="string">&#x27;transparent&#x27;</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">geom_vline<span class="punctuation">(</span>xintercept <span class="operator">=</span> <span class="built_in">min</span><span class="punctuation">(</span>rowSums<span class="punctuation">(</span>otu<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">,</span> linetype <span class="operator">=</span> <span class="number">2</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">scale_x_continuous<span class="punctuation">(</span>breaks <span class="operator">=</span> seq<span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span> <span class="number">30000</span><span class="punctuation">,</span> <span class="number">5000</span><span class="punctuation">)</span><span class="punctuation">,</span> labels <span class="operator">=</span> <span class="built_in">as.character</span><span class="punctuation">(</span>seq<span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span> <span class="number">30000</span><span class="punctuation">,</span> <span class="number">5000</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##对于 Shannon 指数等，方法类似</span></span><br><span class="line"><span class="comment">#以 2000 步长（step=2000）为例统计每个稀释梯度下的 Shannon 指数，Shannon 公式的对数底数默认为 e，若有需要可更改（例如 2）</span></span><br><span class="line">shannon_curves <span class="operator">&lt;-</span> alpha_curves<span class="punctuation">(</span>otu<span class="punctuation">,</span> step <span class="operator">=</span> <span class="number">2000</span><span class="punctuation">,</span> method <span class="operator">=</span> <span class="string">&#x27;shannon&#x27;</span><span class="punctuation">,</span> base <span class="operator">=</span> <span class="number">2</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#获得 ggplot2 作图文件（略，参见上述）</span></span><br><span class="line"><span class="comment">#ggplot2 作图（略，参见上述）</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##若简单的“geom_line()”样式波动幅度过大，不平滑等，可以尝试拟合曲线的样式</span></span><br><span class="line"><span class="comment">#获得作图数据。前面多生成一个点，使得 Shannon 拟合曲线更加平滑（你把 shannon_curves1 注释掉就知道我说的啥了）</span></span><br><span class="line">shannon_curves1 <span class="operator">&lt;-</span> alpha_curves<span class="punctuation">(</span>otu<span class="punctuation">,</span> step <span class="operator">=</span> <span class="number">200</span><span class="punctuation">,</span> rare <span class="operator">=</span> <span class="number">200</span><span class="punctuation">,</span> method <span class="operator">=</span> <span class="string">&#x27;shannon&#x27;</span><span class="punctuation">)</span></span><br><span class="line">shannon_curves2 <span class="operator">&lt;-</span> alpha_curves<span class="punctuation">(</span>otu<span class="punctuation">,</span> step <span class="operator">=</span> <span class="number">2000</span><span class="punctuation">,</span> method <span class="operator">=</span> <span class="string">&#x27;shannon&#x27;</span><span class="punctuation">)</span></span><br><span class="line">shannon_curves <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span>shannon_curves1<span class="punctuation">,</span> shannon_curves2<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">plot_shannon <span class="operator">&lt;-</span> data.frame<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line"><span class="keyword">for</span> <span class="punctuation">(</span>i <span class="keyword">in</span> <span class="number">1</span><span class="operator">:</span><span class="built_in">length</span><span class="punctuation">(</span>shannon_curves<span class="punctuation">)</span><span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">	shannon_curves_i <span class="operator">&lt;-</span> shannon_curves<span class="punctuation">[[</span>i<span class="punctuation">]</span><span class="punctuation">]</span></span><br><span class="line">	shannon_curves_i <span class="operator">&lt;-</span> data.frame<span class="punctuation">(</span>rare <span class="operator">=</span> <span class="built_in">names</span><span class="punctuation">(</span>shannon_curves_i<span class="punctuation">)</span><span class="punctuation">,</span> alpha <span class="operator">=</span> shannon_curves_i<span class="punctuation">,</span> sample <span class="operator">=</span> <span class="built_in">names</span><span class="punctuation">(</span>shannon_curves<span class="punctuation">)</span><span class="punctuation">[</span>i<span class="punctuation">]</span><span class="punctuation">,</span> stringsAsFactors <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span></span><br><span class="line">	plot_shannon <span class="operator">&lt;-</span> rbind<span class="punctuation">(</span>plot_shannon<span class="punctuation">,</span> shannon_curves_i<span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line">rownames<span class="punctuation">(</span>plot_shannon<span class="punctuation">)</span> <span class="operator">&lt;-</span> <span class="literal">NULL</span></span><br><span class="line">plot_shannon<span class="operator">$</span>rare <span class="operator">&lt;-</span> <span class="built_in">as.numeric</span><span class="punctuation">(</span>plot_shannon<span class="operator">$</span>rare<span class="punctuation">)</span></span><br><span class="line">plot_shannon<span class="operator">$</span>alpha <span class="operator">&lt;-</span> <span class="built_in">as.numeric</span><span class="punctuation">(</span>plot_shannon<span class="operator">$</span>alpha<span class="punctuation">)</span></span><br><span class="line">plot_shannon <span class="operator">&lt;-</span> plot_shannon<span class="punctuation">[</span>order<span class="punctuation">(</span>plot_shannon<span class="operator">$</span>sample<span class="punctuation">,</span> plot_shannon<span class="operator">$</span>rare<span class="punctuation">)</span><span class="punctuation">,</span> <span class="punctuation">]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#ggplot2 作图（使用到 ggalt 包的 geom_xspline() 绘制平滑拟合线）</span></span><br><span class="line">ggplot<span class="punctuation">(</span>plot_shannon<span class="punctuation">,</span> aes<span class="punctuation">(</span>rare<span class="punctuation">,</span> alpha<span class="punctuation">,</span> color <span class="operator">=</span> sample<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">geom_xspline<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&#x27;Number of sequences&#x27;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&#x27;Shannon&#x27;</span><span class="punctuation">,</span> color <span class="operator">=</span> <span class="literal">NULL</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">theme<span class="punctuation">(</span>panel.grid <span class="operator">=</span> element_blank<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">,</span> panel.background <span class="operator">=</span> element_rect<span class="punctuation">(</span>fill <span class="operator">=</span> <span class="string">&#x27;transparent&#x27;</span><span class="punctuation">,</span> color <span class="operator">=</span> <span class="string">&#x27;black&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span> legend.key <span class="operator">=</span> element_rect<span class="punctuation">(</span>fill <span class="operator">=</span> <span class="string">&#x27;transparent&#x27;</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">geom_vline<span class="punctuation">(</span>xintercept <span class="operator">=</span> <span class="built_in">min</span><span class="punctuation">(</span>rowSums<span class="punctuation">(</span>otu<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">,</span> linetype <span class="operator">=</span> <span class="number">2</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">scale_x_continuous<span class="punctuation">(</span>breaks <span class="operator">=</span> seq<span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span> <span class="number">30000</span><span class="punctuation">,</span> <span class="number">5000</span><span class="punctuation">)</span><span class="punctuation">,</span> labels <span class="operator">=</span> <span class="built_in">as.character</span><span class="punctuation">(</span>seq<span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span> <span class="number">30000</span><span class="punctuation">,</span> <span class="number">5000</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##对于 PD_whole_tree，除了 OTU 丰度表，还使用到进化树文件</span></span><br><span class="line"><span class="comment">#加载 OTU 丰度表和进化树文件</span></span><br><span class="line">otu <span class="operator">&lt;-</span> read.delim<span class="punctuation">(</span><span class="string">&#x27;otu_table.txt&#x27;</span><span class="punctuation">,</span> row.names <span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span> sep <span class="operator">=</span> <span class="string">&#x27;\t&#x27;</span><span class="punctuation">,</span> stringsAsFactors <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">,</span> check.names <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span></span><br><span class="line">otu <span class="operator">&lt;-</span> t<span class="punctuation">(</span>otu<span class="punctuation">)</span></span><br><span class="line">tree <span class="operator">&lt;-</span> read.tree<span class="punctuation">(</span><span class="string">&#x27;otu_tree.tre&#x27;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#以 2000 步长（step=2000）为例统计</span></span><br><span class="line">pd_curves <span class="operator">&lt;-</span> alpha_curves<span class="punctuation">(</span>otu<span class="punctuation">,</span> tree <span class="operator">=</span> tree<span class="punctuation">,</span> step <span class="operator">=</span> <span class="number">2000</span><span class="punctuation">,</span> method <span class="operator">=</span> <span class="string">&#x27;pd&#x27;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#统计及做图方法同上述</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##Rank-abundance 曲线</span></span><br><span class="line"><span class="comment">#统计（BiodiversityR 包 rankabundance() 实现 OTU 排序）</span></span><br><span class="line">otu_relative <span class="operator">&lt;-</span> otu <span class="operator">/</span> rowSums<span class="punctuation">(</span>otu<span class="punctuation">)</span></span><br><span class="line">rank_dat <span class="operator">&lt;-</span> data.frame<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line"><span class="keyword">for</span> <span class="punctuation">(</span>i <span class="keyword">in</span> rownames<span class="punctuation">(</span>otu_relative<span class="punctuation">)</span><span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">	rank_dat_i <span class="operator">&lt;-</span> data.frame<span class="punctuation">(</span>rankabundance<span class="punctuation">(</span>subset<span class="punctuation">(</span>otu_relative<span class="punctuation">,</span> rownames<span class="punctuation">(</span>otu_relative<span class="punctuation">)</span> <span class="operator">==</span> i<span class="punctuation">)</span><span class="punctuation">,</span> digits <span class="operator">=</span> <span class="number">6</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">[</span><span class="number">1</span><span class="operator">:</span><span class="number">2</span><span class="punctuation">]</span></span><br><span class="line">	rank_dat_i<span class="operator">$</span>sample <span class="operator">&lt;-</span> i</span><br><span class="line">	rank_dat <span class="operator">&lt;-</span> rbind<span class="punctuation">(</span>rank_dat<span class="punctuation">,</span> rank_dat_i<span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line">rank_dat <span class="operator">&lt;-</span> subset<span class="punctuation">(</span>rank_dat<span class="punctuation">,</span> rank_dat<span class="operator">$</span>abundance <span class="operator">!=</span> <span class="number">0</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#ggplot2 作图</span></span><br><span class="line">ggplot<span class="punctuation">(</span>rank_dat<span class="punctuation">,</span> aes<span class="punctuation">(</span>rank<span class="punctuation">,</span> <span class="built_in">log</span><span class="punctuation">(</span>abundance<span class="punctuation">,</span> <span class="number">10</span><span class="punctuation">)</span><span class="punctuation">,</span> color <span class="operator">=</span> sample<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">geom_line<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&#x27;OTUs rank&#x27;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&#x27;Relative adundance (%)&#x27;</span><span class="punctuation">,</span> color <span class="operator">=</span> <span class="literal">NULL</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">theme<span class="punctuation">(</span>panel.grid <span class="operator">=</span> element_blank<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">,</span> panel.background <span class="operator">=</span> element_rect<span class="punctuation">(</span>fill <span class="operator">=</span> <span class="string">&#x27;transparent&#x27;</span><span class="punctuation">,</span> color <span class="operator">=</span> <span class="string">&#x27;black&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span> legend.key <span class="operator">=</span> element_rect<span class="punctuation">(</span>fill <span class="operator">=</span> <span class="string">&#x27;transparent&#x27;</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">scale_y_continuous<span class="punctuation">(</span>breaks <span class="operator">=</span> <span class="number">0</span><span class="operator">:</span><span class="operator">-</span><span class="number">5</span><span class="punctuation">,</span> labels <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;100&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;10&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;1&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;0.1&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;0.01&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;0.001&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span> limits <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="operator">-</span><span class="number">5</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#累积曲线</span></span><br><span class="line">BCI这个数据，它的每一行代表了一个样本，不同样本采样的地点不同，每一列是<span class="number">1</span>个物种的丰度</span><br><span class="line">library<span class="punctuation">(</span>vegan<span class="punctuation">)</span></span><br><span class="line">data<span class="punctuation">(</span>BCI<span class="punctuation">)</span></span><br><span class="line">sp1 <span class="operator">&lt;-</span> specaccum<span class="punctuation">(</span>BCI<span class="punctuation">,</span> method<span class="operator">=</span><span class="string">&quot;random&quot;</span><span class="punctuation">)</span></span><br><span class="line">plot<span class="punctuation">(</span>sp1<span class="punctuation">,</span> ci.type<span class="operator">=</span><span class="string">&quot;poly&quot;</span><span class="punctuation">,</span> col<span class="operator">=</span><span class="string">&quot;blue&quot;</span><span class="punctuation">,</span> lwd<span class="operator">=</span><span class="number">2</span><span class="punctuation">,</span> ci.lty<span class="operator">=</span><span class="number">0</span><span class="punctuation">,</span> ci.col<span class="operator">=</span><span class="string">&quot;lightblue&quot;</span><span class="punctuation">)</span></span><br><span class="line">boxplot<span class="punctuation">(</span>sp1<span class="punctuation">,</span> col<span class="operator">=</span><span class="string">&quot;yellow&quot;</span><span class="punctuation">,</span> add<span class="operator">=</span><span class="literal">TRUE</span><span class="punctuation">,</span> pch<span class="operator">=</span><span class="string">&quot;+&quot;</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<h3 id="pls-da最小二乘法分析">pls_da最小二乘法分析</h3>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">library<span class="punctuation">(</span>mixOmics<span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>ggplot2<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##读入文件</span></span><br><span class="line"><span class="comment">#门水平丰度表</span></span><br><span class="line">phylum <span class="operator">&lt;-</span> read.delim<span class="punctuation">(</span><span class="string">&#x27;phylum_table.txt&#x27;</span><span class="punctuation">,</span> row.names <span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span> sep <span class="operator">=</span> <span class="string">&#x27;\t&#x27;</span><span class="punctuation">,</span> stringsAsFactors <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">,</span> check.names <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span></span><br><span class="line">phylum <span class="operator">&lt;-</span> data.frame<span class="punctuation">(</span>t<span class="punctuation">(</span>phylum<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#样本分组文件</span></span><br><span class="line">group <span class="operator">&lt;-</span> read.delim<span class="punctuation">(</span><span class="string">&#x27;group.txt&#x27;</span><span class="punctuation">,</span> sep <span class="operator">=</span> <span class="string">&#x27;\t&#x27;</span><span class="punctuation">,</span> stringsAsFactors <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##PLS-DA 分析</span></span><br><span class="line"><span class="comment">#基于门水平丰度表，只展示前 3 个排序轴</span></span><br><span class="line">phylum <span class="operator">&lt;-</span> phylum<span class="punctuation">[</span>group<span class="operator">$</span><span class="built_in">names</span><span class="punctuation">,</span> <span class="punctuation">]</span></span><br><span class="line">plsda_result <span class="operator">&lt;-</span>plsda<span class="punctuation">(</span>phylum<span class="punctuation">,</span> group<span class="operator">$</span>group<span class="punctuation">,</span> ncomp <span class="operator">=</span> <span class="number">3</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#简要查看结果</span></span><br><span class="line">plsda_result</span><br><span class="line"><span class="comment">#或</span></span><br><span class="line"><span class="built_in">names</span><span class="punctuation">(</span>plsda_result<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#查看排序轴解释量</span></span><br><span class="line">plsda_result<span class="operator">$</span>explained_variance<span class="operator">$</span>X</span><br><span class="line"><span class="comment">#查看样本排序坐标</span></span><br><span class="line">plsda_result<span class="operator">$</span>variates<span class="operator">$</span>X</span><br><span class="line"><span class="comment">#查看细菌门类群排序坐标</span></span><br><span class="line">plsda_result<span class="operator">$</span>loadings<span class="operator">$</span>X</span><br><span class="line"></span><br><span class="line"><span class="comment">#使用 plotIndiv() 绘制 PLS-DA 分析结果</span></span><br><span class="line">plotIndiv<span class="punctuation">(</span>plsda_result<span class="punctuation">,</span> ind.names <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">,</span> style <span class="operator">=</span> <span class="string">&#x27;ggplot2&#x27;</span><span class="punctuation">)</span></span><br><span class="line">plotIndiv<span class="punctuation">(</span>plsda_result<span class="punctuation">,</span> ind.names <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">,</span> style <span class="operator">=</span> <span class="string">&#x27;3d&#x27;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#提取坐标轴解释量（前两轴）</span></span><br><span class="line">plsda_result_eig <span class="operator">&lt;-</span> <span class="punctuation">&#123;</span>plsda_result<span class="operator">$</span>explained_variance<span class="operator">$</span>X<span class="punctuation">&#125;</span><span class="punctuation">[</span><span class="number">1</span><span class="operator">:</span><span class="number">2</span><span class="punctuation">]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#提取样本点坐标（前两轴）</span></span><br><span class="line">sample_site <span class="operator">&lt;-</span> data.frame<span class="punctuation">(</span>plsda_result<span class="operator">$</span>variates<span class="punctuation">)</span><span class="punctuation">[</span><span class="number">1</span><span class="operator">:</span><span class="number">2</span><span class="punctuation">]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#为样本点坐标添加分组信息</span></span><br><span class="line">sample_site<span class="operator">$</span><span class="built_in">names</span> <span class="operator">&lt;-</span> rownames<span class="punctuation">(</span>sample_site<span class="punctuation">)</span></span><br><span class="line"><span class="built_in">names</span><span class="punctuation">(</span>sample_site<span class="punctuation">)</span><span class="punctuation">[</span><span class="number">1</span><span class="operator">:</span><span class="number">2</span><span class="punctuation">]</span> <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;plsda1&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;plsda2&#x27;</span><span class="punctuation">)</span></span><br><span class="line">sample_site <span class="operator">&lt;-</span> merge<span class="punctuation">(</span>sample_site<span class="punctuation">,</span> group<span class="punctuation">,</span> by <span class="operator">=</span> <span class="string">&#x27;names&#x27;</span><span class="punctuation">,</span> all.x <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#可选输出各样本的 PLS-DA 分析结果</span></span><br><span class="line">write.table<span class="punctuation">(</span>sample_site<span class="punctuation">,</span> <span class="string">&#x27;plsda_sample.txt&#x27;</span><span class="punctuation">,</span> row.names <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">,</span> sep <span class="operator">=</span> <span class="string">&#x27;\t&#x27;</span><span class="punctuation">,</span> <span class="built_in">quote</span> <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#使用 ggplot2 简单绘制 PLS-DA 结果图</span></span><br><span class="line">plsda_plot <span class="operator">&lt;-</span> ggplot<span class="punctuation">(</span>sample_site<span class="punctuation">,</span> aes<span class="punctuation">(</span>plsda1<span class="punctuation">,</span> plsda2<span class="punctuation">,</span> color <span class="operator">=</span> group<span class="punctuation">,</span> label <span class="operator">=</span> <span class="built_in">names</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">geom_point<span class="punctuation">(</span>size <span class="operator">=</span> <span class="number">1.5</span><span class="punctuation">,</span> alpha <span class="operator">=</span> <span class="number">0.6</span><span class="punctuation">)</span> <span class="operator">+</span> </span><br><span class="line">stat_ellipse<span class="punctuation">(</span>show.legend <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span> <span class="operator">+</span>	<span class="comment">#添加 95% 置信椭圆</span></span><br><span class="line">scale_color_manual<span class="punctuation">(</span>values <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;#1D7ACC&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;#F67433&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;#00815F&#x27;</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">theme<span class="punctuation">(</span>panel.grid <span class="operator">=</span> element_line<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&#x27;grey50&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span> panel.background <span class="operator">=</span> element_rect<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&#x27;black&#x27;</span><span class="punctuation">,</span> fill <span class="operator">=</span> <span class="string">&#x27;transparent&#x27;</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span> </span><br><span class="line">theme<span class="punctuation">(</span>legend.title <span class="operator">=</span> element_blank<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">,</span> legend.key <span class="operator">=</span> element_rect<span class="punctuation">(</span>fill <span class="operator">=</span> <span class="string">&#x27;transparent&#x27;</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">labs<span class="punctuation">(</span>x <span class="operator">=</span> paste<span class="punctuation">(</span><span class="string">&#x27;PLS-DA axis1 ( explained variance &#x27;</span><span class="punctuation">,</span> <span class="built_in">round</span><span class="punctuation">(</span><span class="number">100</span> <span class="operator">*</span> plsda_result_eig<span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">,</span> <span class="number">2</span><span class="punctuation">)</span><span class="punctuation">,</span> <span class="string">&#x27;% )&#x27;</span><span class="punctuation">,</span> sep <span class="operator">=</span> <span class="string">&#x27;&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span> y <span class="operator">=</span> paste<span class="punctuation">(</span><span class="string">&#x27;PLS-DA axis2 ( explained variance &#x27;</span><span class="punctuation">,</span> <span class="built_in">round</span><span class="punctuation">(</span><span class="number">100</span> <span class="operator">*</span> plsda_result_eig<span class="punctuation">[</span><span class="number">2</span><span class="punctuation">]</span><span class="punctuation">,</span> <span class="number">2</span><span class="punctuation">)</span><span class="punctuation">,</span> <span class="string">&#x27;% )&#x27;</span><span class="punctuation">,</span> sep <span class="operator">=</span> <span class="string">&#x27;&#x27;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#ggsave(&#x27;plsda_plot.pdf&#x27;, plsda_plot, width = 6, height = 5)</span></span><br><span class="line">ggsave<span class="punctuation">(</span><span class="string">&#x27;plsda_plot.png&#x27;</span><span class="punctuation">,</span> plsda_plot<span class="punctuation">,</span> width <span class="operator">=</span> <span class="number">6</span><span class="punctuation">,</span> height <span class="operator">=</span> <span class="number">5</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<h3 id="物种丰度关联弦图">物种丰度关联弦图</h3>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env Rscript</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##加载R包，初始传递命令</span></span><br><span class="line">library<span class="punctuation">(</span>circlize<span class="punctuation">)</span> <span class="comment">#使用该包绘制 circos 图</span></span><br><span class="line">library<span class="punctuation">(</span>reshape2<span class="punctuation">)</span> <span class="comment">#在某步排列表格用（第 48 行“plot_data &lt;- melt(otu_table, id = &#x27;otu_ID&#x27;)”）</span></span><br><span class="line">library<span class="punctuation">(</span>ComplexHeatmap<span class="punctuation">)</span> <span class="comment">#可用此包添加图例</span></span><br><span class="line">library<span class="punctuation">(</span>grid<span class="punctuation">)</span> <span class="comment">#可用此包调整画板</span></span><br><span class="line"></span><br><span class="line">otu_table_file <span class="operator">&lt;-</span> <span class="string">&#x27;otu_table.txt&#x27;</span></span><br><span class="line">group_file <span class="operator">&lt;-</span> <span class="string">&#x27;group.txt&#x27;</span></span><br><span class="line">taxonomy_file <span class="operator">&lt;-</span> <span class="string">&#x27;taxonomy.txt&#x27;</span></span><br><span class="line">color_otu <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;#8DD3C7&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;#FFFFB3&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;#BEBADA&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;#FB8072&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;#80B1D3&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;#FDB462&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;#B3DE69&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;#FCCDE5&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;#BC80BD&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;#CCEBC5&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;#FFED6F&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;#E41A1C&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;#377EB8&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;#4DAF4A&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;#984EA3&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;#FF7F00&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;#FFFF33&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;#A65628&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;#F781BF&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;#66C2A5&#x27;</span><span class="punctuation">)</span></span><br><span class="line">color_sample <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;#6181BD&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;#F34800&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;#64A10E&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;#FF00FF&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;#c7475b&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;#049a0b&#x27;</span><span class="punctuation">)</span></span><br><span class="line">color_phylum <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;#BEAED4&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;#FDC086&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;#FFFF99&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;#386CB0&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;#F0027F&#x27;</span><span class="punctuation">)</span></span><br><span class="line">color_group <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;#4253ff&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;#ff4308&#x27;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">####预处理</span></span><br><span class="line"><span class="comment">##读取数据</span></span><br><span class="line"><span class="comment">#依据 taxonomy_file 的内容，获取“OTU/分类”排序</span></span><br><span class="line">taxonomy <span class="operator">&lt;-</span> read.delim<span class="punctuation">(</span>taxonomy_file<span class="punctuation">,</span> sep <span class="operator">=</span> <span class="string">&#x27;\t&#x27;</span><span class="punctuation">,</span> stringsAsFactors <span class="operator">=</span> <span class="built_in">F</span><span class="punctuation">)</span></span><br><span class="line">tax_phylum <span class="operator">&lt;-</span> unique<span class="punctuation">(</span>taxonomy<span class="operator">$</span>phylum<span class="punctuation">)</span></span><br><span class="line">taxonomy<span class="operator">$</span>phylum <span class="operator">&lt;-</span> factor<span class="punctuation">(</span>taxonomy<span class="operator">$</span>phylum<span class="punctuation">,</span> levels <span class="operator">=</span> tax_phylum<span class="punctuation">)</span></span><br><span class="line">all_otu <span class="operator">&lt;-</span> taxonomy<span class="operator">$</span>OTU_ID</span><br><span class="line">taxonomy<span class="operator">$</span>OTU_ID <span class="operator">&lt;-</span> factor<span class="punctuation">(</span>taxonomy<span class="operator">$</span>OTU_ID<span class="punctuation">,</span> levels <span class="operator">=</span> all_otu<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#依据 group_file 的内容，获取“样本/分组”排序</span></span><br><span class="line">group <span class="operator">&lt;-</span> read.delim<span class="punctuation">(</span>group_file<span class="punctuation">,</span> sep <span class="operator">=</span> <span class="string">&#x27;\t&#x27;</span><span class="punctuation">,</span> stringsAsFactors <span class="operator">=</span> <span class="built_in">F</span><span class="punctuation">)</span></span><br><span class="line">all_group <span class="operator">&lt;-</span> unique<span class="punctuation">(</span>group<span class="operator">$</span>group_ID<span class="punctuation">)</span></span><br><span class="line">group<span class="operator">$</span>group_ID <span class="operator">&lt;-</span> factor<span class="punctuation">(</span>group<span class="operator">$</span>group_ID<span class="punctuation">,</span> levels <span class="operator">=</span> all_group<span class="punctuation">)</span></span><br><span class="line">all_sample <span class="operator">&lt;-</span> group<span class="operator">$</span>sample_ID</span><br><span class="line"></span><br><span class="line"><span class="comment">#基于上述排序结果，预处理 otu_table_file</span></span><br><span class="line">otu_table <span class="operator">&lt;-</span> read.delim<span class="punctuation">(</span>otu_table_file<span class="punctuation">,</span> sep <span class="operator">=</span> <span class="string">&#x27;\t&#x27;</span><span class="punctuation">)</span></span><br><span class="line">otu_table <span class="operator">&lt;-</span> merge<span class="punctuation">(</span>taxonomy<span class="punctuation">,</span> otu_table<span class="punctuation">,</span> by <span class="operator">=</span> <span class="string">&#x27;OTU_ID&#x27;</span><span class="punctuation">)</span></span><br><span class="line">otu_table <span class="operator">&lt;-</span> otu_table<span class="punctuation">[</span>order<span class="punctuation">(</span>otu_table<span class="operator">$</span>phylum<span class="punctuation">,</span> otu_table<span class="operator">$</span>OTU_ID<span class="punctuation">)</span><span class="punctuation">,</span> <span class="punctuation">]</span></span><br><span class="line">rownames<span class="punctuation">(</span>otu_table<span class="punctuation">)</span> <span class="operator">&lt;-</span> otu_table<span class="operator">$</span>OTU_ID</span><br><span class="line">otu_table <span class="operator">&lt;-</span> otu_table<span class="punctuation">[</span>all_sample<span class="punctuation">]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##生成绘图文件</span></span><br><span class="line"><span class="comment">#circlize 外圈属性数据</span></span><br><span class="line">all_ID <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span>all_otu<span class="punctuation">,</span> all_sample<span class="punctuation">)</span></span><br><span class="line">accum_otu <span class="operator">&lt;-</span> rowSums<span class="punctuation">(</span>otu_table<span class="punctuation">)</span></span><br><span class="line">accum_sample <span class="operator">&lt;-</span> colSums<span class="punctuation">(</span>otu_table<span class="punctuation">)</span></span><br><span class="line">all_ID_xlim <span class="operator">&lt;-</span> cbind<span class="punctuation">(</span><span class="built_in">rep</span><span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span> <span class="built_in">length</span><span class="punctuation">(</span>all_ID<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">,</span>data.frame<span class="punctuation">(</span><span class="built_in">c</span><span class="punctuation">(</span>accum_otu<span class="punctuation">,</span> accum_sample<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#circlize 内圈连线数据</span></span><br><span class="line">otu_table<span class="operator">$</span>otu_ID <span class="operator">&lt;-</span> all_otu</span><br><span class="line">plot_data <span class="operator">&lt;-</span> melt<span class="punctuation">(</span>otu_table<span class="punctuation">,</span> id <span class="operator">=</span> <span class="string">&#x27;otu_ID&#x27;</span><span class="punctuation">)</span> <span class="comment">#此处使用了reshape2包中的melt()命令</span></span><br><span class="line">colnames<span class="punctuation">(</span>plot_data<span class="punctuation">)</span><span class="punctuation">[</span><span class="number">2</span><span class="punctuation">]</span> <span class="operator">&lt;-</span> <span class="string">&#x27;sample_ID&#x27;</span></span><br><span class="line">plot_data<span class="operator">$</span>otu_ID <span class="operator">&lt;-</span> factor<span class="punctuation">(</span>plot_data<span class="operator">$</span>otu_ID<span class="punctuation">,</span> levels <span class="operator">=</span> all_otu<span class="punctuation">)</span></span><br><span class="line">plot_data<span class="operator">$</span>sample_ID <span class="operator">&lt;-</span> factor<span class="punctuation">(</span>plot_data<span class="operator">$</span>sample_ID<span class="punctuation">,</span> levels <span class="operator">=</span> all_sample<span class="punctuation">)</span></span><br><span class="line">plot_data <span class="operator">&lt;-</span> plot_data<span class="punctuation">[</span>order<span class="punctuation">(</span>plot_data<span class="operator">$</span>otu_ID<span class="punctuation">,</span> plot_data<span class="operator">$</span>sample_ID<span class="punctuation">)</span><span class="punctuation">,</span> <span class="punctuation">]</span></span><br><span class="line">plot_data <span class="operator">&lt;-</span> plot_data<span class="punctuation">[</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">2</span><span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">,</span> <span class="number">3</span><span class="punctuation">,</span> <span class="number">3</span><span class="punctuation">)</span><span class="punctuation">]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#颜色设置</span></span><br><span class="line"><span class="built_in">names</span><span class="punctuation">(</span>color_otu<span class="punctuation">)</span> <span class="operator">&lt;-</span> all_otu</span><br><span class="line"><span class="built_in">names</span><span class="punctuation">(</span>color_sample<span class="punctuation">)</span> <span class="operator">&lt;-</span> all_sample</span><br><span class="line"></span><br><span class="line"><span class="comment">####circlize 绘图</span></span><br><span class="line">pdf<span class="punctuation">(</span><span class="string">&#x27;circlize_plot.pdf&#x27;</span><span class="punctuation">,</span> width <span class="operator">=</span> <span class="number">20</span><span class="punctuation">,</span> height <span class="operator">=</span> <span class="number">8</span><span class="punctuation">)</span></span><br><span class="line">circle_size <span class="operator">=</span> unit<span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span> <span class="string">&#x27;snpc&#x27;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##整体布局</span></span><br><span class="line">gap_size <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="built_in">rep</span><span class="punctuation">(</span><span class="number">3</span><span class="punctuation">,</span> <span class="built_in">length</span><span class="punctuation">(</span>all_otu<span class="punctuation">)</span> <span class="operator">-</span> <span class="number">1</span><span class="punctuation">)</span><span class="punctuation">,</span> <span class="number">6</span><span class="punctuation">,</span> <span class="built_in">rep</span><span class="punctuation">(</span><span class="number">3</span><span class="punctuation">,</span> <span class="built_in">length</span><span class="punctuation">(</span>all_sample<span class="punctuation">)</span> <span class="operator">-</span> <span class="number">1</span><span class="punctuation">)</span><span class="punctuation">,</span> <span class="number">6</span><span class="punctuation">)</span></span><br><span class="line">circos.par<span class="punctuation">(</span>cell.padding <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">)</span><span class="punctuation">,</span> start.degree <span class="operator">=</span> <span class="number">270</span><span class="punctuation">,</span> gap.degree <span class="operator">=</span> gap_size<span class="punctuation">)</span></span><br><span class="line">circos.initialize<span class="punctuation">(</span>factors <span class="operator">=</span> factor<span class="punctuation">(</span>all_ID<span class="punctuation">,</span> levels <span class="operator">=</span> all_ID<span class="punctuation">)</span><span class="punctuation">,</span> xlim <span class="operator">=</span> all_ID_xlim<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##绘制 OTU 分类、样本分组区块（第一圈）</span></span><br><span class="line">circos.trackPlotRegion<span class="punctuation">(</span></span><br><span class="line">	ylim <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">)</span><span class="punctuation">,</span> track.height <span class="operator">=</span> <span class="number">0.03</span><span class="punctuation">,</span> bg.border <span class="operator">=</span> <span class="literal">NA</span><span class="punctuation">,</span> </span><br><span class="line">	panel.fun <span class="operator">=</span> <span class="keyword">function</span><span class="punctuation">(</span>x<span class="punctuation">,</span> y<span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">		sector.index <span class="operator">=</span> get.cell.meta.data<span class="punctuation">(</span><span class="string">&#x27;sector.index&#x27;</span><span class="punctuation">)</span></span><br><span class="line">		xlim <span class="operator">=</span> get.cell.meta.data<span class="punctuation">(</span><span class="string">&#x27;xlim&#x27;</span><span class="punctuation">)</span></span><br><span class="line">		ylim <span class="operator">=</span> get.cell.meta.data<span class="punctuation">(</span><span class="string">&#x27;ylim&#x27;</span><span class="punctuation">)</span></span><br><span class="line">	<span class="punctuation">&#125;</span> <span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> <span class="punctuation">(</span>i <span class="keyword">in</span> <span class="number">1</span><span class="operator">:</span><span class="built_in">length</span><span class="punctuation">(</span>tax_phylum<span class="punctuation">)</span><span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">	tax_OTU <span class="operator">&lt;-</span> <span class="punctuation">&#123;</span>subset<span class="punctuation">(</span>taxonomy<span class="punctuation">,</span> phylum <span class="operator">==</span> tax_phylum<span class="punctuation">[</span>i<span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">&#125;</span><span class="operator">$</span>OTU_ID</span><br><span class="line">	highlight.sector<span class="punctuation">(</span>tax_OTU<span class="punctuation">,</span> track.index <span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span> col <span class="operator">=</span> color_phylum<span class="punctuation">[</span>i<span class="punctuation">]</span><span class="punctuation">,</span> text <span class="operator">=</span> tax_phylum<span class="punctuation">[</span>i<span class="punctuation">]</span><span class="punctuation">,</span> cex <span class="operator">=</span> <span class="number">0.5</span><span class="punctuation">,</span> text.col <span class="operator">=</span> <span class="string">&#x27;black&#x27;</span><span class="punctuation">,</span> niceFacing <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> <span class="punctuation">(</span>i <span class="keyword">in</span> <span class="number">1</span><span class="operator">:</span><span class="built_in">length</span><span class="punctuation">(</span>all_group<span class="punctuation">)</span><span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">	group_sample <span class="operator">&lt;-</span> <span class="punctuation">&#123;</span>subset<span class="punctuation">(</span>group<span class="punctuation">,</span> group_ID <span class="operator">==</span> all_group<span class="punctuation">[</span>i<span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">&#125;</span><span class="operator">$</span>sample_ID</span><br><span class="line">	highlight.sector<span class="punctuation">(</span>group_sample<span class="punctuation">,</span> track.index <span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span> col <span class="operator">=</span> color_group<span class="punctuation">[</span>i<span class="punctuation">]</span><span class="punctuation">,</span> text <span class="operator">=</span> all_group<span class="punctuation">[</span>i<span class="punctuation">]</span><span class="punctuation">,</span> cex <span class="operator">=</span> <span class="number">0.7</span><span class="punctuation">,</span> text.col <span class="operator">=</span> <span class="string">&#x27;black&#x27;</span><span class="punctuation">,</span> niceFacing <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##各 OTU、样本绘制区</span></span><br><span class="line"><span class="comment">#添加百分比注释（第二圈）</span></span><br><span class="line">circos.trackPlotRegion<span class="punctuation">(</span></span><br><span class="line">	ylim <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">)</span><span class="punctuation">,</span> track.height <span class="operator">=</span> <span class="number">0.05</span><span class="punctuation">,</span> bg.border <span class="operator">=</span> <span class="literal">NA</span><span class="punctuation">,</span> </span><br><span class="line">	panel.fun <span class="operator">=</span> <span class="keyword">function</span><span class="punctuation">(</span>x<span class="punctuation">,</span> y<span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">		sector.index <span class="operator">=</span> get.cell.meta.data<span class="punctuation">(</span><span class="string">&#x27;sector.index&#x27;</span><span class="punctuation">)</span></span><br><span class="line">		xlim <span class="operator">=</span> get.cell.meta.data<span class="punctuation">(</span><span class="string">&#x27;xlim&#x27;</span><span class="punctuation">)</span></span><br><span class="line">		ylim <span class="operator">=</span> get.cell.meta.data<span class="punctuation">(</span><span class="string">&#x27;ylim&#x27;</span><span class="punctuation">)</span></span><br><span class="line">	<span class="punctuation">&#125;</span> <span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">circos.track<span class="punctuation">(</span></span><br><span class="line">	track.index <span class="operator">=</span> <span class="number">2</span><span class="punctuation">,</span> bg.border <span class="operator">=</span> <span class="literal">NA</span><span class="punctuation">,</span> </span><br><span class="line">	panel.fun <span class="operator">=</span> <span class="keyword">function</span><span class="punctuation">(</span>x<span class="punctuation">,</span> y<span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">		xlim <span class="operator">=</span> get.cell.meta.data<span class="punctuation">(</span><span class="string">&#x27;xlim&#x27;</span><span class="punctuation">)</span></span><br><span class="line">		ylim <span class="operator">=</span> get.cell.meta.data<span class="punctuation">(</span><span class="string">&#x27;ylim&#x27;</span><span class="punctuation">)</span></span><br><span class="line">		sector.name <span class="operator">=</span> get.cell.meta.data<span class="punctuation">(</span><span class="string">&#x27;sector.index&#x27;</span><span class="punctuation">)</span></span><br><span class="line">		xplot <span class="operator">=</span> get.cell.meta.data<span class="punctuation">(</span><span class="string">&#x27;xplot&#x27;</span><span class="punctuation">)</span></span><br><span class="line">		</span><br><span class="line">		by <span class="operator">=</span> ifelse<span class="punctuation">(</span><span class="built_in">abs</span><span class="punctuation">(</span>xplot<span class="punctuation">[</span><span class="number">2</span><span class="punctuation">]</span> <span class="operator">-</span> xplot<span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">)</span> <span class="operator">&gt;</span> <span class="number">30</span><span class="punctuation">,</span> <span class="number">0.25</span><span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">)</span></span><br><span class="line">		<span class="keyword">for</span> <span class="punctuation">(</span>p <span class="keyword">in</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span> seq<span class="punctuation">(</span>by<span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">,</span> by <span class="operator">=</span> by<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span> circos.text<span class="punctuation">(</span>p<span class="operator">*</span><span class="punctuation">(</span>xlim<span class="punctuation">[</span><span class="number">2</span><span class="punctuation">]</span> <span class="operator">-</span> xlim<span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">)</span> <span class="operator">+</span> xlim<span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">,</span> mean<span class="punctuation">(</span>ylim<span class="punctuation">)</span> <span class="operator">+</span> <span class="number">0.4</span><span class="punctuation">,</span> paste0<span class="punctuation">(</span>p<span class="operator">*</span><span class="number">100</span><span class="punctuation">,</span> <span class="string">&#x27;%&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span> cex <span class="operator">=</span> <span class="number">0.4</span><span class="punctuation">,</span> adj <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">0.5</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">)</span><span class="punctuation">,</span> niceFacing <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span></span><br><span class="line">		</span><br><span class="line">		circos.lines<span class="punctuation">(</span>xlim<span class="punctuation">,</span> <span class="built_in">c</span><span class="punctuation">(</span>mean<span class="punctuation">(</span>ylim<span class="punctuation">)</span><span class="punctuation">,</span> mean<span class="punctuation">(</span>ylim<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">,</span> lty <span class="operator">=</span> <span class="number">3</span><span class="punctuation">)</span></span><br><span class="line">	<span class="punctuation">&#125;</span> <span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#绘制 OTU、样本主区块（第三圈）</span></span><br><span class="line">circos.trackPlotRegion<span class="punctuation">(</span></span><br><span class="line">	ylim <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">)</span><span class="punctuation">,</span> track.height <span class="operator">=</span> <span class="number">0.03</span><span class="punctuation">,</span> bg.col <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span>color_otu<span class="punctuation">,</span> color_sample<span class="punctuation">)</span><span class="punctuation">,</span> bg.border <span class="operator">=</span> <span class="literal">NA</span><span class="punctuation">,</span> track.margin <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span> <span class="number">0.01</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">	panel.fun <span class="operator">=</span> <span class="keyword">function</span><span class="punctuation">(</span>x<span class="punctuation">,</span> y<span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">		xlim <span class="operator">=</span> get.cell.meta.data<span class="punctuation">(</span><span class="string">&#x27;xlim&#x27;</span><span class="punctuation">)</span></span><br><span class="line">		sector.name <span class="operator">=</span> get.cell.meta.data<span class="punctuation">(</span><span class="string">&#x27;sector.index&#x27;</span><span class="punctuation">)</span></span><br><span class="line">		circos.axis<span class="punctuation">(</span>h <span class="operator">=</span> <span class="string">&#x27;top&#x27;</span><span class="punctuation">,</span> labels.cex <span class="operator">=</span> <span class="number">0.4</span><span class="punctuation">,</span> major.tick.percentage <span class="operator">=</span> <span class="number">0.4</span><span class="punctuation">,</span> labels.niceFacing <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span></span><br><span class="line">		circos.text<span class="punctuation">(</span>mean<span class="punctuation">(</span>xlim<span class="punctuation">)</span><span class="punctuation">,</span> <span class="number">0.2</span><span class="punctuation">,</span> sector.name<span class="punctuation">,</span> cex <span class="operator">=</span> <span class="number">0.4</span><span class="punctuation">,</span> niceFacing <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">,</span> adj <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">0.5</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">	<span class="punctuation">&#125;</span> <span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#绘制 OTU、样本副区块（第四圈）</span></span><br><span class="line">circos.trackPlotRegion<span class="punctuation">(</span>ylim <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">)</span><span class="punctuation">,</span> track.height <span class="operator">=</span> <span class="number">0.03</span><span class="punctuation">,</span> track.margin <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span> <span class="number">0.01</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##绘制 OTU-样本关联连线（最内圈）</span></span><br><span class="line"><span class="keyword">for</span> <span class="punctuation">(</span>i <span class="keyword">in</span> <span class="built_in">seq_len</span><span class="punctuation">(</span>nrow<span class="punctuation">(</span>plot_data<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">	circos.link<span class="punctuation">(</span></span><br><span class="line">		plot_data<span class="punctuation">[</span>i<span class="punctuation">,</span><span class="number">2</span><span class="punctuation">]</span><span class="punctuation">,</span> <span class="built_in">c</span><span class="punctuation">(</span>accum_otu<span class="punctuation">[</span>plot_data<span class="punctuation">[</span>i<span class="punctuation">,</span><span class="number">2</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">,</span> accum_otu<span class="punctuation">[</span>plot_data<span class="punctuation">[</span>i<span class="punctuation">,</span><span class="number">2</span><span class="punctuation">]</span><span class="punctuation">]</span> <span class="operator">-</span> plot_data<span class="punctuation">[</span>i<span class="punctuation">,</span><span class="number">4</span><span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">		plot_data<span class="punctuation">[</span>i<span class="punctuation">,</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">,</span> <span class="built_in">c</span><span class="punctuation">(</span>accum_sample<span class="punctuation">[</span>plot_data<span class="punctuation">[</span>i<span class="punctuation">,</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">,</span> accum_sample<span class="punctuation">[</span>plot_data<span class="punctuation">[</span>i<span class="punctuation">,</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">]</span> <span class="operator">-</span> plot_data<span class="punctuation">[</span>i<span class="punctuation">,</span><span class="number">3</span><span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">		col <span class="operator">=</span> paste0<span class="punctuation">(</span>color_otu<span class="punctuation">[</span>plot_data<span class="punctuation">[</span>i<span class="punctuation">,</span><span class="number">2</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">,</span> <span class="string">&#x27;70&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span> border <span class="operator">=</span> <span class="literal">NA</span> <span class="punctuation">)</span></span><br><span class="line">	</span><br><span class="line">	circos.rect<span class="punctuation">(</span>accum_otu<span class="punctuation">[</span>plot_data<span class="punctuation">[</span>i<span class="punctuation">,</span><span class="number">2</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">,</span> accum_otu<span class="punctuation">[</span>plot_data<span class="punctuation">[</span>i<span class="punctuation">,</span><span class="number">2</span><span class="punctuation">]</span><span class="punctuation">]</span> <span class="operator">-</span> plot_data<span class="punctuation">[</span>i<span class="punctuation">,</span><span class="number">4</span><span class="punctuation">]</span><span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">,</span> sector.index <span class="operator">=</span> plot_data<span class="punctuation">[</span>i<span class="punctuation">,</span><span class="number">2</span><span class="punctuation">]</span><span class="punctuation">,</span> col <span class="operator">=</span> color_sample<span class="punctuation">[</span>plot_data<span class="punctuation">[</span>i<span class="punctuation">,</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">,</span> border <span class="operator">=</span> <span class="literal">NA</span><span class="punctuation">)</span></span><br><span class="line">	circos.rect<span class="punctuation">(</span>accum_sample<span class="punctuation">[</span>plot_data<span class="punctuation">[</span>i<span class="punctuation">,</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">,</span> accum_sample<span class="punctuation">[</span>plot_data<span class="punctuation">[</span>i<span class="punctuation">,</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">]</span> <span class="operator">-</span> plot_data<span class="punctuation">[</span>i<span class="punctuation">,</span><span class="number">3</span><span class="punctuation">]</span><span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">,</span> sector.index <span class="operator">=</span> plot_data<span class="punctuation">[</span>i<span class="punctuation">,</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">,</span> col <span class="operator">=</span> color_otu<span class="punctuation">[</span>plot_data<span class="punctuation">[</span>i<span class="punctuation">,</span><span class="number">2</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">,</span> border <span class="operator">=</span> <span class="literal">NA</span><span class="punctuation">)</span></span><br><span class="line">	</span><br><span class="line">	accum_otu<span class="punctuation">[</span>plot_data<span class="punctuation">[</span>i<span class="punctuation">,</span><span class="number">2</span><span class="punctuation">]</span><span class="punctuation">]</span> <span class="operator">=</span> accum_otu<span class="punctuation">[</span>plot_data<span class="punctuation">[</span>i<span class="punctuation">,</span><span class="number">2</span><span class="punctuation">]</span><span class="punctuation">]</span> <span class="operator">-</span> plot_data<span class="punctuation">[</span>i<span class="punctuation">,</span><span class="number">4</span><span class="punctuation">]</span></span><br><span class="line">	accum_sample<span class="punctuation">[</span>plot_data<span class="punctuation">[</span>i<span class="punctuation">,</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">]</span> <span class="operator">=</span> accum_sample<span class="punctuation">[</span>plot_data<span class="punctuation">[</span>i<span class="punctuation">,</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">]</span> <span class="operator">-</span> plot_data<span class="punctuation">[</span>i<span class="punctuation">,</span><span class="number">3</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##添加图例</span></span><br><span class="line">otu_legend <span class="operator">&lt;-</span> Legend<span class="punctuation">(</span></span><br><span class="line">		at <span class="operator">=</span> all_otu<span class="punctuation">,</span> labels <span class="operator">=</span> taxonomy<span class="operator">$</span>detail<span class="punctuation">,</span> labels_gp <span class="operator">=</span> gpar<span class="punctuation">(</span>fontsize <span class="operator">=</span> <span class="number">8</span><span class="punctuation">)</span><span class="punctuation">,</span>    </span><br><span class="line">		grid_height <span class="operator">=</span> unit<span class="punctuation">(</span><span class="number">0.5</span><span class="punctuation">,</span> <span class="string">&#x27;cm&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span> grid_width <span class="operator">=</span> unit<span class="punctuation">(</span><span class="number">0.5</span><span class="punctuation">,</span> <span class="string">&#x27;cm&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span> type <span class="operator">=</span> <span class="string">&#x27;points&#x27;</span><span class="punctuation">,</span> pch <span class="operator">=</span> <span class="literal">NA</span><span class="punctuation">,</span> background <span class="operator">=</span> color_otu<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">pushViewport<span class="punctuation">(</span>viewport<span class="punctuation">(</span>x <span class="operator">=</span> <span class="number">0.85</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="number">0.5</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">grid.draw<span class="punctuation">(</span>otu_legend<span class="punctuation">)</span></span><br><span class="line">upViewport<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line">		</span><br><span class="line"><span class="comment">##清除 circlize 样式并关闭画板</span></span><br><span class="line">circos.clear<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line">dev.off<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="绘制细菌基因组重测序变异圈图">绘制细菌基因组重测序变异圈图</h3>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env Rscript</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##加载 R 包 &amp; 初始传递命令</span></span><br><span class="line">library<span class="punctuation">(</span>stringr<span class="punctuation">)</span>	<span class="comment">#方便处理字符串</span></span><br><span class="line">library<span class="punctuation">(</span>circlize<span class="punctuation">)</span>	<span class="comment">#绘制圈图</span></span><br><span class="line">library<span class="punctuation">(</span>ComplexHeatmap<span class="punctuation">)</span>	<span class="comment">#绘制图例</span></span><br><span class="line">library<span class="punctuation">(</span>grid<span class="punctuation">)</span>	<span class="comment">#组合画板，圈图 + 图例</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##命令传递</span></span><br><span class="line">sample_name <span class="operator">&lt;-</span> <span class="string">&#x27;Bacillus_subtilis&#x27;</span>	<span class="comment">#测序样本名称</span></span><br><span class="line">ref_name <span class="operator">&lt;-</span> <span class="string">&#x27;Bacillus_subtilis str168&#x27;</span>	<span class="comment">#参考基因组名称</span></span><br><span class="line"></span><br><span class="line">genome_gff <span class="operator">&lt;-</span> <span class="string">&#x27;Bacillus_subtilis.str168.gff&#x27;</span>	<span class="comment">#参考基因组 gff 注释文件</span></span><br><span class="line">snp_vcf <span class="operator">&lt;-</span> <span class="string">&#x27;Bacillus_subtilis.snp.vcf&#x27;</span>	<span class="comment">#SNP 检测结果 vcf 文件</span></span><br><span class="line">indel_vcf <span class="operator">&lt;-</span> <span class="string">&#x27;Bacillus_subtilis.indel.vcf&#x27;</span>	<span class="comment">#InDel 检测结果 vcf 文件</span></span><br><span class="line">cnv_cnv <span class="operator">&lt;-</span> <span class="string">&#x27;Bacillus_subtilis.cnv&#x27;</span>	<span class="comment">#cnv 检测结果文件</span></span><br><span class="line">sv_ctx <span class="operator">&lt;-</span> <span class="string">&#x27;Bacillus_subtilis.ctx&#x27;</span>	<span class="comment">#sv 检测结果文件</span></span><br><span class="line">depth_base_stat <span class="operator">&lt;-</span> <span class="string">&#x27;Bacillus_subtilis.depth_base.txt&#x27;</span>	<span class="comment">#测序深度、碱基含量统计结果文件</span></span><br><span class="line">seq_split <span class="operator">&lt;-</span> 2000	<span class="comment">#滑窗大小，与 depth_base_stat 中使用的滑窗大小对应</span></span><br><span class="line"></span><br><span class="line">out_dir <span class="operator">=</span> <span class="string">&#x27;output&#x27;</span>	<span class="comment">#生成一个目录，用于存放结果文件</span></span><br><span class="line"><span class="keyword">if</span> <span class="punctuation">(</span><span class="operator">!</span>file.exists<span class="punctuation">(</span>out_dir<span class="punctuation">)</span><span class="punctuation">)</span> dir.create<span class="punctuation">(</span>out_dir<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#####################</span></span><br><span class="line"><span class="comment">##参考基因组长度、GC 统计 &amp; 测序覆盖度、深度统计</span></span><br><span class="line">depth_base <span class="operator">&lt;-</span> read.delim<span class="punctuation">(</span>depth_base_stat<span class="punctuation">,</span> stringsAsFactors <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span></span><br><span class="line">genome_size <span class="operator">&lt;-</span> <span class="built_in">sum</span><span class="punctuation">(</span>depth_base<span class="operator">$</span>seq_end <span class="operator">-</span> depth_base<span class="operator">$</span>seq_start <span class="operator">+</span> <span class="number">1</span><span class="punctuation">)</span> </span><br><span class="line">genome_GC <span class="operator">&lt;-</span> <span class="built_in">round</span><span class="punctuation">(</span>mean<span class="punctuation">(</span>depth_base<span class="operator">$</span>GC<span class="punctuation">)</span><span class="punctuation">,</span> <span class="number">2</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">depth_exist <span class="operator">&lt;-</span> subset<span class="punctuation">(</span>depth_base<span class="punctuation">,</span> depth <span class="operator">!=</span> <span class="number">0</span><span class="punctuation">)</span></span><br><span class="line">coverage <span class="operator">&lt;-</span> <span class="built_in">round</span><span class="punctuation">(</span><span class="number">100</span> <span class="operator">*</span> <span class="built_in">sum</span><span class="punctuation">(</span>depth_exist<span class="operator">$</span>seq_end <span class="operator">-</span> depth_exist<span class="operator">$</span>seq_start <span class="operator">+</span> <span class="number">1</span><span class="punctuation">)</span> <span class="operator">/</span> genome_size<span class="punctuation">,</span> <span class="number">2</span><span class="punctuation">)</span></span><br><span class="line">average_depth <span class="operator">&lt;-</span> <span class="built_in">round</span><span class="punctuation">(</span>mean<span class="punctuation">(</span>depth_base<span class="operator">$</span>depth<span class="punctuation">)</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">seq_stat <span class="operator">&lt;-</span> <span class="literal">NULL</span></span><br><span class="line"><span class="keyword">for</span> <span class="punctuation">(</span>seq_id <span class="keyword">in</span> unique<span class="punctuation">(</span>depth_base<span class="operator">$</span>seq_ID<span class="punctuation">)</span><span class="punctuation">)</span> seq_stat <span class="operator">&lt;-</span> rbind<span class="punctuation">(</span>seq_stat<span class="punctuation">,</span> <span class="built_in">c</span><span class="punctuation">(</span>seq_id<span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">,</span> <span class="built_in">max</span><span class="punctuation">(</span>subset<span class="punctuation">(</span>depth_base<span class="punctuation">,</span> seq_ID <span class="operator">==</span> seq_id<span class="punctuation">)</span><span class="operator">$</span>seq_end<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">seq_stat <span class="operator">&lt;-</span> data.frame<span class="punctuation">(</span>seq_stat<span class="punctuation">,</span> stringsAsFactors <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span></span><br><span class="line">colnames<span class="punctuation">(</span>seq_stat<span class="punctuation">)</span> <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;seq_ID&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;seq_start&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;seq_end&#x27;</span><span class="punctuation">)</span></span><br><span class="line">rownames<span class="punctuation">(</span>seq_stat<span class="punctuation">)</span> <span class="operator">&lt;-</span> seq_stat<span class="operator">$</span>seq_ID</span><br><span class="line">seq_stat<span class="operator">$</span>seq_start <span class="operator">&lt;-</span> <span class="built_in">as.numeric</span><span class="punctuation">(</span>seq_stat<span class="operator">$</span>seq_start<span class="punctuation">)</span></span><br><span class="line">seq_stat<span class="operator">$</span>seq_end <span class="operator">&lt;-</span> <span class="built_in">as.numeric</span><span class="punctuation">(</span>seq_stat<span class="operator">$</span>seq_end<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">write.table<span class="punctuation">(</span>seq_stat<span class="punctuation">,</span> str_c<span class="punctuation">(</span>out_dir<span class="punctuation">,</span> <span class="string">&#x27;/&#x27;</span><span class="punctuation">,</span> sample_name<span class="punctuation">,</span> <span class="string">&#x27;.genome_stat.txt&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span> row.names <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">,</span> sep <span class="operator">=</span> <span class="string">&#x27;\t&#x27;</span><span class="punctuation">,</span> <span class="built_in">quote</span> <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##参考基因组基因信息，CDS &amp; rRNA &amp; tRNA</span></span><br><span class="line">gene <span class="operator">&lt;-</span> read.delim<span class="punctuation">(</span>genome_gff<span class="punctuation">,</span> header <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">,</span> stringsAsFactors <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">,</span> comment.char <span class="operator">=</span> <span class="string">&#x27;#&#x27;</span><span class="punctuation">)</span><span class="punctuation">[</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span> <span class="number">3</span><span class="punctuation">,</span> <span class="number">4</span><span class="punctuation">,</span> <span class="number">5</span><span class="punctuation">,</span> <span class="number">7</span><span class="punctuation">)</span><span class="punctuation">]</span></span><br><span class="line">gene <span class="operator">&lt;-</span> subset<span class="punctuation">(</span>gene<span class="punctuation">,</span> V3 <span class="operator">%in%</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;CDS&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;rRNA&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;tRNA&#x27;</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">[</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span> <span class="number">3</span><span class="punctuation">,</span> <span class="number">4</span><span class="punctuation">,</span> <span class="number">2</span><span class="punctuation">,</span> <span class="number">5</span><span class="punctuation">)</span><span class="punctuation">]</span></span><br><span class="line"><span class="built_in">names</span><span class="punctuation">(</span>gene<span class="punctuation">)</span> <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;seq_ID&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;seq_start&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;seq_end&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;type&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;strand&#x27;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">gene<span class="punctuation">[</span>which<span class="punctuation">(</span>gene<span class="operator">$</span>type <span class="operator">==</span> <span class="string">&#x27;CDS&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span><span class="string">&#x27;type&#x27;</span><span class="punctuation">]</span> <span class="operator">&lt;-</span> <span class="number">1</span></span><br><span class="line">gene<span class="punctuation">[</span>which<span class="punctuation">(</span>gene<span class="operator">$</span>type <span class="operator">==</span> <span class="string">&#x27;rRNA&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span><span class="string">&#x27;type&#x27;</span><span class="punctuation">]</span> <span class="operator">&lt;-</span> <span class="number">2</span></span><br><span class="line">gene<span class="punctuation">[</span>which<span class="punctuation">(</span>gene<span class="operator">$</span>type <span class="operator">==</span> <span class="string">&#x27;tRNA&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span><span class="string">&#x27;type&#x27;</span><span class="punctuation">]</span> <span class="operator">&lt;-</span> <span class="number">3</span></span><br><span class="line">gene<span class="operator">$</span>type <span class="operator">&lt;-</span> <span class="built_in">as.numeric</span><span class="punctuation">(</span>gene<span class="operator">$</span>type<span class="punctuation">)</span></span><br><span class="line">gene <span class="operator">&lt;-</span> <span class="built_in">list</span><span class="punctuation">(</span>subset<span class="punctuation">(</span>gene<span class="punctuation">,</span> strand <span class="operator">==</span> <span class="string">&#x27;-&#x27;</span><span class="punctuation">)</span><span class="punctuation">[</span><span class="operator">-</span><span class="number">5</span><span class="punctuation">]</span><span class="punctuation">,</span> subset<span class="punctuation">(</span>gene<span class="punctuation">,</span> strand <span class="operator">==</span> <span class="string">&#x27;+&#x27;</span><span class="punctuation">)</span><span class="punctuation">[</span><span class="operator">-</span><span class="number">5</span><span class="punctuation">]</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##读取 SNP 检测结果</span></span><br><span class="line"><span class="comment">#读取 vcf 文件，统计 SNP 类型</span></span><br><span class="line">snp <span class="operator">&lt;-</span> read.delim<span class="punctuation">(</span>snp_vcf<span class="punctuation">,</span> header <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">,</span> colClasses <span class="operator">=</span> <span class="string">&#x27;character&#x27;</span><span class="punctuation">,</span> comment.char <span class="operator">=</span> <span class="string">&#x27;#&#x27;</span><span class="punctuation">)</span><span class="punctuation">[</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span> <span class="number">2</span><span class="punctuation">,</span> <span class="number">4</span><span class="punctuation">,</span> <span class="number">5</span><span class="punctuation">)</span><span class="punctuation">]</span></span><br><span class="line">snp<span class="operator">$</span>V2 <span class="operator">&lt;-</span> <span class="built_in">as.numeric</span><span class="punctuation">(</span>snp<span class="operator">$</span>V2<span class="punctuation">)</span></span><br><span class="line">snp<span class="operator">$</span>change <span class="operator">&lt;-</span> str_c<span class="punctuation">(</span>snp<span class="operator">$</span>V4<span class="punctuation">,</span> snp<span class="operator">$</span>V5<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">change <span class="operator">&lt;-</span> which<span class="punctuation">(</span>snp<span class="operator">$</span>change <span class="operator">==</span> <span class="string">&#x27;AT&#x27;</span><span class="punctuation">)</span></span><br><span class="line">snp<span class="punctuation">[</span>change<span class="punctuation">,</span><span class="string">&#x27;type1&#x27;</span><span class="punctuation">]</span> <span class="operator">&lt;-</span> <span class="string">&#x27;A&gt;T|T&gt;A&#x27;</span>; snp<span class="punctuation">[</span>change<span class="punctuation">,</span><span class="string">&#x27;type2&#x27;</span><span class="punctuation">]</span> <span class="operator">&lt;-</span> <span class="string">&#x27;tv&#x27;</span></span><br><span class="line">change <span class="operator">&lt;-</span> which<span class="punctuation">(</span>snp<span class="operator">$</span>change <span class="operator">==</span> <span class="string">&#x27;AG&#x27;</span><span class="punctuation">)</span></span><br><span class="line">snp<span class="punctuation">[</span>change<span class="punctuation">,</span><span class="string">&#x27;type1&#x27;</span><span class="punctuation">]</span> <span class="operator">&lt;-</span> <span class="string">&#x27;A&gt;G|T&gt;C&#x27;</span>; snp<span class="punctuation">[</span>change<span class="punctuation">,</span><span class="string">&#x27;type2&#x27;</span><span class="punctuation">]</span> <span class="operator">&lt;-</span> <span class="string">&#x27;ti&#x27;</span></span><br><span class="line">change <span class="operator">&lt;-</span> which<span class="punctuation">(</span>snp<span class="operator">$</span>change <span class="operator">==</span> <span class="string">&#x27;AC&#x27;</span><span class="punctuation">)</span></span><br><span class="line">snp<span class="punctuation">[</span>change<span class="punctuation">,</span><span class="string">&#x27;type1&#x27;</span><span class="punctuation">]</span> <span class="operator">&lt;-</span> <span class="string">&#x27;A&gt;C|T&gt;G&#x27;</span>; snp<span class="punctuation">[</span>change<span class="punctuation">,</span><span class="string">&#x27;type2&#x27;</span><span class="punctuation">]</span> <span class="operator">&lt;-</span> <span class="string">&#x27;tv&#x27;</span></span><br><span class="line"></span><br><span class="line">change <span class="operator">&lt;-</span> which<span class="punctuation">(</span>snp<span class="operator">$</span>change <span class="operator">==</span> <span class="string">&#x27;TA&#x27;</span><span class="punctuation">)</span></span><br><span class="line">snp<span class="punctuation">[</span>change<span class="punctuation">,</span><span class="string">&#x27;type1&#x27;</span><span class="punctuation">]</span> <span class="operator">&lt;-</span> <span class="string">&#x27;A&gt;T|T&gt;A&#x27;</span>; snp<span class="punctuation">[</span>change<span class="punctuation">,</span><span class="string">&#x27;type2&#x27;</span><span class="punctuation">]</span> <span class="operator">&lt;-</span> <span class="string">&#x27;tv&#x27;</span></span><br><span class="line">change <span class="operator">&lt;-</span> which<span class="punctuation">(</span>snp<span class="operator">$</span>change <span class="operator">==</span> <span class="string">&#x27;TG&#x27;</span><span class="punctuation">)</span></span><br><span class="line">snp<span class="punctuation">[</span>change<span class="punctuation">,</span><span class="string">&#x27;type1&#x27;</span><span class="punctuation">]</span> <span class="operator">&lt;-</span> <span class="string">&#x27;A&gt;C|T&gt;G&#x27;</span>; snp<span class="punctuation">[</span>change<span class="punctuation">,</span><span class="string">&#x27;type2&#x27;</span><span class="punctuation">]</span> <span class="operator">&lt;-</span> <span class="string">&#x27;tv&#x27;</span></span><br><span class="line">change <span class="operator">&lt;-</span> which<span class="punctuation">(</span>snp<span class="operator">$</span>change <span class="operator">==</span> <span class="string">&#x27;TC&#x27;</span><span class="punctuation">)</span></span><br><span class="line">snp<span class="punctuation">[</span>change<span class="punctuation">,</span><span class="string">&#x27;type1&#x27;</span><span class="punctuation">]</span> <span class="operator">&lt;-</span> <span class="string">&#x27;A&gt;G|T&gt;C&#x27;</span>; snp<span class="punctuation">[</span>change<span class="punctuation">,</span><span class="string">&#x27;type2&#x27;</span><span class="punctuation">]</span> <span class="operator">&lt;-</span> <span class="string">&#x27;ti&#x27;</span></span><br><span class="line"></span><br><span class="line">change <span class="operator">&lt;-</span> which<span class="punctuation">(</span>snp<span class="operator">$</span>change <span class="operator">==</span> <span class="string">&#x27;GA&#x27;</span><span class="punctuation">)</span></span><br><span class="line">snp<span class="punctuation">[</span>change<span class="punctuation">,</span><span class="string">&#x27;type1&#x27;</span><span class="punctuation">]</span> <span class="operator">&lt;-</span> <span class="string">&#x27;G&gt;A|C&gt;T&#x27;</span>; snp<span class="punctuation">[</span>change<span class="punctuation">,</span><span class="string">&#x27;type2&#x27;</span><span class="punctuation">]</span> <span class="operator">&lt;-</span> <span class="string">&#x27;ti&#x27;</span></span><br><span class="line">change <span class="operator">&lt;-</span> which<span class="punctuation">(</span>snp<span class="operator">$</span>change <span class="operator">==</span> <span class="string">&#x27;GT&#x27;</span><span class="punctuation">)</span></span><br><span class="line">snp<span class="punctuation">[</span>change<span class="punctuation">,</span><span class="string">&#x27;type1&#x27;</span><span class="punctuation">]</span> <span class="operator">&lt;-</span> <span class="string">&#x27;G&gt;T|C&gt;A&#x27;</span>; snp<span class="punctuation">[</span>change<span class="punctuation">,</span><span class="string">&#x27;type2&#x27;</span><span class="punctuation">]</span> <span class="operator">&lt;-</span> <span class="string">&#x27;tv&#x27;</span></span><br><span class="line">change <span class="operator">&lt;-</span> which<span class="punctuation">(</span>snp<span class="operator">$</span>change <span class="operator">==</span> <span class="string">&#x27;GC&#x27;</span><span class="punctuation">)</span></span><br><span class="line">snp<span class="punctuation">[</span>change<span class="punctuation">,</span><span class="string">&#x27;type1&#x27;</span><span class="punctuation">]</span> <span class="operator">&lt;-</span> <span class="string">&#x27;G&gt;C|C&gt;G&#x27;</span>; snp<span class="punctuation">[</span>change<span class="punctuation">,</span><span class="string">&#x27;type2&#x27;</span><span class="punctuation">]</span> <span class="operator">&lt;-</span> <span class="string">&#x27;tv&#x27;</span></span><br><span class="line"></span><br><span class="line">change <span class="operator">&lt;-</span> which<span class="punctuation">(</span>snp<span class="operator">$</span>change <span class="operator">==</span> <span class="string">&#x27;CA&#x27;</span><span class="punctuation">)</span></span><br><span class="line">snp<span class="punctuation">[</span>change<span class="punctuation">,</span><span class="string">&#x27;type1&#x27;</span><span class="punctuation">]</span> <span class="operator">&lt;-</span> <span class="string">&#x27;G&gt;T|C&gt;A&#x27;</span>; snp<span class="punctuation">[</span>change<span class="punctuation">,</span><span class="string">&#x27;type2&#x27;</span><span class="punctuation">]</span> <span class="operator">&lt;-</span> <span class="string">&#x27;tv&#x27;</span></span><br><span class="line">change <span class="operator">&lt;-</span> which<span class="punctuation">(</span>snp<span class="operator">$</span>change <span class="operator">==</span> <span class="string">&#x27;CT&#x27;</span><span class="punctuation">)</span></span><br><span class="line">snp<span class="punctuation">[</span>change<span class="punctuation">,</span><span class="string">&#x27;type1&#x27;</span><span class="punctuation">]</span> <span class="operator">&lt;-</span> <span class="string">&#x27;G&gt;A|C&gt;T&#x27;</span>; snp<span class="punctuation">[</span>change<span class="punctuation">,</span><span class="string">&#x27;type2&#x27;</span><span class="punctuation">]</span> <span class="operator">&lt;-</span> <span class="string">&#x27;ti&#x27;</span></span><br><span class="line">change <span class="operator">&lt;-</span> which<span class="punctuation">(</span>snp<span class="operator">$</span>change <span class="operator">==</span> <span class="string">&#x27;CG&#x27;</span><span class="punctuation">)</span></span><br><span class="line">snp<span class="punctuation">[</span>change<span class="punctuation">,</span><span class="string">&#x27;type1&#x27;</span><span class="punctuation">]</span> <span class="operator">&lt;-</span> <span class="string">&#x27;G&gt;C|C&gt;G&#x27;</span>; snp<span class="punctuation">[</span>change<span class="punctuation">,</span><span class="string">&#x27;type2&#x27;</span><span class="punctuation">]</span> <span class="operator">&lt;-</span> <span class="string">&#x27;tv&#x27;</span></span><br><span class="line"></span><br><span class="line">snp_ti <span class="operator">&lt;-</span> <span class="built_in">length</span><span class="punctuation">(</span>which<span class="punctuation">(</span>snp<span class="operator">$</span>type2 <span class="operator">==</span> <span class="string">&#x27;ti&#x27;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">snp_tv <span class="operator">&lt;-</span> <span class="built_in">length</span><span class="punctuation">(</span>which<span class="punctuation">(</span>snp<span class="operator">$</span>type2 <span class="operator">==</span> <span class="string">&#x27;tv&#x27;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">snp_at <span class="operator">&lt;-</span> <span class="built_in">length</span><span class="punctuation">(</span>which<span class="punctuation">(</span>snp<span class="operator">$</span>type1 <span class="operator">==</span> <span class="string">&#x27;A&gt;T|T&gt;A&#x27;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">snp_ag <span class="operator">&lt;-</span> <span class="built_in">length</span><span class="punctuation">(</span>which<span class="punctuation">(</span>snp<span class="operator">$</span>type1 <span class="operator">==</span> <span class="string">&#x27;A&gt;G|T&gt;C&#x27;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">snp_ac <span class="operator">&lt;-</span> <span class="built_in">length</span><span class="punctuation">(</span>which<span class="punctuation">(</span>snp<span class="operator">$</span>type1 <span class="operator">==</span> <span class="string">&#x27;A&gt;C|T&gt;G&#x27;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">snp_ga <span class="operator">&lt;-</span> <span class="built_in">length</span><span class="punctuation">(</span>which<span class="punctuation">(</span>snp<span class="operator">$</span>type1 <span class="operator">==</span> <span class="string">&#x27;G&gt;A|C&gt;T&#x27;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">snp_gt <span class="operator">&lt;-</span> <span class="built_in">length</span><span class="punctuation">(</span>which<span class="punctuation">(</span>snp<span class="operator">$</span>type1 <span class="operator">==</span> <span class="string">&#x27;G&gt;T|C&gt;A&#x27;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">snp_gc <span class="operator">&lt;-</span> <span class="built_in">length</span><span class="punctuation">(</span>which<span class="punctuation">(</span>snp<span class="operator">$</span>type1 <span class="operator">==</span> <span class="string">&#x27;G&gt;C|C&gt;G&#x27;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#统计 SNP 密度</span></span><br><span class="line">snp <span class="operator">&lt;-</span> snp<span class="punctuation">[</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span> <span class="number">2</span><span class="punctuation">,</span> <span class="number">5</span><span class="punctuation">,</span> <span class="number">6</span><span class="punctuation">,</span> <span class="number">7</span><span class="punctuation">)</span><span class="punctuation">]</span></span><br><span class="line">colnames<span class="punctuation">(</span>snp<span class="punctuation">)</span><span class="punctuation">[</span><span class="number">1</span><span class="operator">:</span><span class="number">2</span><span class="punctuation">]</span> <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;seq_ID&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;seq_site&#x27;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">snp_stat <span class="operator">&lt;-</span> <span class="literal">NULL</span></span><br><span class="line">seq_ID <span class="operator">&lt;-</span> unique<span class="punctuation">(</span>snp<span class="operator">$</span>seq_ID<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> <span class="punctuation">(</span>seq_ID_n <span class="keyword">in</span> seq_ID<span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">	snp_subset <span class="operator">&lt;-</span> subset<span class="punctuation">(</span>snp<span class="punctuation">,</span> seq_ID <span class="operator">==</span> seq_ID_n<span class="punctuation">)</span></span><br><span class="line">	seq_end <span class="operator">&lt;-</span> seq_split</span><br><span class="line">	snp_num <span class="operator">&lt;-</span> 0</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">for</span> <span class="punctuation">(</span>i <span class="keyword">in</span> <span class="number">1</span><span class="operator">:</span>nrow<span class="punctuation">(</span>snp_subset<span class="punctuation">)</span><span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">		<span class="keyword">if</span> <span class="punctuation">(</span>snp_subset<span class="punctuation">[</span>i<span class="punctuation">,</span><span class="string">&#x27;seq_site&#x27;</span><span class="punctuation">]</span> <span class="operator">&lt;=</span> seq_end<span class="punctuation">)</span> snp_num <span class="operator">&lt;-</span> snp_num <span class="operator">+</span> <span class="number">1</span></span><br><span class="line">		<span class="keyword">else</span> <span class="punctuation">&#123;</span></span><br><span class="line">			snp_stat <span class="operator">&lt;-</span> rbind<span class="punctuation">(</span>snp_stat<span class="punctuation">,</span> <span class="built_in">c</span><span class="punctuation">(</span>seq_ID_n<span class="punctuation">,</span> seq_end <span class="operator">-</span> seq_split <span class="operator">+</span> <span class="number">1</span><span class="punctuation">,</span> seq_end<span class="punctuation">,</span> snp_num<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">			</span><br><span class="line">			seq_end <span class="operator">&lt;-</span> seq_end <span class="operator">+</span> seq_split</span><br><span class="line">			snp_num <span class="operator">&lt;-</span> 0</span><br><span class="line">			<span class="keyword">while</span> <span class="punctuation">(</span>snp_subset<span class="punctuation">[</span>i<span class="punctuation">,</span><span class="string">&#x27;seq_site&#x27;</span><span class="punctuation">]</span> <span class="operator">&gt;</span> seq_end<span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">				snp_stat <span class="operator">&lt;-</span> rbind<span class="punctuation">(</span>snp_stat<span class="punctuation">,</span> <span class="built_in">c</span><span class="punctuation">(</span>seq_ID_n<span class="punctuation">,</span> seq_end <span class="operator">-</span> seq_split <span class="operator">+</span> <span class="number">1</span><span class="punctuation">,</span> seq_end<span class="punctuation">,</span> snp_num<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">				seq_end <span class="operator">&lt;-</span> seq_end <span class="operator">+</span> seq_split</span><br><span class="line">			<span class="punctuation">&#125;</span></span><br><span class="line">			snp_num <span class="operator">&lt;-</span> snp_num <span class="operator">+</span> <span class="number">1</span></span><br><span class="line">		<span class="punctuation">&#125;</span></span><br><span class="line">	<span class="punctuation">&#125;</span></span><br><span class="line">	</span><br><span class="line">	<span class="keyword">while</span> <span class="punctuation">(</span>seq_end <span class="operator">&lt;</span> seq_stat<span class="punctuation">[</span>seq_ID_n<span class="punctuation">,</span><span class="string">&#x27;seq_end&#x27;</span><span class="punctuation">]</span><span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">		snp_stat <span class="operator">&lt;-</span> rbind<span class="punctuation">(</span>snp_stat<span class="punctuation">,</span> <span class="built_in">c</span><span class="punctuation">(</span>seq_ID_n<span class="punctuation">,</span> seq_end <span class="operator">-</span> seq_split <span class="operator">+</span> <span class="number">1</span><span class="punctuation">,</span> seq_end<span class="punctuation">,</span> snp_num<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">		seq_end <span class="operator">&lt;-</span> seq_end <span class="operator">+</span> seq_split</span><br><span class="line">		snp_num <span class="operator">&lt;-</span> 0</span><br><span class="line">	<span class="punctuation">&#125;</span></span><br><span class="line">	snp_stat <span class="operator">&lt;-</span> rbind<span class="punctuation">(</span>snp_stat<span class="punctuation">,</span> <span class="built_in">c</span><span class="punctuation">(</span>seq_ID_n<span class="punctuation">,</span> seq_end <span class="operator">-</span> seq_split <span class="operator">+</span> <span class="number">1</span><span class="punctuation">,</span> seq_stat<span class="punctuation">[</span>seq_ID_n<span class="punctuation">,</span><span class="string">&#x27;seq_end&#x27;</span><span class="punctuation">]</span><span class="punctuation">,</span> snp_num<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line">snp_stat <span class="operator">&lt;-</span> data.frame<span class="punctuation">(</span>snp_stat<span class="punctuation">,</span> stringsAsFactors <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span></span><br><span class="line"><span class="built_in">names</span><span class="punctuation">(</span>snp_stat<span class="punctuation">)</span> <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;seq_ID&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;seq_start&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;seq_end&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;snp_num&#x27;</span><span class="punctuation">)</span></span><br><span class="line">snp_stat<span class="operator">$</span>seq_start <span class="operator">&lt;-</span> <span class="built_in">as.numeric</span><span class="punctuation">(</span>snp_stat<span class="operator">$</span>seq_start<span class="punctuation">)</span></span><br><span class="line">snp_stat<span class="operator">$</span>seq_end <span class="operator">&lt;-</span> <span class="built_in">as.numeric</span><span class="punctuation">(</span>snp_stat<span class="operator">$</span>seq_end<span class="punctuation">)</span></span><br><span class="line">snp_stat<span class="operator">$</span>snp_num <span class="operator">&lt;-</span> <span class="built_in">as.numeric</span><span class="punctuation">(</span>snp_stat<span class="operator">$</span>snp_num<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">write.table<span class="punctuation">(</span>snp_stat<span class="punctuation">,</span> str_c<span class="punctuation">(</span>out_dir<span class="punctuation">,</span> <span class="string">&#x27;/&#x27;</span><span class="punctuation">,</span> sample_name<span class="punctuation">,</span> <span class="string">&#x27;.snp_stat.txt&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span> row.names <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">,</span> sep <span class="operator">=</span> <span class="string">&#x27;\t&#x27;</span><span class="punctuation">,</span> <span class="built_in">quote</span> <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##读取 InDel 检测结果</span></span><br><span class="line"><span class="comment">#读取 vcf 文件，统计 InDel 长度</span></span><br><span class="line">indel <span class="operator">&lt;-</span> read.delim<span class="punctuation">(</span>indel_vcf<span class="punctuation">,</span> header <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">,</span> colClasses <span class="operator">=</span> <span class="string">&#x27;character&#x27;</span><span class="punctuation">,</span> comment.char <span class="operator">=</span> <span class="string">&#x27;#&#x27;</span><span class="punctuation">)</span><span class="punctuation">[</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span> <span class="number">2</span><span class="punctuation">,</span> <span class="number">4</span><span class="punctuation">,</span> <span class="number">5</span><span class="punctuation">)</span><span class="punctuation">]</span></span><br><span class="line">indel<span class="operator">$</span>V2 <span class="operator">&lt;-</span> <span class="built_in">as.numeric</span><span class="punctuation">(</span>indel<span class="operator">$</span>V2<span class="punctuation">)</span></span><br><span class="line">indel<span class="operator">$</span><span class="built_in">length</span> <span class="operator">&lt;-</span> str_length<span class="punctuation">(</span>indel<span class="punctuation">[</span> <span class="punctuation">,</span><span class="number">4</span><span class="punctuation">]</span><span class="punctuation">)</span> <span class="operator">-</span> str_length<span class="punctuation">(</span>indel<span class="punctuation">[</span> <span class="punctuation">,</span><span class="number">3</span><span class="punctuation">]</span><span class="punctuation">)</span></span><br><span class="line">indel_insert <span class="operator">&lt;-</span> <span class="built_in">length</span><span class="punctuation">(</span>which<span class="punctuation">(</span>indel<span class="operator">$</span><span class="built_in">length</span> <span class="operator">&gt;</span> <span class="number">0</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">indel_delet <span class="operator">&lt;-</span> <span class="built_in">length</span><span class="punctuation">(</span>which<span class="punctuation">(</span>indel<span class="operator">$</span><span class="built_in">length</span> <span class="operator">&lt;</span> <span class="number">0</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#统计 InDel 密度</span></span><br><span class="line">indel <span class="operator">&lt;-</span> indel<span class="punctuation">[</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span> <span class="number">2</span><span class="punctuation">,</span> <span class="number">5</span><span class="punctuation">)</span><span class="punctuation">]</span></span><br><span class="line">colnames<span class="punctuation">(</span>indel<span class="punctuation">)</span><span class="punctuation">[</span><span class="number">1</span><span class="operator">:</span><span class="number">2</span><span class="punctuation">]</span> <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;seq_ID&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;seq_site&#x27;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">indel_stat <span class="operator">&lt;-</span> <span class="literal">NULL</span></span><br><span class="line">seq_ID <span class="operator">&lt;-</span> unique<span class="punctuation">(</span>indel<span class="operator">$</span>seq_ID<span class="punctuation">)</span></span><br><span class="line"><span class="keyword">for</span> <span class="punctuation">(</span>seq_ID_n <span class="keyword">in</span> seq_ID<span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">	indel_subset <span class="operator">&lt;-</span> subset<span class="punctuation">(</span>indel<span class="punctuation">,</span> seq_ID <span class="operator">==</span> seq_ID_n<span class="punctuation">)</span></span><br><span class="line">	seq_end <span class="operator">&lt;-</span> seq_split</span><br><span class="line">	indel_num <span class="operator">&lt;-</span> 0</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">for</span> <span class="punctuation">(</span>i <span class="keyword">in</span> <span class="number">1</span><span class="operator">:</span>nrow<span class="punctuation">(</span>indel_subset<span class="punctuation">)</span><span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">		<span class="keyword">if</span> <span class="punctuation">(</span>indel_subset<span class="punctuation">[</span>i<span class="punctuation">,</span><span class="string">&#x27;seq_site&#x27;</span><span class="punctuation">]</span> <span class="operator">&lt;=</span> seq_end<span class="punctuation">)</span> indel_num <span class="operator">&lt;-</span> indel_num <span class="operator">+</span> <span class="number">1</span></span><br><span class="line">		<span class="keyword">else</span> <span class="punctuation">&#123;</span></span><br><span class="line">			indel_stat <span class="operator">&lt;-</span> rbind<span class="punctuation">(</span>indel_stat<span class="punctuation">,</span> <span class="built_in">c</span><span class="punctuation">(</span>seq_ID_n<span class="punctuation">,</span> seq_end <span class="operator">-</span> seq_split <span class="operator">+</span> <span class="number">1</span><span class="punctuation">,</span> seq_end<span class="punctuation">,</span> indel_num<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">			</span><br><span class="line">			seq_end <span class="operator">&lt;-</span> seq_end <span class="operator">+</span> seq_split</span><br><span class="line">			indel_num <span class="operator">&lt;-</span> 0</span><br><span class="line">			<span class="keyword">while</span> <span class="punctuation">(</span>indel_subset<span class="punctuation">[</span>i<span class="punctuation">,</span><span class="string">&#x27;seq_site&#x27;</span><span class="punctuation">]</span> <span class="operator">&gt;</span> seq_end<span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">				indel_stat <span class="operator">&lt;-</span> rbind<span class="punctuation">(</span>indel_stat<span class="punctuation">,</span> <span class="built_in">c</span><span class="punctuation">(</span>seq_ID_n<span class="punctuation">,</span> seq_end <span class="operator">-</span> seq_split <span class="operator">+</span> <span class="number">1</span><span class="punctuation">,</span> seq_end<span class="punctuation">,</span> indel_num<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">				seq_end <span class="operator">&lt;-</span> seq_end <span class="operator">+</span> seq_split</span><br><span class="line">			<span class="punctuation">&#125;</span></span><br><span class="line">			indel_num <span class="operator">&lt;-</span> indel_num <span class="operator">+</span> <span class="number">1</span></span><br><span class="line">		<span class="punctuation">&#125;</span></span><br><span class="line">	<span class="punctuation">&#125;</span></span><br><span class="line">	</span><br><span class="line">	<span class="keyword">while</span> <span class="punctuation">(</span>seq_end <span class="operator">&lt;</span> seq_stat<span class="punctuation">[</span>seq_ID_n<span class="punctuation">,</span><span class="string">&#x27;seq_end&#x27;</span><span class="punctuation">]</span><span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">		indel_stat <span class="operator">&lt;-</span> rbind<span class="punctuation">(</span>indel_stat<span class="punctuation">,</span> <span class="built_in">c</span><span class="punctuation">(</span>seq_ID_n<span class="punctuation">,</span> seq_end <span class="operator">-</span> seq_split <span class="operator">+</span> <span class="number">1</span><span class="punctuation">,</span> seq_end<span class="punctuation">,</span> indel_num<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">		seq_end <span class="operator">&lt;-</span> seq_end <span class="operator">+</span> seq_split</span><br><span class="line">		indel_num <span class="operator">&lt;-</span> 0</span><br><span class="line">	<span class="punctuation">&#125;</span></span><br><span class="line">	indel_stat <span class="operator">&lt;-</span> rbind<span class="punctuation">(</span>indel_stat<span class="punctuation">,</span> <span class="built_in">c</span><span class="punctuation">(</span>seq_ID_n<span class="punctuation">,</span> seq_end <span class="operator">-</span> seq_split <span class="operator">+</span> <span class="number">1</span><span class="punctuation">,</span> seq_stat<span class="punctuation">[</span>seq_ID_n<span class="punctuation">,</span><span class="string">&#x27;seq_end&#x27;</span><span class="punctuation">]</span><span class="punctuation">,</span> indel_num<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line">indel_stat <span class="operator">&lt;-</span> data.frame<span class="punctuation">(</span>indel_stat<span class="punctuation">,</span> stringsAsFactors <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span></span><br><span class="line"><span class="built_in">names</span><span class="punctuation">(</span>indel_stat<span class="punctuation">)</span> <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;seq_ID&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;seq_start&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;seq_end&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;indel_num&#x27;</span><span class="punctuation">)</span></span><br><span class="line">indel_stat<span class="operator">$</span>seq_start <span class="operator">&lt;-</span> <span class="built_in">as.numeric</span><span class="punctuation">(</span>indel_stat<span class="operator">$</span>seq_start<span class="punctuation">)</span></span><br><span class="line">indel_stat<span class="operator">$</span>seq_end <span class="operator">&lt;-</span> <span class="built_in">as.numeric</span><span class="punctuation">(</span>indel_stat<span class="operator">$</span>seq_end<span class="punctuation">)</span></span><br><span class="line">indel_stat<span class="operator">$</span>indel_num <span class="operator">&lt;-</span> <span class="built_in">as.numeric</span><span class="punctuation">(</span>indel_stat<span class="operator">$</span>indel_num<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">write.table<span class="punctuation">(</span>indel_stat<span class="punctuation">,</span> str_c<span class="punctuation">(</span>out_dir<span class="punctuation">,</span> <span class="string">&#x27;/&#x27;</span><span class="punctuation">,</span> sample_name<span class="punctuation">,</span> <span class="string">&#x27;.indel_stat.txt&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span> row.names <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">,</span> sep <span class="operator">=</span> <span class="string">&#x27;\t&#x27;</span><span class="punctuation">,</span> <span class="built_in">quote</span> <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##读取 CNV 检测结果</span></span><br><span class="line">cnv <span class="operator">&lt;-</span> read.delim<span class="punctuation">(</span>cnv_cnv<span class="punctuation">,</span> header <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">,</span> stringsAsFactors <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span><span class="punctuation">[</span><span class="number">1</span><span class="operator">:</span><span class="number">2</span><span class="punctuation">]</span></span><br><span class="line"><span class="keyword">for</span> <span class="punctuation">(</span>i <span class="keyword">in</span> <span class="number">1</span><span class="operator">:</span>nrow<span class="punctuation">(</span>cnv<span class="punctuation">)</span><span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">	str_split <span class="operator">&lt;-</span> unlist<span class="punctuation">(</span>str_split<span class="punctuation">(</span>cnv<span class="punctuation">[</span>i<span class="punctuation">,</span><span class="number">2</span><span class="punctuation">]</span><span class="punctuation">,</span> <span class="string">&#x27;[:-]&#x27;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">	cnv<span class="punctuation">[</span>i<span class="punctuation">,</span><span class="string">&#x27;seq_ID&#x27;</span><span class="punctuation">]</span> <span class="operator">&lt;-</span> str_split<span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span></span><br><span class="line">	cnv<span class="punctuation">[</span>i<span class="punctuation">,</span><span class="string">&#x27;seq_start&#x27;</span><span class="punctuation">]</span> <span class="operator">&lt;-</span> str_split<span class="punctuation">[</span><span class="number">2</span><span class="punctuation">]</span></span><br><span class="line">	cnv<span class="punctuation">[</span>i<span class="punctuation">,</span><span class="string">&#x27;seq_end&#x27;</span><span class="punctuation">]</span> <span class="operator">&lt;-</span> str_split<span class="punctuation">[</span><span class="number">3</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line">cnv <span class="operator">&lt;-</span> cnv<span class="punctuation">[</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">3</span><span class="operator">:</span><span class="number">5</span><span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">)</span><span class="punctuation">]</span></span><br><span class="line">cnv<span class="operator">$</span>seq_start <span class="operator">&lt;-</span> <span class="built_in">as.numeric</span><span class="punctuation">(</span>cnv<span class="operator">$</span>seq_start<span class="punctuation">)</span></span><br><span class="line">cnv<span class="operator">$</span>seq_end <span class="operator">&lt;-</span> <span class="built_in">as.numeric</span><span class="punctuation">(</span>cnv<span class="operator">$</span>seq_end<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">cnv_dup <span class="operator">&lt;-</span> <span class="built_in">length</span><span class="punctuation">(</span>which<span class="punctuation">(</span>cnv<span class="punctuation">[[</span><span class="number">4</span><span class="punctuation">]</span><span class="punctuation">]</span> <span class="operator">==</span> <span class="string">&#x27;duplication&#x27;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">cnv_del <span class="operator">&lt;-</span> <span class="built_in">length</span><span class="punctuation">(</span>which<span class="punctuation">(</span>cnv<span class="punctuation">[[</span><span class="number">4</span><span class="punctuation">]</span><span class="punctuation">]</span> <span class="operator">==</span> <span class="string">&#x27;deletion&#x27;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##读取 SV 检测结果</span></span><br><span class="line">sv <span class="operator">&lt;-</span> read.delim<span class="punctuation">(</span>sv_ctx<span class="punctuation">,</span> header <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">,</span> stringsAsFactors <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">,</span> comment.char <span class="operator">=</span> <span class="string">&#x27;#&#x27;</span><span class="punctuation">)</span><span class="punctuation">[</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span> <span class="number">2</span><span class="punctuation">,</span> <span class="number">4</span><span class="punctuation">,</span> <span class="number">5</span><span class="punctuation">,</span> <span class="number">7</span><span class="punctuation">)</span><span class="punctuation">]</span></span><br><span class="line"></span><br><span class="line">sv_in_de <span class="operator">&lt;-</span> subset<span class="punctuation">(</span>sv<span class="punctuation">,</span> sv<span class="punctuation">[[</span><span class="number">5</span><span class="punctuation">]</span><span class="punctuation">]</span> <span class="operator">%in%</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;INS&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;DEL&#x27;</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">[</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span> <span class="number">2</span><span class="punctuation">,</span> <span class="number">4</span><span class="punctuation">,</span> <span class="number">5</span><span class="punctuation">)</span><span class="punctuation">]</span></span><br><span class="line">sv_ITX <span class="operator">&lt;-</span> subset<span class="punctuation">(</span>sv<span class="punctuation">,</span> sv<span class="punctuation">[[</span><span class="number">5</span><span class="punctuation">]</span><span class="punctuation">]</span> <span class="operator">%in%</span> <span class="string">&#x27;ITX&#x27;</span><span class="punctuation">)</span></span><br><span class="line">sv_CTX <span class="operator">&lt;-</span> subset<span class="punctuation">(</span>sv<span class="punctuation">,</span> sv<span class="punctuation">[[</span><span class="number">5</span><span class="punctuation">]</span><span class="punctuation">]</span> <span class="operator">%in%</span> <span class="string">&#x27;CTX&#x27;</span><span class="punctuation">)</span></span><br><span class="line">sv_INV <span class="operator">&lt;-</span> subset<span class="punctuation">(</span>sv<span class="punctuation">,</span> sv<span class="punctuation">[[</span><span class="number">5</span><span class="punctuation">]</span><span class="punctuation">]</span> <span class="operator">%in%</span> <span class="string">&#x27;INV&#x27;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">sv_ins <span class="operator">&lt;-</span> <span class="built_in">length</span><span class="punctuation">(</span>which<span class="punctuation">(</span>sv<span class="punctuation">[[</span><span class="number">5</span><span class="punctuation">]</span><span class="punctuation">]</span> <span class="operator">==</span> <span class="string">&#x27;INS&#x27;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">sv_del <span class="operator">&lt;-</span> <span class="built_in">length</span><span class="punctuation">(</span>which<span class="punctuation">(</span>sv<span class="punctuation">[[</span><span class="number">5</span><span class="punctuation">]</span><span class="punctuation">]</span> <span class="operator">==</span> <span class="string">&#x27;DEL&#x27;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">sv_itx <span class="operator">&lt;-</span> nrow<span class="punctuation">(</span>sv_ITX<span class="punctuation">)</span></span><br><span class="line">sv_ctx <span class="operator">&lt;-</span> nrow<span class="punctuation">(</span>sv_CTX<span class="punctuation">)</span></span><br><span class="line">sv_inv <span class="operator">&lt;-</span> nrow<span class="punctuation">(</span>sv_INV<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#####################</span></span><br><span class="line"><span class="comment">##circlize 绘图</span></span><br><span class="line">pdf<span class="punctuation">(</span>str_c<span class="punctuation">(</span>out_dir<span class="punctuation">,</span> <span class="string">&#x27;/&#x27;</span><span class="punctuation">,</span> sample_name<span class="punctuation">,</span> <span class="string">&#x27;.circlize.pdf&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span> width <span class="operator">=</span> <span class="number">14</span><span class="punctuation">,</span> height <span class="operator">=</span> <span class="number">8</span><span class="punctuation">)</span></span><br><span class="line">circle_size <span class="operator">=</span> unit<span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span> <span class="string">&quot;snpc&quot;</span><span class="punctuation">)</span></span><br><span class="line">circos.par<span class="punctuation">(</span>gap.degree <span class="operator">=</span> <span class="number">2</span><span class="punctuation">)</span></span><br><span class="line">circos.genomicInitialize<span class="punctuation">(</span>seq_stat<span class="punctuation">,</span> plotType <span class="operator">=</span> <span class="string">&#x27;axis&#x27;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">circos.track<span class="punctuation">(</span></span><br><span class="line">	ylim <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">)</span><span class="punctuation">,</span> track.height <span class="operator">=</span> <span class="number">0.05</span><span class="punctuation">,</span> bg.border <span class="operator">=</span> <span class="literal">NA</span><span class="punctuation">,</span> bg.col <span class="operator">=</span> <span class="string">&#x27;#8DD3C7&#x27;</span><span class="punctuation">,</span></span><br><span class="line">	panel.fun <span class="operator">=</span> <span class="keyword">function</span><span class="punctuation">(</span>x<span class="punctuation">,</span> y<span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">		xlim <span class="operator">=</span> CELL_META<span class="operator">$</span>xlim</span><br><span class="line">		ylim <span class="operator">=</span> CELL_META<span class="operator">$</span>ylim</span><br><span class="line">		seq_ID <span class="operator">=</span> CELL_META<span class="operator">$</span>sector.index</span><br><span class="line">		circos.text<span class="punctuation">(</span>mean<span class="punctuation">(</span>xlim<span class="punctuation">)</span><span class="punctuation">,</span> mean<span class="punctuation">(</span>ylim<span class="punctuation">)</span><span class="punctuation">,</span> seq_ID<span class="punctuation">,</span> cex <span class="operator">=</span> <span class="number">0.7</span><span class="punctuation">,</span> col <span class="operator">=</span> <span class="string">&#x27;black&#x27;</span><span class="punctuation">,</span> facing <span class="operator">=</span> <span class="string">&#x27;inside&#x27;</span><span class="punctuation">,</span> niceFacing <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span></span><br><span class="line">	<span class="punctuation">&#125;</span> <span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#GC% 含量图</span></span><br><span class="line">circos.genomicTrack<span class="punctuation">(</span></span><br><span class="line">	depth_base<span class="punctuation">[</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">1</span><span class="operator">:</span><span class="number">3</span><span class="punctuation">,</span> <span class="number">5</span><span class="punctuation">)</span><span class="punctuation">]</span><span class="punctuation">,</span> track.height <span class="operator">=</span> <span class="number">0.08</span><span class="punctuation">,</span> bg.col <span class="operator">=</span> <span class="string">&#x27;#EEEEEE6E&#x27;</span><span class="punctuation">,</span> bg.border <span class="operator">=</span> <span class="literal">NA</span><span class="punctuation">,</span></span><br><span class="line">	panel.fun <span class="operator">=</span> <span class="keyword">function</span><span class="punctuation">(</span>region<span class="punctuation">,</span> value<span class="punctuation">,</span> ...<span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">		circos.genomicLines<span class="punctuation">(</span>region<span class="punctuation">,</span> value<span class="punctuation">,</span> col <span class="operator">=</span> <span class="string">&#x27;blue&#x27;</span><span class="punctuation">,</span> lwd <span class="operator">=</span> <span class="number">0.35</span><span class="punctuation">,</span> ...<span class="punctuation">)</span></span><br><span class="line">		circos.lines<span class="punctuation">(</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span> <span class="built_in">max</span><span class="punctuation">(</span>region<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">,</span> <span class="built_in">c</span><span class="punctuation">(</span>genome_GC<span class="punctuation">,</span> genome_GC<span class="punctuation">)</span><span class="punctuation">,</span> col <span class="operator">=</span> <span class="string">&#x27;blue2&#x27;</span><span class="punctuation">,</span> lwd <span class="operator">=</span> <span class="number">0.15</span><span class="punctuation">,</span> lty <span class="operator">=</span> <span class="number">2</span><span class="punctuation">)</span></span><br><span class="line">	circos.yaxis<span class="punctuation">(</span>labels.cex <span class="operator">=</span> <span class="number">0.2</span><span class="punctuation">,</span> lwd <span class="operator">=</span> <span class="number">0.1</span><span class="punctuation">,</span> tick.length <span class="operator">=</span> convert_x<span class="punctuation">(</span><span class="number">0.15</span><span class="punctuation">,</span> <span class="string">&#x27;mm&#x27;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">	<span class="punctuation">&#125;</span> <span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">gc_legend <span class="operator">&lt;-</span> Legend<span class="punctuation">(</span></span><br><span class="line">	at <span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span> labels <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span>str_c<span class="punctuation">(</span><span class="string">&#x27;GC % ( Average: &#x27;</span><span class="punctuation">,</span> genome_GC<span class="punctuation">,</span> <span class="string">&#x27; % )&#x27;</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">,</span> labels_gp <span class="operator">=</span> gpar<span class="punctuation">(</span>fontsize <span class="operator">=</span> <span class="number">8</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">	grid_height <span class="operator">=</span> unit<span class="punctuation">(</span><span class="number">0.5</span><span class="punctuation">,</span> <span class="string">&#x27;cm&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span> grid_width <span class="operator">=</span> unit<span class="punctuation">(</span><span class="number">0.5</span><span class="punctuation">,</span> <span class="string">&#x27;cm&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span> type <span class="operator">=</span> <span class="string">&#x27;lines&#x27;</span><span class="punctuation">,</span> background <span class="operator">=</span> <span class="string">&#x27;#EEEEEE6E&#x27;</span><span class="punctuation">,</span> </span><br><span class="line">	legend_gp <span class="operator">=</span> gpar<span class="punctuation">(</span>col <span class="operator">=</span> <span class="string">&#x27;blue&#x27;</span><span class="punctuation">,</span> lwd <span class="operator">=</span> <span class="number">0.5</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#覆盖度 &amp; 深度</span></span><br><span class="line">circos.genomicTrack<span class="punctuation">(</span></span><br><span class="line">	depth_base<span class="punctuation">[</span><span class="number">1</span><span class="operator">:</span><span class="number">4</span><span class="punctuation">]</span><span class="punctuation">,</span> track.height <span class="operator">=</span> <span class="number">0.08</span><span class="punctuation">,</span> ylim <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span> <span class="punctuation">(</span><span class="built_in">max</span><span class="punctuation">(</span>depth_base<span class="operator">$</span>depth<span class="punctuation">)</span> <span class="operator">+</span> <span class="number">1</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">,</span> bg.col <span class="operator">=</span> <span class="string">&#x27;#EEEEEE6E&#x27;</span><span class="punctuation">,</span> bg.border <span class="operator">=</span> <span class="literal">NA</span><span class="punctuation">,</span></span><br><span class="line">	panel.fun <span class="operator">=</span> <span class="keyword">function</span><span class="punctuation">(</span>region<span class="punctuation">,</span>value<span class="punctuation">,</span> ...<span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">		circos.genomicRect<span class="punctuation">(</span>region<span class="punctuation">,</span> value<span class="punctuation">,</span> ytop.column <span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span> ybottom <span class="operator">=</span> <span class="number">0</span><span class="punctuation">,</span> border <span class="operator">=</span> <span class="string">&#x27;white&#x27;</span><span class="punctuation">,</span> lwd <span class="operator">=</span> <span class="number">0.02</span><span class="punctuation">,</span> col <span class="operator">=</span> <span class="string">&#x27;red&#x27;</span><span class="punctuation">,</span> ...<span class="punctuation">)</span></span><br><span class="line">		circos.lines<span class="punctuation">(</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span> <span class="built_in">max</span><span class="punctuation">(</span>region<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">,</span> <span class="built_in">c</span><span class="punctuation">(</span>average_depth<span class="punctuation">,</span> average_depth<span class="punctuation">)</span><span class="punctuation">,</span> col <span class="operator">=</span> <span class="string">&#x27;red3&#x27;</span><span class="punctuation">,</span> lwd <span class="operator">=</span> <span class="number">0.15</span><span class="punctuation">,</span> lty <span class="operator">=</span> <span class="number">2</span><span class="punctuation">)</span></span><br><span class="line">		circos.yaxis<span class="punctuation">(</span>labels.cex <span class="operator">=</span> <span class="number">0.2</span><span class="punctuation">,</span> lwd <span class="operator">=</span> <span class="number">0.1</span><span class="punctuation">,</span> tick.length <span class="operator">=</span> convert_x<span class="punctuation">(</span><span class="number">0.15</span><span class="punctuation">,</span> <span class="string">&#x27;mm&#x27;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">	<span class="punctuation">&#125;</span> <span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">depth_legend <span class="operator">&lt;-</span> Legend<span class="punctuation">(</span></span><br><span class="line">	at <span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span> labels <span class="operator">=</span> str_c<span class="punctuation">(</span><span class="string">&#x27; Depth ( average: &#x27;</span><span class="punctuation">,</span> average_depth<span class="punctuation">,</span> <span class="string">&#x27; X )&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span> labels_gp <span class="operator">=</span> gpar<span class="punctuation">(</span>fontsize <span class="operator">=</span> <span class="number">8</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">	title <span class="operator">=</span> str_c<span class="punctuation">(</span><span class="string">&#x27;Coverage: &#x27;</span><span class="punctuation">,</span> coverage <span class="punctuation">,</span> <span class="string">&#x27; %&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span> title_gp <span class="operator">=</span> gpar<span class="punctuation">(</span>fontsize <span class="operator">=</span> <span class="number">9</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">	grid_height <span class="operator">=</span> unit<span class="punctuation">(</span><span class="number">0.4</span><span class="punctuation">,</span> <span class="string">&#x27;cm&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span> grid_width <span class="operator">=</span> unit<span class="punctuation">(</span><span class="number">0.4</span><span class="punctuation">,</span> <span class="string">&#x27;cm&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span> type <span class="operator">=</span> <span class="string">&#x27;points&#x27;</span><span class="punctuation">,</span> pch <span class="operator">=</span> <span class="literal">NA</span><span class="punctuation">,</span> background <span class="operator">=</span> <span class="string">&#x27;red&#x27;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#CDS &amp; rRNA &amp; tRNA</span></span><br><span class="line">color_assign <span class="operator">&lt;-</span> colorRamp2<span class="punctuation">(</span>breaks <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span> <span class="number">2</span><span class="punctuation">,</span> <span class="number">3</span><span class="punctuation">)</span><span class="punctuation">,</span> col <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;#00ADFF&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;orange&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;green2&#x27;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">circos.genomicTrackPlotRegion<span class="punctuation">(</span></span><br><span class="line">	gene<span class="punctuation">,</span> track.height <span class="operator">=</span> <span class="number">0.12</span><span class="punctuation">,</span> stack <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">,</span> bg.border <span class="operator">=</span> <span class="literal">NA</span><span class="punctuation">,</span></span><br><span class="line">	panel.fun <span class="operator">=</span> <span class="keyword">function</span><span class="punctuation">(</span>region<span class="punctuation">,</span> value<span class="punctuation">,</span> ...<span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">		circos.genomicRect<span class="punctuation">(</span>region<span class="punctuation">,</span> value<span class="punctuation">,</span> col <span class="operator">=</span> color_assign<span class="punctuation">(</span>value<span class="punctuation">[[</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">,</span> border <span class="operator">=</span> <span class="literal">NA</span><span class="punctuation">,</span> ...<span class="punctuation">)</span></span><br><span class="line">	<span class="punctuation">&#125;</span> <span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">gene_legend <span class="operator">&lt;-</span> Legend<span class="punctuation">(</span></span><br><span class="line">	at <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">3</span><span class="punctuation">,</span> <span class="number">2</span><span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">)</span><span class="punctuation">,</span> labels <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27; CDS&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27; rRNA&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27; tRNA&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span> labels_gp <span class="operator">=</span> gpar<span class="punctuation">(</span>fontsize <span class="operator">=</span> <span class="number">8</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">	title <span class="operator">=</span> <span class="string">&#x27;CDS | rRNA | tRNA&#x27;</span><span class="punctuation">,</span> title_gp <span class="operator">=</span> gpar<span class="punctuation">(</span>fontsize <span class="operator">=</span> <span class="number">9</span><span class="punctuation">)</span><span class="punctuation">,</span> </span><br><span class="line">	grid_height <span class="operator">=</span> unit<span class="punctuation">(</span><span class="number">0.4</span><span class="punctuation">,</span> <span class="string">&#x27;cm&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span> grid_width <span class="operator">=</span> unit<span class="punctuation">(</span><span class="number">0.4</span><span class="punctuation">,</span> <span class="string">&#x27;cm&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span> type <span class="operator">=</span> <span class="string">&#x27;points&#x27;</span><span class="punctuation">,</span> pch <span class="operator">=</span> <span class="literal">NA</span><span class="punctuation">,</span> background <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;#00ADFF&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;orange&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;green2&#x27;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#SNP 密度</span></span><br><span class="line">value_max <span class="operator">&lt;-</span> <span class="built_in">max</span><span class="punctuation">(</span>snp_stat<span class="operator">$</span>snp_num<span class="punctuation">)</span></span><br><span class="line">colorsChoice <span class="operator">&lt;-</span> colorRampPalette<span class="punctuation">(</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;white&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;#245B8E&#x27;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">color_assign <span class="operator">&lt;-</span> colorRamp2<span class="punctuation">(</span>breaks <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">0</span><span class="operator">:</span>value_max<span class="punctuation">)</span><span class="punctuation">,</span> col <span class="operator">=</span> colorsChoice<span class="punctuation">(</span>value_max <span class="operator">+</span> <span class="number">1</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">circos.genomicTrackPlotRegion<span class="punctuation">(</span></span><br><span class="line">	snp_stat<span class="punctuation">,</span> track.height <span class="operator">=</span> <span class="number">0.08</span><span class="punctuation">,</span> stack <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">,</span> bg.border <span class="operator">=</span> <span class="literal">NA</span><span class="punctuation">,</span></span><br><span class="line">	panel.fun <span class="operator">=</span> <span class="keyword">function</span><span class="punctuation">(</span>region<span class="punctuation">,</span> value<span class="punctuation">,</span> ...<span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">		circos.genomicRect<span class="punctuation">(</span>region<span class="punctuation">,</span> value<span class="punctuation">,</span> col <span class="operator">=</span> color_assign<span class="punctuation">(</span>value<span class="punctuation">[[</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">,</span> border <span class="operator">=</span> <span class="literal">NA</span><span class="punctuation">,</span> ...<span class="punctuation">)</span></span><br><span class="line">	<span class="punctuation">&#125;</span> <span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">snp_legend <span class="operator">&lt;-</span> Legend<span class="punctuation">(</span></span><br><span class="line">	at <span class="operator">=</span> <span class="built_in">round</span><span class="punctuation">(</span>seq<span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span> value_max<span class="punctuation">,</span> length.out <span class="operator">=</span> <span class="number">6</span><span class="punctuation">)</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">)</span><span class="punctuation">,</span> labels_gp <span class="operator">=</span> gpar<span class="punctuation">(</span>fontsize <span class="operator">=</span> <span class="number">8</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">	col_fun <span class="operator">=</span> colorRamp2<span class="punctuation">(</span><span class="built_in">round</span><span class="punctuation">(</span>seq<span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span> value_max<span class="punctuation">,</span> length.out <span class="operator">=</span> <span class="number">6</span><span class="punctuation">)</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">)</span><span class="punctuation">,</span> colorsChoice<span class="punctuation">(</span><span class="number">6</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">	title_position <span class="operator">=</span> <span class="string">&#x27;topleft&#x27;</span><span class="punctuation">,</span> title <span class="operator">=</span> <span class="string">&#x27;SNP density&#x27;</span><span class="punctuation">,</span> legend_height <span class="operator">=</span> unit<span class="punctuation">(</span><span class="number">4</span><span class="punctuation">,</span> <span class="string">&#x27;cm&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span> title_gp <span class="operator">=</span> gpar<span class="punctuation">(</span>fontsize <span class="operator">=</span> <span class="number">9</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#InDel 密度</span></span><br><span class="line">value_max <span class="operator">&lt;-</span> <span class="built_in">max</span><span class="punctuation">(</span>indel_stat<span class="operator">$</span>indel_num<span class="punctuation">)</span></span><br><span class="line">colorsChoice <span class="operator">&lt;-</span> colorRampPalette<span class="punctuation">(</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;white&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;#7744A4&#x27;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">color_assign <span class="operator">&lt;-</span> colorRamp2<span class="punctuation">(</span>breaks <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">0</span><span class="operator">:</span>value_max<span class="punctuation">)</span><span class="punctuation">,</span> col <span class="operator">=</span> colorsChoice<span class="punctuation">(</span>value_max <span class="operator">+</span> <span class="number">1</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">circos.genomicTrackPlotRegion<span class="punctuation">(</span></span><br><span class="line">	indel_stat<span class="punctuation">,</span> track.height <span class="operator">=</span> <span class="number">0.08</span><span class="punctuation">,</span> stack <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">,</span> bg.border <span class="operator">=</span> <span class="literal">NA</span><span class="punctuation">,</span></span><br><span class="line">	panel.fun <span class="operator">=</span> <span class="keyword">function</span><span class="punctuation">(</span>region<span class="punctuation">,</span> value<span class="punctuation">,</span> ...<span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">		circos.genomicRect<span class="punctuation">(</span>region<span class="punctuation">,</span> value<span class="punctuation">,</span> col <span class="operator">=</span> color_assign<span class="punctuation">(</span>value<span class="punctuation">[[</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">,</span> border <span class="operator">=</span> <span class="literal">NA</span><span class="punctuation">,</span> ...<span class="punctuation">)</span></span><br><span class="line">	<span class="punctuation">&#125;</span> <span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">indel_legend <span class="operator">&lt;-</span> Legend<span class="punctuation">(</span></span><br><span class="line">	at <span class="operator">=</span> <span class="built_in">round</span><span class="punctuation">(</span>seq<span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span> value_max<span class="punctuation">,</span> length.out <span class="operator">=</span> <span class="number">6</span><span class="punctuation">)</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">)</span><span class="punctuation">,</span> labels_gp <span class="operator">=</span> gpar<span class="punctuation">(</span>fontsize <span class="operator">=</span> <span class="number">8</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">	col_fun <span class="operator">=</span> colorRamp2<span class="punctuation">(</span><span class="built_in">round</span><span class="punctuation">(</span>seq<span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span> value_max<span class="punctuation">,</span> length.out <span class="operator">=</span> <span class="number">6</span><span class="punctuation">)</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">)</span><span class="punctuation">,</span> colorsChoice<span class="punctuation">(</span><span class="number">6</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">	title_position <span class="operator">=</span> <span class="string">&#x27;topleft&#x27;</span><span class="punctuation">,</span> title <span class="operator">=</span> <span class="string">&#x27;InDel density&#x27;</span><span class="punctuation">,</span> legend_height <span class="operator">=</span> unit<span class="punctuation">(</span><span class="number">4</span><span class="punctuation">,</span> <span class="string">&#x27;cm&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span> title_gp <span class="operator">=</span> gpar<span class="punctuation">(</span>fontsize <span class="operator">=</span> <span class="number">9</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#CNV 变异 duplication、deletion，1 插入、2 缺失</span></span><br><span class="line"><span class="keyword">for</span> <span class="punctuation">(</span>i <span class="keyword">in</span> <span class="number">1</span><span class="operator">:</span>nrow<span class="punctuation">(</span>cnv<span class="punctuation">)</span><span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">	<span class="keyword">if</span> <span class="punctuation">(</span>cnv<span class="punctuation">[</span>i<span class="punctuation">,</span><span class="number">4</span><span class="punctuation">]</span> <span class="operator">==</span> <span class="string">&#x27;duplication&#x27;</span><span class="punctuation">)</span> cnv<span class="punctuation">[</span>i<span class="punctuation">,</span><span class="number">4</span><span class="punctuation">]</span> <span class="operator">&lt;-</span> <span class="number">1</span></span><br><span class="line">	<span class="keyword">if</span> <span class="punctuation">(</span>cnv<span class="punctuation">[</span>i<span class="punctuation">,</span><span class="number">4</span><span class="punctuation">]</span> <span class="operator">==</span> <span class="string">&#x27;deletion&#x27;</span><span class="punctuation">)</span> cnv<span class="punctuation">[</span>i<span class="punctuation">,</span><span class="number">4</span><span class="punctuation">]</span> <span class="operator">&lt;-</span> <span class="number">2</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line">cnv<span class="punctuation">[[</span><span class="number">4</span><span class="punctuation">]</span><span class="punctuation">]</span> <span class="operator">&lt;-</span> <span class="built_in">as.numeric</span><span class="punctuation">(</span>cnv<span class="punctuation">[[</span><span class="number">4</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">color_assign <span class="operator">&lt;-</span> colorRamp2<span class="punctuation">(</span>breaks <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span> <span class="number">2</span><span class="punctuation">)</span><span class="punctuation">,</span> color <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;#FB564A&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;#74C476&#x27;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">circos.genomicTrackPlotRegion<span class="punctuation">(</span></span><br><span class="line">	cnv<span class="punctuation">,</span> track.height <span class="operator">=</span> <span class="number">0.06</span><span class="punctuation">,</span> stack <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">,</span> bg.border <span class="operator">=</span> <span class="literal">NA</span><span class="punctuation">,</span></span><br><span class="line">	panel.fun <span class="operator">=</span> <span class="keyword">function</span><span class="punctuation">(</span>region<span class="punctuation">,</span> value<span class="punctuation">,</span> ...<span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">		circos.genomicRect<span class="punctuation">(</span>region<span class="punctuation">,</span> value<span class="punctuation">,</span> col <span class="operator">=</span> color_assign<span class="punctuation">(</span>value<span class="punctuation">[[</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">,</span> border <span class="operator">=</span> <span class="literal">NA</span><span class="punctuation">,</span> ...<span class="punctuation">)</span></span><br><span class="line">	<span class="punctuation">&#125;</span> <span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">cnv_legend <span class="operator">&lt;-</span> Legend<span class="punctuation">(</span></span><br><span class="line">	at <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span> <span class="number">2</span><span class="punctuation">)</span><span class="punctuation">,</span> labels <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27; Duplication&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27; Deletion&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span> labels_gp <span class="operator">=</span> gpar<span class="punctuation">(</span>fontsize <span class="operator">=</span> <span class="number">8</span><span class="punctuation">)</span><span class="punctuation">,</span> title <span class="operator">=</span> <span class="string">&#x27;CNV type&#x27;</span><span class="punctuation">,</span> title_gp <span class="operator">=</span> gpar<span class="punctuation">(</span>fontsize <span class="operator">=</span> <span class="number">9</span><span class="punctuation">)</span><span class="punctuation">,</span>  </span><br><span class="line">	grid_height <span class="operator">=</span> unit<span class="punctuation">(</span><span class="number">0.5</span><span class="punctuation">,</span> <span class="string">&#x27;cm&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span> grid_width <span class="operator">=</span> unit<span class="punctuation">(</span><span class="number">0.5</span><span class="punctuation">,</span> <span class="string">&#x27;cm&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span> type <span class="operator">=</span> <span class="string">&#x27;points&#x27;</span><span class="punctuation">,</span> pch <span class="operator">=</span> <span class="literal">NA</span><span class="punctuation">,</span> background <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;#FB564A&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;#74C476&#x27;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#SV 变异</span></span><br><span class="line"><span class="comment">#INS、DEL，1 插入、2 缺失</span></span><br><span class="line"><span class="keyword">for</span> <span class="punctuation">(</span>i <span class="keyword">in</span> <span class="number">1</span><span class="operator">:</span>nrow<span class="punctuation">(</span>sv_in_de<span class="punctuation">)</span><span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">	<span class="keyword">if</span> <span class="punctuation">(</span>sv_in_de<span class="punctuation">[</span>i<span class="punctuation">,</span><span class="number">4</span><span class="punctuation">]</span> <span class="operator">==</span> <span class="string">&#x27;INS&#x27;</span><span class="punctuation">)</span> sv_in_de<span class="punctuation">[</span>i<span class="punctuation">,</span><span class="number">4</span><span class="punctuation">]</span> <span class="operator">&lt;-</span> <span class="number">1</span></span><br><span class="line">	<span class="keyword">if</span> <span class="punctuation">(</span>sv_in_de<span class="punctuation">[</span>i<span class="punctuation">,</span><span class="number">4</span><span class="punctuation">]</span> <span class="operator">==</span> <span class="string">&#x27;DEL&#x27;</span><span class="punctuation">)</span> sv_in_de<span class="punctuation">[</span>i<span class="punctuation">,</span><span class="number">4</span><span class="punctuation">]</span> <span class="operator">&lt;-</span> <span class="number">2</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line">sv_in_de<span class="punctuation">[[</span><span class="number">4</span><span class="punctuation">]</span><span class="punctuation">]</span> <span class="operator">&lt;-</span> <span class="built_in">as.numeric</span><span class="punctuation">(</span>sv_in_de<span class="punctuation">[[</span><span class="number">4</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">color_assign <span class="operator">&lt;-</span> colorRamp2<span class="punctuation">(</span>breaks <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span> <span class="number">2</span><span class="punctuation">)</span><span class="punctuation">,</span> color <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;#FB564A&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;#74C476&#x27;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">circos.genomicTrackPlotRegion<span class="punctuation">(</span></span><br><span class="line">	sv_in_de<span class="punctuation">,</span> track.height <span class="operator">=</span> <span class="number">0.06</span><span class="punctuation">,</span> stack <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">,</span> bg.border <span class="operator">=</span> <span class="literal">NA</span><span class="punctuation">,</span></span><br><span class="line">	panel.fun <span class="operator">=</span> <span class="keyword">function</span><span class="punctuation">(</span>region<span class="punctuation">,</span> value<span class="punctuation">,</span> ...<span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">		circos.genomicRect<span class="punctuation">(</span>region<span class="punctuation">,</span> value<span class="punctuation">,</span> col <span class="operator">=</span> color_assign<span class="punctuation">(</span>value<span class="punctuation">[[</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">,</span> border <span class="operator">=</span> <span class="literal">NA</span><span class="punctuation">,</span> ...<span class="punctuation">)</span></span><br><span class="line">	<span class="punctuation">&#125;</span> <span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#ITX，内易位</span></span><br><span class="line">circos.genomicLink<span class="punctuation">(</span>sv_ITX<span class="punctuation">[</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span> <span class="number">2</span><span class="punctuation">,</span> <span class="number">2</span><span class="punctuation">)</span><span class="punctuation">]</span><span class="punctuation">,</span> sv_ITX<span class="punctuation">[</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">3</span><span class="punctuation">,</span> <span class="number">4</span><span class="punctuation">,</span> <span class="number">4</span><span class="punctuation">)</span><span class="punctuation">]</span><span class="punctuation">,</span> col <span class="operator">=</span> <span class="string">&#x27;#FF46346E&#x27;</span><span class="punctuation">,</span> lwd <span class="operator">=</span> <span class="number">0.5</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#CTX，间易位</span></span><br><span class="line">circos.genomicLink<span class="punctuation">(</span>sv_CTX<span class="punctuation">[</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span> <span class="number">2</span><span class="punctuation">,</span> <span class="number">2</span><span class="punctuation">)</span><span class="punctuation">]</span><span class="punctuation">,</span> sv_CTX<span class="punctuation">[</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">3</span><span class="punctuation">,</span> <span class="number">4</span><span class="punctuation">,</span> <span class="number">4</span><span class="punctuation">)</span><span class="punctuation">]</span><span class="punctuation">,</span> col <span class="operator">=</span> <span class="string">&#x27;#66CB716E&#x27;</span><span class="punctuation">,</span> lwd <span class="operator">=</span> <span class="number">0.5</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#INV，倒位</span></span><br><span class="line">circos.genomicLink<span class="punctuation">(</span>sv_INV<span class="punctuation">[</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span> <span class="number">2</span><span class="punctuation">,</span> <span class="number">2</span><span class="punctuation">)</span><span class="punctuation">]</span><span class="punctuation">,</span> sv_INV<span class="punctuation">[</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">3</span><span class="punctuation">,</span> <span class="number">4</span><span class="punctuation">,</span> <span class="number">4</span><span class="punctuation">)</span><span class="punctuation">]</span><span class="punctuation">,</span> col <span class="operator">=</span> <span class="string">&#x27;#53C6FF6E&#x27;</span><span class="punctuation">,</span> lwd <span class="operator">=</span> <span class="number">0.5</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">sv_legend <span class="operator">&lt;-</span> Legend<span class="punctuation">(</span></span><br><span class="line">	at <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span> <span class="number">2</span><span class="punctuation">,</span> <span class="number">3</span><span class="punctuation">,</span> <span class="number">4</span><span class="punctuation">,</span> <span class="number">5</span><span class="punctuation">)</span><span class="punctuation">,</span> labels <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27; INS&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27; DEL&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27; ITX&#x27;</span><span class="punctuation">,</span><span class="string">&#x27; CTX&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27; INV&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">	labels_gp <span class="operator">=</span> gpar<span class="punctuation">(</span>fontsize <span class="operator">=</span> <span class="number">8</span><span class="punctuation">)</span><span class="punctuation">,</span> grid_height <span class="operator">=</span> unit<span class="punctuation">(</span><span class="number">0.5</span><span class="punctuation">,</span> <span class="string">&#x27;cm&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span> grid_width <span class="operator">=</span> unit<span class="punctuation">(</span><span class="number">0.5</span><span class="punctuation">,</span> <span class="string">&#x27;cm&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span> </span><br><span class="line">	type <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;points&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;points&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;lines&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;lines&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;lines&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span> pch <span class="operator">=</span> <span class="literal">NA</span><span class="punctuation">,</span> background <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;#FB564A&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;#74C476&#x27;</span><span class="punctuation">,</span> <span class="literal">NA</span><span class="punctuation">,</span> <span class="literal">NA</span><span class="punctuation">,</span> <span class="literal">NA</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">	legend_gp <span class="operator">=</span> gpar<span class="punctuation">(</span>col <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="literal">NA</span><span class="punctuation">,</span> <span class="literal">NA</span><span class="punctuation">,</span> <span class="string">&#x27;#FF4634&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;#66CB71&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;#53C6FF&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span> lwd <span class="operator">=</span> <span class="number">1</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">	title <span class="operator">=</span> <span class="string">&#x27;SV type&#x27;</span><span class="punctuation">,</span> title_gp <span class="operator">=</span> gpar<span class="punctuation">(</span>fontsize <span class="operator">=</span> <span class="number">9</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#添加图例</span></span><br><span class="line">y_coord <span class="operator">&lt;-</span> 0.8</span><br><span class="line">x_coord <span class="operator">&lt;-</span> 0.87</span><br><span class="line"></span><br><span class="line">pushViewport<span class="punctuation">(</span>viewport<span class="punctuation">(</span>x <span class="operator">=</span> x_coord <span class="operator">+</span> <span class="number">0.011</span><span class="punctuation">,</span> y <span class="operator">=</span> y_coord<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">grid.draw<span class="punctuation">(</span>gc_legend<span class="punctuation">)</span></span><br><span class="line">y_coord <span class="operator">&lt;-</span> y_coord <span class="operator">-</span> <span class="number">0.06</span></span><br><span class="line">upViewport<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">pushViewport<span class="punctuation">(</span>viewport<span class="punctuation">(</span>x <span class="operator">=</span> x_coord <span class="operator">+</span> <span class="number">0.005</span><span class="punctuation">,</span> y <span class="operator">=</span> y_coord<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">grid.draw<span class="punctuation">(</span>depth_legend<span class="punctuation">)</span></span><br><span class="line">y_coord <span class="operator">&lt;-</span> y_coord <span class="operator">-</span> <span class="number">0.1</span></span><br><span class="line">upViewport<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">pushViewport<span class="punctuation">(</span>viewport<span class="punctuation">(</span>x <span class="operator">=</span> x_coord <span class="operator">-</span> <span class="number">0.0063</span><span class="punctuation">,</span> y <span class="operator">=</span> y_coord<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">grid.draw<span class="punctuation">(</span>gene_legend<span class="punctuation">)</span></span><br><span class="line">y_coord <span class="operator">&lt;-</span> y_coord <span class="operator">-</span> <span class="number">0.19</span></span><br><span class="line">upViewport<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">pushViewport<span class="punctuation">(</span>viewport<span class="punctuation">(</span>x <span class="operator">=</span> x_coord <span class="operator">-</span> <span class="number">0.0205</span><span class="punctuation">,</span> y <span class="operator">=</span> y_coord<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">grid.draw<span class="punctuation">(</span>snp_legend<span class="punctuation">)</span></span><br><span class="line">y_coord <span class="operator">&lt;-</span> y_coord</span><br><span class="line">upViewport<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">pushViewport<span class="punctuation">(</span>viewport<span class="punctuation">(</span>x <span class="operator">=</span> x_coord <span class="operator">+</span> <span class="number">0.0505</span><span class="punctuation">,</span> y <span class="operator">=</span> y_coord<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">grid.draw<span class="punctuation">(</span>indel_legend<span class="punctuation">)</span></span><br><span class="line">y_coord <span class="operator">&lt;-</span> y_coord <span class="operator">-</span> <span class="number">0.195</span></span><br><span class="line">upViewport<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">pushViewport<span class="punctuation">(</span>viewport<span class="punctuation">(</span>x <span class="operator">=</span> x_coord <span class="operator">-</span> <span class="number">0.018</span><span class="punctuation">,</span> y <span class="operator">=</span> y_coord<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">grid.draw<span class="punctuation">(</span>cnv_legend<span class="punctuation">)</span></span><br><span class="line">y_coord <span class="operator">&lt;-</span> y_coord</span><br><span class="line">upViewport<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">pushViewport<span class="punctuation">(</span>viewport<span class="punctuation">(</span>x <span class="operator">=</span> x_coord <span class="operator">+</span> <span class="number">0.04</span><span class="punctuation">,</span> y <span class="operator">=</span> y_coord <span class="operator">-</span> <span class="number">0.0373</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">grid.draw<span class="punctuation">(</span>sv_legend<span class="punctuation">)</span></span><br><span class="line">y_coord <span class="operator">&lt;-</span> y_coord</span><br><span class="line">upViewport<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#统计总览（涵括了上文大部分的统计结果信息，例如 SNP 替换类型统计等）</span></span><br><span class="line">stat_legend <span class="operator">&lt;-</span> Legend<span class="punctuation">(</span></span><br><span class="line">	at <span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span> labels <span class="operator">=</span> <span class="string">&#x27;1&#x27;</span><span class="punctuation">,</span> labels_gp <span class="operator">=</span> gpar<span class="punctuation">(</span>fontsize <span class="operator">=</span> <span class="number">0</span><span class="punctuation">)</span><span class="punctuation">,</span> title_gp <span class="operator">=</span> gpar<span class="punctuation">(</span>fontsize <span class="operator">=</span> <span class="number">9</span><span class="punctuation">)</span><span class="punctuation">,</span> </span><br><span class="line">	grid_height <span class="operator">=</span> unit<span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span> <span class="string">&#x27;cm&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span> grid_width <span class="operator">=</span> unit<span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span> <span class="string">&#x27;cm&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span> type <span class="operator">=</span> <span class="string">&#x27;points&#x27;</span><span class="punctuation">,</span> pch <span class="operator">=</span> <span class="literal">NA</span><span class="punctuation">,</span> background <span class="operator">=</span> <span class="literal">NA</span><span class="punctuation">,</span> </span><br><span class="line">	title <span class="operator">=</span> str_c<span class="punctuation">(</span><span class="string">&#x27;Sample: &#x27;</span><span class="punctuation">,</span> sample_name<span class="punctuation">,</span> <span class="string">&#x27;\nRefer species: &#x27;</span><span class="punctuation">,</span> ref_name<span class="punctuation">,</span> <span class="string">&#x27;\nRefer size: &#x27;</span><span class="punctuation">,</span> genome_size<span class="punctuation">,</span> <span class="string">&#x27; bp\nRefer GC: &#x27;</span><span class="punctuation">,</span> genome_GC<span class="punctuation">,</span> <span class="string">&#x27; %\n\n\nTotal SNP: &#x27;</span><span class="punctuation">,</span> snp_ti <span class="operator">+</span> snp_tv<span class="punctuation">,</span> <span class="string">&#x27;\nTransitions: &#x27;</span><span class="punctuation">,</span> snp_ti<span class="punctuation">,</span> <span class="string">&#x27;\nTransversions: &#x27;</span><span class="punctuation">,</span> snp_tv<span class="punctuation">,</span> <span class="string">&#x27;\nTi/Tv: &#x27;</span><span class="punctuation">,</span> <span class="built_in">round</span><span class="punctuation">(</span>snp_ti <span class="operator">/</span> snp_tv<span class="punctuation">,</span> <span class="number">2</span><span class="punctuation">)</span><span class="punctuation">,</span> <span class="string">&#x27;\nA&gt;T|T&gt;A: &#x27;</span><span class="punctuation">,</span> snp_at<span class="punctuation">,</span> <span class="string">&#x27;\nA&gt;G|T&gt;C: &#x27;</span><span class="punctuation">,</span> snp_ag<span class="punctuation">,</span> <span class="string">&#x27;\nA&gt;C|T&gt;G: &#x27;</span><span class="punctuation">,</span> snp_ac<span class="punctuation">,</span> <span class="string">&#x27;\nG&gt;A|C&gt;T: &#x27;</span><span class="punctuation">,</span> snp_ga<span class="punctuation">,</span> <span class="string">&#x27;\nG&gt;T|C&gt;A: &#x27;</span><span class="punctuation">,</span> snp_gt<span class="punctuation">,</span> <span class="string">&#x27;\nG&gt;C|C&gt;G: &#x27;</span><span class="punctuation">,</span> snp_gc<span class="punctuation">,</span> <span class="string">&#x27;\n\n\nTotal InDel: &#x27;</span><span class="punctuation">,</span> indel_insert <span class="operator">+</span> indel_delet<span class="punctuation">,</span> <span class="string">&#x27;\nInsert: &#x27;</span><span class="punctuation">,</span> indel_insert<span class="punctuation">,</span> <span class="string">&#x27;\nDelet: &#x27;</span><span class="punctuation">,</span> indel_delet<span class="punctuation">,</span> <span class="string">&#x27;\n\n\nTotal CNV: &#x27;</span><span class="punctuation">,</span> cnv_dup <span class="operator">+</span> cnv_del<span class="punctuation">,</span> <span class="string">&#x27;\nDuplication: &#x27;</span><span class="punctuation">,</span> cnv_dup<span class="punctuation">,</span> <span class="string">&#x27;\nDeletion: &#x27;</span><span class="punctuation">,</span> cnv_del<span class="punctuation">,</span> <span class="string">&#x27;\n\n\nTotal SV: &#x27;</span><span class="punctuation">,</span> sv_ins <span class="operator">+</span> sv_del <span class="operator">+</span> sv_itx <span class="operator">+</span> sv_ctx <span class="operator">+</span> sv_inv<span class="punctuation">,</span> <span class="string">&#x27;\nINS: &#x27;</span><span class="punctuation">,</span> sv_ins<span class="punctuation">,</span><span class="string">&#x27;\nDEL: &#x27;</span><span class="punctuation">,</span> sv_del<span class="punctuation">,</span> <span class="string">&#x27;\nITX: &#x27;</span><span class="punctuation">,</span> sv_itx<span class="punctuation">,</span> <span class="string">&#x27;\nCTX: &#x27;</span><span class="punctuation">,</span> sv_ctx<span class="punctuation">,</span> <span class="string">&#x27;\nINV: &#x27;</span><span class="punctuation">,</span> sv_inv<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">pushViewport<span class="punctuation">(</span>viewport<span class="punctuation">(</span>x <span class="operator">=</span> <span class="number">0.12</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="number">0.5</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">grid.draw<span class="punctuation">(</span>stat_legend<span class="punctuation">)</span></span><br><span class="line">upViewport<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">circos.clear<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line">dev.off<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="三元相图">三元相图</h3>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#示例数据“data.txt”</span></span><br><span class="line"><span class="comment">#第一列，OTU 名称</span></span><br><span class="line"><span class="comment">#第二、三、四列，OTU 在 3 个样本中的丰度信息</span></span><br><span class="line"><span class="comment">#第五列，标注了这些 OTU 在哪个样本中发生了富集</span></span><br><span class="line"><span class="comment">#第六列，OTU 的门类群</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#读取数据</span></span><br><span class="line">dat <span class="operator">&lt;-</span> read.delim<span class="punctuation">(</span><span class="string">&#x27;data.txt&#x27;</span><span class="punctuation">,</span> sep <span class="operator">=</span> <span class="string">&#x27;\t&#x27;</span><span class="punctuation">,</span> stringsAsFactors <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">,</span> check.names <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##ternaryplot() 三元图</span></span><br><span class="line">library<span class="punctuation">(</span>vcd<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">dat1 <span class="operator">&lt;-</span> dat</span><br><span class="line"></span><br><span class="line"><span class="comment">#定义图中点的大小，这里取 3 个样本的平均值的 0.4 次方再除以 10......</span></span><br><span class="line"><span class="comment">#丰度差异过大，调整图中点大小确实是件麻烦事</span></span><br><span class="line">dat1<span class="operator">$</span>size <span class="operator">&lt;-</span> <span class="punctuation">(</span>apply<span class="punctuation">(</span>dat1<span class="punctuation">[</span><span class="number">2</span><span class="operator">:</span><span class="number">4</span><span class="punctuation">]</span><span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">,</span> mean<span class="punctuation">)</span><span class="punctuation">)</span><span class="operator">^</span><span class="number">0.4</span> <span class="operator">/</span> <span class="number">10</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#定义富集 OTUs 的颜色，按富集样本划分</span></span><br><span class="line">dat1<span class="punctuation">[</span>which<span class="punctuation">(</span>dat1<span class="operator">$</span>rich <span class="operator">==</span> <span class="string">&#x27;env1&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span><span class="string">&#x27;color&#x27;</span><span class="punctuation">]</span> <span class="operator">&lt;-</span> <span class="string">&#x27;red&#x27;</span></span><br><span class="line">dat1<span class="punctuation">[</span>which<span class="punctuation">(</span>dat1<span class="operator">$</span>rich <span class="operator">==</span> <span class="string">&#x27;env2&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span><span class="string">&#x27;color&#x27;</span><span class="punctuation">]</span> <span class="operator">&lt;-</span> <span class="string">&#x27;blue&#x27;</span></span><br><span class="line">dat1<span class="punctuation">[</span>which<span class="punctuation">(</span>dat1<span class="operator">$</span>rich <span class="operator">==</span> <span class="string">&#x27;env3&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span><span class="string">&#x27;color&#x27;</span><span class="punctuation">]</span> <span class="operator">&lt;-</span> <span class="string">&#x27;green3&#x27;</span></span><br><span class="line">dat1<span class="punctuation">[</span>which<span class="punctuation">(</span>dat1<span class="operator">$</span>rich <span class="operator">==</span> <span class="string">&#x27;0&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span><span class="string">&#x27;color&#x27;</span><span class="punctuation">]</span> <span class="operator">&lt;-</span> <span class="string">&#x27;gray&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#ternaryplot() 示例，按 OTUs 富集区域着色</span></span><br><span class="line"><span class="comment">#pdf(&#x27;ternaryplot.pdf&#x27;)</span></span><br><span class="line">png<span class="punctuation">(</span><span class="string">&#x27;ternaryplot.png&#x27;</span><span class="punctuation">,</span> width <span class="operator">=</span> <span class="number">2000</span><span class="punctuation">,</span> height <span class="operator">=</span> <span class="number">2000</span><span class="punctuation">,</span> res <span class="operator">=</span> <span class="number">300</span><span class="punctuation">,</span> units <span class="operator">=</span> <span class="string">&#x27;px&#x27;</span><span class="punctuation">)</span></span><br><span class="line">ternaryplot<span class="punctuation">(</span>dat1<span class="punctuation">[</span><span class="number">2</span><span class="operator">:</span><span class="number">4</span><span class="punctuation">]</span><span class="punctuation">,</span> scale <span class="operator">=</span> <span class="literal">NULL</span><span class="punctuation">,</span> col <span class="operator">=</span> dat1<span class="operator">$</span>color<span class="punctuation">,</span> prop_size <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">,</span> cex <span class="operator">=</span> dat1<span class="operator">$</span>size<span class="punctuation">,</span> main <span class="operator">=</span> <span class="string">&#x27;Enriched OTUs&#x27;</span><span class="punctuation">)</span></span><br><span class="line">grid_legend<span class="punctuation">(</span>x <span class="operator">=</span> <span class="number">0.8</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="number">0.7</span><span class="punctuation">,</span> pch <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">19</span><span class="punctuation">,</span> <span class="number">19</span><span class="punctuation">,</span> <span class="number">19</span><span class="punctuation">)</span><span class="punctuation">,</span> col <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;red&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;blue&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;green3&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span> label <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;env1&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;env2&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;env3&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span> title <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">,</span> frame <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span></span><br><span class="line">dev.off<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##ggtern 三元图</span></span><br><span class="line">library<span class="punctuation">(</span>ggtern<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">dat2 <span class="operator">&lt;-</span> dat</span><br><span class="line"></span><br><span class="line"><span class="comment">#用于定义图中点的大小，这里取 3 个样本的平均值的 0.5 次方......</span></span><br><span class="line">dat2<span class="operator">$</span>size <span class="operator">&lt;-</span> <span class="punctuation">(</span>apply<span class="punctuation">(</span>dat2<span class="punctuation">[</span><span class="number">2</span><span class="operator">:</span><span class="number">4</span><span class="punctuation">]</span><span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">,</span> mean<span class="punctuation">)</span><span class="punctuation">)</span><span class="operator">^</span><span class="number">0.5</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#ggtern，按 OTUs 富集区域着色</span></span><br><span class="line">p_rich <span class="operator">&lt;-</span> ggtern<span class="punctuation">(</span>dat2<span class="punctuation">,</span> aes<span class="punctuation">(</span>env1<span class="punctuation">,</span> env2<span class="punctuation">,</span> env3<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">geom_mask<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">geom_point<span class="punctuation">(</span>aes<span class="punctuation">(</span>color <span class="operator">=</span> rich<span class="punctuation">,</span> size <span class="operator">=</span> size<span class="punctuation">)</span><span class="punctuation">,</span> alpha <span class="operator">=</span> <span class="number">0.8</span><span class="punctuation">,</span> show.legend <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">scale_size<span class="punctuation">(</span><span class="built_in">range</span> <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span> <span class="number">6</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">scale_colour_manual<span class="punctuation">(</span>values  <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;red&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;blue&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;green3&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;gray&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span> limits <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;env1&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;env2&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;env3&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;0&#x27;</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">theme_bw<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">theme<span class="punctuation">(</span>axis.text <span class="operator">=</span> element_blank<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">,</span> axis.ticks <span class="operator">=</span> element_blank<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#ggtern，按 OTUs 类群着色</span></span><br><span class="line">p_taxonomy <span class="operator">&lt;-</span> ggtern<span class="punctuation">(</span>dat2<span class="punctuation">,</span> aes<span class="punctuation">(</span>env1<span class="punctuation">,</span> env2<span class="punctuation">,</span> env3<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">geom_mask<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">geom_point<span class="punctuation">(</span>aes<span class="punctuation">(</span>color <span class="operator">=</span> taxonomy<span class="punctuation">,</span> size <span class="operator">=</span> size<span class="punctuation">)</span><span class="punctuation">,</span> alpha <span class="operator">=</span> <span class="number">0.8</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">scale_size<span class="punctuation">(</span><span class="built_in">range</span> <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span> <span class="number">6</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">theme_bw<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">theme<span class="punctuation">(</span>axis.text <span class="operator">=</span> element_blank<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">,</span> axis.ticks <span class="operator">=</span> element_blank<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">,</span> legend.title <span class="operator">=</span> element_blank<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">guides<span class="punctuation">(</span>size <span class="operator">=</span> <span class="string">&#x27;none&#x27;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#ggsave(&#x27;ggtern.pdf&#x27;, p_rich, width = 6, height = 6)</span></span><br><span class="line">ggsave<span class="punctuation">(</span><span class="string">&#x27;ggtern.png&#x27;</span><span class="punctuation">,</span> p_rich<span class="punctuation">,</span> width <span class="operator">=</span> <span class="number">6</span><span class="punctuation">,</span> height <span class="operator">=</span> <span class="number">6</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#密度图举例</span></span><br><span class="line">ggtern<span class="punctuation">(</span>dat2<span class="punctuation">,</span> aes<span class="punctuation">(</span>env1<span class="punctuation">,</span> env2<span class="punctuation">,</span> env3<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">stat_density_tern<span class="punctuation">(</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<img src="/2023/10/31/ggplot-picture/Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20200301165119323.png" alt="image-20200301165119323" style="zoom:33%;">
<h3 id="生存曲线图">生存曲线图</h3>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="punctuation">(</span><span class="operator">!</span>requireNamespace<span class="punctuation">(</span><span class="string">&quot;BiocManager&quot;</span><span class="punctuation">,</span> quietly <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">  install.packages<span class="punctuation">(</span><span class="string">&quot;BiocManager&quot;</span><span class="punctuation">)</span></span><br><span class="line">BiocManager<span class="operator">::</span>install<span class="punctuation">(</span><span class="string">&quot;survival&quot;</span><span class="punctuation">,</span> version <span class="operator">=</span> <span class="string">&quot;3.8&quot;</span><span class="punctuation">)</span></span><br><span class="line">BiocManager<span class="operator">::</span>install<span class="punctuation">(</span><span class="string">&quot;ggplot2&quot;</span><span class="punctuation">,</span> version <span class="operator">=</span> <span class="string">&quot;3.8&quot;</span><span class="punctuation">)</span></span><br><span class="line">BiocManager<span class="operator">::</span>install<span class="punctuation">(</span><span class="string">&quot;survminer&quot;</span><span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>survival<span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>ggplot2<span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>survminer<span class="punctuation">)</span></span><br><span class="line"><span class="comment">#读取个人采集的生存曲线数据表</span></span><br><span class="line">survival_time<span class="operator">&lt;-</span>read.csv<span class="punctuation">(</span><span class="string">&quot;survival_time.csv&quot;</span><span class="punctuation">,</span>header <span class="operator">=</span> <span class="built_in">T</span><span class="punctuation">,</span>row.names <span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span> sep<span class="operator">=</span><span class="string">&quot;,&quot;</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment">#创建生存对象surv（time，status）不变，分组变量可根据自己实验分组，此处以性别sex分类</span></span><br><span class="line">fit <span class="operator">&lt;-</span> survfit<span class="punctuation">(</span>Surv<span class="punctuation">(</span>time<span class="punctuation">,</span> status<span class="punctuation">)</span> <span class="operator">~</span> sex<span class="punctuation">,</span> data <span class="operator">=</span> survival_time<span class="punctuation">)</span> </span><br><span class="line"><span class="comment">#最基本绘图</span></span><br><span class="line">ggsurvplot<span class="punctuation">(</span>fit<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#绘制个性化生存曲线</span></span><br><span class="line">ggsurvplot<span class="punctuation">(</span>fit<span class="punctuation">,</span>risk.table<span class="operator">=</span><span class="literal">TRUE</span><span class="punctuation">,</span><span class="comment">#生存统计统计表</span></span><br><span class="line">           conf.int<span class="operator">=</span><span class="literal">TRUE</span><span class="punctuation">,</span><span class="comment">#添加置信区间带</span></span><br><span class="line">           palette <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;skyblue&quot;</span><span class="punctuation">,</span> <span class="string">&quot;red&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span><span class="comment">#颜色设置</span></span><br><span class="line">           pval<span class="operator">=</span><span class="literal">TRUE</span><span class="punctuation">,</span><span class="comment">#log-rank检验</span></span><br><span class="line">           pval.method<span class="operator">=</span><span class="literal">TRUE</span><span class="punctuation">)</span><span class="comment">#添加检验text</span></span><br><span class="line"></span><br><span class="line"><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span>示例数据<span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span><span class="operator">*</span></span><br><span class="line">library<span class="punctuation">(</span>survival<span class="punctuation">)</span></span><br><span class="line"><span class="comment">#示例数据，详情 ?lung</span></span><br><span class="line">data<span class="punctuation">(</span>lung<span class="punctuation">)</span></span><br><span class="line">head<span class="punctuation">(</span>lung<span class="punctuation">)</span></span><br><span class="line"><span class="comment">#Kaplan-Meier 分析，详情 ?survfit</span></span><br><span class="line">KM <span class="operator">&lt;-</span> survfit<span class="punctuation">(</span>Surv<span class="punctuation">(</span>time<span class="punctuation">,</span> status<span class="punctuation">)</span> <span class="operator">~</span> sex<span class="punctuation">,</span> data <span class="operator">=</span> lung<span class="punctuation">,</span> type <span class="operator">=</span> <span class="string">&#x27;kaplan-meier&#x27;</span><span class="punctuation">,</span> conf.type <span class="operator">=</span> <span class="string">&#x27;log&#x27;</span><span class="punctuation">)</span></span><br><span class="line">KM</span><br><span class="line">summary<span class="punctuation">(</span>KM<span class="punctuation">)</span></span><br><span class="line"><span class="comment">#结果提取，例如重要的统计值</span></span><br><span class="line">summary<span class="punctuation">(</span>KM<span class="punctuation">)</span><span class="operator">$</span>table</span><br><span class="line"><span class="comment">#对数秩检验，详情 ?survdiff</span></span><br><span class="line">survdiff<span class="punctuation">(</span>Surv<span class="punctuation">(</span>time<span class="punctuation">,</span> status<span class="punctuation">)</span> <span class="operator">~</span> sex<span class="punctuation">,</span> data <span class="operator">=</span> lung<span class="punctuation">)</span></span><br><span class="line"><span class="comment">#绘制生存曲线，反映了尚在世的患者数量比例和时间的关系</span></span><br><span class="line">plot<span class="punctuation">(</span>KM<span class="punctuation">,</span> main <span class="operator">=</span> <span class="string">&#x27;Kaplan-Meier &#x27;</span><span class="punctuation">,</span> xlab <span class="operator">=</span> <span class="string">&#x27;Time (days)&#x27;</span><span class="punctuation">,</span> ylab <span class="operator">=</span> <span class="string">&#x27;Overall survival&#x27;</span><span class="punctuation">,</span> </span><br><span class="line">     lwd <span class="operator">=</span> <span class="number">2</span><span class="punctuation">,</span> col <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;blue&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;red&#x27;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">legend<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&#x27;topright&#x27;</span><span class="punctuation">,</span> col <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;blue&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;red&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span> lwd <span class="operator">=</span> <span class="number">2</span><span class="punctuation">,</span> legend <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;1: male&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;2: female&#x27;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#绘制累积风险曲线，反映了疾病风险和时间的关系，与累积的去世患者数量有关</span></span><br><span class="line">plot<span class="punctuation">(</span>KM<span class="punctuation">,</span> main <span class="operator">=</span> <span class="string">&#x27;Cumulative hazard&#x27;</span><span class="punctuation">,</span> xlab <span class="operator">=</span> <span class="string">&#x27;Time (days)&#x27;</span><span class="punctuation">,</span> ylab <span class="operator">=</span> <span class="string">&#x27;Cumulative hazard&#x27;</span><span class="punctuation">,</span> </span><br><span class="line">     lwd <span class="operator">=</span> <span class="number">2</span><span class="punctuation">,</span> col <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;blue&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;red&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span> fun <span class="operator">=</span> <span class="string">&#x27;cumhaz&#x27;</span><span class="punctuation">)</span></span><br><span class="line">legend<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&#x27;topright&#x27;</span><span class="punctuation">,</span> col <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;blue&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;red&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span> lwd <span class="operator">=</span> <span class="number">2</span><span class="punctuation">,</span> legend <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;1: male&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;2: female&#x27;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>survminer<span class="punctuation">)</span></span><br><span class="line"><span class="comment">#生存曲线，详情 ?ggsurvplot</span></span><br><span class="line">ggsurvplot<span class="punctuation">(</span>KM<span class="punctuation">,</span> conf.int <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">,</span> palette <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;blue&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;red&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span> risk.table <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">,</span> pval <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment">#累积风险曲线</span></span><br><span class="line">ggsurvplot<span class="punctuation">(</span>KM<span class="punctuation">,</span> conf.int <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">,</span> palette <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;blue&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;red&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span> fun <span class="operator">=</span> <span class="string">&#x27;cumhaz&#x27;</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<h3 id="风玫瑰图">风玫瑰图</h3>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#基于疫情数据</span></span><br><span class="line">require<span class="punctuation">(</span>nCov2019<span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>dplyr<span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>ggplot2<span class="punctuation">)</span></span><br><span class="line">y <span class="operator">=</span> load_nCov2019<span class="punctuation">(</span>lang <span class="operator">=</span> <span class="string">&#x27;zh&#x27;</span><span class="punctuation">)</span></span><br><span class="line">y</span><br><span class="line">d <span class="operator">=</span> y<span class="punctuation">[</span><span class="string">&#x27;global&#x27;</span><span class="punctuation">]</span></span><br><span class="line">dd <span class="operator">&lt;-</span>  filter<span class="punctuation">(</span>d<span class="punctuation">,</span> time <span class="operator">==</span> time<span class="punctuation">(</span>y<span class="punctuation">)</span><span class="operator">&amp;</span> country <span class="operator">!=</span> <span class="string">&#x27;中国&#x27;</span><span class="punctuation">)</span><span class="operator">%&gt;%</span></span><br><span class="line">  arrange<span class="punctuation">(</span>desc<span class="punctuation">(</span>cum_confirm<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">dd <span class="operator">=</span> dd<span class="punctuation">[</span><span class="number">1</span><span class="operator">:</span><span class="number">40</span><span class="punctuation">,</span><span class="punctuation">]</span></span><br><span class="line">dd<span class="operator">$</span>country <span class="operator">=</span> factor<span class="punctuation">(</span>dd<span class="operator">$</span>country<span class="punctuation">,</span>levels <span class="operator">=</span> dd<span class="operator">$</span>country<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">dd<span class="operator">$</span>angle <span class="operator">=</span> <span class="number">1</span><span class="operator">:</span><span class="number">40</span><span class="operator">*</span><span class="number">360</span><span class="operator">/</span><span class="number">40</span>	</span><br><span class="line">ggplot<span class="punctuation">(</span>dd<span class="punctuation">,</span>aes<span class="punctuation">(</span>country<span class="punctuation">,</span>cum_confirm<span class="punctuation">,</span>fill<span class="operator">=</span>cum_confirm<span class="punctuation">)</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  geom_col<span class="punctuation">(</span>width <span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span>color <span class="operator">=</span> <span class="string">&#x27;grey90&#x27;</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  geom_col<span class="punctuation">(</span>aes<span class="punctuation">(</span>y<span class="operator">=</span>I<span class="punctuation">(</span><span class="number">2</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">,</span>width <span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span>fill <span class="operator">=</span> <span class="string">&#x27;white&#x27;</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  scale_y_log10<span class="punctuation">(</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  scale_fill_gradientn<span class="punctuation">(</span>colors<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;darkgreen&quot;</span><span class="punctuation">,</span><span class="string">&quot;green&quot;</span><span class="punctuation">,</span><span class="string">&quot;orange&quot;</span><span class="punctuation">,</span><span class="string">&quot;firebrick&quot;</span><span class="punctuation">,</span><span class="string">&quot;red&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span>trans<span class="operator">=</span><span class="string">&quot;log&quot;</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  geom_text<span class="punctuation">(</span>aes<span class="punctuation">(</span>label<span class="operator">=</span>paste<span class="punctuation">(</span>country<span class="punctuation">,</span>cum_confirm<span class="punctuation">,</span>sep <span class="operator">=</span><span class="string">&quot;\n&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">                y <span class="operator">=</span> cum_confirm<span class="operator">*</span><span class="number">.8</span><span class="punctuation">,</span>angle<span class="operator">=</span>angle<span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">            data<span class="operator">=</span><span class="keyword">function</span><span class="punctuation">(</span>d<span class="punctuation">)</span>d<span class="punctuation">[</span>d<span class="operator">$</span>cum_confirm <span class="operator">&gt;</span> <span class="number">100</span><span class="punctuation">,</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            color <span class="operator">=</span> <span class="string">&quot;white&quot;</span><span class="punctuation">,</span>fontface <span class="operator">=</span> <span class="string">&quot;bold&quot;</span><span class="punctuation">,</span> vjust <span class="operator">=</span><span class="number">1</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  geom_text<span class="punctuation">(</span>aes<span class="punctuation">(</span>label <span class="operator">=</span> paste0<span class="punctuation">(</span>cum_confirm<span class="punctuation">,</span><span class="string">&quot;例&quot;</span><span class="punctuation">,</span>country<span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">                y <span class="operator">=</span> cum_confirm <span class="operator">*</span><span class="number">2</span><span class="punctuation">,</span> angle <span class="operator">=</span> angle<span class="operator">+</span><span class="number">90</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">            data <span class="operator">=</span> <span class="keyword">function</span><span class="punctuation">(</span>d<span class="punctuation">)</span> d<span class="punctuation">[</span>d<span class="operator">$</span>cum_confirm <span class="operator">&lt;</span> <span class="number">100</span><span class="punctuation">,</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            vjust <span class="operator">=</span> <span class="number">0</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  coord_polar<span class="punctuation">(</span>direction <span class="operator">=</span> <span class="operator">-</span><span class="number">1</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  theme_void<span class="punctuation">(</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  theme<span class="punctuation">(</span>legend.position <span class="operator">=</span> <span class="string">&quot;none&quot;</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<p><strong>画cog注释的玫瑰图</strong></p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#载入绘图包</span></span><br><span class="line">library<span class="punctuation">(</span>ggplot2<span class="punctuation">)</span></span><br><span class="line"><span class="comment">#导入绘图数据</span></span><br><span class="line">f<span class="operator">&lt;-</span>read.table<span class="punctuation">(</span><span class="string">&quot;cog_lab&quot;</span><span class="punctuation">,</span> header<span class="operator">=</span><span class="built_in">T</span><span class="punctuation">,</span> sep<span class="operator">=</span><span class="string">&quot;\t&quot;</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment">#对图例标签进行处理</span></span><br><span class="line">myLabel <span class="operator">=</span> as.vector<span class="punctuation">(</span>f<span class="operator">$</span>lab<span class="punctuation">)</span></span><br><span class="line"><span class="comment">#根据数据计算每个功能分类所占的比例并添加到图例标签中</span></span><br><span class="line">myLabel <span class="operator">=</span> paste<span class="punctuation">(</span>myLabel<span class="punctuation">,</span> <span class="string">&quot; (&quot;</span><span class="punctuation">,</span> <span class="built_in">round</span><span class="punctuation">(</span>f<span class="operator">$</span>mag <span class="operator">/</span> <span class="built_in">sum</span><span class="punctuation">(</span>f<span class="operator">$</span>mag<span class="punctuation">)</span> <span class="operator">*</span> <span class="number">100</span><span class="punctuation">,</span> <span class="number">2</span><span class="punctuation">)</span><span class="punctuation">,</span> <span class="string">&quot;%) &quot;</span><span class="punctuation">,</span> sep <span class="operator">=</span> <span class="string">&quot;&quot;</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment">#绘制图像</span></span><br><span class="line">p<span class="operator">&lt;-</span>ggplot<span class="punctuation">(</span>f<span class="punctuation">,</span> aes<span class="punctuation">(</span>x<span class="operator">=</span>dir<span class="punctuation">,</span> y<span class="operator">=</span>factor<span class="punctuation">(</span>mag<span class="punctuation">)</span><span class="punctuation">,</span> fill<span class="operator">=</span>dir<span class="punctuation">)</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">geom_bar<span class="punctuation">(</span>stat<span class="operator">=</span><span class="string">&#x27;identity&#x27;</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">coord_polar<span class="punctuation">(</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&quot;Number of Unigenes&quot;</span><span class="punctuation">,</span> title <span class="operator">=</span> <span class="string">&quot;COG Function Classification of Unigene Sequence&quot;</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">theme<span class="punctuation">(</span>axis.ticks <span class="operator">=</span> element_blank<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">theme<span class="punctuation">(</span>legend.title <span class="operator">=</span> element_blank<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">theme<span class="punctuation">(</span>panel.background<span class="operator">=</span>element_blank<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">scale_fill_discrete<span class="punctuation">(</span>breaks <span class="operator">=</span> f<span class="operator">$</span>dir<span class="punctuation">,</span> labels <span class="operator">=</span> myLabel<span class="punctuation">)</span></span><br><span class="line"><span class="comment">#图像输出</span></span><br><span class="line">png<span class="punctuation">(</span><span class="string">&quot;COG.png&quot;</span><span class="punctuation">,</span>width <span class="operator">=</span> <span class="number">8200</span><span class="punctuation">,</span>height <span class="operator">=</span> <span class="number">5400</span><span class="punctuation">,</span>res <span class="operator">=</span> <span class="number">600</span><span class="punctuation">,</span>type <span class="operator">=</span> <span class="string">&quot;cairo&quot;</span><span class="punctuation">)</span></span><br><span class="line">p</span><br><span class="line">dev.off<span class="punctuation">(</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<h3 id="制作六边形logo">制作六边形Logo</h3>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">library<span class="punctuation">(</span>hexSticker<span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>ggplot2<span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>ggstar<span class="punctuation">)</span></span><br><span class="line">data <span class="operator">&lt;-</span> data.frame<span class="punctuation">(</span>x <span class="operator">=</span> <span class="built_in">rep</span><span class="punctuation">(</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">1</span><span class="operator">:</span><span class="number">4</span><span class="punctuation">)</span><span class="punctuation">,</span> <span class="number">3</span><span class="punctuation">)</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="built_in">rep</span><span class="punctuation">(</span><span class="number">1</span><span class="operator">:</span><span class="number">3</span><span class="punctuation">,</span> each <span class="operator">=</span> <span class="number">4</span><span class="punctuation">,</span></span><br><span class="line">                                               len <span class="operator">=</span> <span class="number">12</span><span class="punctuation">)</span><span class="punctuation">,</span> group <span class="operator">=</span> <span class="built_in">letters</span><span class="punctuation">[</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">1</span><span class="operator">:</span><span class="number">12</span><span class="punctuation">)</span><span class="punctuation">]</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">p <span class="operator">&lt;-</span> ggplot<span class="punctuation">(</span>data<span class="operator">=</span>iris<span class="punctuation">,</span> aes<span class="punctuation">(</span>x<span class="operator">=</span>Sepal.Length<span class="punctuation">,</span>y<span class="operator">=</span>Sepal.Width<span class="punctuation">,</span></span><br><span class="line">                           starshape<span class="operator">=</span>Species<span class="punctuation">,</span> fill<span class="operator">=</span>Species<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span> geom_star<span class="punctuation">(</span>show.legend<span class="operator">=</span><span class="literal">FALSE</span><span class="punctuation">,</span> size<span class="operator">=</span><span class="number">1.8</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  scale_fill_manual<span class="punctuation">(</span>values<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;#66C2A5&quot;</span><span class="punctuation">,</span> <span class="string">&quot;#FC8D62&quot;</span><span class="punctuation">,</span> <span class="string">&quot;#8DA0CB&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">p</span><br><span class="line">p <span class="operator">&lt;-</span> p <span class="operator">+</span> theme_void<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">+</span> theme<span class="punctuation">(</span>axis.line.x.bottom <span class="operator">=</span> element_line<span class="punctuation">(</span>color<span class="operator">=</span><span class="string">&quot;white&quot;</span><span class="punctuation">,</span> size<span class="operator">=</span><span class="number">0.22</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">                              axis.line.y.left <span class="operator">=</span> element_line<span class="punctuation">(</span>color<span class="operator">=</span><span class="string">&quot;white&quot;</span><span class="punctuation">,</span> size<span class="operator">=</span><span class="number">0.22</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span> theme_transparent<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line">p</span><br><span class="line">sticker<span class="punctuation">(</span>p<span class="punctuation">,</span> package<span class="operator">=</span><span class="string">&quot;ggstar&quot;</span><span class="punctuation">,</span> p_size<span class="operator">=</span><span class="number">14</span><span class="punctuation">,</span> s_x<span class="operator">=</span><span class="number">1</span><span class="punctuation">,</span> s_y<span class="operator">=</span><span class="number">.75</span><span class="punctuation">,</span> s_width<span class="operator">=</span><span class="number">1.3</span><span class="punctuation">,</span> s_height<span class="operator">=</span><span class="number">0.68</span><span class="punctuation">,</span></span><br><span class="line">        h_fill<span class="operator">=</span><span class="string">&quot;black&quot;</span><span class="punctuation">,</span> h_color<span class="operator">=</span><span class="string">&quot;#B3B3B3&quot;</span><span class="punctuation">,</span> p_color<span class="operator">=</span><span class="string">&quot;#FFDF00&quot;</span><span class="punctuation">,</span></span><br><span class="line">        filename<span class="operator">=</span><span class="string">&quot;ggstarlog.png&quot;</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment">#package指的是输入字体 p_color字体颜色 h_color边框颜色 h_fill背景</span></span><br></pre></td></tr></table></figure>
<h3 id="chord-diagram">Chord diagram</h3>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#http://houyun.xyz/post/2019/12/08/chord-diagram/</span></span><br><span class="line"><span class="keyword">if</span><span class="punctuation">(</span><span class="operator">!</span>require<span class="punctuation">(</span>devtools<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">  install.packages<span class="punctuation">(</span>devtools<span class="punctuation">)</span></span><br><span class="line">devtools<span class="operator">::</span>install_github<span class="punctuation">(</span><span class="string">&quot;houyunhuang/nivochord&quot;</span><span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>nivochord<span class="punctuation">)</span></span><br><span class="line">nivochord<span class="punctuation">(</span>data.matrix<span class="punctuation">(</span>mtcars<span class="punctuation">[</span><span class="number">1</span><span class="operator">:</span><span class="number">8</span><span class="punctuation">,</span> <span class="number">1</span><span class="operator">:</span><span class="number">8</span><span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">,</span> <span class="built_in">LETTERS</span><span class="punctuation">[</span><span class="number">1</span><span class="operator">:</span><span class="number">8</span><span class="punctuation">]</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment">#第一个参数是类矩阵的数据，需要是行列数相等，且都是数值型，</span></span><br><span class="line"><span class="comment">#第二个参数keys是每个类的名称，若为NULL，赋值为第一个参数的行名或者列名。</span></span><br><span class="line">library<span class="punctuation">(</span>RColorBrewer<span class="punctuation">)</span></span><br><span class="line">m <span class="operator">&lt;-</span> matrix<span class="punctuation">(</span>runif<span class="punctuation">(</span><span class="number">36</span><span class="punctuation">)</span><span class="punctuation">,</span> ncol <span class="operator">=</span> <span class="number">6</span><span class="punctuation">)</span></span><br><span class="line">rownames<span class="punctuation">(</span>m<span class="punctuation">)</span> <span class="operator">&lt;-</span> paste0<span class="punctuation">(</span><span class="string">&quot;row&quot;</span><span class="punctuation">,</span> <span class="number">1</span><span class="operator">:</span><span class="number">6</span><span class="punctuation">)</span></span><br><span class="line">col <span class="operator">&lt;-</span> brewer.pal<span class="punctuation">(</span><span class="number">3</span><span class="punctuation">,</span> <span class="string">&quot;Set2&quot;</span><span class="punctuation">)</span></span><br><span class="line">nivochord<span class="punctuation">(</span>m<span class="punctuation">,</span> colors <span class="operator">=</span> col<span class="punctuation">)</span></span><br><span class="line">nivochord<span class="punctuation">(</span>m<span class="punctuation">,</span> colors <span class="operator">=</span> col<span class="punctuation">,</span> innerRadiusRatio <span class="operator">=</span> <span class="number">0.8</span><span class="punctuation">)</span><span class="comment">#innerRadiusOffset = 0.05;innerRadiusOffset用来控制ribbon和圆环之间的距离，默认是0。</span></span><br><span class="line"><span class="comment">#innerRadiusRatio用来控制内部（ribbon）所在区域的比较，</span></span><br><span class="line"><span class="comment">#默认是0.9（即90%），这里我们设置成0.8，圆环宽度就相应的变大了。</span></span><br><span class="line"><span class="comment">#padAngle = 0.05 padAngle参数比较好玩，可以在每个小的圆环之间增加空白</span></span><br><span class="line"><span class="comment">#margin = .margin(90, 60, 10, 60)四个参数分别是下、左上、右四个方位的空白，单位是像素（px）。</span></span><br><span class="line">colors <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;red&quot;</span><span class="punctuation">,</span> <span class="string">&quot;blue&quot;</span><span class="punctuation">,</span> <span class="string">&quot;yellow&quot;</span><span class="punctuation">)</span></span><br><span class="line">nivochord<span class="punctuation">(</span>m<span class="punctuation">,</span> colors <span class="operator">=</span> colors<span class="punctuation">,</span> legends <span class="operator">=</span> .legends<span class="punctuation">(</span>anchor <span class="operator">=</span> <span class="string">&quot;top&quot;</span><span class="punctuation">,</span></span><br><span class="line">                                                 translateY <span class="operator">=</span> <span class="operator">-</span><span class="number">45</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="maptree">Maptree</h3>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#导入otu表格</span></span><br><span class="line">otu <span class="operator">=</span> read.delim<span class="punctuation">(</span><span class="string">&quot;./otutab.txt&quot;</span><span class="punctuation">,</span>row.names <span class="operator">=</span> <span class="number">1</span><span class="punctuation">)</span></span><br><span class="line">head<span class="punctuation">(</span>otu<span class="punctuation">)</span></span><br><span class="line">otu <span class="operator">=</span> as.matrix<span class="punctuation">(</span>otu<span class="punctuation">)</span></span><br><span class="line"><span class="comment"># str(otu)</span></span><br><span class="line"><span class="comment">#导入注释文件</span></span><br><span class="line">tax <span class="operator">=</span> read.delim<span class="punctuation">(</span><span class="string">&quot;./taxonomy.txt&quot;</span><span class="punctuation">,</span>row.names <span class="operator">=</span> <span class="number">1</span><span class="punctuation">)</span></span><br><span class="line">head<span class="punctuation">(</span>tax<span class="punctuation">)</span></span><br><span class="line"><span class="comment">#将物种注释文件转化为矩阵，方便使用phyloseq封装</span></span><br><span class="line">tax <span class="operator">=</span> as.matrix<span class="punctuation">(</span>tax<span class="punctuation">)</span></span><br><span class="line"><span class="comment">#基本函数，画出maptree</span></span><br><span class="line">mapdata <span class="operator">=</span> data_to_maptree <span class="punctuation">(</span>otu<span class="punctuation">,</span>tax<span class="punctuation">,</span><span class="number">200</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment">#参数N代表选取OTU的数量（按照丰度排序，选取丰度最高的前N个OTU做展示），这里我设置N = 200</span></span><br><span class="line"><span class="comment">#提取图形部分并保存</span></span><br><span class="line">p1<span class="operator">=</span> mapdata<span class="punctuation">[[</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">]</span></span><br><span class="line">p1</span><br><span class="line">ggsave<span class="punctuation">(</span><span class="string">&quot;./maptree1.pdf&quot;</span><span class="punctuation">,</span> p1<span class="punctuation">,</span> width <span class="operator">=</span> <span class="number">12</span><span class="punctuation">,</span> height <span class="operator">=</span><span class="number">10</span> <span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#按照物种分类信息上色</span></span><br><span class="line"><span class="comment">#按照平均丰度修改大小和按照门水平上色颜色</span></span><br><span class="line">mapadd <span class="operator">=</span> maptree_add1_plot<span class="punctuation">(</span>mapdata<span class="punctuation">)</span></span><br><span class="line">p2 <span class="operator">=</span> mapadd<span class="punctuation">[[</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">]</span></span><br><span class="line">p2</span><br><span class="line"><span class="comment">#d导出ggplot对象的优点就是可以随心所欲的修改图形上的内容</span></span><br><span class="line">p2 <span class="operator">+</span>scale_fill_brewer<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment"># p2 + scale_color_gradient2()</span></span><br><span class="line">ggsave<span class="punctuation">(</span><span class="string">&quot;./maptree.pdf&quot;</span><span class="punctuation">,</span> p2<span class="punctuation">,</span> width <span class="operator">=</span> <span class="number">12</span><span class="punctuation">,</span> height <span class="operator">=</span><span class="number">10</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#ggraph版本的物种分类树</span></span><br><span class="line">graph <span class="operator">=</span> mapadd<span class="punctuation">[[</span><span class="number">2</span><span class="punctuation">]</span><span class="punctuation">]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#展示物种分类关系</span></span><br><span class="line">ggraph<span class="punctuation">(</span>graph<span class="punctuation">,</span> <span class="string">&#x27;dendrogram&#x27;</span><span class="punctuation">,</span> circular <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_edge_elbow<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">   scale_edge_colour_distiller<span class="punctuation">(</span>palette <span class="operator">=</span> <span class="string">&quot;RdPu&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_node_point<span class="punctuation">(</span>aes<span class="punctuation">(</span> x <span class="operator">=</span> x<span class="punctuation">,</span> y<span class="operator">=</span>y<span class="punctuation">,</span> filter <span class="operator">=</span> leaf<span class="punctuation">,</span>size<span class="operator">=</span>mean<span class="punctuation">,</span>colour<span class="operator">=</span>Phylum<span class="punctuation">,</span> alpha<span class="operator">=</span><span class="number">0.2</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_node_text<span class="punctuation">(</span>aes<span class="punctuation">(</span>x <span class="operator">=</span> x<span class="operator">*</span><span class="number">1.05</span><span class="punctuation">,</span> y<span class="operator">=</span>y<span class="operator">*</span><span class="number">1.05</span><span class="punctuation">,</span> filter <span class="operator">=</span> leaf<span class="punctuation">,</span> label<span class="operator">=</span>name<span class="punctuation">,</span></span><br><span class="line">   hjust<span class="operator">=</span><span class="string">&#x27;outward&#x27;</span><span class="punctuation">,</span> angle <span class="operator">=</span> <span class="operator">-</span><span class="punctuation">(</span><span class="punctuation">(</span><span class="operator">-</span>node_angle<span class="punctuation">(</span>x<span class="punctuation">,</span> y<span class="punctuation">)</span><span class="operator">+</span><span class="number">90</span><span class="punctuation">)</span><span class="operator">%%</span><span class="number">180</span><span class="punctuation">)</span><span class="operator">+</span><span class="number">90</span><span class="punctuation">,</span> size<span class="operator">=</span><span class="number">3</span><span class="punctuation">,</span></span><br><span class="line">   colour<span class="operator">=</span>Phylum<span class="punctuation">)</span><span class="punctuation">,</span> size<span class="operator">=</span><span class="number">0.8</span><span class="punctuation">,</span> alpha<span class="operator">=</span><span class="number">1</span><span class="punctuation">)</span>  <span class="operator">+</span> theme_void<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#另一种形式</span></span><br><span class="line">graph <span class="operator">=</span> mapadd<span class="punctuation">[[</span><span class="number">2</span><span class="punctuation">]</span><span class="punctuation">]</span></span><br><span class="line"><span class="comment"># data = create_layout(graph, layout = &#x27;dendrogram&#x27;, circular = TRUE)</span></span><br><span class="line"><span class="comment"># head(data)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#展示为无数种分类树，这种方式也是我知道</span></span><br><span class="line">ggraph<span class="punctuation">(</span>graph<span class="punctuation">,</span> layout <span class="operator">=</span> <span class="string">&#x27;dendrogram&#x27;</span><span class="punctuation">,</span> circular <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">   geom_edge_diagonal<span class="punctuation">(</span>colour<span class="operator">=</span><span class="string">&quot;blue&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">   scale_edge_colour_distiller<span class="punctuation">(</span>palette <span class="operator">=</span> <span class="string">&quot;RdPu&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_node_point<span class="punctuation">(</span>aes<span class="punctuation">(</span> x <span class="operator">=</span> x<span class="punctuation">,</span> y<span class="operator">=</span>y<span class="punctuation">,</span> filter <span class="operator">=</span> leaf<span class="punctuation">,</span>size<span class="operator">=</span>mean<span class="punctuation">,</span>colour<span class="operator">=</span>Phylum<span class="punctuation">,</span> alpha<span class="operator">=</span><span class="number">0.2</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_node_text<span class="punctuation">(</span>aes<span class="punctuation">(</span>x <span class="operator">=</span> x<span class="operator">*</span><span class="number">1.05</span><span class="punctuation">,</span> y<span class="operator">=</span>y<span class="operator">*</span><span class="number">1.05</span><span class="punctuation">,</span> filter <span class="operator">=</span> leaf<span class="punctuation">,</span> label<span class="operator">=</span>name<span class="punctuation">,</span></span><br><span class="line">   hjust<span class="operator">=</span><span class="string">&#x27;outward&#x27;</span><span class="punctuation">,</span> angle <span class="operator">=</span> <span class="operator">-</span><span class="punctuation">(</span><span class="punctuation">(</span><span class="operator">-</span>node_angle<span class="punctuation">(</span>x<span class="punctuation">,</span> y<span class="punctuation">)</span><span class="operator">+</span><span class="number">90</span><span class="punctuation">)</span><span class="operator">%%</span><span class="number">180</span><span class="punctuation">)</span><span class="operator">+</span><span class="number">90</span><span class="punctuation">,</span> size<span class="operator">=</span><span class="number">3</span><span class="punctuation">,</span></span><br><span class="line">   colour<span class="operator">=</span>Phylum<span class="punctuation">)</span><span class="punctuation">,</span> size<span class="operator">=</span><span class="number">0.5</span><span class="punctuation">,</span> alpha<span class="operator">=</span><span class="number">1</span><span class="punctuation">)</span>  <span class="operator">+</span> theme_void<span class="punctuation">(</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<h3 id="3d柱状图">3D柱状图</h3>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">set.seed<span class="punctuation">(</span><span class="number">1234</span><span class="punctuation">)</span></span><br><span class="line">data <span class="operator">&lt;-</span> data.frame<span class="punctuation">(</span>a <span class="operator">=</span> sample<span class="punctuation">(</span><span class="number">1</span><span class="operator">:</span><span class="number">50</span><span class="punctuation">,</span> <span class="number">10</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">                                       b <span class="operator">=</span> sample<span class="punctuation">(</span><span class="number">1</span><span class="operator">:</span><span class="number">50</span><span class="punctuation">,</span> <span class="number">10</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">                                       <span class="built_in">c</span> <span class="operator">=</span> sample<span class="punctuation">(</span><span class="number">1</span><span class="operator">:</span><span class="number">50</span><span class="punctuation">,</span> <span class="number">10</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">                                       d <span class="operator">=</span> sample<span class="punctuation">(</span><span class="number">1</span><span class="operator">:</span><span class="number">50</span><span class="punctuation">,</span> <span class="number">10</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">rownames<span class="punctuation">(</span>data<span class="punctuation">)</span> <span class="operator">&lt;-</span> <span class="built_in">LETTERS</span><span class="punctuation">[</span><span class="number">1</span><span class="operator">:</span><span class="number">10</span><span class="punctuation">]</span></span><br><span class="line">library<span class="punctuation">(</span>rgl<span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>barplot3d<span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>RColorBrewer<span class="punctuation">)</span></span><br><span class="line">install.packages<span class="punctuation">(</span><span class="string">&#x27;barplot3d&#x27;</span><span class="punctuation">)</span></span><br><span class="line">barplot3d<span class="punctuation">(</span>rows <span class="operator">=</span> <span class="number">10</span><span class="punctuation">,</span> cols <span class="operator">=</span> <span class="number">4</span><span class="punctuation">,</span> <span class="comment">#先根据数据构造一个画图矩阵</span></span><br><span class="line">                    <span class="comment">#画图要用的数据，必须是matrix类型</span></span><br><span class="line">                  z <span class="operator">=</span> data <span class="operator">%&gt;%</span> as.matrix<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="comment">#展示角度，正面观</span></span><br><span class="line">                    theta<span class="operator">=</span><span class="number">30</span><span class="punctuation">,</span></span><br><span class="line">                   <span class="comment">#展示角度，顶面观（出的图是可旋转的，所以这些都无关紧要）</span></span><br><span class="line">                    phi<span class="operator">=</span><span class="number">30</span><span class="punctuation">,</span></span><br><span class="line">                  <span class="comment">#调整出图的高矮胖瘦的，挺重要！</span></span><br><span class="line">                    scalexy<span class="operator">=</span><span class="number">20</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="comment">#柱子（什么鬼）的侧面颜色，可调整透明度</span></span><br><span class="line">                    sidecolors<span class="operator">=</span>brewer.pal<span class="punctuation">(</span><span class="number">4</span><span class="punctuation">,</span><span class="string">&quot;Dark2&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span> alpha<span class="operator">=</span><span class="number">0.4</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="comment">#顶面颜色</span></span><br><span class="line">                    topcolors <span class="operator">=</span> brewer.pal<span class="punctuation">(</span><span class="number">4</span><span class="punctuation">,</span><span class="string">&quot;Dark2&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="comment">#x轴刻度标注，向量形式</span></span><br><span class="line">                    xlabels <span class="operator">=</span> colnames<span class="punctuation">(</span>data<span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="comment">#y轴刻度标注，向量形式</span></span><br><span class="line">                    ylabels <span class="operator">=</span> rownames<span class="punctuation">(</span>data<span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">                   <span class="comment">#z轴刻度，逻辑值</span></span><br><span class="line">                    zlabels <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#再用barplot包里的测试数据画个“乐高图”</span></span><br><span class="line">x<span class="operator">=</span>system.file<span class="punctuation">(</span><span class="string">&quot;extdata&quot;</span><span class="punctuation">,</span> <span class="string">&quot;signature_probabilities.txt&quot;</span><span class="punctuation">,</span> package <span class="operator">=</span> <span class="string">&quot;barplot3d&quot;</span><span class="punctuation">)</span></span><br><span class="line">sigdata<span class="operator">=</span>read.table<span class="punctuation">(</span>x<span class="punctuation">,</span>header<span class="operator">=</span><span class="literal">TRUE</span><span class="punctuation">,</span>stringsAsFactors <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Plot signature 2 without axis labels, with Sanger colors and some transparency so we can see all bars</span></span><br><span class="line">legoplot3d<span class="punctuation">(</span>contextdata<span class="operator">=</span>sigdata<span class="operator">$</span>Signature_7<span class="punctuation">,</span></span><br><span class="line">                      labels<span class="operator">=</span><span class="literal">FALSE</span><span class="punctuation">,</span></span><br><span class="line">                       scalexy<span class="operator">=</span><span class="number">0.01</span><span class="punctuation">,</span></span><br><span class="line">                      sixcolors<span class="operator">=</span><span class="string">&quot;sanger&quot;</span><span class="punctuation">,</span></span><br><span class="line">                       alpha<span class="operator">=</span><span class="number">0.4</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<h3 id="dotplot气球图">Dotplot气球图</h3>
<p><a target="_blank" rel="noopener" href="http://rpkgs.datanovia.com/ggpubr/reference/ggballoonplot.html">balloonplot</a></p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#第一种就是简单的用ggplot画的散点图</span></span><br><span class="line">setwd<span class="punctuation">(</span><span class="string">&#x27;./Script/Dot_plot/&#x27;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 加载ggplot2包</span></span><br><span class="line">library<span class="punctuation">(</span>ggplot2<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#读入数据</span></span><br><span class="line">dt<span class="operator">&lt;-</span>read.table<span class="punctuation">(</span><span class="string">&quot;testdata.txt&quot;</span><span class="punctuation">,</span>sep <span class="operator">=</span> <span class="string">&quot;\t&quot;</span><span class="punctuation">,</span>header <span class="operator">=</span> <span class="built_in">T</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#查看数据框dt的前6行</span></span><br><span class="line">head<span class="punctuation">(</span>dt<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#加载reshape2包</span></span><br><span class="line">library<span class="punctuation">(</span>reshape2<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#将“宽型”数据框转成“长型”数据框</span></span><br><span class="line">dt2<span class="operator">&lt;-</span>melt<span class="punctuation">(</span>dt<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#查看数据框dt2的前6行</span></span><br><span class="line">head<span class="punctuation">(</span>dt2<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#指定纵轴标签顺序</span></span><br><span class="line">dt2<span class="operator">$</span>Genus<span class="operator">&lt;-</span>factor<span class="punctuation">(</span>dt2<span class="operator">$</span>Genus<span class="punctuation">,</span>levels <span class="operator">=</span> rev<span class="punctuation">(</span>unique<span class="punctuation">(</span>dt2<span class="operator">$</span>Genus<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">,</span>ordered <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#绘制正方形“点”，带描边</span></span><br><span class="line">p1<span class="operator">&lt;-</span>ggplot<span class="punctuation">(</span>dt2<span class="punctuation">,</span> aes<span class="punctuation">(</span>variable<span class="punctuation">,</span> Genus<span class="punctuation">)</span><span class="punctuation">)</span><span class="operator">+</span>geom_point<span class="punctuation">(</span>aes<span class="punctuation">(</span>size<span class="operator">=</span>value<span class="punctuation">)</span><span class="punctuation">,</span>shape<span class="operator">=</span><span class="number">22</span><span class="punctuation">,</span>color<span class="operator">=</span><span class="string">&quot;steelblue&quot;</span><span class="punctuation">,</span>fill<span class="operator">=</span><span class="string">&quot;white&quot;</span><span class="punctuation">)</span></span><br><span class="line">p1</span><br><span class="line"></span><br><span class="line"><span class="comment">#绘制“圆点”，不带描边颜色</span></span><br><span class="line">p2<span class="operator">&lt;-</span>ggplot<span class="punctuation">(</span>dt2<span class="punctuation">,</span> aes<span class="punctuation">(</span>variable<span class="punctuation">,</span> Genus<span class="punctuation">)</span><span class="punctuation">)</span><span class="operator">+</span>geom_point<span class="punctuation">(</span>aes<span class="punctuation">(</span>size<span class="operator">=</span>value<span class="punctuation">)</span><span class="punctuation">,</span>shape<span class="operator">=</span><span class="number">16</span><span class="punctuation">,</span>color<span class="operator">=</span><span class="string">&quot;steelblue&quot;</span><span class="punctuation">)</span></span><br><span class="line">p2</span><br><span class="line"></span><br><span class="line"><span class="comment">#建立颜色与数据的关系,这里让不同的样本的点显示不同的颜色</span></span><br><span class="line">p3<span class="operator">&lt;-</span>ggplot<span class="punctuation">(</span>dt2<span class="punctuation">,</span> aes<span class="punctuation">(</span>variable<span class="punctuation">,</span> Genus<span class="punctuation">)</span><span class="punctuation">)</span><span class="operator">+</span>geom_point<span class="punctuation">(</span>aes<span class="punctuation">(</span>size<span class="operator">=</span>value<span class="punctuation">,</span>color<span class="operator">=</span>variable<span class="punctuation">)</span><span class="punctuation">,</span>shape<span class="operator">=</span><span class="number">16</span><span class="punctuation">)</span></span><br><span class="line">p3</span><br><span class="line"></span><br><span class="line"><span class="comment">#自定义颜色，这里使用RColorBrewer的颜色集</span></span><br><span class="line">p4<span class="operator">&lt;-</span>p3<span class="operator">+</span>scale_color_brewer<span class="punctuation">(</span>palette<span class="operator">=</span><span class="string">&quot;Dark2&quot;</span><span class="punctuation">)</span></span><br><span class="line">p4</span><br><span class="line"></span><br><span class="line"><span class="comment">#更改图表的主题，实现类似iTOL的点状图效果</span></span><br><span class="line">p5<span class="operator">&lt;-</span>p4<span class="operator">+</span>theme_minimal<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line">p5</span><br><span class="line"></span><br><span class="line"><span class="comment">#不想要网格线也可以去掉，甚至图例也可用legend.position = &quot;none&quot;去掉</span></span><br><span class="line">p6<span class="operator">&lt;-</span>p5<span class="operator">+</span>theme<span class="punctuation">(</span>panel.grid <span class="operator">=</span> element_blank<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">p6</span><br><span class="line"></span><br><span class="line"><span class="comment">#保存图表为pdf格式</span></span><br><span class="line">ggsave<span class="punctuation">(</span><span class="string">&quot;p6.pdf&quot;</span><span class="punctuation">,</span>width <span class="operator">=</span> <span class="number">4.4</span><span class="punctuation">,</span>height <span class="operator">=</span> <span class="number">6</span><span class="punctuation">,</span>units <span class="operator">=</span> <span class="string">&quot;in&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#第二种就是用ggpubr中的函数画气球图</span></span><br><span class="line">my_cols <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;#0D0887FF&quot;</span><span class="punctuation">,</span> <span class="string">&quot;#6A00A8FF&quot;</span><span class="punctuation">,</span> <span class="string">&quot;#B12A90FF&quot;</span><span class="punctuation">,</span></span><br><span class="line">             <span class="string">&quot;#E16462FF&quot;</span><span class="punctuation">,</span> <span class="string">&quot;#FCA636FF&quot;</span><span class="punctuation">,</span> <span class="string">&quot;#F0F921FF&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">library<span class="punctuation">(</span>ggpubr<span class="punctuation">)</span></span><br><span class="line">data <span class="operator">&lt;-</span> read.delim<span class="punctuation">(</span></span><br><span class="line">  system.file<span class="punctuation">(</span><span class="string">&quot;demo-data/housetasks.txt&quot;</span><span class="punctuation">,</span> package <span class="operator">=</span> <span class="string">&quot;ggpubr&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">  row.names <span class="operator">=</span> <span class="number">1</span></span><br><span class="line"><span class="punctuation">)</span></span><br><span class="line">data </span><br><span class="line">ggballoonplot<span class="punctuation">(</span>data<span class="punctuation">)</span></span><br><span class="line"><span class="comment">#试试上述的图</span></span><br><span class="line">dt<span class="operator">%&gt;%</span>tibble<span class="operator">::</span>column_to_rownames<span class="punctuation">(</span><span class="string">&#x27;Genus&#x27;</span><span class="punctuation">)</span> <span class="operator">%&gt;%</span> ggballoonplot<span class="punctuation">(</span>.<span class="punctuation">,</span>fill <span class="operator">=</span> <span class="string">&quot;value&quot;</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  scale_fill_gradientn<span class="punctuation">(</span>colors <span class="operator">=</span> my_cols<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#加上颜色</span></span><br><span class="line">ggballoonplot<span class="punctuation">(</span>data<span class="punctuation">,</span> color <span class="operator">=</span> <span class="string">&quot;#0073C2FF&quot;</span><span class="punctuation">,</span> fill <span class="operator">=</span> <span class="string">&quot;#0073C2FF&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Change color according to the value of table cells</span></span><br><span class="line">ggballoonplot<span class="punctuation">(</span>data<span class="punctuation">,</span> fill <span class="operator">=</span> <span class="string">&quot;value&quot;</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  scale_fill_gradientn<span class="punctuation">(</span>colors <span class="operator">=</span> my_cols<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Change the plotting symbol shape</span></span><br><span class="line">ggballoonplot<span class="punctuation">(</span>data<span class="punctuation">,</span> fill <span class="operator">=</span> <span class="string">&quot;value&quot;</span><span class="punctuation">,</span>  shape <span class="operator">=</span> <span class="number">23</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  gradient_fill<span class="punctuation">(</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;blue&quot;</span><span class="punctuation">,</span> <span class="string">&quot;white&quot;</span><span class="punctuation">,</span> <span class="string">&quot;red&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Set points size to 8, but change fill color by values</span></span><br><span class="line"><span class="comment"># Sow labels</span></span><br><span class="line">ggballoonplot<span class="punctuation">(</span>data<span class="punctuation">,</span> fill <span class="operator">=</span> <span class="string">&quot;value&quot;</span><span class="punctuation">,</span> color <span class="operator">=</span> <span class="string">&quot;lightgray&quot;</span><span class="punctuation">,</span></span><br><span class="line">              size <span class="operator">=</span> <span class="number">10</span><span class="punctuation">,</span> show.label <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  gradient_fill<span class="punctuation">(</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;blue&quot;</span><span class="punctuation">,</span> <span class="string">&quot;white&quot;</span><span class="punctuation">,</span> <span class="string">&quot;red&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="http://genewlan.github.io">ZhangLei</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://genewlan.github.io/2023/10/31/ggplot-picture/">http://genewlan.github.io/2023/10/31/ggplot-picture/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://genewlan.github.io" target="_blank">GeneWlan</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/ggplot/">ggplot</a></div><div class="post_share"><div class="social-share" data-image="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2023/11/30/Transformer/" title="Transformer"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Transformer</div></div></a></div><div class="next-post pull-right"><a href="/2023/10/31/picture/" title="50_ggplot_picture"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">50_ggplot_picture</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2023/10/31/picture/" title="50_ggplot_picture"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-10-31</div><div class="title">50_ggplot_picture</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">ZhangLei</div><div class="author-info__description">change or die!</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">30</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">23</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/genewlan/" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:xiaolobglee@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#none"><span class="toc-number">1.</span> <span class="toc-text"></span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%A4%E7%BB%84%E6%98%BE%E8%91%97%E6%80%A7%E5%B7%AE%E5%BC%82%E5%9B%BE"><span class="toc-number">1.1.</span> <span class="toc-text">两组显著性差异图**</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%8E%E5%A4%ABpie%E5%9B%BE"><span class="toc-number">1.2.</span> <span class="toc-text">华夫pie图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#none"><span class="toc-number">1.3.</span> <span class="toc-text"></span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9B%B7%E8%BE%BE%E5%9B%BE"><span class="toc-number">1.4.</span> <span class="toc-text">雷达图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%91%E6%95%A3%E6%80%A7%E6%AD%A3%E8%B4%9F%E5%9B%BE"><span class="toc-number">1.5.</span> <span class="toc-text">发散性正负图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#bee%E8%9C%9C%E8%9C%82%E5%9B%BE"><span class="toc-number">1.6.</span> <span class="toc-text">bee蜜蜂图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#beanplot-%E8%B1%86%E8%8D%9A%E5%9B%BE"><span class="toc-number">1.7.</span> <span class="toc-text">BeanPlot(豆荚图)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#none"><span class="toc-number">1.8.</span> <span class="toc-text"></span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%B4%E6%96%B9%E5%9B%BE"><span class="toc-number">1.9.</span> <span class="toc-text">直方图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%83%AD%E5%9B%BE"><span class="toc-number">1.10.</span> <span class="toc-text">热图</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AF%B9%E8%A7%92%E7%BA%BF%E7%83%AD%E5%9B%BE"><span class="toc-number">1.10.1.</span> <span class="toc-text">对角线热图</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%8E%AF%E7%8A%B6%E7%83%AD%E5%9B%BE"><span class="toc-number">1.10.2.</span> <span class="toc-text">环状热图</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#heatmap-pheatmap%E7%83%AD%E5%9B%BE"><span class="toc-number">1.10.3.</span> <span class="toc-text">heatmap&amp;pheatmap热图</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E6%80%A7%E7%83%AD%E5%9B%BE-ggcor%E5%8C%85"><span class="toc-number">1.10.4.</span> <span class="toc-text">相关性热图 (ggcor包)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ggcor%E5%8C%85%E7%BB%84%E5%90%88%E7%9B%B8%E5%85%B3%E7%9F%A9%E9%98%B5%E5%92%8Cmantel%E7%9B%B8"><span class="toc-number">1.10.5.</span> <span class="toc-text">ggcor包组合相关矩阵和Mantel相</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%A1%E7%AE%97alpha%E5%A4%9A%E6%A0%B7%E6%80%A7%E6%8C%87%E6%95%B0"><span class="toc-number">1.11.</span> <span class="toc-text">计算Alpha多样性指数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#go%E6%9D%A1%E5%BD%A2%E5%9B%BE-%E6%B0%94%E6%B3%A1%E5%9B%BE"><span class="toc-number">1.12.</span> <span class="toc-text">Go条形图&amp;气泡图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%8C%E9%9B%86%E6%B0%94%E6%B3%A1%E5%9B%BE"><span class="toc-number">1.13.</span> <span class="toc-text">富集气泡图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%81%AB%E5%B1%B1%E5%9B%BE"><span class="toc-number">1.14.</span> <span class="toc-text">火山图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#deseq2"><span class="toc-number">1.15.</span> <span class="toc-text">Deseq2</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%95%9C%E9%9D%A2%E6%9F%B1%E5%BD%A2%E5%9B%BE"><span class="toc-number">1.16.</span> <span class="toc-text">镜面柱形图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%B0%E5%BA%A6%E9%A5%BC%E5%9B%BE"><span class="toc-number">1.17.</span> <span class="toc-text">丰度饼图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#venn%E5%9B%BE"><span class="toc-number">1.18.</span> <span class="toc-text">Venn图</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%88%E5%88%B6%E4%BD%9C%E5%88%86%E7%BB%84%E6%96%87%E4%BB%B6-%E8%BE%93%E5%85%A5otu%E8%A1%A8%E7%B1%BB%E5%9E%8B%E6%96%87%E4%BB%B6"><span class="toc-number">1.18.1.</span> <span class="toc-text">先制作分组文件  输入OTU表类型文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%B6%E4%BD%9Cvenn%E5%9B%BE"><span class="toc-number">1.18.2.</span> <span class="toc-text">制作Venn图</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%92%E5%BA%8F%E7%B1%BB%E5%9E%8B%E5%9B%BE"><span class="toc-number">1.19.</span> <span class="toc-text">排序类型图</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#pls-da%E5%88%86%E6%9E%90"><span class="toc-number">1.19.1.</span> <span class="toc-text">PLS-DA分析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#nmds%E5%88%86%E6%9E%90"><span class="toc-number">1.19.2.</span> <span class="toc-text">NMDS分析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#apcoa%E5%88%86%E6%9E%90"><span class="toc-number">1.19.3.</span> <span class="toc-text">aPCOA分析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#pcoa%E5%88%86%E6%9E%90"><span class="toc-number">1.19.4.</span> <span class="toc-text">PCOA分析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#pca%E5%88%86%E6%9E%90"><span class="toc-number">1.19.5.</span> <span class="toc-text">PCA分析</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BE%A4%E8%90%BDbar%E5%9B%BE"><span class="toc-number">1.20.</span> <span class="toc-text">群落bar图</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%A6%E8%81%9A%E7%B1%BB%E6%A0%91%E7%9A%84bar%E5%9B%BE"><span class="toc-number">1.20.1.</span> <span class="toc-text">带聚类树的bar图</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A0%86%E5%8F%A0%E9%9D%A2%E7%A7%AF%E5%9B%BE"><span class="toc-number">1.20.2.</span> <span class="toc-text">堆叠面积图</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%B0%E5%BA%A6%E6%98%9F%E6%98%9F%E5%9B%BE"><span class="toc-number">1.20.3.</span> <span class="toc-text">丰度星星图</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9C%86%E8%A7%92%E6%9F%B1%E5%BD%A2%E5%9B%BE"><span class="toc-number">1.20.4.</span> <span class="toc-text">圆角柱形图</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%B9%E9%87%8F%E5%B7%AE%E5%BC%82%E6%A3%80%E9%AA%8C"><span class="toc-number">1.21.</span> <span class="toc-text">批量差异检验</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%98%E5%88%B6%E7%AE%B1%E7%BA%BF%E5%9B%BE"><span class="toc-number">1.22.</span> <span class="toc-text">绘制箱线图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9B%BC%E5%93%88%E9%A1%BF%E5%9B%BE"><span class="toc-number">1.23.</span> <span class="toc-text">曼哈顿图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A1%91%E8%91%9A%E5%9B%BE"><span class="toc-number">1.24.</span> <span class="toc-text">桑葚图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%A3%E7%82%B9%E5%9B%BE"><span class="toc-number">1.25.</span> <span class="toc-text">散点图</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#ggsymbol%E7%BB%98%E5%88%B6%E6%9B%B4%E5%A4%9A%E7%82%B9%E6%A0%B7%E5%BC%8F"><span class="toc-number">1.25.1.</span> <span class="toc-text">ggsymbol绘制更多点样式</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AE%B1%E7%BA%BF%E5%9B%BE%E5%92%8C%E5%B0%8F%E6%8F%90%E7%90%B4%E5%9B%BE"><span class="toc-number">1.26.</span> <span class="toc-text">箱线图和小提琴图</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#ggplot2%E9%85%8D%E5%AF%B9%E6%95%A3%E7%82%B9%E7%AE%B1%E7%BA%BF%E5%9B%BE"><span class="toc-number">1.26.1.</span> <span class="toc-text">ggplot2配对散点箱线图</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AE%B1%E7%BA%BF%E5%9B%BE%E5%AE%9E%E4%BE%8B"><span class="toc-number">1.26.2.</span> <span class="toc-text">箱线图实例</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ggpubr%E7%AE%B1%E7%BA%BF%E5%9B%BE"><span class="toc-number">1.26.3.</span> <span class="toc-text">ggpubr箱线图</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#anosim%E5%88%86%E6%9E%90"><span class="toc-number">1.27.</span> <span class="toc-text">Anosim分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E9%9D%A2%E6%9F%B1%E7%8A%B6%E5%9B%BE"><span class="toc-number">1.28.</span> <span class="toc-text">分面柱状图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#id%E8%BD%AC%E6%8D%A2"><span class="toc-number">1.29.</span> <span class="toc-text">ID转换</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A8%80%E9%87%8A-%E7%B4%AF%E7%A7%AF%E6%9B%B2%E7%BA%BF%E5%92%8Crank-abundance"><span class="toc-number">1.30.</span> <span class="toc-text">稀释、累积曲线和Rank_abundance</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#pls-da%E6%9C%80%E5%B0%8F%E4%BA%8C%E4%B9%98%E6%B3%95%E5%88%86%E6%9E%90"><span class="toc-number">1.31.</span> <span class="toc-text">pls_da最小二乘法分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%89%A9%E7%A7%8D%E4%B8%B0%E5%BA%A6%E5%85%B3%E8%81%94%E5%BC%A6%E5%9B%BE"><span class="toc-number">1.32.</span> <span class="toc-text">物种丰度关联弦图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%98%E5%88%B6%E7%BB%86%E8%8F%8C%E5%9F%BA%E5%9B%A0%E7%BB%84%E9%87%8D%E6%B5%8B%E5%BA%8F%E5%8F%98%E5%BC%82%E5%9C%88%E5%9B%BE"><span class="toc-number">1.33.</span> <span class="toc-text">绘制细菌基因组重测序变异圈图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89%E5%85%83%E7%9B%B8%E5%9B%BE"><span class="toc-number">1.34.</span> <span class="toc-text">三元相图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%9F%E5%AD%98%E6%9B%B2%E7%BA%BF%E5%9B%BE"><span class="toc-number">1.35.</span> <span class="toc-text">生存曲线图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A3%8E%E7%8E%AB%E7%91%B0%E5%9B%BE"><span class="toc-number">1.36.</span> <span class="toc-text">风玫瑰图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%B6%E4%BD%9C%E5%85%AD%E8%BE%B9%E5%BD%A2logo"><span class="toc-number">1.37.</span> <span class="toc-text">制作六边形Logo</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#chord-diagram"><span class="toc-number">1.38.</span> <span class="toc-text">Chord diagram</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#maptree"><span class="toc-number">1.39.</span> <span class="toc-text">Maptree</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3d%E6%9F%B1%E7%8A%B6%E5%9B%BE"><span class="toc-number">1.40.</span> <span class="toc-text">3D柱状图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#dotplot%E6%B0%94%E7%90%83%E5%9B%BE"><span class="toc-number">1.41.</span> <span class="toc-text">Dotplot气球图</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/04/30/20244302/" title="20244302_Validation_and_Model_Selection">20244302_Validation_and_Model_Selection</a><time datetime="2024-04-30T10:16:27.000Z" title="发表于 2024-04-30 18:16:27">2024-04-30</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/04/30/20244301/" title="20244301_random forest">20244301_random forest</a><time datetime="2024-04-30T10:16:10.000Z" title="发表于 2024-04-30 18:16:10">2024-04-30</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/03/31/20243312/" title="20243312_PCA">20243312_PCA</a><time datetime="2024-03-31T10:04:12.000Z" title="发表于 2024-03-31 18:04:12">2024-03-31</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/03/31/20243311/" title="20243311_SVM">20243311_SVM</a><time datetime="2024-03-31T10:03:56.000Z" title="发表于 2024-03-31 18:03:56">2024-03-31</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/02/29/20242292/" title="20242292_k-means">20242292_k-means</a><time datetime="2024-02-29T09:43:33.000Z" title="发表于 2024-02-29 17:43:33">2024-02-29</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2023 - 2024 By ZhangLei</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex/dist/katex.min.css"><script src="https://cdn.jsdelivr.net/npm/katex/dist/contrib/copy-tex.min.js"></script><script>(() => {
  document.querySelectorAll('#article-container span.katex-display').forEach(item => {
    btf.wrap(item, 'div', { class: 'katex-wrap'})
  })
})()</script><script>function loadValine () {
  function initValine () {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: 'J0s1l0MeDfMbgw4y4awgy2jX-MdYXbMMI',
      appKey: '3vZoaKxqWQYlKbXXdXuSxBsT',
      avatar: 'monsterid',
      serverURLs: '',
      emojiMaps: "",
      path: window.location.pathname,
      visitor: false
    }, null))
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js').then(initValine)
}

if ('Valine' === 'Valine' || !false) {
  if (false) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div><!-- hexo injector body_end start --><div id="background-effect"></div><script src="https://cdn.jsdelivr.net/npm/three@0.121.1/build/three.min.js"></script><script src="https://cdn.jsdelivr.net/npm/vanta/dist/vanta.birds.min.js"></script><script>VANTA.BIRDS({"el":"#background-effect","mouseControls":true,"touchControls":true,"gyroControls":false,"minHeight":200,"minWidth":200,"scale":1,"scaleMobile":1})</script><!-- hexo injector body_end end --><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","model":{"jsonPath":"/live2dw/assets/wanko.model.json"},"display":{"position":"left","width":150,"height":300},"mobile":{"show":true},"react":{"opacityDefault":1,"opacityOnHover":1},"log":false,"tagMode":false});</script></body></html>